(function(c,r,o,a,s,i,u,m){"use strict";function g(){return o.before("uploadLocalFiles",r.findByProps("uploadLocalFiles"),function(e){if(!a.storage.sendAsVM||e[0].flags==8192)return;const t=e[0].items[0];t.mimeType.startsWith("audio")&&(t.mimeType="audio/ogg",e[0].flags=8192,t.waveform=t.item.waveform="AEtWPyUaGA4OEAcA",t.durationSecs=t.item.durationSecs=60)})}function E(){return o.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("LOAD_MESSAGES_SUCCESS").find(function(e){return e.name==="MessageStore"}),function(e){a.storage.allAsVM&&e[0].messages.forEach(function(t){t.attachments.forEach(function(n){n.content_type?.startsWith?.("audio")&&(t.flags|=8192,n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60)})})})}function h(){return o.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_CREATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!a.storage.allAsVM)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(n){n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60}))})}function S(){return o.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_UPDATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!a.storage.allAsVM)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(n){n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60}))})}const _=r.findByProps("openLazy","hideActionSheet"),y=u.Forms.FormIcon,{FormRow:M}=u.Forms;function v(){return o.before("openLazy",_,function(e){const[t,n,R]=e;n==="MessageLongPressActionSheet"&&t.then(function(P){const D=o.after("default",P,function(U,b){s.React.useEffect(function(){return function(){D()}},[]);let[H,A]=b.props?.children?.props?.children?.props?.children;const d=H?.props?.message??R?.message;!A||!d||d.hasFlag(8192)&&A.splice(5,0,s.React.createElement(M,{label:"Download Voice Message",leading:s.React.createElement(y,{source:i.getAssetIDByName("ic_download_24px")}),onPress:async function(){await r.findByProps("downloadMediaAsset").downloadMediaAsset(d.attachments[0].url,0),r.findByProps("hideActionSheet").hideActionSheet()}}))})})})}const{FormDivider:w,FormIcon:l,FormSwitchRow:f}=u.Forms;function V(){return m.useProxy(a.storage),React.createElement(s.ReactNative.ScrollView,null,React.createElement(f,{label:"Send audio files as Voice Message",leading:React.createElement(l,{source:i.getAssetIDByName("voice_bar_mute_off")}),onValueChange:function(e){return a.storage.sendAsVM=e},value:a.storage.sendAsVM}),React.createElement(w,null),React.createElement(f,{label:"Show every audio file as a Voice Message",leading:React.createElement(l,{source:i.getAssetIDByName("ic_stage_music")}),onValueChange:function(e){return a.storage.allAsVM=e},value:a.storage.allAsVM}))}a.storage.sendAsVM??=!0,a.storage.allAsVM??=!1;const p=[g(),h(),E(),S(),v()],F=function(){p.forEach(function(e){return e()})};return c.onUnload=F,c.settings=V,c})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.storage);
