(function(c,s,r,n,o,i,d,m){"use strict";function g(e){return s.findByProps("getGuildExperimentBucket").getGuildExperimentBucket("2023-01_voice_messages",e)}function E(){return r.before("uploadLocalFiles",s.findByProps("uploadLocalFiles"),function(e){n.storage.sendAsVM&&g(s.findByProps("getLastSelectedGuildId").getGuildId())==1&&e[0].items[0].mimeType.startsWith("audio")&&(e[0].flags=8192,e[0].items[0].item.waveform="AEtWPyUaGA4OEAcA",e[0].items[0].item.durationSecs=60,e[0].items[0].waveform="AEtWPyUaGA4OEAcA",e[0].items[0].durationSecs=60)})}function h(){return r.before("actionHandler",o.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("LOAD_MESSAGES_SUCCESS").find(function(e){return e.name==="MessageStore"}),function(e){n.storage.allAsVM&&e[0].messages.forEach(function(t){t.attachments.forEach(function(a){a.content_type?.startsWith?.("audio")&&(t.flags|=8192,a.waveform="AEtWPyUaGA4OEAcA",a.duration_secs=60)})})})}function y(){return r.before("actionHandler",o.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_CREATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!n.storage.allAsVM)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(a){a.waveform="AEtWPyUaGA4OEAcA",a.duration_secs=60}))})}function S(){return r.before("actionHandler",o.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_UPDATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!n.storage.allAsVM)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(a){a.waveform="AEtWPyUaGA4OEAcA",a.duration_secs=60}))})}const _=s.findByProps("openLazy","hideActionSheet"),M=s.findByName("Icon"),{FormRow:p}=d.Forms;function v(){return r.before("openLazy",_,function(e){const[t,a,B]=e;a==="MessageLongPressActionSheet"&&t.then(function(F){const G=r.after("default",F,function(b,D){o.React.useEffect(function(){return function(){G()}},[]);let[U,A]=D.props?.children?.props?.children?.props?.children;const u=U?.props?.message??B?.message;!A||!u||u.hasFlag(8192)&&A.splice(5,0,o.React.createElement(p,{label:"Download Voice Message",leading:o.React.createElement(M,{source:i.getAssetIDByName("ic_download_24px")}),onPress:async function(){await s.findByProps("downloadMediaAsset").downloadMediaAsset(u.attachments[0].url,0),s.findByProps("hideActionSheet").hideActionSheet()}}))})})})}const{FormDivider:w,FormIcon:l,FormSwitchRow:f}=d.Forms;function V(){return m.useProxy(n.storage),React.createElement(o.ReactNative.ScrollView,null,React.createElement(f,{label:"Send audio files as Voice Message",leading:React.createElement(l,{source:i.getAssetIDByName("voice_bar_mute_off")}),onValueChange:function(e){return n.storage.sendAsVM=e},value:n.storage.sendAsVM}),React.createElement(w,null),React.createElement(f,{label:"Show every audio file as a Voice Message",leading:React.createElement(l,{source:i.getAssetIDByName("ic_stage_music")}),onValueChange:function(e){return n.storage.allAsVM=e},value:n.storage.allAsVM}))}n.storage.sendAsVM??=!0,n.storage.allAsVM??=!1;const P=[E(),y(),h(),S(),v()],R=function(){P.forEach(function(e){return e()})};return c.onUnload=R,c.settings=V,c})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.storage);
