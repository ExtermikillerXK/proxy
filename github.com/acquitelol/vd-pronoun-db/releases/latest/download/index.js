(function(S,E,e,_,i,Q,l,T,c,J,Z){"use strict";var f={Failed:l.getAssetIDByName("Small"),Delete:l.getAssetIDByName("ic_message_delete"),Copy:l.getAssetIDByName("toast_copy_link"),Open:l.getAssetIDByName("ic_leave_stage"),Clipboard:l.getAssetIDByName("pending-alert"),Clock:l.getAssetIDByName("clock"),Pronoun:l.getAssetIDByName("ic_profile_badge_guild_booster_lvl9"),Settings:{Toasts:{Settings:l.getAssetIDByName("ic_selection_checked_24px"),Failed:l.getAssetIDByName("ic_close_circle_24px")},Initial:l.getAssetIDByName("coffee"),Update:l.getAssetIDByName("discover"),Locale:l.getAssetIDByName("ic_locale_24px"),External:l.getAssetIDByName("ic_raised_hand_list"),Edit:l.getAssetIDByName("ic_edit_24px")}},R={shadow:(t=.1)=>({shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:t,shadowRadius:4.65,elevation:8}),displayToast:(t,r)=>{e.toasts.open({content:r=="clipboard"?`Copied ${t} to clipboard.`:t,source:r=="clipboard"?f.Clipboard:f.Settings.Initial})}},L=(t,r,a,n,s)=>{try{return t(...r)}catch(d){console.warn(`[${a}] The following error happened when trying to ${n} ${s??"unspecificied label"}: ${d}`);return}};const M=(t,r,a,n)=>L(()=>{if(t){t.length++,a++;for(let s=t.length-1;s>=a;s--)t[s]=t[s-1];return t[a-1]=r,t.length}},[t,r,a],i.manifest.name,"insert an item at",n);var F={mapItem:(t,r,a)=>L(()=>{let n=[];for(let s=0;s<t.length;s++)M(n,r(t[s],s,t),n.length);return n},[t,r],i.manifest.name,"map an array at",a),insertItem:M},o={map:{},queue:[],fetching:!1,referenceMap:{hh:"he/him",hi:"he/it",hs:"he/she",ht:"he/they",ih:"it/him",ii:"it/its",is:"it/she",it:"it/they",shh:"she/he",sh:"she/her",si:"she/it",st:"she/they",th:"they/he",ti:"they/it",ts:"they/she",tt:"they/them",any:"any",other:"other",ask:"ask",avoid:"avoid, use name",unspecified:"unspecified"},async updateQueuedPronouns(){if(this.queue.length<=0||this.fetching)return;const t=this.queue.splice(0,49),r=s=>this.queue.length<=0?s:this.map[s]?r(this.queue.shift()):s;for(const s of t)this.map[s]&&(t[s]=r(s));this.fetching=!0;const a=await(await fetch(`https://pronoundb.org/api/v1/lookup-bulk?platform=discord&ids=${t.join(",")}`,{method:"GET",headers:{Accept:"application/json","X-PronounDB-Source":"Vendetta"}})).json(),n=Object.fromEntries(Object.entries(a).filter(([s,d])=>!isNaN(+s)));Object.assign(this.map,n),this.fetching=!1,this.queue.length>0&&this.updateQueuedPronouns()}},I={plugin:{source:"https://github.com/acquitelol/vd-pronoun-db",pronoundb:"https://pronoundb.org/"},author:{profile:{"Rosie<3":"https://github.com/acquitelol"}}};const{View:x,Text:P,TouchableOpacity:ee}=T.General,y=e.stylesheet.createThemedStyleSheet({container:{marginTop:12,marginLeft:12,alignSelf:"flex-start"},eyebrow:{textTransform:"uppercase",fontSize:12,lineHeight:16,fontFamily:e.constants.Fonts.PRIMARY_BOLD,color:c.semanticColors.TEXT_NORMAL,marginBottom:10},innerContainer:{backgroundColor:c.semanticColors.BACKGROUND_MOBILE_PRIMARY,borderRadius:8,borderWidth:1,borderColor:c.semanticColors.HEADER_PRIMARY,overflow:"hidden",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},circle:{width:12,height:12,borderRadius:12/2,backgroundColor:c.semanticColors.HEADER_PRIMARY,marginLeft:8,marginRight:6},content:{fontSize:14,paddingRight:8,paddingTop:8,paddingBottom:8},text:{fontFamily:e.constants.Fonts.DISPLAY_NORMAL,color:c.semanticColors.TEXT_NORMAL}});var te=({pronoun:t})=>e.React.createElement(x,{style:y.container},e.React.createElement(P,{style:y.eyebrow},"Pronouns"),e.React.createElement(ee,{onPress:()=>e.toasts.open({content:t,source:f.Pronoun})},i.storage.isRole?e.React.createElement(x,{style:y.innerContainer},e.React.createElement(x,{style:y.circle}),e.React.createElement(P,{style:[y.text,y.content]},t)):e.React.createElement(P,{style:[y.text,{fontSize:16}]},t)));const{TouchableOpacity:C,View:v,Image:ae,Text:N,Animated:A}=T.General,U=E.findByProps("transitionToGuild"),Y=E.findByStoreName("UserStore"),re=E.findByProps("showUserProfile"),g=e.stylesheet.createThemedStyleSheet({container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",...R.shadow()},image:{width:75,height:75,borderRadius:10,...R.shadow()},mainText:{opacity:.975,letterSpacing:.25},header:{color:c.semanticColors.HEADER_PRIMARY,fontFamily:e.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:c.semanticColors.HEADER_SECONDARY,fontSize:12.75}});var se=({name:t,authors:r})=>{const a=e.React.useRef(new A.Value(1)).current,n=()=>A.spring(a,{toValue:1.1,duration:10,useNativeDriver:!0}).start(),s=()=>A.spring(a,{toValue:1,duration:250,useNativeDriver:!0}).start(),d=()=>re.showUserProfile({userId:Y.getCurrentUser().id}),w={transform:[{scale:a}]};return e.React.createElement(e.React.Fragment,null,e.React.createElement(v,{style:g.container},e.React.createElement(C,{onPress:d,onPressIn:n,onPressOut:s},e.React.createElement(A.View,{style:w},e.React.createElement(ae,{style:[g.image],source:{uri:Y?.getCurrentUser()?.getAvatarURL()?.replace("webp","png")}}))),e.React.createElement(v,{style:g.textContainer},e.React.createElement(C,{onPress:()=>U.openURL(I.plugin.source)},e.React.createElement(N,{style:[g.mainText,g.header]},t)),e.React.createElement(v,{style:{flexDirection:"row"}},e.React.createElement(N,{style:[g.mainText,g.subHeader]},"A project by"),F.mapItem(r,(u,m,D)=>e.React.createElement(C,{onPress:()=>U.openURL(I.author.profile[u.name]??"https://github.com/")},e.React.createElement(N,{style:[g.mainText,g.subHeader,{paddingLeft:4,fontFamily:e.constants.Fonts.DISPLAY_BOLD,flexDirection:"row"}]},u.name,m<D.length-1?",":null)))))))};const{View:ne,Text:ie}=T.General,k=e.stylesheet.createThemedStyleSheet({text:{color:c.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:12}});var O=({label:t,children:r})=>e.React.createElement(ne,{style:{marginTop:10}},e.React.createElement(ie,{style:[k.text,k.optionText]},t.toUpperCase()),r);const{Image:G}=T.General,oe=e.ReactNative.Dimensions?.get("window").width;var V=({style:t,source:r})=>{const[a,n]=e.React.useState({width:0,height:0}),[s,d]=e.React.useState(0),w=()=>{const u=$=>typeof $=="string"?parseInt($.replace("%",""))*oe/100:$,m=u(t.width);if(!t.maxWidth)return m;const D=u(t.maxWidth);return m>D?D:m};return e.React.useEffect(()=>{G.getSize(r,(u,m)=>{n({width:u,height:m})},u=>{console.error(`[${i.manifest.name}] ${u} when fetching ${r}`)}),d(w())},[]),e.React.createElement(G,{style:[...Array.isArray(t)?t:[t],{height:s*(a.height/a.width)}],source:{uri:r},resizeMode:"stretch"})};const{FormRow:h,FormSwitch:H,FormDivider:q}=T.Forms,{ScrollView:le,View:b,Text:ce}=T.General,j=E.findByProps("transitionToGuild","openURL"),B=parseInt(Z.getDebugInfo()?.discord?.version.split(".")[0])>163?15:0,p=e.stylesheet.createThemedStyleSheet({icon:{color:c.semanticColors.INTERACTIVE_NORMAL},item:{color:c.semanticColors.TEXT_MUTED,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM},container:{width:"90%",marginLeft:"5%",borderRadius:10,backgroundColor:c.semanticColors.BACKGROUND_MOBILE_SECONDARY,...R.shadow()},subheaderText:{color:c.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:14},image:{width:"100%",maxWidth:350,borderRadius:10}});var de=()=>{J.useProxy(i.storage);const[t,r]=e.React.useState(i.storage.isTimestamp),[a,n]=e.React.useState(i.storage.isRole);return e.React.createElement(le,null,e.React.createElement(se,{name:i.manifest.name,authors:i.manifest.authors}),e.React.createElement(b,{style:{marginTop:20}},e.React.createElement(O,{label:"Preferences"},e.React.createElement(b,{style:[p.container]},e.React.createElement(h,{label:"Timestamps",subLabel:"Use Timestamps instead of OP Tag for the pronoun in the chat area.",onLongPress:()=>R.displayToast(`By default, ${i.manifest.name} will use the OP tag to display pronouns. Toggling this option will always use Timestamps instead of OP tag for pronouns.`,"tooltip"),leading:e.React.createElement(h.Icon,{style:p.icon,source:f.Settings.Locale}),trailing:e.React.createElement(H,{value:i.storage.isTimestamp,style:{marginLeft:-B},onValueChange:()=>{i.storage.isTimestamp=!i.storage.isTimestamp,r(i.storage.isTimestamp)}})}),e.React.createElement(q,null),e.React.createElement(h,{label:"Roles",subLabel:"Show the pronoun styled as a role instead of plain text inside of profiles.",onLongPress:()=>R.displayToast(`With this option enabled, ${i.manifest.name} will style pronouns as roles in profiles. Otherwise, it will style them as plain text.`,"tooltip"),leading:e.React.createElement(h.Icon,{style:p.icon,source:f.Settings.Edit}),trailing:e.React.createElement(H,{value:i.storage.isRole,style:{marginLeft:-B},onValueChange:()=>{i.storage.isRole=!i.storage.isRole,n(i.storage.isRole)}})}))),e.React.createElement(O,{label:"Previews"},e.React.createElement(b,{style:{...p.container,maxWidth:350}},e.React.createElement(V,{style:p.image,source:`https://cdn.discordapp.com/attachments/${t?"1011346757214543875/1075007230337896448/pronoun-timestamp.png":"1011346757214543875/1075007230107193374/pronoun-tag.png"}`})),e.React.createElement(b,{style:{...p.container,marginTop:10,maxWidth:350}},e.React.createElement(V,{style:p.image,source:`https://cdn.discordapp.com/attachments/${a?"1011346757214543875/1075007778399199282/profile-role.png":"1011346757214543875/1075007778067841044/profile-plain.png"}`}))),e.React.createElement(O,{label:"Source"},e.React.createElement(b,{style:p.container},e.React.createElement(h,{label:"Source",subLabel:`Open the repository of ${i.manifest.name} externally.`,onLongPress:()=>R.displayToast(`Opens the repository of ${i.manifest.name} on GitHub in an external page to view any source code of the plugin.`,"tooltip"),leading:e.React.createElement(h.Icon,{style:p.icon,source:f.Open}),trailing:()=>e.React.createElement(h.Arrow,null),onPress:()=>{j.openURL(I.plugin.source)}}),e.React.createElement(q,null),e.React.createElement(h,{label:"PronounDB",subLabel:`Open the ${i.manifest.name} website externally at \`https://pronoundb.org\`.`,onLongPress:()=>R.displayToast("Opens the PronounDB website in an external page which allows you to link your Discord account to PronounDB.","tooltip"),leading:e.React.createElement(h.Icon,{style:p.icon,source:f.Settings.External}),trailing:()=>e.React.createElement(h.Arrow,{style:{marginLeft:-B}}),onPress:()=>{j.openURL(I.plugin.pronoundb)}})))),e.React.createElement(ce,{style:p.subheaderText},`Build: (${i.manifest.hash.substring(0,8)})`))};const pe=E.findByProps("PRIMARY_INFO_TOP_OFFSET","SECONDARY_INFO_TOP_MARGIN","SIDE_PADDING"),he=E.findByStoreName("UserStore"),{DCDChatManager:ge}=e.ReactNative.NativeModules,z=e.stylesheet.createThemedStyleSheet({opTagBackgroundColor:{color:c.semanticColors.HEADER_PRIMARY},opTagTextColor:{color:c.semanticColors.BACKGROUND_PRIMARY}});let W,X,K;var ue={onLoad:()=>{W=_.before("getUser",he,t=>{const r=t[0];o.map[r]||F.insertItem(o.queue,r,o.queue.length,"user id pronoun queue"),o.updateQueuedPronouns()}),X=_.after("type",pe.default,(t,r)=>{const a=Q.findInReactTree(r,d=>d?.props?.children.find(w=>typeof w?.props?.displayProfile?.userId=="string")&&d?.type?.displayName==="View"&&Array.isArray(d?.props?.style))?.props?.children;if(!a)return r;const{userId:n}=a?.find(d=>typeof d?.props?.displayProfile?.userId=="string")?.props?.displayProfile??{};if(!n||!o.map[n]||o.referenceMap[o.map[n]]==="unspecified")return console.log(`uid: ${n}, map: ${o.map[n]}, ref: ${o.referenceMap[o.map[n]]}`),r;const s=o.referenceMap[o.map[n]];a.unshift(React.createElement(te,{pronoun:s}))}),K=_.before("updateRows",ge,t=>{const r=JSON.parse(t[1]);for(const a of r){if(a.type!==1||!a?.message?.authorId||!o.map[a?.message?.authorId]||o.referenceMap[o.map[a?.message?.authorId]]==="unspecified")continue;const n=o.referenceMap[o.map[a.message.authorId]];if(i.storage.isTimestamp&&a.message.timestamp){a.message.timestamp+=" \u2022 "+n;continue}a.message.opTagText&&(a.message.tagText=a.message.tagText?a.message.tagText+" \u2022 ":""+a.message.opTagText),a.message.opTagText=n,a.message.opTagTextColor=e.ReactNative.processColor(z.opTagTextColor.color),a.message.opTagBackgroundColor=e.ReactNative.processColor(z.opTagBackgroundColor.color)}t[1]=JSON.stringify(r)})},onUnload:()=>{W?.(),X?.(),K?.()},settings:de};return S.default=ue,Object.defineProperty(S,"__esModule",{value:!0}),S})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.storage,vendetta.debug);
