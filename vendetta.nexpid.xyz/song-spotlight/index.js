(function(N,be,H,e,l,ae,C,p,L,b,Se,kt,me,Ae){"use strict";const re="https://songspotlight.nexpid.xyz/";var T={get api(){return y.host?y.host.endsWith("/")?y.host:`${y.host}/`:re},oauth2:{clientId:"1157745434140344321",get redirectURL(){return`${y.host?y.host.endsWith("/")?y.host:`${y.host}/`:re}api/oauth2-response`}}};function xe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Te(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function V(t,n,r){return ie()?V=Reflect.construct:V=function(a,o,s){var u=[null];u.push.apply(u,o);var f=Function.bind.apply(a,u),i=new f;return s&&$(i,s.prototype),i},V.apply(null,arguments)}function O(t){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},O(t)}function Ie(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&$(t,n)}function Pe(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function Be(t,n){return n&&(ke(n)==="object"||typeof n=="function")?n:xe(t)}function $(t,n){return $=Object.setPrototypeOf||function(r,a){return r.__proto__=a,r},$(t,n)}function ke(t){"@swc/helpers - typeof";return t&&typeof Symbol<"u"&&t.constructor===Symbol?"symbol":typeof t}function F(t){var n=typeof Map=="function"?new Map:void 0;return F=function(r){if(r===null||!Pe(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n<"u"){if(n.has(r))return n.get(r);n.set(r,a)}function a(){return V(r,arguments,O(this).constructor)}return a.prototype=Object.create(r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),$(a,r)},F(t)}function ie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ne(t){var n=ie();return function(){var r=O(t),a;if(n){var o=O(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return Be(this,a)}}const oe=l.findByStoreName("UserStore");let D=function(t){Ie(r,t);var n=Ne(r);function r(a){Te(this,r);var o;return o=n.call(this,`${a.status}: ${a.message}${a.error?` (${a.error})`:""}`),o.name=o.constructor.name,o}return r}(F(Error));function I(){return y.auth?.[oe.getCurrentUser()?.id]}async function G(){var t;const n=new Error("Unauthorized, try logging out and back in again");let r=I();if(!r)throw n;if(Date.now()>=r.expiresAt){const a=await fetch(`${T.api}api/refresh-access-token?refresh_token=${encodeURIComponent(r.refreshToken)}`);if(a.status!==200)throw new D(await a.json());r=await a.json(),(t=y).auth??(t.auth={}),y.auth[oe.getCurrentUser().id]=r}return r.accessToken}async function De(t){const n=await fetch(`${T.api}api/get-access-token?code=${encodeURIComponent(t)}`);if(n.status===200)return await n.json();throw new D(await n.json())}async function _e(t){const n=new URLSearchParams;n.append("id",t);const r=await fetch(`${T.api}api/get-profile-data?${n.toString()}`);if(r.status===200)return await r.json();throw new D(await r.json())}async function Le(){if(!I())return;const t=await fetch(`${T.api}api/get-data`,{headers:{authorization:await G()}});if(t.status===200)return await t.json();throw new D(await t.json())}async function Oe(t){if(!I())return;const n=await fetch(`${T.api}api/sync-data`,{method:"POST",headers:{authorization:await G(),"content-type":"application/json"},body:JSON.stringify(t)});if(n.status===200)return await n.json();throw new D(await n.json())}async function $e(){if(!I())return;const t=await fetch(`${T.api}api/delete-data`,{method:"DELETE",headers:{authorization:await G()}});if(t.status===200)return await t.json();throw new D(await t.json())}var Me=`<!DOCTYPE html>
<html></html>
<script>
  const RNWV = window.ReactNativeWebView;

  /** @type {(HTMLAudioElement | null)[]} */
  const audios = AUDIOS_VARIABLE.map((x) => (x ? new Audio(x) : null));
  let position = 0;

  /** @argument enabled {boolean} */
  const playback = (enabled) => {
    audios.forEach((x, i) => {
      if (!x) return;
      if (i === position && enabled) x.play();
      else {
        if (i !== position) x.currentTime = 0;
        x.pause();
      }
    });
  };

  audios.forEach((x) =>
    x?.addEventListener("ended", () => RNWV.postMesssage("ended"))
  );

  window.addEventListener("message", (ev) => {
    const { action, pos } = ev.data;
    if (!action) return;

    if (pos !== undefined) position = audios[pos] ? pos : 0;

    if (action === "play") playback(true);
    else if (action === "pause") playback(false);
  });
<\/script>`,Ue=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1 12C1 5.925 5.925 1 12 1C18.075 1 23 5.925 23 12C23 18.075 18.075 23 12 23C5.925 23 1 18.075 1 12ZM8.5 7C8.36739 7 8.24021 7.05268 8.14645 7.14645C8.05268 7.24021 8 7.36739 8 7.5V16.5C8 16.6326 8.05268 16.7598 8.14645 16.8536C8.24021 16.9473 8.36739 17 8.5 17H10.5C10.6326 17 10.7598 16.9473 10.8536 16.8536C10.9473 16.7598 11 16.6326 11 16.5V7.5C11 7.36739 10.9473 7.24021 10.8536 7.14645C10.7598 7.05268 10.6326 7 10.5 7H8.5ZM13.5 7C13.3674 7 13.2402 7.05268 13.1464 7.14645C13.0527 7.24021 13 7.36739 13 7.5V16.5C13 16.6326 13.0527 16.7598 13.1464 16.8536C13.2402 16.9473 13.3674 17 13.5 17H15.5C15.6326 17 15.7598 16.9473 15.8536 16.8536C15.9473 16.7598 16 16.6326 16 16.5V7.5C16 7.36739 15.9473 7.24021 15.8536 7.14645C15.7598 7.05268 15.6326 7 15.5 7H13.5Z" fill="white"/>
</svg>`,je=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1 12C1 5.925 5.925 1 12 1C18.075 1 23 5.925 23 12C23 18.075 18.075 23 12 23C5.925 23 1 18.075 1 12ZM9.75 7.433C9.67399 7.38912 9.58777 7.36601 9.5 7.36601C9.41224 7.36601 9.32601 7.38911 9.25001 7.433C9.174 7.47688 9.11088 7.54 9.06699 7.616C9.02311 7.69201 9 7.77823 9 7.866V16.134C9 16.2218 9.02311 16.308 9.06699 16.384C9.11088 16.46 9.174 16.5231 9.25001 16.567C9.32601 16.6109 9.41224 16.634 9.5 16.634C9.58777 16.634 9.67399 16.6109 9.75 16.567L16.911 12.433C16.987 12.3891 17.0501 12.326 17.094 12.25C17.1379 12.174 17.161 12.0878 17.161 12C17.161 11.9122 17.1379 11.826 17.094 11.75C17.0501 11.674 16.987 11.6109 16.911 11.567L9.75 7.433Z" fill="white"/>
</svg>`,He=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.7 1C12.5143 1 12.3363 1.07375 12.205 1.20503C12.0738 1.3363 12 1.51435 12 1.7V6.85L2.05 1.107C1.94368 1.04561 1.82308 1.01327 1.7003 1.01322C1.57753 1.01316 1.4569 1.0454 1.35053 1.1067C1.24415 1.16799 1.15576 1.25618 1.09424 1.36243C1.03271 1.46867 1.00021 1.58923 1 1.712V14.287C0.999863 14.4099 1.03211 14.5308 1.09349 14.6373C1.15487 14.7438 1.24322 14.8323 1.34966 14.8938C1.4561 14.9553 1.57686 14.9877 1.6998 14.9878C1.82275 14.9878 1.94353 14.9555 2.05 14.894L12 9.149V14.3C12 14.4857 12.0738 14.6637 12.205 14.795C12.3363 14.9262 12.5143 15 12.7 15H14.3C14.4857 15 14.6637 14.9262 14.795 14.795C14.9262 14.6637 15 14.4857 15 14.3V1.7C15 1.51435 14.9262 1.3363 14.795 1.20503C14.6637 1.07375 14.4857 1 14.3 1H12.7Z" fill="white"/>
</svg>`;const W=new Map,X=async function(t,n,r,a){const o=`${t}${n}${r}`;if(W.has(o))return W.get(o);if(t==="spotify"){const s=await(await fetch(`https://open.spotify.com/embed/${n}/${r}`,{signal:a})).text(),u=JSON.parse(`{"props"${s.split('{"props"')[1].split("<\/script>")[0]}`);return W.set(o,u),u}else return!1};async function Ve(t,n,r,a){if(t==="spotify"){const o=(await X(t,n,r,a))?.props?.pageProps?.state?.data?.entity;return o?.name&&o?.coverArt?o:!1}else return!1}async function ze(t,n,r,a){return t==="spotify"?(await X(t,n,r,a))?.props?.pageProps?.state?.data?.entity?.name??!1:!1}async function Fe(t,n,r,a){return t==="spotify"?(await X(t,n,r,a)).page?.props?.status!==404:!1}const Ge=l.findByStoreName("ThemeStore"),We=function(t,n){return Ge.theme!=="light"?t:n},z=function(t,n,r){const a=function(i){return i.match(/\w\w/g)?.map(function(g){return parseInt(g,16)})??[0,0,0]},o=function(i){return`#${i.map(function(g){return g.toString(16).padStart(2,"0")}).join("")}`},s=a(t),u=a(n),f=s.map(function(i,g){return Math.round(i+(u[g]-i)*r)});return o(f)},Xe=l.findByStoreName("ThemeStore"),Je=l.findByProps("colors","meta");l.findByProps("triggerHaptic");const J=l.findByProps("TextStyleSheet").TextStyleSheet,{View:M,Text:ce,Pressable:Ye}=L.General;l.findByProps("TableRow");const Ze=l.findByProps("ActionSheet")?.ActionSheet??l.find(function(t){return t.render?.name==="ActionSheet"}),Qe=l.findByProps("openLazy","hideActionSheet"),{openLazy:Ke,hideActionSheet:U}=Qe,{ActionSheetTitleHeader:qe,ActionSheetCloseButton:et,ActionSheetContentContainer:tt}=l.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");l.findByProps("ActionSheetRow")?.ActionSheetRow,l.findByName("Navigator")??l.findByProps("Navigator")?.Navigator,l.findByProps("getRenderCloseButton")?.getRenderCloseButton??l.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,l.findByProps("popModal","pushModal");const se=l.findByProps("useSearchControls"),Y=l.findByProps("useSettingSearchQuery"),nt=l.findByName("SettingSearchBar"),{SvgXml:le}=l.findByProps("SvgXml");l.findByProps("useInMainTabsExperiment","isInMainTabsExperiment");const at=l.find(function(t){return t?.WebView&&!t.default}).WebView;function rt(t){return Je.meta.resolveSemanticColor(Xe.theme,t)}function Z(t,n){try{Ke(new Promise(function(r){return r({default:t})}),"ActionSheet",n)}catch(r){Se.logger.error(r.stack),C.showToast("Got error when opening ActionSheet! Please check debug logs",p.getAssetIDByName("Smal"))}}Object.assign(function(t){let{searchContext:n,controls:r}=t;return e.React.createElement(e.ReactNative.ScrollView,{scrollEnabled:!1},e.React.createElement(se.default,{searchContext:n,controls:r},e.React.createElement(nt,null)))},{useAdvancedSearch:function(t){const n=Y.useSettingSearchQuery(),r=se.useSearchControls(t,!1,function(){});return e.React.useEffect(function(){return function(){Y.setSettingSearchQuery(""),Y.setIsSettingSearchActive(!1)}},[]),[n,r]}});function it(t){let{title:n,onPress:r,icon:a}=t;const o=e.stylesheet.createThemedStyleSheet({androidRipple:{color:b.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:b.semanticColors.HEADER_SECONDARY,opacity:.5}}),s=r?Ye:M;return e.React.createElement(s,{android_ripple:o.androidRipple,disabled:!1,accessibilityRole:"button",onPress:r,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},a&&e.React.createElement(M,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:o.icon,source:a,resizeMode:"contain"})),e.React.createElement(S,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},n))}function ue(t){let{title:n,onTitlePress:r,icon:a,children:o,padding:s}=t;const u=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:b.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(M,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(it,{title:n,onPress:r,icon:a}),e.React.createElement(M,{style:u.main},s?e.React.createElement(M,{style:{paddingHorizontal:16,paddingVertical:16}},o):o))}var de;(function(t){function n(a){let{children:o,onPress:s}=a;return e.React.createElement(S,{variant:"text-md/bold",onPress:s},o)}t.Bold=n;function r(a){let{children:o,onPress:s}=a;return e.React.createElement(ce,{style:{textDecorationLine:"underline"},onPress:s},o)}t.Underline=r})(de||(de={}));function S(t){let{variant:n,lineClamp:r,color:a,align:o,style:s,onPress:u,getChildren:f,children:i,liveUpdate:g}=t;const[m,A]=e.React.useReducer(function(k){return~k},0);return e.React.useEffect(function(){if(!g)return;const k=new Date().setMilliseconds(1e3);let v,c;return c=setTimeout(function(){A(),v=setInterval(A,1e3)},k-Date.now()),function(){clearTimeout(c),clearInterval(v)}},[]),e.React.createElement(ce,{style:[n?J[n]:{},a?{color:rt(b.semanticColors[a])}:{},o?{textAlign:o}:{},s??{}],numberOfLines:r,onPress:u},f?.()??i)}const fe=function(t,n,r){return t==="spotify"?`https://open.spotify.com/${n}/${r}`:void 0};l.findByStoreName("ThemeStore");async function ot(t){await e.ReactNative.Linking.canOpenURL(t)?e.url.openDeeplink(t):await e.ReactNative.Linking.canOpenURL("market://details?id=com.spotify.music")?e.url.openDeeplink("market://details?id=com.spotify.music"):e.url.openDeeplink("itms-apps://itunes.apple.com/app/id324684580")}let pe=0;function ct(t){clearTimeout(pe),pe=setTimeout(t,1500)}let he;function Q(){const t=he?.slice();he=JSON.stringify(E.data),t&&t!==JSON.stringify(E.data)&&ct(function(){return Oe(E.data.songs)})}const{FormRow:P}=L.Forms,st={color:"TEXT_DANGER",variant:"text-md/semibold"};function K(t){let{song:n,remove:r,showAdd:a}=t;const o=e.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:b.semanticColors.TEXT_DANGER}});return React.createElement(Ze,null,React.createElement(tt,null,React.createElement(qe,{title:"Edit Song",trailing:React.createElement(et,{onPress:U})}),n.service==="spotify"&&React.createElement(P,{label:"Open in Spotify",leading:React.createElement(P.Icon,{source:p.getAssetIDByName("img_account_sync_spotify_light_and_dark")}),onPress:function(){ot(`spotify://${n.type}/${n.id}`),U()}}),React.createElement(P,{label:"Copy link",leading:React.createElement(P.Icon,{source:p.getAssetIDByName("copy")}),onPress:function(){e.clipboard.setString(fe(n.service,n.type,n.id)),C.showToast("Copied to clipboard.",p.getAssetIDByName("toast_copy_link")),U()}}),a&&React.createElement(P,{label:"Add to your profile",leading:React.createElement(P.Icon,{source:p.getAssetIDByName("ic_pin")}),onPress:function(){U();const s=E.data?.songs;if(!s)return;const u=s.findIndex(function(f){return f===null});if(u===-1)return C.showToast("No space left!",p.getAssetIDByName("Small"));s[u]=n,Q(),C.showToast("Added to your profile",p.getAssetIDByName("Check"))}}),r&&React.createElement(P,{label:React.createElement(S,st,"Remove song"),leading:React.createElement(P.Icon,{style:o.destructiveIcon,source:p.getAssetIDByName("trash")}),onPress:function(){r(),C.showToast("Removed",p.getAssetIDByName("toast_trash")),U()}})))}const{View:w}=L.General,lt=e.ReactNative.Animated.createAnimatedComponent(e.ReactNative.Pressable),ut=l.findByName("UserProfileSection"),{YouScreenProfileCard:dt}=l.findByProps("YouScreenProfileCard"),{TableRowGroupTitle:ft}=l.findByProps("TableRowGroupTitle"),pt=l.findByStoreName("UserStore"),q=new Map,ht=function(t){let{song:n,showAdd:r,remove:a}=t;const[o,s]=e.React.useState(!1),[u,f]=e.React.useState(0),[i,g]=e.React.useState(void 0),m=i&&i.type==="track"||n.type==="track"?600/152:600/352,A=e.React.useRef(null),k=e.React.useRef(Math.random().toString()).current;e.React.useEffect(function(){o&&q.forEach(function(h,d){return d!==k&&h()}),A.current?.injectJavaScript(`window.postMessage(${JSON.stringify({action:o?"play":"pause",pos:u})})`)},[o,u]),q.set(k,function(){return s(!1)}),e.React.useEffect(function(){return function(){q.delete(k)}},[]);const v=i&&(i.coverArt.extractedColors.colorLight?We(i.coverArt.extractedColors.colorDark.hex,i.coverArt.extractedColors.colorLight.hex):i.coverArt.extractedColors.colorDark.hex),c=e.stylesheet.createThemedStyleSheet({emptyCard:{width:"100%",aspectRatio:m,backgroundColor:b.semanticColors.BG_MOD_FAINT,borderRadius:12,justifyContent:"center",alignItems:"center"},noImage:{tintColor:b.semanticColors.TEXT_DANGER,width:36,height:36},card:{width:"100%",backgroundColor:v&&z(v,"#000000",.15),aspectRatio:m,borderRadius:12,flexDirection:"column"},cardFirst:{backgroundColor:v,width:"100%",height:"100%",borderRadius:12},cardFirstContent:{flexDirection:"row",gap:8,padding:10},cardImage:{height:"100%",aspectRatio:1,borderRadius:8,backgroundColor:b.semanticColors.BG_MOD_SUBTLE,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:4.65,elevation:8},cardContent:{width:"90%",flexDirection:"column",gap:2,justifyContent:"center",flexGrow:0,flexShrink:0},cardContentArtist:{flexDirection:"row",gap:4,alignItems:"center",flexGrow:0,flexShrink:0},cardContentTag:{backgroundColor:"#ffffffb3",paddingHorizontal:6,paddingVertical:1,borderRadius:4},cardOther:{position:"absolute",width:"100%",height:"100%",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-end",padding:10},cardOtherBottom:{flexDirection:"row-reverse",alignItems:"center",gap:4},cardTracklist:{height:"100%",paddingHorizontal:8,flexDirection:"column"},cardTracklistEntry:{backgroundColor:v&&z(v,"#000000",.25),borderRadius:5,flexDirection:"column",padding:8,flexGrow:0,flexShrink:0},cardTracklistEntryUnplayable:{backgroundColor:v&&z(v,"#000000",.2)},cardTracklistEntryPlaying:{backgroundColor:v&&z(v,"#000000",.35)},cardTracklistEntryTitle:{width:"95%"},cardTracklistEntryOther:{position:"absolute",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",alignItems:"flex-end",padding:5},webview:{display:"none",width:0,height:0,opacity:0},secondaryText:{opacity:.7},unplayableItem:{opacity:.5},androidRipple:{color:b.semanticColors.ANDROID_RIPPLE,cornerRadius:2147483647},androidRippleTwo:{color:b.semanticColors.ANDROID_RIPPLE,cornerRadius:8}}),ne=e.React.useRef(null),Ee=function(){ne.current?.abort();const h=new AbortController;ne.current=h,g(void 0),Ve(n.service,n.type,n.id,h.signal).then(function(d){const R=d??!1;R&&R.type!=="track"&&(R.trackList=R.trackList.slice(0,50)),g(R)}).catch(function(d){return d?.name!=="AbortError"&&(C.showToast(`${d}`,p.getAssetIDByName("Small")),g(!1))})};e.React.useEffect(function(){return Ee(),function(){return ne.current?.abort()}},[]);const Tt=i&&i.coverArt.sources.sort(function(h,d){return h.width*h.height-d.width*d.height})[0],ve=e.React.useRef();e.React.useEffect(function(){ve.current?.scrollToIndex({animated:!0,index:u,viewOffset:16})},[u]);const It=function(h){let{item:d,selected:R,playable:x,jump:_,more:j}=h;return e.React.createElement(lt,{android_ripple:c.androidRippleTwo,style:[c.cardTracklistEntry,!x&&c.cardTracklistEntryUnplayable,R&&c.cardTracklistEntryPlaying],onPress:_,onLongPress:j},e.React.createElement(S,{style:[c.cardTracklistEntryTitle,!x&&c.unplayableItem],variant:R?"text-sm/bold":"text-sm/semibold",color:"WHITE",lineClamp:1},d.title),e.React.createElement(w,{style:c.cardContentArtist},d.isExplicit&&e.React.createElement(S,{variant:"text-xs/semibold",color:"BLACK",style:[c.cardContentTag,!x&&c.unplayableItem]},"E"),e.React.createElement(S,{variant:R?"text-xs/bold":"text-xs/semibold",color:"WHITE",style:[c.secondaryText,!x&&c.unplayableItem],lineClamp:1},d.subtitle)),e.React.createElement(w,{style:c.cardTracklistEntryOther},e.React.createElement(e.ReactNative.Pressable,{android_ripple:c.androidRipple,onPress:j},e.React.createElement(e.ReactNative.Image,{source:p.getAssetIDByName("ic_feed_more")}))))},Pt=i&&i.type==="track"?i.isPlayable&&!!i.audioPreview?.url:!0,Ce=8*2+J["text-sm/normal"].lineHeight+J["text-xs/normal"].lineHeight+1.4;return i?e.React.createElement(e.React.Fragment,null,e.React.createElement(w,{style:c.card,pointerEvents:"box-none"},e.React.createElement(w,{style:[c.cardFirst,i.type!=="track"&&{height:"40%"}]},e.React.createElement(w,{style:c.cardFirstContent},e.React.createElement(e.ReactNative.Image,{style:c.cardImage,source:{uri:Tt.url}}),e.React.createElement(w,{style:c.cardContent},e.React.createElement(S,{variant:"text-sm/bold",color:"WHITE",lineClamp:1},i.title),i.type==="track"?e.React.createElement(w,{style:c.cardContentArtist},i.isExplicit&&e.React.createElement(S,{variant:"text-xs/semibold",color:"BLACK",style:c.cardContentTag},"E"),e.React.createElement(S,{variant:"text-xs/semibold",color:"WHITE",style:c.secondaryText,lineClamp:1},i.artists.map(function(h){return h.name}).join(", "))):e.React.createElement(S,{variant:"text-xs/semibold",color:"WHITE",style:c.secondaryText,lineClamp:1},i.subtitle))),e.React.createElement(w,{style:c.cardOther},e.React.createElement(e.ReactNative.Pressable,{android_ripple:c.androidRipple,onPress:function(){return Z(K,{song:n,showAdd:r,remove:a})}},e.React.createElement(e.ReactNative.Image,{source:p.getAssetIDByName("ic_feed_more")})),e.React.createElement(w,{style:c.cardOtherBottom},e.React.createElement(e.ReactNative.Pressable,{android_ripple:c.androidRipple,onPress:function(){return s(!o)},style:!Pt&&c.unplayableItem},e.React.createElement(le,{width:30,height:30,xml:o?Ue:je})),i.type!=="track"&&e.React.createElement(e.ReactNative.Pressable,{android_ripple:c.androidRipple,onPress:function(){s(!1);const h=u+1;if(h<i.trackList.length){const d=i.trackList[h];if(d.isPlayable&&d.audioPreview?.url)f(h),s(!0);else{const R=i.trackList.findIndex(function(x,_){return _>h&&x.isPlayable&&!!x.audioPreview?.url});R!==-1&&(f(R),s(!0)),C.showToast("The next song cannot be played")}}else f(0)}},e.React.createElement(le,{width:20,height:20,xml:He}))))),i.type!=="track"&&e.React.createElement(e.ReactNative.FlatList,{nestedScrollEnabled:!0,ref:ve,getItemLayout:function(h,d){return{length:Ce,offset:8*(d+1)+Ce*d,index:d}},style:c.cardTracklist,data:i.trackList,ListHeaderComponent:function(){return e.React.createElement(w,{style:{height:8}})},ListFooterComponent:function(){return e.React.createElement(w,{style:{height:8}})},ItemSeparatorComponent:function(){return e.React.createElement(w,{style:{height:8}})},renderItem:function(h){let{item:d,index:R}=h;const x=d.isPlayable&&!!d.audioPreview?.url;return e.React.createElement(It,{item:d,selected:R===u,playable:x,jump:function(){if(x)f(R),s(!0);else{const _=i.trackList.findIndex(function(j,Bt){return Bt>R&&j.isPlayable&&!!j.audioPreview?.url});return _!==-1&&(f(_),s(!0)),C.showToast("This song cannot be played")}},more:function(){return Z(K,{song:{service:"spotify",type:"track",id:d.uid},showAdd:r})}})}})),i.isPlayable&&e.React.createElement(at,{source:{html:Me.replace(/AUDIOS_VARIABLE/g,JSON.stringify(i.type==="track"?[i.audioPreview?.url??null]:i.trackList.map(function(h){return h.audioPreview?.url??null})))},style:c.webview,mediaPlaybackRequiresUserAction:!1,onMessage:function(h){let{nativeEvent:{data:d}}=h;if(console.log(d),d==="ended"&&(console.log("finished playing :3"),s(!1),i.type!=="track")){const R=u+1;R<i.trackList.length?(f(R),s(!0)):f(0)}},ref:A,pointerEvents:"none"})):i===!1?e.React.createElement(w,{style:c.emptyCard},e.React.createElement(e.ReactNative.Pressable,{android_ripple:c.androidRipple,onPress:Ee},e.React.createElement(e.ReactNative.Image,{style:c.noImage,source:p.getAssetIDByName("ic_message_retry"),resizeMode:"contain"}))):e.React.createElement(w,{style:c.emptyCard},e.React.createElement(e.ReactNative.ActivityIndicator,{size:"large"}))};function ye(t){let{userId:n,you:r}=t;const[a,o]=e.React.useState(void 0),s=pt.getCurrentUser().id;e.React.useEffect(function(){s===n&&E.data?o(E.data.songs):_e(n).then(function(i){return o(i?.songs??[])}).catch(function(i){return C.showToast(`${i}`,p.getAssetIDByName("Small")),o([])})},[]);const u=a&&!a.filter(function(i){return!!i}).length,f=a?a.map(function(i,g){return i?i.service==="spotify"&&e.React.createElement(ht,{song:i,showAdd:n!==s&&!!I(),remove:n===s&&function(){const m=E.data?.songs;m&&(m[g]=null,Q())}}):null}):e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small",style:{flex:1}});return!u&&(r?e.React.createElement(dt,null,e.React.createElement(ft,{title:"Song Spotlight"}),e.React.createElement(w,{style:{flexDirection:"column",gap:8,marginTop:4}},f)):e.React.createElement(ut,{title:"Song Spotlight",showContainer:!0},e.React.createElement(w,{style:{flexDirection:"column",gap:8,paddingHorizontal:8,paddingVertical:8}},f)))}const yt=l.findByName("UserProfileBio",!1),gt=l.findByName("YouAboutMeCard",!1);function Rt(){const t=new Array;return t.push(ae.after("default",yt,function(n,r){let[a]=n;return e.React.createElement(e.React.Fragment,{},[a?.displayProfile?.userId&&e.React.createElement(ye,{userId:a.displayProfile.userId,you:!1}),r])})),t.push(ae.after("default",gt,function(n,r){let[{userId:a}]=n;return e.React.createElement(e.React.Fragment,{},[e.React.createElement(ye,{userId:a,you:!0}),r])})),function(){return t.forEach(function(n){return n()})}}const{pushModal:wt,popModal:Et}=l.findByProps("pushModal","popModal"),vt=l.findByName("OAuth2AuthorizeModal"),Ct=l.findByStoreName("UserStore");function bt(){wt({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:vt,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:T.oauth2.clientId,redirectUri:T.oauth2.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(t){var n;let{location:r}=t;try{const a=new URL(r).searchParams.get("code"),o=await De(a);(n=y).auth??(n.auth={}),y.auth[Ct.getCurrentUser().id]=o,te(),C.showToast("Successfully authenticated",p.getAssetIDByName("Check"))}catch(a){C.showToast(String(a),p.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return Et("oauth2-authorize")}},closable:!0}})}function St(t){let{service:n,type:r,id:a,normal:o}=t;const[s,u]=e.React.useState(null);return e.React.useEffect(function(){u(void 0),a&&ze(n,r,a).then(function(f){return u(f!==!1?f:"N/A")})},[a]),e.React.createElement(S,{variant:o?"text-md/semibold":"text-md/medium",color:o?"TEXT_NORMAL":"TEXT_MUTED"},s??"-")}const{ScrollView:mt,View:ee}=L.General,{FormRow:B}=L.Forms,ge=l.findByStoreName("UserStore");function At(){H.useProxy(E),H.useProxy(y),Q();const t=e.stylesheet.createThemedStyleSheet({song:{backgroundColor:b.semanticColors.BG_MOD_FAINT,borderRadius:8},serviceFrame:{height:24,width:24,backgroundColor:b.semanticColors.BG_MOD_FAINT,borderRadius:2147483647}}),n=!!I(),r=!!E.data;return React.createElement(mt,null,React.createElement(ue,{title:"Songs",icon:p.getAssetIDByName("abc"),padding:!0},n&&r?React.createElement(ee,{style:{flexDirection:"column",gap:8}},E.data.songs.map(function(a,o){return React.createElement(B,{label:a===null?"Press to add song in this position":React.createElement(St,{service:a.service,type:a.type,id:a.id,normal:!0}),leading:a===null?React.createElement(ee,{style:t.serviceFrame}):React.createElement(e.ReactNative.Image,{style:t.serviceFrame,source:p.getAssetIDByName("img_account_sync_spotify_light_and_dark")}),onLongPress:function(){return a&&Z(K,{song:a,remove:function(){return E.data.songs[o]=null}})},onPress:function(){return me.showInputAlert({title:"Add song",placeholder:["https://open.spotify.com/track/ABC","https://open.spotify.com/album/ABC","https://open.spotify.com/playlist/ABC","https://spotify.link/ABC"].sort(function(){return Math.random()>.5?1:-1})[0],initialValue:a&&fe(a.service,a.type,a.id),cancelText:"Cancel",confirmText:"Save",onConfirm:async function(s){const u=s.match(Ae.HTTP_REGEX_MULTI)?.[0];if(!u)throw new Error("Invalid link!");let f=new URL(u),i=f.hostname,g,m,A;if(i==="spotify.link"&&(g="spotify",f=new URL((await fetch(u)).url),i=f.hostname),i==="open.spotify.com"){g="spotify";const[k,v,c]=f.pathname.split("/");["album","track","playlist"].includes(v)&&c&&(m=v,A=c)}if(!g||!m||!A)throw new Error("Missing service, type or id!");if(!await Fe(g,m,A))throw new Error("Invalid song!");E.data.songs[o]={service:g,type:m,id:A}}})},style:t.song})})):n?React.createElement(e.ReactNative.ActivityIndicator,{size:"small",style:{flex:1}}):React.createElement(S,{variant:"text-md/semibold",color:"TEXT_NORMAL",align:"center"},"Authenticate first to manage your songs")),React.createElement(ue,{title:"Authentication",icon:p.getAssetIDByName("lock")},I()?React.createElement(React.Fragment,null,React.createElement(B,{label:"Log out",subLabel:"Logs you out of SongSpotlight",leading:React.createElement(B.Icon,{source:p.getAssetIDByName("ic_logout_24px")}),onPress:function(){var a;(a=y).auth??(a.auth={}),delete y.auth[ge.getCurrentUser().id],delete E.data,C.showToast("Successfully logged out",p.getAssetIDByName("ic_logout_24px"))}}),React.createElement(B,{label:"Delete data",subLabel:"Deletes your SongSpotlight data",leading:React.createElement(B.Icon,{source:p.getAssetIDByName("trash")}),onPress:async function(){var a;await $e(),(a=y).auth??(a.auth={}),delete y.auth[ge.getCurrentUser().id],delete E.data,C.showToast("Successfully deleted data",p.getAssetIDByName("trash"))}})):React.createElement(B,{label:"Authenticate",leading:React.createElement(B.Icon,{source:p.getAssetIDByName("copy")}),trailing:B.Arrow,onPress:bt})),React.createElement(ee,{style:{height:12}}))}const y=be.storage;let Re;const E=H.wrapSync(H.createStorage({get:function(){return Re},set:function(t){Re=t}}));async function te(){try{E.data=await Le()}catch{}}let we;var xt={onLoad:function(){I()&&te(),we=Rt()},onUnload:function(){return we?.()},settings:At};return N.cache=E,N.default=xt,N.fillCache=te,N.vstorage=y,Object.defineProperty(N,"__esModule",{value:!0}),N})({},vendetta.plugin,vendetta.storage,vendetta.metro.common,vendetta.metro,vendetta.patcher,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta,vendetta.utils,vendetta.ui.alerts,vendetta.constants);
