(function(N,Re,M,e,l,K,S,d,D,v,we,Tt,Ee,ve){"use strict";const q="https://songspotlight.nexpid.xyz/";var T={get api(){return h.host?h.host.endsWith("/")?h.host:`${h.host}/`:q},oauth2:{clientId:"1157745434140344321",get redirectURL(){return`${h.host?h.host.endsWith("/")?h.host:`${h.host}/`:q}api/oauth2-response`}}};function Ce(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Se(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function U(t,n,r){return ee()?U=Reflect.construct:U=function(a,o,c){var u=[null];u.push.apply(u,o);var f=Function.bind.apply(a,u),i=new f;return c&&O(i,c.prototype),i},U.apply(null,arguments)}function _(t){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},_(t)}function be(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&O(t,n)}function me(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function Ae(t,n){return n&&(Te(n)==="object"||typeof n=="function")?n:Ce(t)}function O(t,n){return O=Object.setPrototypeOf||function(r,a){return r.__proto__=a,r},O(t,n)}function Te(t){"@swc/helpers - typeof";return t&&typeof Symbol<"u"&&t.constructor===Symbol?"symbol":typeof t}function j(t){var n=typeof Map=="function"?new Map:void 0;return j=function(r){if(r===null||!me(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n<"u"){if(n.has(r))return n.get(r);n.set(r,a)}function a(){return U(r,arguments,_(this).constructor)}return a.prototype=Object.create(r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),O(a,r)},j(t)}function ee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function xe(t){var n=ee();return function(){var r=_(t),a;if(n){var o=_(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return Ae(this,a)}}const te=l.findByStoreName("UserStore");let k=function(t){be(r,t);var n=xe(r);function r(a){Se(this,r);var o;return o=n.call(this,`${a.status}: ${a.message}${a.error?` (${a.error})`:""}`),o.name=o.constructor.name,o}return r}(j(Error));function x(){return h.auth?.[te.getCurrentUser()?.id]}async function H(){var t;const n=new Error("Unauthorized, try logging out and back in again");let r=x();if(!r)throw n;if(Date.now()>=r.expiresAt){const a=await fetch(`${T.api}api/refresh-access-token?refresh_token=${encodeURIComponent(r.refreshToken)}`);if(a.status!==200)throw new k(await a.json());r=await a.json(),(t=h).auth??(t.auth={}),h.auth[te.getCurrentUser().id]=r}return r.accessToken}async function Ie(t){const n=await fetch(`${T.api}api/get-access-token?code=${encodeURIComponent(t)}`);if(n.status===200)return await n.json();throw new k(await n.json())}async function Pe(t){const n=new URLSearchParams;n.append("id",t);const r=await fetch(`${T.api}api/get-profile-data?${n.toString()}`);if(r.status===200)return await r.json();throw new k(await r.json())}async function Be(){if(!x())return;const t=await fetch(`${T.api}api/get-data`,{headers:{authorization:await H()}});if(t.status===200)return await t.json();throw new k(await t.json())}async function Ne(t){if(!x())return;const n=await fetch(`${T.api}api/sync-data`,{method:"POST",headers:{authorization:await H(),"content-type":"application/json"},body:JSON.stringify(t)});if(n.status===200)return await n.json();throw new k(await n.json())}async function ke(){if(!x())return;const t=await fetch(`${T.api}api/delete-data`,{method:"DELETE",headers:{authorization:await H()}});if(t.status===200)return await t.json();throw new k(await t.json())}var De=`<!DOCTYPE html>
<html></html>
<script>
  const RNWV = window.ReactNativeWebView;

  /** @type {HTMLAudioElement[]} */
  const audios = AUDIOS_VARIABLE.map((x) => new Audio(x));
  let position = 0;

  /** @argument enabled {boolean} */
  const playback = (enabled) => {
    audios.forEach((x, i) => {
      if (i === position && enabled) x.play();
      else {
        if (i !== position) x.currentTime = 0;
        x.pause();
      }
    });
  };

  audios.forEach((x) =>
    x.addEventListener("ended", () => RNWV.postMesssage("ended"))
  );

  window.addEventListener("message", (ev) => {
    const { action, pos } = ev.data;
    if (!action) return;

    if (pos !== undefined) position = audios[pos] ? pos : 0;

    if (action === "play") playback(true);
    else if (action === "pause") playback(false);
  });
<\/script>`,_e=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1 12C1 5.925 5.925 1 12 1C18.075 1 23 5.925 23 12C23 18.075 18.075 23 12 23C5.925 23 1 18.075 1 12ZM8.5 7C8.36739 7 8.24021 7.05268 8.14645 7.14645C8.05268 7.24021 8 7.36739 8 7.5V16.5C8 16.6326 8.05268 16.7598 8.14645 16.8536C8.24021 16.9473 8.36739 17 8.5 17H10.5C10.6326 17 10.7598 16.9473 10.8536 16.8536C10.9473 16.7598 11 16.6326 11 16.5V7.5C11 7.36739 10.9473 7.24021 10.8536 7.14645C10.7598 7.05268 10.6326 7 10.5 7H8.5ZM13.5 7C13.3674 7 13.2402 7.05268 13.1464 7.14645C13.0527 7.24021 13 7.36739 13 7.5V16.5C13 16.6326 13.0527 16.7598 13.1464 16.8536C13.2402 16.9473 13.3674 17 13.5 17H15.5C15.6326 17 15.7598 16.9473 15.8536 16.8536C15.9473 16.7598 16 16.6326 16 16.5V7.5C16 7.36739 15.9473 7.24021 15.8536 7.14645C15.7598 7.05268 15.6326 7 15.5 7H13.5Z" fill="white"/>
</svg>`,Oe=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1 12C1 5.925 5.925 1 12 1C18.075 1 23 5.925 23 12C23 18.075 18.075 23 12 23C5.925 23 1 18.075 1 12ZM9.75 7.433C9.67399 7.38912 9.58777 7.36601 9.5 7.36601C9.41224 7.36601 9.32601 7.38911 9.25001 7.433C9.174 7.47688 9.11088 7.54 9.06699 7.616C9.02311 7.69201 9 7.77823 9 7.866V16.134C9 16.2218 9.02311 16.308 9.06699 16.384C9.11088 16.46 9.174 16.5231 9.25001 16.567C9.32601 16.6109 9.41224 16.634 9.5 16.634C9.58777 16.634 9.67399 16.6109 9.75 16.567L16.911 12.433C16.987 12.3891 17.0501 12.326 17.094 12.25C17.1379 12.174 17.161 12.0878 17.161 12C17.161 11.9122 17.1379 11.826 17.094 11.75C17.0501 11.674 16.987 11.6109 16.911 11.567L9.75 7.433Z" fill="white"/>
</svg>`,$e=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.7 1C12.5143 1 12.3363 1.07375 12.205 1.20503C12.0738 1.3363 12 1.51435 12 1.7V6.85L2.05 1.107C1.94368 1.04561 1.82308 1.01327 1.7003 1.01322C1.57753 1.01316 1.4569 1.0454 1.35053 1.1067C1.24415 1.16799 1.15576 1.25618 1.09424 1.36243C1.03271 1.46867 1.00021 1.58923 1 1.712V14.287C0.999863 14.4099 1.03211 14.5308 1.09349 14.6373C1.15487 14.7438 1.24322 14.8323 1.34966 14.8938C1.4561 14.9553 1.57686 14.9877 1.6998 14.9878C1.82275 14.9878 1.94353 14.9555 2.05 14.894L12 9.149V14.3C12 14.4857 12.0738 14.6637 12.205 14.795C12.3363 14.9262 12.5143 15 12.7 15H14.3C14.4857 15 14.6637 14.9262 14.795 14.795C14.9262 14.6637 15 14.4857 15 14.3V1.7C15 1.51435 14.9262 1.3363 14.795 1.20503C14.6637 1.07375 14.4857 1 14.3 1H12.7Z" fill="white"/>
</svg>`;const V=new Map,z=async function(t,n,r){const a=`${t}${n}${r}`;if(V.has(a))return V.get(a);if(t==="spotify"){const o=await(await fetch(`https://open.spotify.com/embed/${n}/${r}`)).text(),c=JSON.parse(`{"props"${o.split('{"props"')[1].split("<\/script>")[0]}`);return V.set(a,c),c}else return!1};async function Le(t,n,r){if(t==="spotify"){const a=(await z(t,n,r))?.props?.pageProps?.state?.data?.entity;return a?.name&&a?.coverArt?a:!1}else return!1}async function Me(t,n,r){return t==="spotify"?(await z(t,n,r))?.props?.pageProps?.state?.data?.entity?.name??!1:!1}async function Ue(t,n,r){return t==="spotify"?(await z(t,n,r)).page?.props?.status!==404:!1}const je=l.findByStoreName("ThemeStore"),He=function(t,n){return je.theme!=="light"?t:n},F=function(t,n,r){const a=function(i){return i.match(/\w\w/g)?.map(function(y){return parseInt(y,16)})??[0,0,0]},o=function(i){return`#${i.map(function(y){return y.toString(16).padStart(2,"0")}).join("")}`},c=a(t),u=a(n),f=c.map(function(i,y){return Math.round(i+(u[y]-i)*r)});return o(f)},Ve=l.findByStoreName("ThemeStore"),ze=l.findByProps("colors","meta");l.findByProps("triggerHaptic");const{TextStyleSheet:Fe}=l.findByProps("TextStyleSheet"),{View:$,Text:ne,Pressable:Ge}=D.General;l.findByProps("TableRow");const We=l.findByProps("ActionSheet")?.ActionSheet??l.find(function(t){return t.render?.name==="ActionSheet"}),Xe=l.findByProps("openLazy","hideActionSheet"),{openLazy:Je,hideActionSheet:L}=Xe,{ActionSheetTitleHeader:Ye,ActionSheetCloseButton:Ze,ActionSheetContentContainer:Qe}=l.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");l.findByProps("ActionSheetRow")?.ActionSheetRow,l.findByName("Navigator")??l.findByProps("Navigator")?.Navigator,l.findByProps("getRenderCloseButton")?.getRenderCloseButton??l.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,l.findByProps("popModal","pushModal");const ae=l.findByProps("useSearchControls"),G=l.findByProps("useSettingSearchQuery"),Ke=l.findByName("SettingSearchBar"),{SvgXml:re}=l.findByProps("SvgXml");l.findByProps("useInMainTabsExperiment","isInMainTabsExperiment");const qe=l.find(function(t){return t?.WebView&&!t.default}).WebView;function et(t){return ze.meta.resolveSemanticColor(Ve.theme,t)}function W(t,n){try{Je(new Promise(function(r){return r({default:t})}),"ActionSheet",n)}catch(r){we.logger.error(r.stack),S.showToast("Got error when opening ActionSheet! Please check debug logs",d.getAssetIDByName("Smal"))}}Object.assign(function(t){let{searchContext:n,controls:r}=t;return e.React.createElement(e.ReactNative.ScrollView,{scrollEnabled:!1},e.React.createElement(ae.default,{searchContext:n,controls:r},e.React.createElement(Ke,null)))},{useAdvancedSearch:function(t){const n=G.useSettingSearchQuery(),r=ae.useSearchControls(t,!1,function(){});return e.React.useEffect(function(){return function(){G.setSettingSearchQuery(""),G.setIsSettingSearchActive(!1)}},[]),[n,r]}});function tt(t){let{title:n,onPress:r,icon:a}=t;const o=e.stylesheet.createThemedStyleSheet({androidRipple:{color:v.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:v.semanticColors.HEADER_SECONDARY,opacity:.5}}),c=r?Ge:$;return e.React.createElement(c,{android_ripple:o.androidRipple,disabled:!1,accessibilityRole:"button",onPress:r,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},a&&e.React.createElement($,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:o.icon,source:a,resizeMode:"contain"})),e.React.createElement(C,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},n))}function ie(t){let{title:n,onTitlePress:r,icon:a,children:o,padding:c}=t;const u=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:v.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement($,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(tt,{title:n,onPress:r,icon:a}),e.React.createElement($,{style:u.main},c?e.React.createElement($,{style:{paddingHorizontal:16,paddingVertical:16}},o):o))}var oe;(function(t){function n(a){let{children:o,onPress:c}=a;return e.React.createElement(C,{variant:"text-md/bold",onPress:c},o)}t.Bold=n;function r(a){let{children:o,onPress:c}=a;return e.React.createElement(ne,{style:{textDecorationLine:"underline"},onPress:c},o)}t.Underline=r})(oe||(oe={}));function C(t){let{variant:n,lineClamp:r,color:a,align:o,style:c,onPress:u,getChildren:f,children:i,liveUpdate:y}=t;const[b,m]=e.React.useReducer(function(B){return~B},0);return e.React.useEffect(function(){if(!y)return;const B=new Date().setMilliseconds(1e3);let E,s;return s=setTimeout(function(){m(),E=setInterval(m,1e3)},B-Date.now()),function(){clearTimeout(s),clearInterval(E)}},[]),e.React.createElement(ne,{style:[n?Fe[n]:{},a?{color:et(v.semanticColors[a])}:{},o?{textAlign:o}:{},c??{}],numberOfLines:r,onPress:u},f?.()??i)}const ce=function(t,n,r){return t==="spotify"?`https://open.spotify.com/${n}/${r}`:void 0};l.findByStoreName("ThemeStore");async function nt(t){await e.ReactNative.Linking.canOpenURL(t)?e.url.openDeeplink(t):await e.ReactNative.Linking.canOpenURL("market://details?id=com.spotify.music")?e.url.openDeeplink("market://details?id=com.spotify.music"):e.url.openDeeplink("itms-apps://itunes.apple.com/app/id324684580")}let se=0;function at(t){clearTimeout(se),se=setTimeout(t,1500)}let le;function X(){const t=le?.slice();le=JSON.stringify(R.data),t&&t!==JSON.stringify(R.data)&&at(function(){return Ne(R.data.songs)})}const{FormRow:I}=D.Forms,rt={color:"TEXT_DANGER",variant:"text-md/semibold"};function J(t){let{song:n,remove:r,showAdd:a}=t;const o=e.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:v.semanticColors.TEXT_DANGER}});return React.createElement(We,null,React.createElement(Qe,null,React.createElement(Ye,{title:"Edit Song",trailing:React.createElement(Ze,{onPress:L})}),n.service==="spotify"&&React.createElement(I,{label:"Open in Spotify",leading:React.createElement(I.Icon,{source:d.getAssetIDByName("img_account_sync_spotify_light_and_dark")}),onPress:function(){nt(`spotify://${n.type}/${n.id}`),L()}}),React.createElement(I,{label:"Copy link",leading:React.createElement(I.Icon,{source:d.getAssetIDByName("copy")}),onPress:function(){e.clipboard.setString(ce(n.service,n.type,n.id)),S.showToast("Copied to clipboard.",d.getAssetIDByName("toast_copy_link")),L()}}),a&&React.createElement(I,{label:"Add to your profile",leading:React.createElement(I.Icon,{source:d.getAssetIDByName("ic_pin")}),onPress:function(){L();const c=R.data?.songs;if(!c)return;const u=c.findIndex(function(f){return f===null});if(u===-1)return S.showToast("No space left!",d.getAssetIDByName("Small"));c[u]=n,X(),S.showToast("Added to your profile",d.getAssetIDByName("Check"))}}),r&&React.createElement(I,{label:React.createElement(C,rt,"Remove song"),leading:React.createElement(I.Icon,{style:o.destructiveIcon,source:d.getAssetIDByName("trash")}),onPress:function(){r(),S.showToast("Removed",d.getAssetIDByName("toast_trash")),L()}})))}const{View:g}=D.General,it=e.ReactNative.Animated.createAnimatedComponent(e.ReactNative.Pressable),ot=l.findByName("UserProfileSection"),{YouScreenProfileCard:ct}=l.findByProps("YouScreenProfileCard"),{TableRowGroupTitle:st}=l.findByProps("TableRowGroupTitle"),lt=l.findByStoreName("UserStore"),Y=new Map,ut=function(t){let{song:n,showAdd:r,remove:a}=t;const[o,c]=e.React.useState(!1),[u,f]=e.React.useState(0),[i,y]=e.React.useState(void 0),b=i&&i.type==="track"||n.type==="track"?600/152:600/352,m=e.React.useRef(null),B=e.React.useRef(Math.random().toString()).current;e.React.useEffect(function(){o&&Y.forEach(function(p,w){return w!==B&&p()}),m.current?.injectJavaScript(`window.postMessage(${JSON.stringify({action:o?"play":"pause",pos:u})})`)},[o,u]),Y.set(B,function(){return c(!1)}),e.React.useEffect(function(){return function(){Y.delete(B)}},[]);const E=i&&(i.coverArt.extractedColors.colorLight?He(i.coverArt.extractedColors.colorDark.hex,i.coverArt.extractedColors.colorLight.hex):i.coverArt.extractedColors.colorDark.hex),s=e.stylesheet.createThemedStyleSheet({emptyCard:{width:"100%",aspectRatio:b,backgroundColor:v.semanticColors.BG_MOD_FAINT,borderRadius:12,justifyContent:"center",alignItems:"center"},noImage:{tintColor:v.semanticColors.TEXT_DANGER,width:36,height:36},card:{width:"100%",backgroundColor:E&&F(E,"#000000",.15),aspectRatio:b,borderRadius:12,flexDirection:"column"},cardFirst:{backgroundColor:E,width:"100%",height:"100%",borderRadius:12},cardFirstContent:{flexDirection:"row",gap:8,padding:10},cardImage:{height:"100%",aspectRatio:1,borderRadius:8,backgroundColor:v.semanticColors.BG_MOD_SUBTLE,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:4.65,elevation:8},cardContent:{width:"90%",flexDirection:"column",gap:2,justifyContent:"center",flexGrow:0,flexShrink:0},cardContentArtist:{flexDirection:"row",gap:4,alignItems:"center",flexGrow:0,flexShrink:0},cardContentTag:{backgroundColor:"#ffffffb3",paddingHorizontal:6,paddingVertical:1,borderRadius:4},cardOther:{position:"absolute",width:"100%",height:"100%",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-end",padding:10},cardOtherBottom:{flexDirection:"row-reverse",alignItems:"center",gap:4},cardTracklist:{height:"100%",paddingHorizontal:8,flexDirection:"column"},cardTracklistEntry:{backgroundColor:E&&F(E,"#000000",.25),borderRadius:5,flexDirection:"column",padding:8,flexGrow:0,flexShrink:0},cardTracklistEntryPlaying:{backgroundColor:E&&F(E,"#000000",.35)},cardTracklistEntryTitle:{width:"95%"},cardTracklistEntryOther:{position:"absolute",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",alignItems:"flex-end",padding:5},webview:{display:"none",width:0,height:0,opacity:0},secondaryText:{opacity:.7},androidRipple:{color:v.semanticColors.ANDROID_RIPPLE,cornerRadius:2147483647},androidRippleTwo:{color:v.semanticColors.ANDROID_RIPPLE,cornerRadius:8}}),he=function(){y(void 0),Le(n.service,n.type,n.id).then(function(p){return y(p??!1)}).catch(function(p){return S.showToast(`${p}`,d.getAssetIDByName("Small")),y(!1)})};e.React.useEffect(he,[]);const bt=i&&i.coverArt.sources.sort(function(p,w){return p.width*p.height-w.width*w.height})[0],ye=e.React.useRef();e.React.useEffect(function(){ye.current?.scrollToIndex({animated:!0,index:u,viewOffset:16})},[u]);const mt=function(p){let{item:w,selected:A,jump:At,more:ge}=p;return e.React.createElement(it,{android_ripple:s.androidRippleTwo,style:[s.cardTracklistEntry,A&&s.cardTracklistEntryPlaying],onPress:At,onLongPress:ge},e.React.createElement(C,{style:s.cardTracklistEntryTitle,variant:A?"text-sm/bold":"text-sm/semibold",color:"WHITE",lineClamp:1},w.title),e.React.createElement(g,{style:s.cardContentArtist},w.isExplicit&&e.React.createElement(C,{variant:"text-xs/semibold",color:"BLACK",style:s.cardContentTag},"E"),e.React.createElement(C,{variant:A?"text-xs/bold":"text-xs/semibold",color:"WHITE",style:s.secondaryText,lineClamp:1},w.subtitle)),e.React.createElement(g,{style:s.cardTracklistEntryOther},e.React.createElement(e.ReactNative.Pressable,{android_ripple:s.androidRipple,onPress:ge},e.React.createElement(e.ReactNative.Image,{source:d.getAssetIDByName("ic_feed_more")}))))};return i?e.React.createElement(e.React.Fragment,null,e.React.createElement(g,{style:s.card,pointerEvents:"box-none"},e.React.createElement(g,{style:[s.cardFirst,i.type!=="track"&&{height:"40%"}]},e.React.createElement(g,{style:s.cardFirstContent},e.React.createElement(e.ReactNative.Image,{style:s.cardImage,source:{uri:bt.url}}),e.React.createElement(g,{style:s.cardContent},e.React.createElement(C,{variant:"text-sm/bold",color:"WHITE",lineClamp:1},i.title),i.type==="track"?e.React.createElement(g,{style:s.cardContentArtist},i.isExplicit&&e.React.createElement(C,{variant:"text-xs/semibold",color:"BLACK",style:s.cardContentTag},"E"),e.React.createElement(C,{variant:"text-xs/semibold",color:"WHITE",style:s.secondaryText,lineClamp:1},i.artists.map(function(p){return p.name}).join(", "))):e.React.createElement(C,{variant:"text-xs/semibold",color:"WHITE",style:s.secondaryText,lineClamp:1},i.subtitle))),e.React.createElement(g,{style:s.cardOther},e.React.createElement(e.ReactNative.Pressable,{android_ripple:s.androidRipple,onPress:function(){return W(J,{song:n,showAdd:r,remove:a})}},e.React.createElement(e.ReactNative.Image,{source:d.getAssetIDByName("ic_feed_more")})),e.React.createElement(g,{style:s.cardOtherBottom},e.React.createElement(e.ReactNative.Pressable,{android_ripple:s.androidRipple,onPress:function(){return c(!o)}},e.React.createElement(re,{width:30,height:30,xml:o?_e:Oe})),i.type!=="track"&&e.React.createElement(e.ReactNative.Pressable,{android_ripple:s.androidRipple,onPress:function(){c(!1);const p=u+1;p<i.trackList.length?(f(p),c(!0)):f(0)}},e.React.createElement(re,{width:20,height:20,xml:$e}))))),i.type!=="track"&&e.React.createElement(e.ReactNative.FlatList,{nestedScrollEnabled:!0,ref:ye,style:s.cardTracklist,data:i.trackList,ListHeaderComponent:function(){return e.React.createElement(g,{style:{height:8}})},ListFooterComponent:function(){return e.React.createElement(g,{style:{height:8}})},ItemSeparatorComponent:function(){return e.React.createElement(g,{style:{height:8}})},renderItem:function(p){let{item:w,index:A}=p;return e.React.createElement(mt,{item:w,selected:A===u,jump:function(){f(A),c(!0)},more:function(){return W(J,{song:{service:"spotify",type:"track",id:w.uid},showAdd:r})}})}})),i.isPlayable&&e.React.createElement(qe,{source:{html:De.replace(/AUDIOS_VARIABLE/g,JSON.stringify(i.type==="track"?[i.audioPreview.url]:i.trackList.map(function(p){return p.audioPreview.url})))},style:s.webview,mediaPlaybackRequiresUserAction:!1,onMessage:function(p){let{nativeEvent:{data:w}}=p;if(console.log(w),w==="ended"&&(console.log("finished playing :3"),c(!1),i.type!=="track")){const A=u+1;A<i.trackList.length?(f(A),c(!0)):f(0)}},ref:m,pointerEvents:"none"})):i===!1?e.React.createElement(g,{style:s.emptyCard},e.React.createElement(e.ReactNative.Pressable,{android_ripple:s.androidRipple,onPress:he},e.React.createElement(e.ReactNative.Image,{style:s.noImage,source:d.getAssetIDByName("ic_message_retry"),resizeMode:"contain"}))):e.React.createElement(g,{style:s.emptyCard},e.React.createElement(e.ReactNative.ActivityIndicator,{size:"large"}))};function ue(t){let{userId:n,you:r}=t;const[a,o]=e.React.useState(void 0),c=lt.getCurrentUser().id;e.React.useEffect(function(){c===n&&R.data?o(R.data.songs):Pe(n).then(function(i){return o(i?.songs??[])}).catch(function(i){return S.showToast(`${i}`,d.getAssetIDByName("Small")),o([])})},[]);const u=a&&!a.filter(function(i){return!!i}).length,f=a?a.map(function(i,y){return i?i.service==="spotify"&&e.React.createElement(ut,{song:i,showAdd:n!==c&&!!x(),remove:n===c&&function(){const b=R.data?.songs;b&&(b[y]=null,X())}}):null}):e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small",style:{flex:1}});return!u&&(r?e.React.createElement(ct,null,e.React.createElement(st,{title:"Song Spotlight"}),e.React.createElement(g,{style:{flexDirection:"column",gap:8,marginTop:4}},f)):e.React.createElement(ot,{title:"Song Spotlight",showContainer:!0},e.React.createElement(g,{style:{flexDirection:"column",gap:8,paddingHorizontal:8,paddingVertical:8}},f)))}const dt=l.findByName("UserProfileBio",!1),ft=l.findByName("YouAboutMeCard",!1);function pt(){const t=new Array;return t.push(K.after("default",dt,function(n,r){let[a]=n;return e.React.createElement(e.React.Fragment,{},[a?.displayProfile?.userId&&e.React.createElement(ue,{userId:a.displayProfile.userId,you:!1}),r])})),t.push(K.after("default",ft,function(n,r){let[{userId:a}]=n;return e.React.createElement(e.React.Fragment,{},[e.React.createElement(ue,{userId:a,you:!0}),r])})),function(){return t.forEach(function(n){return n()})}}const{pushModal:ht,popModal:yt}=l.findByProps("pushModal","popModal"),gt=l.findByName("OAuth2AuthorizeModal"),Rt=l.findByStoreName("UserStore");function wt(){ht({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:gt,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:T.oauth2.clientId,redirectUri:T.oauth2.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(t){var n;let{location:r}=t;try{const a=new URL(r).searchParams.get("code"),o=await Ie(a);(n=h).auth??(n.auth={}),h.auth[Rt.getCurrentUser().id]=o,Q(),S.showToast("Successfully authenticated",d.getAssetIDByName("Check"))}catch(a){S.showToast(String(a),d.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return yt("oauth2-authorize")}},closable:!0}})}function Et(t){let{service:n,type:r,id:a,normal:o}=t;const[c,u]=e.React.useState(null);return e.React.useEffect(function(){u(void 0),a&&Me(n,r,a).then(function(f){return u(f!==!1?f:"N/A")})},[a]),e.React.createElement(C,{variant:o?"text-md/semibold":"text-md/medium",color:o?"TEXT_NORMAL":"TEXT_MUTED"},c??"-")}const{ScrollView:vt,View:Z}=D.General,{FormRow:P}=D.Forms,de=l.findByStoreName("UserStore");function Ct(){M.useProxy(R),M.useProxy(h),X();const t=e.stylesheet.createThemedStyleSheet({song:{backgroundColor:v.semanticColors.BG_MOD_FAINT,borderRadius:8},serviceFrame:{height:24,width:24,backgroundColor:v.semanticColors.BG_MOD_FAINT,borderRadius:2147483647}}),n=!!x(),r=!!R.data;return React.createElement(vt,null,React.createElement(ie,{title:"Songs",icon:d.getAssetIDByName("abc"),padding:!0},n&&r?React.createElement(Z,{style:{flexDirection:"column",gap:8}},R.data.songs.map(function(a,o){return React.createElement(P,{label:a===null?"Press to add song in this position":React.createElement(Et,{service:a.service,type:a.type,id:a.id,normal:!0}),leading:a===null?React.createElement(Z,{style:t.serviceFrame}):React.createElement(e.ReactNative.Image,{style:t.serviceFrame,source:d.getAssetIDByName("img_account_sync_spotify_light_and_dark")}),onLongPress:function(){return a&&W(J,{song:a,remove:function(){return R.data.songs[o]=null}})},onPress:function(){return Ee.showInputAlert({title:"Add song",placeholder:["https://open.spotify.com/track/ABC","https://open.spotify.com/album/ABC","https://open.spotify.com/playlist/ABC","https://spotify.link/ABC"].sort(function(){return Math.random()>.5?1:-1})[0],initialValue:a&&ce(a.service,a.type,a.id),cancelText:"Cancel",confirmText:"Save",onConfirm:async function(c){const u=c.match(ve.HTTP_REGEX_MULTI)?.[0];if(!u)throw new Error("Invalid link!");let f=new URL(u),i=f.hostname,y,b,m;if(i==="spotify.link"&&(y="spotify",f=new URL((await fetch(u)).url),i=f.hostname),i==="open.spotify.com"){y="spotify";const[B,E,s]=f.pathname.split("/");["album","track","playlist"].includes(E)&&s&&(b=E,m=s)}if(!y||!b||!m)throw new Error("Missing service, type or id!");if(!await Ue(y,b,m))throw new Error("Invalid song!");R.data.songs[o]={service:y,type:b,id:m}}})},style:t.song})})):n?React.createElement(e.ReactNative.ActivityIndicator,{size:"small",style:{flex:1}}):React.createElement(C,{variant:"text-md/semibold",color:"TEXT_NORMAL",align:"center"},"Authenticate first to manage your songs")),React.createElement(ie,{title:"Authentication",icon:d.getAssetIDByName("lock")},x()?React.createElement(React.Fragment,null,React.createElement(P,{label:"Log out",subLabel:"Logs you out of SongSpotlight",leading:React.createElement(P.Icon,{source:d.getAssetIDByName("ic_logout_24px")}),onPress:function(){var a;(a=h).auth??(a.auth={}),delete h.auth[de.getCurrentUser().id],delete R.data,S.showToast("Successfully logged out",d.getAssetIDByName("ic_logout_24px"))}}),React.createElement(P,{label:"Delete data",subLabel:"Deletes your SongSpotlight data",leading:React.createElement(P.Icon,{source:d.getAssetIDByName("trash")}),onPress:async function(){var a;await ke(),(a=h).auth??(a.auth={}),delete h.auth[de.getCurrentUser().id],delete R.data,S.showToast("Successfully deleted data",d.getAssetIDByName("trash"))}})):React.createElement(P,{label:"Authenticate",leading:React.createElement(P.Icon,{source:d.getAssetIDByName("copy")}),trailing:P.Arrow,onPress:wt})),React.createElement(Z,{style:{height:12}}))}const h=Re.storage;let fe;const R=M.wrapSync(M.createStorage({get:function(){return fe},set:function(t){fe=t}}));async function Q(){try{R.data=await Be()}catch{}}let pe;var St={onLoad:function(){x()&&Q(),pe=pt()},onUnload:function(){return pe?.()},settings:Ct};return N.cache=R,N.default=St,N.fillCache=Q,N.vstorage=h,Object.defineProperty(N,"__esModule",{value:!0}),N})({},vendetta.plugin,vendetta.storage,vendetta.metro.common,vendetta.metro,vendetta.patcher,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta,vendetta.utils,vendetta.ui.alerts,vendetta.constants);
