(function(w,e,K,D,x,b,O,m,fe,B,A){"use strict";const W=m.findByStoreName("ThemeStore"),J=m.findByProps("colors","meta");m.findByProps("triggerHaptic");const{TextStyleSheet:Q}=m.findByProps("TextStyleSheet"),{View:k,Text:I,Pressable:Z}=x.General;m.findByProps("ActionSheet")?.ActionSheet??m.find(function(t){return t.render?.name==="ActionSheet"}),m.findByProps("openLazy","hideActionSheet"),m.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),m.findByProps("ActionSheetRow")?.ActionSheetRow,m.findByName("Navigator"),m.findByProps("getRenderCloseButton"),m.findByProps("popModal","pushModal");function ee(t){return J.meta.resolveSemanticColor(W.theme,t)}function te(t){let{title:p,onPress:i,icon:o}=t;const n=e.stylesheet.createThemedStyleSheet({androidRipple:{color:B.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:B.semanticColors.HEADER_SECONDARY,opacity:.5}}),l=i?Z:k;return e.React.createElement(l,{android_ripple:n.androidRipple,disabled:!1,accessibilityRole:"button",onPress:i,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},o&&e.React.createElement(k,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:n.icon,source:o,resizeMode:"contain"})),e.React.createElement(h,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},p))}function F(t){let{title:p,onTitlePress:i,icon:o,children:n,padding:l}=t;const u=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:B.semanticColors.REDESIGN_ACTIVITY_CARD_BACKGROUND,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(k,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(te,{title:p,onPress:i,icon:o}),e.React.createElement(k,{style:u.main},l?e.React.createElement(k,{style:{paddingHorizontal:16,paddingVertical:16}},n):n))}var M;(function(t){function p(o){let{children:n,onPress:l}=o;return e.React.createElement(h,{variant:"text-md/bold",onPress:l},n)}t.Bold=p;function i(o){let{children:n,onPress:l}=o;return e.React.createElement(I,{style:{textDecorationLine:"underline"},onPress:l},n)}t.Underline=i})(M||(M={}));function h(t){let{variant:p,lineClamp:i,color:o,align:n,style:l,onPress:u,getChildren:a,children:f,liveUpdate:d}=t;const[s,g]=e.React.useReducer(function(R){return~R},0);return e.React.useEffect(function(){if(!d)return;const R=new Date().setMilliseconds(1e3);let y,v;return v=setTimeout(function(){g(),y=setInterval(g,1e3)},R-Date.now()),function(){clearTimeout(v),clearInterval(y)}},[]),e.React.createElement(I,{style:[p?Q[p]:{},o?{color:ee(B.semanticColors[o])}:{},n?{textAlign:n}:{},l??{}],numberOfLines:i,onPress:u},a?.()??f)}const{parseTimestamp:q}=m.findByProps("parseTimestamp","unparseTimestamp"),C=e.stylesheet.createThemedStyleSheet({code:{fontFamily:e.constants.Fonts.CODE_SEMIBOLD,backgroundColor:B.semanticColors.BACKGROUND_SECONDARY},timestamp:{backgroundColor:B.semanticColors.BACKGROUND_MODIFIER_ACCENT}});function ae(){const[t,p]=e.React.useState(Date.now());return e.React.useLayoutEffect(function(){return p(Date.now())},[r.time.acceptRelative]),e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",liveUpdate:!0,getChildren:function(){const i=new Date,o=[[4],[19,20],[4,18,2],i.getHours()<12&&[i.getHours()],[i.getHours(),i.getMinutes()],[i.getHours(),i.getMinutes(),i.getSeconds()]].filter(function(u){return!!u}),n=[];let l=-1;for(const[u,a,f]of o){l++;const d=new Date;d.setHours(u,a??0,f||0);let s=[d.getHours().toString(),a!==void 0&&d.getMinutes().toString().padStart(2,"0"),f!==void 0&&d.getSeconds().toString().padStart(2,"0")].filter(function(R){return!!R}).join(":");u<12&&(s+=" AM");const g=q(Math.floor(d.getTime()/1e3).toString(),d.getSeconds()===0?"t":"T");n.push(r.time.requireBackticks?e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:C.code},s):s),n.push(" \u2014 "),n.push(e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:C.timestamp,onPress:function(){return A.showToast(g.full,D.getAssetIDByName("ic_information_24px"))}},g.formatted)),l!==o.length-1&&n.push(`
`)}if(r.time.acceptRelative){n.push(`

`);const u=[["in 20 seconds",1e3*20],["8 minutes ago",-(1e3*60*8)]];l=-1;for(const[a,f]of u){const d=t+f,s=q(Math.floor(d/1e3).toString(),"R");n.push(r.time.requireBackticks?e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:C.code},a):a),n.push(" \u2014 "),n.push(e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:C.timestamp,onPress:function(){return A.showToast(s.full,D.getAssetIDByName("ic_information_24px"))}},s.formatted)),l!==u.length-1&&n.push(`
`)}}return n}})}const{parseTimestamp:H}=m.findByProps("parseTimestamp","unparseTimestamp"),_=e.stylesheet.createThemedStyleSheet({code:{fontFamily:e.constants.Fonts.CODE_SEMIBOLD,backgroundColor:B.semanticColors.BACKGROUND_SECONDARY},timestamp:{backgroundColor:B.semanticColors.BACKGROUND_MODIFIER_ACCENT}});function ne(){const[t,p]=e.React.useState(Date.now());return e.React.useLayoutEffect(function(){return p(Date.now())},[r.day.acceptRelative]),e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",liveUpdate:!0,getChildren:function(){const i=new Date,o=[[21,11,2023],[12,5],[1,8,20],[i.getDate(),i.getMonth()-1,i.getFullYear()],[i.getDate(),i.getMonth()-1],[i.getDate(),i.getMonth()-1,i.getFullYear()-2e3]].filter(function(u){return!!u}),n=[];let l=-1;for(let[u,a,f]of o){l++;const d=new Date().getFullYear(),s=new Date;f<100&&(f+=2e3),s.setFullYear(f??d,a,u);const g=H(Math.floor(s.getTime()/1e3).toString(),"d"),R=[r.day.american?a:u,r.day.american?u:a,f].join("/");n.push(r.day.requireBackticks?e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.code},R):R),n.push(" \u2014 "),n.push(e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.timestamp,onPress:function(){return A.showToast(g.full,D.getAssetIDByName("ic_information_24px"))}},g.formatted)),l!==o.length-1&&n.push(`
`)}if(r.day.acceptRelative){n.push(`

`);const u=1e3*60*60*24,a=u*(365+1/4),f=[["yesterday",-u],["in 2 days",u*2],["2 centuries ago",-(a*200)],["next week",u*7]];l=-1;for(const[d,s]of f){const g=t+s,R=H(Math.floor(g/1e3).toString(),"R");n.push(r.day.requireBackticks?e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.code},d):d),n.push(" \u2014 "),n.push(e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.timestamp,onPress:function(){return A.showToast(R.full,D.getAssetIDByName("ic_information_24px"))}},R.formatted)),l!==f.length-1&&n.push(`
`)}}return n}})}const{View:Y,ScrollView:re}=x.General,{FormSwitchRow:P,FormIcon:L}=x.Forms,{BadgableTabBar:ie}=m.findByProps("BadgableTabBar");function ce(){const[t,p]=e.React.useState("time");return r.time??={acceptRelative:!1,requireBackticks:b.storage.reqBackticks??!0},r.day??={acceptRelative:!1,requireBackticks:!0,american:!1},b.storage.alwaysLong!==void 0&&delete b.storage.alwaysLong,b.storage.reqBackticks!==void 0&&delete b.storage.reqBackticks,K.useProxy(r),e.React.createElement(re,null,e.React.createElement(Y,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(ie,{activeTab:t,onTabSelected:p,tabs:[{id:"day",title:"Date"},{id:"time",title:"Time"}]})),e.React.createElement(F,{title:"Info",icon:D.getAssetIDByName("ic_info_24px"),padding:!0},e.React.createElement(h,{variant:"text-md/semibold",color:"TEXT_NORMAL"},t==="time"?e.React.createElement(e.React.Fragment,null,"Send a message with a time code (in"," ",e.React.createElement(M.Bold,null,"HH:MM"),r.time.acceptRelative?", ":" or ",e.React.createElement(M.Bold,null,"HH:MM:SS"),r.time.acceptRelative&&e.React.createElement(e.React.Fragment,null," or relative")," format) and automatically turn it into a timestamp",`

`,e.React.createElement(ae,null)):e.React.createElement(e.React.Fragment,null,"Send a message with a date code (in"," ",e.React.createElement(M.Bold,null,r.day.american?"MM/DD":"DD/MM","/YY(YY)"),r.day.acceptRelative?", ":" or ",e.React.createElement(M.Bold,null,r.day.american?"MM/DD":"DD/MM","/MM"),r.day.acceptRelative&&e.React.createElement(e.React.Fragment,null," or relative")," format) and automatically turn it into a timestamp",`

`,e.React.createElement(ne,null)))),e.React.createElement(F,{title:"Settings",icon:D.getAssetIDByName("settings")},e.React.createElement(P,{key:`${t}_acceptRelative`,label:`Allow Relative ${t==="time"?"Time":"Date"}`,subLabel:t==="time"?"Formats relative time (in 10 seconds, 5 minutes ago)":"Formats relative date (in 2 days, 6 weeks ago)",leading:e.React.createElement(L,{source:D.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return r[t].acceptRelative=!r[t].acceptRelative},value:r[t].acceptRelative}),e.React.createElement(P,{key:`${t}_requireBackticks`,label:"Require Backticks",subLabel:`Require ${t==="day"?"date":"time"} to be surrounded by backticks (\`)`,leading:e.React.createElement(L,{source:D.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return r[t].requireBackticks=!r[t].requireBackticks},value:r[t].requireBackticks}),t==="day"&&e.React.createElement(P,{key:`${t}_american`,label:"'Merican Dates",subLabel:"Uses MM/DD instead of DD/MM",leading:e.React.createElement(L,{source:D.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return r.day.american=!r.day.american},value:r.day.american})),e.React.createElement(Y,{style:{marginBottom:16}}))}function se(t,p,i,o){const n=[["seconds?",1e3],["minutes?",6e4],["hours?",36e5]],l=31556952e3,u=1e3*60*60*24,a=[["days?",u],["weeks?",u*7],["months?",u*30.436875],["years?",l],["decades?",l*10],["century",l*100],["centuries",l*100],["millennium",l*1e3],["millennia",l*1e3]],f=[...t.time?n:[],...t.date?a:[]].filter(function(c){return!!c}),d=function(c){return c?["`","`"]:["(?:\\s|\\t|^)","(?:\\s|\\t|$)"]},s=d(p.time),g=d(p.date),R=function(c){return`in (an?|[0-9]+) (${c})`},y=function(c){return`(an?|[0-9]+) (${c}) ago`},v=[t.time&&[1,`${s[0]}${R(n.map(function(c){return c[0]}).join("|"))}${s[1]}`],t.time&&[-1,`${s[0]}${y(n.map(function(c){return c[0]}).join("|"))}${s[1]}`],t.date&&[1,`${g[0]}${R(a.map(function(c){return c[0]}).join("|"))}${g[1]}`],t.date&&[-1,`${g[0]}${y(a.map(function(c){return c[0]}).join("|"))}${g[1]}`]].filter(function(c){return!!c});for(const[c,S]of v)i=i.replace(new RegExp(S,"gi"),function(N,G,ue){const V=G.toLowerCase().startsWith("a")?1:Number(G);if(Number.isNaN(V))return N;const z=f.find(function(de){return de[0].toLowerCase().includes(ue)})?.[1];return z?o(N,z*V*c):N});const E=[["last week",-7],["yesterday",-1],["tomorrow",1],["next week",7]].map(function(c){return[`${g[0]}${c[0]}${g[1]}`,c[1]*1e3*60*60*24]}),T=[...t.date?E:[]].filter(function(c){return!!c});for(const[c,S]of T)i=i.replace(new RegExp(c,"gi"),function(N){return o(N,S)});return i}const U=m.findByProps("sendMessage","editMessage"),$=function(t){return/^\s$/.test(t)},X=function(t){let[p,i]=t,o=i?.content;if(typeof o!="string"||typeof i!="object")return;const n=function(a){return a?["`","`"]:["(?:\\s|\\t|^)","(?:\\s|\\t|$)"]},l=n(r.time?.requireBackticks),u=n(r.day?.requireBackticks);if(r.time){const a={otN:"[0-9]{1,2}",tN:"[0-9]{2}",abrv:"(?: ?(AM|PM))"},f=[`(${a.otN}:${a.tN}:${a.tN})${a.abrv}?`,`(${a.otN}:${a.tN})${a.abrv}?`,`(${a.otN})${a.abrv}`].map(function(d){return new RegExp(`${l[0]}${d}${l[1]}`,"gi")});for(const d of f)o=o.replace(d,function(s,g,R){let[y,v,E]=g.split(":").map(function(c){return Number(c)});if(y<0||y>24||typeof v=="number"&&(v<0||v>60)||typeof E=="number"&&(E<0||E>60))return s;R&&(R.toLowerCase()==="pm"&&y!==12?y+=12:R.toLowerCase()==="am"&&y===12&&(y=0));const T=new Date;return T.setHours(y,v??0,E??0,0),`${$(s[0])?s[0]:""}<t:${Math.floor(T.getTime()/1e3)}:${T.getSeconds()===0?"t":"T"}>${$(s[s.length-1])?s[s.length-1]:""}`})}if(r.day){const a={otN:"[0-9]{1,2}",tN:"[0-9]{2}",fN:"[0-9]{4}"},f=[`(${a.otN})\\/(${a.otN})\\/(${a.fN}|${a.tN})`,`(${a.otN})\\/(${a.otN})`].map(function(d){return new RegExp(`${u[0]}${d}${u[1]}`,"gi")});for(const d of f)o=o.replace(d,function(s,g,R,y){const v=new Date().getFullYear();let[E,T,c]=[Number(g),Number(R),y?Number(y):v];if(r.day.american){const N=T;T=E,E=N}if(E<0||E>31||T<0||T>12||c<0||c>9999)return s;c<100&&(c+=2e3);const S=new Date(0);return S.setFullYear(c,T-1,E),`${$(s[0])?s[0]:""}<t:${Math.floor(S.getTime()/1e3)}:d>${$(s[s.length-1])?s[s.length-1]:""}`})}o=se({time:!!r.time?.acceptRelative,date:!!r.day?.acceptRelative},{time:!!r.time?.requireBackticks,date:!!r.day?.requireBackticks},o,function(a,f){return`${$(a[0])?a[0]:""}<t:${Math.floor((Date.now()+f)/1e3)}:R>${$(a[a.length-1])?a[0]:""}`}),i.content=o};function oe(){const t=new Array;return t.push(O.before("sendMessage",U,X)),t.push(O.before("editMessage",U,X)),function(){return t.forEach(function(p){return p()})}}const r=b.storage;let j;var le={onLoad:function(){return j=oe()},onUnload:function(){return j?.()},settings:ce};return w.default=le,w.vstorage=r,Object.defineProperty(w,"__esModule",{value:!0}),w})({},vendetta.metro.common,vendetta.storage,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.patcher,vendetta.metro,vendetta,vendetta.ui,vendetta.ui.toasts);
