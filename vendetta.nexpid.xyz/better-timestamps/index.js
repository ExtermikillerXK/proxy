(function(C,e,W,S,P,N,I,f,Re,T,k){"use strict";const J=f.findByStoreName("ThemeStore"),Z=f.findByProps("colors","meta");f.findByProps("triggerHaptic");const ee=f.findByProps("TextStyleSheet").TextStyleSheet,{View:w,Text:F,Pressable:te}=P.General;f.findByProps("TableRow"),f.findByProps("ActionSheet")?.ActionSheet??f.find(function(a){return a.render?.name==="ActionSheet"}),f.findByProps("openLazy","hideActionSheet"),f.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),f.findByProps("ActionSheetRow")?.ActionSheetRow,f.findByName("Navigator")??f.findByProps("Navigator")?.Navigator,f.findByProps("getRenderCloseButton")?.getRenderCloseButton??f.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,f.findByProps("popModal","pushModal");const H=f.findByProps("useSearchControls"),x=f.findByProps("useSettingSearchQuery"),ae=f.findByName("SettingSearchBar");f.findByProps("SvgXml"),f.findByProps("useInMainTabsExperiment","isInMainTabsExperiment"),f.find(function(a){return a?.WebView&&!a.default}).WebView;function ne(a){return Z.meta.resolveSemanticColor(J.theme,a)}Object.assign(function(a){let{searchContext:g,controls:t}=a;return e.React.createElement(e.ReactNative.ScrollView,{scrollEnabled:!1},e.React.createElement(H.default,{searchContext:g,controls:t},e.React.createElement(ae,null)))},{useAdvancedSearch:function(a){const g=x.useSettingSearchQuery(),t=H.useSearchControls(a,!1,function(){});return e.React.useEffect(function(){return function(){x.setSettingSearchQuery(""),x.setIsSettingSearchActive(!1)}},[]),[g,t]}});function re(a){let{title:g,onPress:t,icon:o}=a;const r=e.stylesheet.createThemedStyleSheet({androidRipple:{color:T.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:T.semanticColors.HEADER_SECONDARY,opacity:.5}}),l=t?te:w;return e.React.createElement(l,{android_ripple:r.androidRipple,disabled:!1,accessibilityRole:"button",onPress:t,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},o&&e.React.createElement(w,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:r.icon,source:o,resizeMode:"contain"})),e.React.createElement(m,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},g))}function q(a){let{title:g,onTitlePress:t,icon:o,children:r,padding:l}=a;const u=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:T.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(w,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(re,{title:g,onPress:t,icon:o}),e.React.createElement(w,{style:u.main},l?e.React.createElement(w,{style:{paddingHorizontal:16,paddingVertical:16}},r):r))}var D;(function(a){function g(o){let{children:r,onPress:l}=o;return e.React.createElement(m,{variant:"text-md/bold",onPress:l},r)}a.Bold=g;function t(o){let{children:r,onPress:l}=o;return e.React.createElement(F,{style:{textDecorationLine:"underline"},onPress:l},r)}a.Underline=t})(D||(D={}));function m(a){let{variant:g,lineClamp:t,color:o,align:r,style:l,onPress:u,getChildren:n,children:p,liveUpdate:d}=a;const[c,R]=e.React.useReducer(function(y){return~y},0);return e.React.useEffect(function(){if(!d)return;const y=new Date().setMilliseconds(1e3);let h,v;return v=setTimeout(function(){R(),h=setInterval(R,1e3)},y-Date.now()),function(){clearTimeout(v),clearInterval(h)}},[]),e.React.createElement(F,{style:[g?ee[g]:{},o?{color:ne(T.semanticColors[o])}:{},r?{textAlign:r}:{},l??{}],numberOfLines:t,onPress:u},n?.()??p)}const{parseTimestamp:Y}=f.findByProps("parseTimestamp","unparseTimestamp"),A=e.stylesheet.createThemedStyleSheet({code:{fontFamily:e.constants.Fonts.CODE_SEMIBOLD,backgroundColor:T.semanticColors.BACKGROUND_SECONDARY},timestamp:{backgroundColor:T.semanticColors.BACKGROUND_MODIFIER_ACCENT}});function ie(){const[a,g]=e.React.useState(Date.now());return e.React.useLayoutEffect(function(){return g(Date.now())},[i.time.acceptRelative]),e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",liveUpdate:!0,getChildren:function(){const t=new Date,o=[[4],[19,20],[4,18,2],t.getHours()<12&&[t.getHours()],[t.getHours(),t.getMinutes()],[t.getHours(),t.getMinutes(),t.getSeconds()]].filter(function(u){return!!u}),r=[];let l=-1;for(const[u,n,p]of o){l++;const d=new Date;d.setHours(u,n??0,p||0);let c=[d.getHours().toString(),n!==void 0&&d.getMinutes().toString().padStart(2,"0"),p!==void 0&&d.getSeconds().toString().padStart(2,"0")].filter(function(y){return!!y}).join(":");u<12&&(c+=" AM");const R=Y(Math.floor(d.getTime()/1e3).toString(),d.getSeconds()===0?"t":"T");r.push(i.time.requireBackticks?e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:A.code},c):c),r.push(" \u2014 "),r.push(e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:A.timestamp,onPress:function(){return k.showToast(R.full,S.getAssetIDByName("ic_information_24px"))}},R.formatted)),l!==o.length-1&&r.push(`
`)}if(i.time.acceptRelative){r.push(`

`);const u=[["in 20 seconds",1e3*20],["8 minutes ago",-(1e3*60*8)]];l=-1;for(const[n,p]of u){const d=a+p,c=Y(Math.floor(d/1e3).toString(),"R");r.push(i.time.requireBackticks?e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:A.code},n):n),r.push(" \u2014 "),r.push(e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:A.timestamp,onPress:function(){return k.showToast(c.full,S.getAssetIDByName("ic_information_24px"))}},c.formatted)),l!==u.length-1&&r.push(`
`)}}return r}})}const{parseTimestamp:U}=f.findByProps("parseTimestamp","unparseTimestamp"),_=e.stylesheet.createThemedStyleSheet({code:{fontFamily:e.constants.Fonts.CODE_SEMIBOLD,backgroundColor:T.semanticColors.BACKGROUND_SECONDARY},timestamp:{backgroundColor:T.semanticColors.BACKGROUND_MODIFIER_ACCENT}});function se(){const[a,g]=e.React.useState(Date.now());return e.React.useLayoutEffect(function(){return g(Date.now())},[i.day.acceptRelative]),e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",liveUpdate:!0,getChildren:function(){const t=new Date,o=[[21,11,2023],[12,5],[1,8,20],[t.getDate(),t.getMonth()-1,t.getFullYear()],[t.getDate(),t.getMonth()-1],[t.getDate(),t.getMonth()-1,t.getFullYear()-2e3]].filter(function(u){return!!u}),r=[];let l=-1;for(let[u,n,p]of o){l++;const d=new Date().getFullYear(),c=new Date;p<100&&(p+=2e3),c.setFullYear(p??d,n,u);const R=U(Math.floor(c.getTime()/1e3).toString(),"d"),y=[i.day.american?n:u,i.day.american?u:n,p].join("/");r.push(i.day.requireBackticks?e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.code},y):y),r.push(" \u2014 "),r.push(e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.timestamp,onPress:function(){return k.showToast(R.full,S.getAssetIDByName("ic_information_24px"))}},R.formatted)),l!==o.length-1&&r.push(`
`)}if(i.day.acceptRelative){r.push(`

`);const u=1e3*60*60*24,n=u*(365+1/4),p=[["yesterday",-u],["in 2 days",u*2],["2 centuries ago",-(n*200)],["next week",u*7]];l=-1;for(const[d,c]of p){const R=a+c,y=U(Math.floor(R/1e3).toString(),"R");r.push(i.day.requireBackticks?e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.code},d):d),r.push(" \u2014 "),r.push(e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.timestamp,onPress:function(){return k.showToast(y.full,S.getAssetIDByName("ic_information_24px"))}},y.formatted)),l!==p.length-1&&r.push(`
`)}}return r}})}const{View:X,ScrollView:ce}=P.General,{FormSwitchRow:L,FormIcon:O}=P.Forms,{BadgableTabBar:oe}=f.findByProps("BadgableTabBar");function le(){var a,g;const[t,o]=e.React.useState("time");return(a=i).time??(a.time={acceptRelative:!1,requireBackticks:N.storage.reqBackticks??!0}),(g=i).day??(g.day={acceptRelative:!1,requireBackticks:!0,american:!1}),N.storage.alwaysLong!==void 0&&delete N.storage.alwaysLong,N.storage.reqBackticks!==void 0&&delete N.storage.reqBackticks,W.useProxy(i),e.React.createElement(ce,null,e.React.createElement(X,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(oe,{activeTab:t,onTabSelected:o,tabs:[{id:"day",title:"Date"},{id:"time",title:"Time"}]})),e.React.createElement(q,{title:"Info",icon:S.getAssetIDByName("ic_info_24px"),padding:!0},e.React.createElement(m,{variant:"text-md/semibold",color:"TEXT_NORMAL"},t==="time"?e.React.createElement(e.React.Fragment,null,"Send a message with a time code (in"," ",e.React.createElement(D.Bold,null,"HH:MM"),i.time.acceptRelative?", ":" or ",e.React.createElement(D.Bold,null,"HH:MM:SS"),i.time.acceptRelative&&e.React.createElement(e.React.Fragment,null," or relative")," format) and automatically turn it into a timestamp",`

`,e.React.createElement(ie,null)):e.React.createElement(e.React.Fragment,null,"Send a message with a date code (in"," ",e.React.createElement(D.Bold,null,i.day.american?"MM/DD":"DD/MM","/YY(YY)"),i.day.acceptRelative?", ":" or ",e.React.createElement(D.Bold,null,i.day.american?"MM/DD":"DD/MM","/MM"),i.day.acceptRelative&&e.React.createElement(e.React.Fragment,null," or relative")," format) and automatically turn it into a timestamp",`

`,e.React.createElement(se,null)))),e.React.createElement(q,{title:"Settings",icon:S.getAssetIDByName("settings")},e.React.createElement(L,{key:`${t}_acceptRelative`,label:`Allow Relative ${t==="time"?"Time":"Date"}`,subLabel:t==="time"?"Formats relative time (in 10 seconds, 5 minutes ago)":"Formats relative date (in 2 days, 6 weeks ago)",leading:e.React.createElement(O,{source:S.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return i[t].acceptRelative=!i[t].acceptRelative},value:i[t].acceptRelative}),e.React.createElement(L,{key:`${t}_requireBackticks`,label:"Require Backticks",subLabel:`Require ${t==="day"?"date":"time"} to be surrounded by backticks (\`)`,leading:e.React.createElement(O,{source:S.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return i[t].requireBackticks=!i[t].requireBackticks},value:i[t].requireBackticks}),t==="day"&&e.React.createElement(L,{key:`${t}_american`,label:"'Merican Dates",subLabel:"Uses MM/DD instead of DD/MM",leading:e.React.createElement(O,{source:S.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return i.day.american=!i.day.american},value:i.day.american})),e.React.createElement(X,{style:{marginBottom:16}}))}function ue(a,g,t,o){const r=[["seconds?",1e3],["minutes?",6e4],["hours?",36e5]],l=31556952e3,u=1e3*60*60*24,n=[["days?",u],["weeks?",u*7],["months?",u*30.436875],["years?",l],["decades?",l*10],["century",l*100],["centuries",l*100],["millennium",l*1e3],["millennia",l*1e3]],p=[...a.time?r:[],...a.date?n:[]].filter(function(s){return!!s}),d=function(s){return s?["`","`"]:["(?:\\s|\\t|^)","(?:\\s|\\t|$)"]},c=d(g.time),R=d(g.date),y=function(s){return`in (an?|[0-9]+) (${s})`},h=function(s){return`(an?|[0-9]+) (${s}) ago`},v=[a.time&&[1,`${c[0]}${y(r.map(function(s){return s[0]}).join("|"))}${c[1]}`],a.time&&[-1,`${c[0]}${h(r.map(function(s){return s[0]}).join("|"))}${c[1]}`],a.date&&[1,`${R[0]}${y(n.map(function(s){return s[0]}).join("|"))}${R[1]}`],a.date&&[-1,`${R[0]}${h(n.map(function(s){return s[0]}).join("|"))}${R[1]}`]].filter(function(s){return!!s});for(const[s,$]of v)t=t.replace(new RegExp($,"gi"),function(b,z,ge){const K=z.toLowerCase().startsWith("a")?1:Number(z);if(Number.isNaN(K))return b;const Q=p.find(function(pe){return pe[0].toLowerCase().includes(ge)})?.[1];return Q?o(b,Q*K*s):b});const E=[["last week",-7],["yesterday",-1],["tomorrow",1],["next week",7]].map(function(s){return[`${R[0]}${s[0]}${R[1]}`,s[1]*1e3*60*60*24]}),B=[...a.date?E:[]].filter(function(s){return!!s});for(const[s,$]of B)t=t.replace(new RegExp(s,"gi"),function(b){return o(b,$)});return t}const j=f.findByProps("sendMessage","editMessage"),M=function(a){return/^\s$/.test(a)},V=function(a){let[g,t]=a,o=t?.content;if(typeof o!="string"||typeof t!="object")return;const r=function(n){return n?["`","`"]:["(?:\\s|\\t|^)","(?:\\s|\\t|$)"]},l=r(i.time?.requireBackticks),u=r(i.day?.requireBackticks);if(i.time){const n={otN:"[0-9]{1,2}",tN:"[0-9]{2}",abrv:"(?: ?(AM|PM))"},p=[`(${n.otN}:${n.tN}:${n.tN})${n.abrv}?`,`(${n.otN}:${n.tN})${n.abrv}?`,`(${n.otN})${n.abrv}`].map(function(d){return new RegExp(`${l[0]}${d}${l[1]}`,"gi")});for(const d of p)o=o.replace(d,function(c,R,y){let[h,v,E]=R.split(":").map(function(s){return Number(s)});if(h<0||h>24||typeof v=="number"&&(v<0||v>60)||typeof E=="number"&&(E<0||E>60))return c;y&&(y.toLowerCase()==="pm"&&h!==12?h+=12:y.toLowerCase()==="am"&&h===12&&(h=0));const B=new Date;return B.setHours(h,v??0,E??0,0),`${M(c[0])?c[0]:""}<t:${Math.floor(B.getTime()/1e3)}:${B.getSeconds()===0?"t":"T"}>${M(c[c.length-1])?c[c.length-1]:""}`})}if(i.day){const n={otN:"[0-9]{1,2}",tN:"[0-9]{2}",fN:"[0-9]{4}"},p=[`(${n.otN})\\/(${n.otN})\\/(${n.fN}|${n.tN})`,`(${n.otN})\\/(${n.otN})`].map(function(d){return new RegExp(`${u[0]}${d}${u[1]}`,"gi")});for(const d of p)o=o.replace(d,function(c,R,y,h){const v=new Date().getFullYear();let[E,B,s]=[Number(R),Number(y),h?Number(h):v];if(i.day.american){const b=B;B=E,E=b}if(E<0||E>31||B<0||B>12||s<0||s>9999)return c;s<100&&(s+=2e3);const $=new Date(0);return $.setFullYear(s,B-1,E),`${M(c[0])?c[0]:""}<t:${Math.floor($.getTime()/1e3)}:d>${M(c[c.length-1])?c[c.length-1]:""}`})}o=ue({time:!!i.time?.acceptRelative,date:!!i.day?.acceptRelative},{time:!!i.time?.requireBackticks,date:!!i.day?.requireBackticks},o,function(n,p){return`${M(n[0])?n[0]:""}<t:${Math.floor((Date.now()+p)/1e3)}:R>${M(n[n.length-1])?n[0]:""}`}),t.content=o};function de(){const a=new Array;return a.push(I.before("sendMessage",j,V)),a.push(I.before("editMessage",j,V)),function(){return a.forEach(function(g){return g()})}}const i=N.storage;let G;var fe={onLoad:function(){return G=de()},onUnload:function(){return G?.()},settings:le};return C.default=fe,C.vstorage=i,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.metro.common,vendetta.storage,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.patcher,vendetta.metro,vendetta,vendetta.ui,vendetta.ui.toasts);
