(function(v,U,n,T,_,e,E,y,f,G,ge,Re,k){"use strict";const{Animated:A}=e.ReactNative;function $(t){let{duration:r,children:a,style:s,fade:i,trigger:c,customOpacity:d,setDisplay:h,animateOnInit:p}=t;p??(p=!0);const P=e.React.useRef(!0),x=e.React.useRef(!0),o=e.React.useRef(new A.Value(p&&i==="in"?1:0)).current,[S,B]=e.React.useState(p?i!=="in":!0);return e.React.useEffect(function(){const C=o.addListener(function(fe){let{value:ye}=fe;B(ye<=.1)});return function(){return o.removeListener(C)}},[]),e.React.useEffect(function(){if(!p&&P.current){P.current=!1;return}!p&&x.current&&(o.setValue(i==="in"?0:1),x.current=!1),A.timing(o,{toValue:d??(i==="in"?1:0),duration:r,useNativeDriver:!0}).start()},[o,i,d,c]),e.React.createElement(A.View,{style:[{opacity:o},h&&S&&{display:"none"},s]},a)}const{ScrollView:j}=y.General,{default:F}=n.findByProps("DCDAutoModerationSystemMessageView","default"),Y=n.findByName("MessageRecord"),Q=n.findByName("RowManager"),I=n.findByStoreName("SelectedChannelStore"),m=n.findByStoreName("UserStore"),{receiveMessage:K}=n.findByProps("receiveMessage"),{createBotMessage:W}=n.findByProps("createBotMessage"),{getText:X}=n.findByProps("openSystemKeyboard","getText");function M(){const t=X(I.getChannelId());if(t.trim()!=="")if(l.previewType==="popup")G.showConfirmationAlert({title:"Message Preview",onConfirm:function(){},children:React.createElement(j,{style:{marginVertical:12,maxHeight:e.ReactNative.Dimensions.get("window").height*.7}},React.createElement(F,{rowGenerator:new Q,message:new Y({id:"0",channel_id:I.getChannelId(),author:m.getCurrentUser(),content:t})}))});else{const r=I.getChannelId(),a=m.getCurrentUser();return K(r,Object.assign(W({channelId:r,content:t}),{author:a}))}}const{Pressable:q,View:J}=y.General,g=40,N=e.stylesheet.createThemedStyleSheet({androidRipple:{color:f.semanticColors.ANDROID_RIPPLE,cornerRadius:2147483647},actionButton:{borderRadius:2147483647,height:g,width:g,marginHorizontal:4,flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:f.semanticColors.BACKGROUND_SECONDARY_ALT,marginLeft:8,marginTop:-4},actionIcon:{tintColor:f.semanticColors.INTERACTIVE_NORMAL,width:g*.6,height:g*.6}});function Z(t){let{inputProps:r}=t;const[a,s]=e.React.useState("");b.push(T.after("onChangeText",r,function(d){let[h]=d;return s(h)},!0));const i=a.length>0,c=i?q:J;return e.React.createElement($,{style:{flexDirection:"row",position:"absolute",left:0,top:-g,zIndex:3},duration:100,fade:i?"in":"out"},e.React.createElement(c,{android_ripple:N.androidRipple,disabled:!1,accessibilityRole:"button",accessibilityState:{disabled:!1,expanded:!1},accessibilityLabel:"Open markdown preview",accessibilityHint:"Open a modal which shows your message's markdown preview",onPress:i?function(){return M()}:void 0,style:N.actionButton},e.React.createElement(e.ReactNative.Image,{style:N.actionIcon,source:E.getAssetIDByName("ic_eye")})))}const{ChatInput:ee}=n.findByProps("ChatInput"),b=[];function te(){return b.push(T.after("render",ee.prototype,function(t,r){const a=_.findInReactTree(r.props.children,function(i){return i?.type?.name==="ChatInput"})?.props;if(!a?.onChangeText)return;const s=_.findInReactTree(r.props.children,function(i){return i?.type?.displayName==="View"&&Array.isArray(i?.props?.children)})?.props?.children;s&&l.buttonType==="pill"&&s.unshift(React.createElement(Z,{inputProps:a}))})),b.push(T.before("render",e.ReactNative.Pressable.type,function(t){let[r]=t;r?.accessibilityLabel===e.i18n.Messages.SEND&&(r.onLongPress=function(){return l.buttonType==="send"&&M()})})),function(){return b.forEach(function(t){return t()})}}const ne=n.findByStoreName("ThemeStore"),re=n.findByProps("colors","meta");n.findByProps("triggerHaptic");const ie=n.findByProps("TextStyleSheet").TextStyleSheet,{View:R,Text:V,Pressable:ae}=y.General;n.findByProps("TableRow"),n.findByProps("ActionSheet")?.ActionSheet??n.find(function(t){return t.render?.name==="ActionSheet"}),n.findByProps("openLazy","hideActionSheet"),n.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),n.findByProps("ActionSheetRow")?.ActionSheetRow,n.findByName("Navigator")??n.findByProps("Navigator")?.Navigator,n.findByProps("getRenderCloseButton")?.getRenderCloseButton??n.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,n.findByProps("popModal","pushModal");const H=n.findByProps("useSearchControls"),D=n.findByProps("useSettingSearchQuery"),se=n.findByName("SettingSearchBar");n.findByProps("SvgXml"),n.findByProps("useInMainTabsExperiment","isInMainTabsExperiment"),n.find(function(t){return t?.WebView&&!t.default}).WebView;function le(t){return re.meta.resolveSemanticColor(ne.theme,t)}Object.assign(function(t){let{searchContext:r,controls:a}=t;return e.React.createElement(e.ReactNative.ScrollView,{scrollEnabled:!1},e.React.createElement(H.default,{searchContext:r,controls:a},e.React.createElement(se,null)))},{useAdvancedSearch:function(t){const r=D.useSettingSearchQuery(),a=H.useSearchControls(t,!1,function(){});return e.React.useEffect(function(){return function(){D.setSettingSearchQuery(""),D.setIsSettingSearchActive(!1)}},[]),[r,a]}});function ce(t){let{title:r,onPress:a,icon:s}=t;const i=e.stylesheet.createThemedStyleSheet({androidRipple:{color:f.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:f.semanticColors.HEADER_SECONDARY,opacity:.5}}),c=a?ae:R;return e.React.createElement(c,{android_ripple:i.androidRipple,disabled:!1,accessibilityRole:"button",onPress:a,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},s&&e.React.createElement(R,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:i.icon,source:s,resizeMode:"contain"})),e.React.createElement(O,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},r))}function oe(t){let{title:r,onTitlePress:a,icon:s,children:i,padding:c}=t;const d=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:f.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(R,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(ce,{title:r,onPress:a,icon:s}),e.React.createElement(R,{style:d.main},c?e.React.createElement(R,{style:{paddingHorizontal:16,paddingVertical:16}},i):i))}var L;(function(t){function r(s){let{children:i,onPress:c}=s;return e.React.createElement(O,{variant:"text-md/bold",onPress:c},i)}t.Bold=r;function a(s){let{children:i,onPress:c}=s;return e.React.createElement(V,{style:{textDecorationLine:"underline"},onPress:c},i)}t.Underline=a})(L||(L={}));function O(t){let{variant:r,lineClamp:a,color:s,align:i,style:c,onPress:d,getChildren:h,children:p,liveUpdate:P}=t;const[x,o]=e.React.useReducer(function(S){return~S},0);return e.React.useEffect(function(){if(!P)return;const S=new Date().setMilliseconds(1e3);let B,C;return C=setTimeout(function(){o(),B=setInterval(o,1e3)},S-Date.now()),function(){clearTimeout(C),clearInterval(B)}},[]),e.React.createElement(V,{style:[r?ie[r]:{},s?{color:le(f.semanticColors[s])}:{},i?{textAlign:i}:{},c??{}],numberOfLines:a,onPress:d},h?.()??p)}const{ScrollView:ue}=y.General,{FormRow:u,FormRadioRow:w}=y.Forms;function de(){var t,r;return(t=l).buttonType??(t.buttonType="pill"),(r=l).previewType??(r.previewType="popup"),k.useProxy(l),React.createElement(ue,null,React.createElement(oe,{title:"Settings",icon:E.getAssetIDByName("ic_cog")},React.createElement(u,{label:"Button type",leading:React.createElement(u.Icon,{source:E.getAssetIDByName("ic_message_edit")})}),React.createElement(w,{label:"Floating Pill",onPress:function(){return l.buttonType="pill"},trailing:React.createElement(u.Arrow,null),selected:l.buttonType==="pill",style:{marginHorizontal:12}}),React.createElement(w,{label:"Send button",subLabel:"Holding the send button",onPress:function(){return l.buttonType="send"},trailing:React.createElement(u.Arrow,null),selected:l.buttonType==="send",style:{marginHorizontal:12}}),React.createElement(u,{label:"Preview type",leading:React.createElement(u.Icon,{source:E.getAssetIDByName("ic_message_edit")})}),React.createElement(w,{label:"Popup",onPress:function(){return l.previewType="popup"},trailing:React.createElement(u.Arrow,null),selected:l.previewType==="popup",style:{marginHorizontal:12}}),React.createElement(w,{label:"Ephemeral message",onPress:function(){return l.previewType="clyde"},trailing:React.createElement(u.Arrow,null),selected:l.previewType==="clyde",style:{marginHorizontal:12}})))}const l=U.storage;let z;var pe={onLoad:function(){return z=te()},onUnload:function(){return z?.()},settings:de};return v.default=pe,v.vstorage=l,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.plugin,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.ui.alerts,vendetta,vendetta.ui.toasts,vendetta.storage);
