(function(w,t,u,y,ae,E,o,v,A,G,I,se,ce,T){"use strict";const oe=o.findByStoreName("ThemeStore"),le=o.findByProps("colors","meta"),{TextStyleSheet:ue}=o.findByProps("TextStyleSheet"),{View:Oe,Text:Y,Pressable:xe}=y.General;o.find(function(e){return e.render?.name==="ActionSheet"}),o.findByProps("openLazy","hideActionSheet"),o.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),o.findByName("Navigator"),o.findByProps("getRenderCloseButton"),o.findByProps("popModal","pushModal");function fe(e){return le.meta.resolveSemanticColor(oe.theme,e)}var z;(function(e){function n(a){let{children:i,onPress:s}=a;return t.React.createElement(C,{variant:"text-md/bold",onPress:s},i)}e.Bold=n;function r(a){let{children:i,onPress:s}=a;return t.React.createElement(Y,{style:{textDecorationLine:"underline"},onPress:s},i)}e.Underline=r})(z||(z={}));function C(e){let{variant:n,lineClamp:r,color:a,align:i,style:s,onPress:f,getChildren:R,children:d,liveUpdate:c}=e;const[g,h]=t.React.useReducer(function(p){return~p},0);return t.React.useEffect(function(){if(!c)return;const p=new Date().setMilliseconds(1e3);let l,S;return S=setTimeout(function(){h(),l=setInterval(h,1e3)},p-Date.now()),function(){clearTimeout(S),clearInterval(l)}},[]),t.React.createElement(Y,{style:[n?ue[n]:{},a?{color:fe(v.semanticColors[a])}:{},i?{textAlign:i}:{},s??{}],numberOfLines:r,onPress:f},R?.()??d)}function O(e){let{onPress:n,onLongPress:r,icon:a,style:i,destructive:s}=e;const f=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:v.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:v.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:v.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n,onLongPress:r},t.React.createElement(t.ReactNative.Image,{style:[typeof i=="string"?i==="header"?f.headerStyleIcon:f.cardStyleIcon:i,s&&f.destructiveIcon].filter(function(R){return!!R}),source:a}))}let B={};function x(){return!Object.keys(B)[0]||!D.pluginCache?.[0]?[]:Object.entries(B).map(function(e){let[n,r]=e;return D.pluginCache?.includes(n)?G.plugins.plugins[n]&&G.plugins.plugins[n].manifest.hash!==r?[n,"update"]:void 0:[n,"new"]}).filter(function(e){return!!e})}function de(){D.pluginCache=Object.keys(B)}async function K(){const e=await(await A.safeFetch(V,{cache:"no-store"})).json();B=Object.fromEntries(e.map(function(n){return[`https://vd-plugins.github.io/proxy/${n.vendetta.original}`,n.hash]}))}function ge(){const e=setInterval(K,6e5);return K(),function(){return clearInterval(e)}}const{FormRow:$}=y.Forms,F=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:v.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:v.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function he(e){return t.React.createElement(t.ReactNative.View,{style:[F.card,{marginBottom:10}]},t.React.createElement($,{style:F.header,label:e.headerLabel,leading:e.headerIcon&&t.React.createElement($.Icon,{source:e.headerIcon})}),t.React.createElement($,{label:e.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:F.actions},e.actions?.map(function(n){let{icon:r,onPress:a,onLongPress:i,destructive:s}=n;return t.React.createElement(O,{icon:r,onPress:a,onLongPress:i,style:"card",destructive:s??!1})}))}))}const{View:X}=y.General,W=t.stylesheet.createThemedStyleSheet({main:{marginRight:16,flexGrow:0},content:{backgroundColor:v.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:16,marginLeft:8,paddingHorizontal:8}});function q(e){let{text:n,marginLeft:r}=e;return React.createElement(X,{style:[W.main,r?{marginLeft:16,marginRight:0}:{}]},React.createElement(X,{style:W.content},React.createElement(C,{variant:"eyebrow",color:"TEXT_NORMAL"},n)))}const{showUserProfile:J}=o.findByProps("showUserProfile"),{fetchProfile:Q}=o.findByProps("fetchProfile"),U=o.findByStoreName("UserStore");function pe(e){let{userId:n,color:r,loadUsername:a,children:i}=e;const[s,f]=t.React.useState(!1);return t.React.useEffect(function(){return!s&&a&&(U.getUser(n)?f(U.getUser(n).username):Q(n).then(function(R){return f(R.user.username)}))},[a]),t.React.createElement(C,{variant:"text-md/bold",color:r??"TEXT_NORMAL",onPress:function(){return U.getUser(n)?J({userId:n}):Q(n).then(function(){return J({userId:n})})}},a?`@${s??"..."}`:i)}function Re(e){return e.endsWith("/")?e:e+"/"}const L={origin:/^([^/]+)\/(.*)/,multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/},Z={"vendetta.nexpid.xyz":function(e){return`https://github.com/nexpid/VendettaPlugins/tree/master/plugins/${e.join("/")}`},"vendetta.sdh.gay":function(e){return`https://github.com/sdhhhhh/vd-repo/tree/master/plugins/${e.join("/")}`},"plugins.obamabot.me":function(e){return`https://github.com/WolfPlugs/${e[0]}/tree/master/${e.slice(1).join("/")}`},"mugman.catvibers.me":function(e){return`https://github.com/mugman174/${e[0]}/tree/master/plugins/${e.slice(1).join("/")}`}};function ye(e){const n=e.match(L.multiplePluginGitio);if(n?.[0])return`https://github.com/${n[1]}/${n[2]}/tree/master/plugins/${n[3]}`;const r=e.match(L.singlePluginGitio)??e.match(L.githubReleases);if(r?.[0])return`https://github.com/${r[1]}/${r[2]}`;const[a,i,s]=e.match(L.origin);if(Z[i])return Z[i](s.split("/"))}async function Ee(e){const n=e.enabled;for(let r=0;r<2;r++)n&&I.stopPlugin(e.id,!1),await I.fetchPlugin(e.id),n&&await I.startPlugin(e.id)}const k=Symbol.for("vendetta.storage.emitter"),Se=!!I.plugins[k]&&!!se.themes[k];function Ie(e){const[n,r]=t.React.useState(!!I.plugins[e]),a=I.plugins[k],i=function(){return r(!!I.plugins[e])};return t.React.useEffect(function(){return a.on("SET",i),a.on("DEL",i),function(){a.off("SET",i),a.off("DEL",i)}}),n}const{View:Ne}=y.General;function ve(e){let{item:n,index:r,changes:a}=e;const i=Re(`https://vd-plugins.github.io/proxy/${n.vendetta.original}`),s=Ie(i),f=a.find(function(c){return c[0]===i}),R=ye(n.vendetta.original),d=[];return R&&d.push({icon:u.getAssetIDByName("img_account_sync_github_white"),onPress:function(){return t.url.openURL(R)},onLongPress:function(){t.clipboard.setString(R),E.showToast("Copied GitHub link",u.getAssetIDByName("toast_copy_link"))}}),t.React.createElement(t.React.Fragment,null,t.React.createElement(he,{index:r,headerLabel:t.React.createElement(Ne,{style:{flexDirection:"row"}},f&&t.React.createElement(q,{text:f[1]==="new"?"New":"Upd"}),t.React.createElement(C,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},n.name,n.authors[0]&&" by ",...n.authors.map(function(c,g,h){return t.React.createElement(t.React.Fragment,null,t.React.createElement(pe,{userId:c.id,color:"TEXT_LINK"},c.name),g!==h.length-1&&", ")}))),headerIcon:u.getAssetIDByName(n.vendetta.icon),descriptionLabel:n.description,actions:i.includes("plugin-browser")?d:s?[I.plugins[i]?.manifest.hash!==n.hash&&{icon:u.getAssetIDByName("ic_sync_24px"),onPress:function(){Ee(i).then(function(){return E.showToast(`Successfully updated ${n.name}`,u.getAssetIDByName("ic_sync_24px"))}).catch(function(){return E.showToast(`Failed to update ${n.name}!`,u.getAssetIDByName("Small"))})}},{icon:u.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(){try{I.removePlugin(i),E.showToast(`Successfully deleted ${n.name}`,u.getAssetIDByName("ic_message_delete"))}catch{E.showToast(`Failed to delete ${n.name}!`,u.getAssetIDByName("Small"))}},onLongPress:function(){t.clipboard.setString(n.vendetta.original),E.showToast("Copied unproxied link",u.getAssetIDByName("toast_copy_link"))}},...d].filter(function(c){return!!c}):[{icon:u.getAssetIDByName("ic_download_24px"),onPress:async function(){I.installPlugin(i,!0).then(function(){E.showToast(`Successfully installed ${n.name}`,u.getAssetIDByName("toast_image_saved"))}).catch(function(c){return E.showToast(c?.message??`Failed to install ${n.name}!`,u.getAssetIDByName("Small"))})},onLongPress:function(){t.clipboard.setString(n.vendetta.original),E.showToast("Copied unproxied link",u.getAssetIDByName("toast_copy_link"))}},...d]}))}const{showSimpleActionSheet:Te}=o.findByProps("showSimpleActionSheet"),{View:Pe}=y.General;var N;(function(e){e.Newest="Newest",e.Oldest="Oldest",e.Alphabetical="Alphabetical",e.ReverseAlphabetical="Reverse Alphabetical"})(N||(N={}));let ee,te;function ne(){const e=t.NavigationNative.useNavigation();if(!Se)return ce.showConfirmationAlert({title:"Can't use",content:"You must reinstall Vendetta first in order for Plugin Browser to function properly",confirmText:"Dismiss",confirmColor:"brand",onConfirm:function(){},isDismissable:!0}),e.goBack(),null;const[n]=t.React.useState(x()),[r,a]=t.React.useState(N.Newest),[i,s]=t.React.useState(),[f,R]=t.React.useState("");if(t.React.useEffect(function(){R(""),a(N.Newest)},[]),t.React.useEffect(function(){de()},[]),t.React.useEffect(function(){i||A.safeFetch(V,{cache:"no-store"}).then(function(c){return c.json().then(function(g){return s(g)}).catch(function(){return E.showToast("Failed to parse plugins",u.getAssetIDByName("Small"))})}).catch(function(){return E.showToast("Failed to fetch plugins",u.getAssetIDByName("Small"))})},[i]),ee=function(){return i&&s(void 0)},te=function(){return i&&Te({key:"CardOverflow",options:Object.values(N).map(function(c){return{label:c,onPress:function(){return a(c)}}})})},e.addListener("focus",function(){e.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(Pe,{style:{flexDirection:"row-reverse"}},t.React.createElement(O,{onPress:function(){return ee?.()},icon:u.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(O,{onPress:function(){return te?.()},icon:u.getAssetIDByName("ic_filter"),style:"header"}))}})}),!i)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let d=i.filter(function(c){return c.name?.toLowerCase().includes(f)||c.authors?.some(function(g){return g.name?.toLowerCase().includes(f)})||c.description?.toLowerCase().includes(f)});return[N.Alphabetical,N.ReverseAlphabetical].includes(r)&&(d=d.sort(function(c,g){return c.name<g.name?-1:c.name>g.name?1:0})),[N.ReverseAlphabetical,N.Newest].includes(r)&&d.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(y.Search,{style:{marginBottom:10},onChangeText:function(c){return R(c.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:d,renderItem:function(c){let{item:g,index:h}=c;return t.React.createElement(y.ErrorBoundary,null,t.React.createElement(ve,{item:g,index:h,changes:n}))},removeClippedSubviews:!0})}const{FormRow:M}=y.Forms;function be(e){let{changes:n}=e;const r=t.NavigationNative.useNavigation();return React.createElement(y.ErrorBoundary,null,React.createElement(M,{label:React.createElement(C,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},"Plugin Browser",n?React.createElement(q,{text:n.toString(),marginLeft:!0}):React.createElement(React.Fragment,null)),leading:React.createElement(M.Icon,{source:u.getAssetIDByName("ic_search_items_24px")}),trailing:M.Arrow,onPress:function(){return r.push("VendettaCustomPage",{render:ne})}}))}const{FormSection:_e}=y.Forms,we=o.findByName("getScreens"),Ae=o.findByName("UserSettingsOverviewWrapper",!1),Ce=t.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:v.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function me(e,n,r){const a=[],i=T.after("default",Ae,function(s,f){i();const R=A.findInReactTree(f.props.children,function(d){return d.type&&d.type.name==="UserSettingsOverview"});a.push(T.after("render",R.type.prototype,function(d,c){let{props:{children:g}}=c;const h=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];g=A.findInReactTree(g,function(l){return l.children[1].type===_e}).children;const p=g.findIndex(function(l){return h.includes(l?.props.label)});e()&&g.splice(p===-1?4:p,0,n({}))}))},!0);if(a.push(i),we&&r){const s=`VENDETTA_PLUGIN_${t.lodash.snakeCase(r.key).toUpperCase()}`,f=r.page.render,R=t.React.memo(function(h){let{navigation:p}=h;const l=p.addListener("focus",function(){l(),p.setOptions(A.without(r.page,"noErrorBoundary","render"))});return t.React.createElement(t.ReactNative.View,{style:Ce.container},r.page.noErrorBoundary?t.React.createElement(f,null):t.React.createElement(y.ErrorBoundary,null,t.React.createElement(f,null)))}),d={[s]:{type:"route",title:typeof r.title=="function"?r.title:function(){return r.title},icon:r.icon,screen:{route:`VendettaPlugin${t.lodash.chain(r.key).camelCase().upperFirst().value()}`,getComponent:function(){return R}}}},c=function(h,p){const l=[...h],S=p?l?.[0]?.sections:l;if(!Array.isArray(S))return l;const P="Vendetta",b=S.find(function(_){return _?.title===P});return b&&b.settings.push(s),l},g=function(){const h=o.findByProps("useOverviewSettings"),p=o.findByProps("getSettingTitleConfig"),l=o.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),S="getSettingSearchListItems",P="getSettingListItems",b=o.findByProps(S),_=b?S:P,ie=b??o.findByProps(P);if(!ie||!h)return!1;a.push(T.after("useOverviewSettings",h,function(H,m){return c(m,!1)})),a.push(T.after("getSettingTitleConfig",p,function(H,m){return{...m,[s]:typeof r.title=="function"?r.title():r.title}})),a.push(T.after(_,ie,function(H,m){let[Ge]=H;return[...Ge.includes(s)?[{type:"setting_search_result",ancestorRendererData:d[s],setting:s,title:typeof r.title=="function"?r.title():r.title,breadcrumbs:["Vendetta"],icon:d[s].icon}]:[],...m]}));const j=l.SETTING_RELATIONSHIPS,De=l.SETTING_RENDERER_CONFIGS;return l.SETTING_RELATIONSHIPS={...j,[s]:null},l.SETTING_RENDERER_CONFIGS={...De,...d},a.push(function(){l.SETTING_RELATIONSHIPS=j,l.SETTING_RENDERER_CONFIGS=j}),!0};(function(){const h=o.findByProps("SearchableSettingsList"),p=o.findByProps("SETTING_RENDERER_CONFIG"),l=o.findByProps("getSettingListItems");if(!l||!h||!p)return!1;a.push(T.before("type",h.SearchableSettingsList,function(P){return c(P,!0)})),a.push(T.after("getSettingListSearchResultItems",l,function(P,b){for(const _ of b)_.setting===s&&(_.breadcrumbs=["Vendetta"])}));const S=p.SETTING_RENDERER_CONFIG;return p.SETTING_RENDERER_CONFIG={...S,...d},a.push(function(){p.SETTING_RENDERER_CONFIG=S}),!0})()||g()}return function(){return a.forEach(function(s){return s()})}}function Be(){let e=[];return e.push(me(function(){return!0},function(){return React.createElement(be,{changes:x().filter(function(n){return n[1]==="new"}).length})},{key:G.plugin.manifest.name,icon:u.getAssetIDByName("ic_search_items_24px"),title:function(){const n=x().filter(function(r){return r[1]==="new"}).length;return`Plugin Browser${n?` (+${n})`:""}`},page:{render:ne}})),e.push(ge()),function(){return e.forEach(function(n){return n()})}}const V="https://vd-plugins.github.io/proxy/plugins-full.json",D=ae.storage;let re;var Le={onLoad:function(){return re=Be()},onUnload:function(){return re?.()}};return w.default=Le,w.pluginsURL=V,w.vstorage=D,Object.defineProperty(w,"__esModule",{value:!0}),w})({},vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.ui.toasts,vendetta.metro,vendetta.ui,vendetta.utils,vendetta,vendetta.plugins,vendetta.themes,vendetta.ui.alerts,vendetta.patcher);
