(function(B,t,d,E,se,y,L,s,I,C,N,oe,ue,b){"use strict";const le=s.findByStoreName("ThemeStore"),de=s.findByProps("colors","meta");s.findByProps("triggerHaptic");const fe=s.findByProps("TextStyleSheet").TextStyleSheet,{View:Ze,Text:z,Pressable:Ke}=E.General;s.findByProps("TableRow");const ge=s.findByProps("ActionSheet")?.ActionSheet??s.find(function(e){return e.render?.name==="ActionSheet"}),he=s.findByProps("openLazy","hideActionSheet"),{openLazy:pe,hideActionSheet:Re}=he,{ActionSheetTitleHeader:ye,ActionSheetCloseButton:Se,ActionSheetContentContainer:Ee}=s.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");s.findByProps("ActionSheetRow")?.ActionSheetRow,s.findByName("Navigator")??s.findByProps("Navigator")?.Navigator,s.findByProps("getRenderCloseButton")?.getRenderCloseButton??s.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,s.findByProps("popModal","pushModal");const Z=s.findByProps("useSearchControls"),G=s.findByProps("useSettingSearchQuery"),Ne=s.findByName("SettingSearchBar");s.findByProps("SvgXml"),s.findByProps("useInMainTabsExperiment","isInMainTabsExperiment"),s.find(function(e){return e?.WebView&&!e.default}).WebView;function Ie(e){return de.meta.resolveSemanticColor(le.theme,e)}function ve(e,n){try{pe(new Promise(function(r){return r({default:e})}),"ActionSheet",n)}catch(r){L.logger.error(r.stack),y.showToast("Got error when opening ActionSheet! Please check debug logs",d.getAssetIDByName("Smal"))}}Object.assign(function(e){let{searchContext:n,controls:r}=e;return t.React.createElement(t.ReactNative.ScrollView,{scrollEnabled:!1},t.React.createElement(Z.default,{searchContext:n,controls:r},t.React.createElement(Ne,null)))},{useAdvancedSearch:function(e){const n=G.useSettingSearchQuery(),r=Z.useSearchControls(e,!1,function(){});return t.React.useEffect(function(){return function(){G.setSettingSearchQuery(""),G.setIsSettingSearchActive(!1)}},[]),[n,r]}});var K;(function(e){function n(i){let{children:c,onPress:a}=i;return t.React.createElement(w,{variant:"text-md/bold",onPress:a},c)}e.Bold=n;function r(i){let{children:c,onPress:a}=i;return t.React.createElement(z,{style:{textDecorationLine:"underline"},onPress:a},c)}e.Underline=r})(K||(K={}));function w(e){let{variant:n,lineClamp:r,color:i,align:c,style:a,onPress:g,getChildren:h,children:R,liveUpdate:u}=e;const[o,f]=t.React.useReducer(function(p){return~p},0);return t.React.useEffect(function(){if(!u)return;const p=new Date().setMilliseconds(1e3);let l,S;return S=setTimeout(function(){f(),l=setInterval(f,1e3)},p-Date.now()),function(){clearTimeout(S),clearInterval(l)}},[]),t.React.createElement(z,{style:[n?fe[n]:{},i?{color:Ie(I.semanticColors[i])}:{},c?{textAlign:c}:{},a??{}],numberOfLines:r,onPress:g},h?.()??R)}function $(e){let{onPress:n,onLongPress:r,icon:i,style:c,destructive:a,color:g}=e;const h=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:I.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:I.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:I.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n,onLongPress:r},t.React.createElement(t.ReactNative.Image,{style:[typeof c=="string"?c==="header"?h.headerStyleIcon:h.cardStyleIcon:c,a&&h.destructiveIcon,g&&{tintColor:g}].filter(function(R){return!!R}),source:i}))}let D={};function O(){return!Object.keys(D)[0]||!x.pluginCache?.[0]?[]:Object.entries(D).map(function(e){let[n,r]=e;return x.pluginCache?.includes(n)?L.plugins.plugins[n]&&L.plugins.plugins[n].manifest.hash!==r?[n,"update"]:void 0:[n,"new"]}).filter(function(e){return!!e})}function Pe(){x.pluginCache=Object.keys(D)}async function W(){const e=await(await C.safeFetch(H,{cache:"no-store"})).json();D=Object.fromEntries(e.map(function(n){return[`https://vd-plugins.github.io/proxy/${n.vendetta.original}`,n.hash]}))}function Te(){const e=setInterval(W,6e5);return W(),function(){return clearInterval(e)}}const{FormRow:F}=E.Forms,U=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:I.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:I.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function be(e){return t.React.createElement(t.ReactNative.View,{style:[U.card,{marginBottom:10}]},t.React.createElement(F,{style:U.header,label:e.headerLabel,leading:e.headerIcon&&t.React.createElement(F.Icon,{source:e.headerIcon})}),t.React.createElement(F,{label:e.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:U.actions},e.actions?.map(function(n){let{icon:r,onPress:i,onLongPress:c,destructive:a}=n;return t.React.createElement($,{icon:r,onPress:i,onLongPress:c,style:"card",destructive:a??!1})}),e.loading&&t.React.createElement(t.ReactNative.ActivityIndicator,{size:"small",style:{height:22,width:22}}))}))}const{View:X}=E.General,Q=t.stylesheet.createThemedStyleSheet({main:{marginRight:16,flexGrow:0},content:{backgroundColor:I.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:16,marginLeft:8,paddingHorizontal:8}});function q(e){let{text:n,marginLeft:r}=e;return React.createElement(X,{style:[Q.main,r?{marginLeft:16,marginRight:0}:{}]},React.createElement(X,{style:Q.content},React.createElement(w,{variant:"eyebrow",color:"TEXT_NORMAL"},n)))}const{showUserProfile:J}=s.findByProps("showUserProfile"),{fetchProfile:ee}=s.findByProps("fetchProfile"),k=s.findByStoreName("UserStore");function Ae(e){let{userId:n,color:r,loadUsername:i,children:c}=e;const[a,g]=t.React.useState(null);return t.React.useEffect(function(){return!a&&i&&(k.getUser(n)?g(k.getUser(n).username):ee(n).then(function(h){return g(h.user.username)}))},[i]),t.React.createElement(w,{variant:"text-md/bold",color:r??"TEXT_NORMAL",onPress:function(){return k.getUser(n)?J({userId:n}):ee(n).then(function(){return J({userId:n})})}},i?`@${a??"..."}`:c)}function Be(e){return e.endsWith("/")?e:e+"/"}const m={origin:/^([^/]+)\/(.*)/,multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/},te={"vendetta.nexpid.xyz":function(e){return`https://github.com/nexpid/VendettaPlugins/tree/master/plugins/${e.join("/")}`},"vendetta.sdh.gay":function(e){return`https://github.com/sdhhhhh/vd-repo/tree/master/plugins/${e.join("/")}`},"plugins.obamabot.me":function(e){return`https://github.com/WolfPlugs/${e[0]}/tree/master/${e.slice(1).join("/")}`},"mugman.catvibers.me":function(e){return`https://github.com/mugman174/${e[0]}/tree/master/plugins/${e.slice(1).join("/")}`}};function Ce(e){const n=e.match(m.multiplePluginGitio);if(n?.[0])return`https://github.com/${n[1]}/${n[2]}/tree/master/plugins/${n[3]}`;const r=e.match(m.singlePluginGitio)??e.match(m.githubReleases);if(r?.[0])return`https://github.com/${r[1]}/${r[2]}`;const[i,c,a]=e.match(m.origin);if(te[c])return te[c](a.split("/"))}async function we(e){const n=e.enabled;for(let r=0;r<2;r++)n&&N.stopPlugin(e.id,!1),await N.fetchPlugin(e.id),n&&await N.startPlugin(e.id)}const M=Symbol.for("vendetta.storage.emitter"),_e=!!N.plugins[M]&&!!oe.themes[M];function Le(e){const[n,r]=t.React.useState(!!N.plugins[e]),i=N.plugins[M],c=function(){return r(!!N.plugins[e])};return t.React.useEffect(function(){return r(!!N.plugins[e]),i.on("SET",c),i.on("DEL",c),function(){i.off("SET",c),i.off("DEL",c)}}),n}const{View:De}=E.General;function me(e){let{item:n,changes:r}=e;const i=Be(`https://vd-plugins.github.io/proxy/${n.vendetta.original}`),[c,a]=t.React.useState(!1),g=Le(i),h=r.find(function(o){return o[0]===i}),R=Ce(n.vendetta.original),u=[];return R&&u.push({icon:d.getAssetIDByName("img_account_sync_github_white"),onPress:function(){return t.url.openURL(R)},onLongPress:function(){t.clipboard.setString(R),y.showToast("Copied GitHub link",d.getAssetIDByName("toast_copy_link"))}}),t.React.createElement(be,{headerLabel:t.React.createElement(De,{style:{flexDirection:"row"}},h&&t.React.createElement(q,{text:h[1]==="new"?"New":"Upd"}),t.React.createElement(w,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},n.name,n.authors[0]&&" by ",...n.authors.map(function(o,f,p){return t.React.createElement(t.React.Fragment,null,t.React.createElement(Ae,{userId:o.id,color:"TEXT_LINK"},o.name),f!==p.length-1&&", ")}))),headerIcon:d.getAssetIDByName(n.vendetta.icon),descriptionLabel:n.description,actions:c?[]:i.includes("plugin-browser")?u:g?[N.plugins[i]?.manifest.hash!==n.hash&&{icon:d.getAssetIDByName("ic_sync_24px"),onPress:function(){a(!0),we(i).then(function(){return y.showToast(`Successfully updated ${n.name}`,d.getAssetIDByName("ic_sync_24px"))}).catch(function(){return y.showToast(`Failed to update ${n.name}!`,d.getAssetIDByName("Small"))}).finally(function(){return a(!1)})}},{icon:d.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(){a(!0);try{N.removePlugin(i),y.showToast(`Successfully deleted ${n.name}`,d.getAssetIDByName("ic_message_delete"))}catch{y.showToast(`Failed to delete ${n.name}!`,d.getAssetIDByName("Small"))}a(!1)},onLongPress:function(){t.clipboard.setString(n.vendetta.original),y.showToast("Copied unproxied link",d.getAssetIDByName("toast_copy_link"))}},...u].filter(function(o){return!!o}):[{icon:d.getAssetIDByName("ic_download_24px"),onPress:async function(){a(!0),N.installPlugin(i,!0).then(function(){y.showToast(`Successfully installed ${n.name}`,d.getAssetIDByName("toast_image_saved"))}).catch(function(o){return y.showToast(o?.message??`Failed to install ${n.name}!`,d.getAssetIDByName("Small"))}).finally(function(){return a(!1)})},onLongPress:function(){t.clipboard.setString(n.vendetta.original),y.showToast("Copied unproxied link",d.getAssetIDByName("toast_copy_link"))}},...u],loading:c})}const{FormRadioRow:xe}=E.Forms;function Ge(e){let{label:n,value:r,choices:i,update:c}=e;const[a,g]=t.React.useState(r);return c(a),t.React.createElement(ge,null,t.React.createElement(Ee,null,t.React.createElement(ye,{title:n,trailing:t.React.createElement(Se,{onPress:function(){return Re()}})}),i.map(function(h){return t.React.createElement(xe,{label:h,onPress:function(){return g(h)},selected:a===h})})))}const{View:$e}=E.General;var v;(function(e){e.DateNewest="Creation date (new to old)",e.DateOldest="Creation date (old to new)",e.NameAZ="Name (A-Z)",e.NameZA="Name (Z-A)"})(v||(v={}));let ne,re;function ie(){const e=t.NavigationNative.useNavigation();if(!_e)return ue.showConfirmationAlert({title:"Can't use",content:"You must reinstall Vendetta first in order for Plugin Browser to function properly",confirmText:"Dismiss",confirmColor:"brand",onConfirm:function(){},isDismissable:!0}),e.goBack(),null;const n=t.React.useRef(O()).current,[r,i]=t.React.useState(v.DateNewest),[c,a]=t.React.useState(null),[g,h]=t.React.useState(""),R=t.React.useMemo(function(){if(!c)return;let u=c.filter(function(o){return o.name?.toLowerCase().includes(g)||o.authors?.some(function(f){return f.name?.toLowerCase().includes(g)})||o.description?.toLowerCase().includes(g)});return[v.NameAZ,v.NameZA].includes(r)&&(u=u.sort(function(o,f){return o.name<f.name?-1:o.name>f.name?1:0})),[v.NameZA,v.DateNewest].includes(r)&&u.reverse(),u},[r,c]);return t.React.useEffect(Pe,[]),t.React.useEffect(function(){c||C.safeFetch(H,{cache:"no-store"}).then(function(u){return u.json().then(function(o){return a(o)}).catch(function(){return y.showToast("Failed to parse plugins",d.getAssetIDByName("Small"))})}).catch(function(){return y.showToast("Failed to fetch plugins",d.getAssetIDByName("Small"))})},[c]),ne=function(){return c&&a(null)},re=function(){return c&&ve(Ge,{label:"Filter",value:r,choices:Object.values(v),update:function(u){return i(u)}})},e.addListener("focus",function(){e.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement($e,{style:{flexDirection:"row-reverse"}},t.React.createElement($,{onPress:function(){return ne?.()},icon:d.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement($,{onPress:function(){return re?.()},icon:d.getAssetIDByName("ic_filter"),style:"header"}))}})}),c?t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(E.Search,{style:{marginBottom:10},onChangeText:function(u){return h(u.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:R,keyExtractor:function(u){return`plugin-${u.vendetta}`},renderItem:function(u){let{item:o}=u;return t.React.createElement(me,{item:o,changes:n,key:`plugin-${o.vendetta}`})},removeClippedSubviews:!0}):t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}})}const{FormRow:V}=E.Forms;function Oe(e){let{changes:n}=e;const r=t.NavigationNative.useNavigation();return React.createElement(E.ErrorBoundary,null,React.createElement(V,{label:React.createElement(w,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},"Plugin Browser",n?React.createElement(q,{text:n.toString(),marginLeft:!0}):React.createElement(React.Fragment,null)),leading:React.createElement(V.Icon,{source:d.getAssetIDByName("ic_search_items_24px")}),trailing:V.Arrow,onPress:function(){return r.push("VendettaCustomPage",{render:ie})}}))}const{FormSection:Fe}=E.Forms,Ue=s.findByName("getScreens"),ke=s.findByName("UserSettingsOverviewWrapper",!1),Me=t.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:I.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function Ve(e,n,r){const i=[],c=b.after("default",ke,function(a,g){c();const h=C.findInReactTree(g.props.children,function(R){return R.type&&R.type.name==="UserSettingsOverview"});i.push(b.after("render",h.type.prototype,function(R,u){let{props:{children:o}}=u;const f=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];o=C.findInReactTree(o,function(l){return l.children[1].type===Fe}).children;const p=o.findIndex(function(l){return f.includes(l?.props.label)});e()&&o.splice(p===-1?4:p,0,n({}))}))},!0);if(i.push(c),Ue&&r){const a=`VENDETTA_PLUGIN_${t.lodash.snakeCase(r.key).toUpperCase()}`,g=r.page.render,h=t.React.memo(function(f){let{navigation:p}=f;const l=p.addListener("focus",function(){l(),p.setOptions(C.without(r.page,"noErrorBoundary","render"))});return t.React.createElement(t.ReactNative.View,{style:Me.container},r.page.noErrorBoundary?t.React.createElement(g,null):t.React.createElement(E.ErrorBoundary,null,t.React.createElement(g,null)))}),R={[a]:{type:"route",title:function(){return r.title},icon:r.icon,parent:null,screen:{route:`VendettaPlugin${t.lodash.chain(r.key).camelCase().upperFirst().value()}`,getComponent:function(){return h}}}},u=function(f,p){const l=[...f],S=p?l?.[0]?.sections:l;if(!Array.isArray(S))return S;const P="Vendetta",T=S.find(function(A){return A?.title===P||A?.label===P});return T&&!T?.settings?.includes(a)&&T.settings.push(a),l},o=function(){const f=s.findByProps("useOverviewSettings"),p=s.findByProps("getSettingTitleConfig"),l=s.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),S="getSettingSearchListItems",P="getSettingListItems",T=s.findByProps(S),A=T?S:P,ce=T??s.findByProps(P);if(!ce||!f)return!1;i.push(b.after("useOverviewSettings",f,function(Y,_){return u(_)})),i.push(b.after("getSettingTitleConfig",p,function(Y,_){return{..._,[a]:r.title}})),i.push(b.after(A,ce,function(Y,_){let[ze]=Y;return[...ze.includes(a)?[{type:"setting_search_result",ancestorRendererData:R[a],setting:a,title:function(){return r.title},breadcrumbs:["Vendetta"],icon:R[a].icon}]:[],..._]}));const j=l.SETTING_RELATIONSHIPS,Ye=l.SETTING_RENDERER_CONFIGS;return l.SETTING_RELATIONSHIPS={...j,[a]:null},l.SETTING_RENDERER_CONFIGS={...Ye,...R},i.push(function(){l.SETTING_RELATIONSHIPS=j,l.SETTING_RENDERER_CONFIGS=j}),!0};(function(){const f=s.findByProps("SearchableSettingsList"),p=s.findByProps("SETTING_RENDERER_CONFIG"),l=s.findByProps("getSettingListItems");if(!l||!f||!p)return!1;i.push(b.before("type",f.SearchableSettingsList,function(P){return u(P,!0)})),i.push(b.after("getSettingListSearchResultItems",l,function(P,T){for(const A of T)A.setting===a&&(A.breadcrumbs=["Vendetta"])}));const S=p.SETTING_RENDERER_CONFIG;return p.SETTING_RENDERER_CONFIG={...S,...R},i.push(function(){p.SETTING_RENDERER_CONFIG=S}),!0})()||o()}return function(){return i.forEach(function(a){return a()})}}function He(){let e=[];return e.push(Ve(function(){return!0},function(){return React.createElement(Oe,{changes:O().filter(function(n){return n[1]==="new"}).length})},{key:L.plugin.manifest.name,icon:d.getAssetIDByName("ic_search_items_24px"),get title(){const n=O().filter(function(r){return r[1]==="new"}).length;return`Plugin Browser${n?` (+${n})`:""}`},page:{render:ie}})),e.push(Te()),function(){return e.forEach(function(n){return n()})}}const H="https://vd-plugins.github.io/proxy/plugins-full.json",x=se.storage;let ae;var je={onLoad:function(){return ae=He()},onUnload:function(){return ae?.()}};return B.default=je,B.pluginsURL=H,B.vstorage=x,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.ui.toasts,vendetta,vendetta.metro,vendetta.ui,vendetta.utils,vendetta.plugins,vendetta.themes,vendetta.ui.alerts,vendetta.patcher);
