(function(T,t,l,R,re,y,u,I,P,m,E,ie,ae,b){"use strict";const se=u.findByStoreName("ThemeStore"),ce=u.findByProps("colors","meta"),{TextStyleSheet:oe}=u.findByProps("TextStyleSheet"),{View:xe,Text:k,Pressable:Oe}=R.General;u.find(function(e){return e.render?.name==="ActionSheet"}),u.findByProps("openLazy","hideActionSheet"),u.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),u.findByName("Navigator"),u.findByProps("getRenderCloseButton"),u.findByProps("popModal","pushModal");function le(e){return ce.meta.resolveSemanticColor(se.theme,e)}var M;(function(e){function n(s){let{children:i,onPress:c}=s;return t.React.createElement(_,{variant:"text-md/bold",onPress:c},i)}e.Bold=n;function r(s){let{children:i,onPress:c}=s;return t.React.createElement(k,{style:{textDecorationLine:"underline"},onPress:c},i)}e.Underline=r})(M||(M={}));function _(e){let{variant:n,lineClamp:r,color:s,align:i,style:c,onPress:d,getChildren:g,children:f,liveUpdate:a}=e;const[o,h]=t.React.useReducer(function(N){return~N},0);return t.React.useEffect(function(){if(!a)return;const N=new Date().setMilliseconds(1e3);let p,ne;return ne=setTimeout(function(){h(),p=setInterval(h,1e3)},N-Date.now()),function(){clearTimeout(ne),clearInterval(p)}},[]),t.React.createElement(k,{style:[n?oe[n]:{},s?{color:le(I.semanticColors[s])}:{},i?{textAlign:i}:{},c??{}],numberOfLines:r,onPress:d},g?.()??f)}function B(e){let{onPress:n,onLongPress:r,icon:s,style:i,destructive:c}=e;const d=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:I.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:I.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:I.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n,onLongPress:r},t.React.createElement(t.ReactNative.Image,{style:[typeof i=="string"?i==="header"?d.headerStyleIcon:d.cardStyleIcon:i,c&&d.destructiveIcon].filter(function(g){return!!g}),source:s}))}let w={};function D(){return!Object.keys(w)[0]||!A.pluginCache?.[0]?[]:Object.entries(w).map(function(e){let[n,r]=e;return A.pluginCache?.includes(n)?m.plugins.plugins[n]&&m.plugins.plugins[n].manifest.hash!==r?[n,"update"]:void 0:[n,"new"]}).filter(function(e){return!!e})}function ue(){A.pluginCache=Object.keys(w)}async function V(){const e=await(await P.safeFetch(U,{cache:"no-store"})).json();w=Object.fromEntries(e.map(function(n){return[`https://vd-plugins.github.io/proxy/${n.vendetta.original}`,n.hash]}))}function de(){const e=setInterval(V,6e5);return V(),function(){return clearInterval(e)}}const{FormRow:L}=R.Forms,G=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:I.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:I.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function fe(e){return t.React.createElement(t.ReactNative.View,{style:[G.card,{marginBottom:10}]},t.React.createElement(L,{style:G.header,label:e.headerLabel,leading:e.headerIcon&&t.React.createElement(L.Icon,{source:e.headerIcon})}),t.React.createElement(L,{label:e.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:G.actions},e.actions?.map(function(n){let{icon:r,onPress:s,onLongPress:i,destructive:c}=n;return t.React.createElement(B,{icon:r,onPress:s,onLongPress:i,style:"card",destructive:c??!1})}))}))}const{View:j}=R.General,H=t.stylesheet.createThemedStyleSheet({main:{marginRight:16,flexGrow:0},content:{backgroundColor:I.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:16,marginLeft:8,paddingHorizontal:8}});function Y(e){let{text:n,marginLeft:r}=e;return React.createElement(j,{style:[H.main,r?{marginLeft:16,marginRight:0}:{}]},React.createElement(j,{style:H.content},React.createElement(_,{variant:"eyebrow",color:"TEXT_NORMAL"},n)))}const{showUserProfile:z}=u.findByProps("showUserProfile"),{fetchProfile:K}=u.findByProps("fetchProfile"),$=u.findByStoreName("UserStore");function ge(e){let{userId:n,color:r,loadUsername:s,children:i}=e;const[c,d]=t.React.useState(!1);return t.React.useEffect(function(){return!c&&s&&($.getUser(n)?d($.getUser(n).username):K(n).then(function(g){return d(g.user.username)}))},[s]),t.React.createElement(_,{variant:"text-md/bold",color:r??"TEXT_NORMAL",onPress:function(){return $.getUser(n)?z({userId:n}):K(n).then(function(){return z({userId:n})})}},s?`@${c??"..."}`:i)}function he(e){return e.endsWith("/")?e:e+"/"}const C={origin:/^([^/]+)\/(.*)/,multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/},X={"vendetta.nexpid.xyz":function(e){return`https://github.com/nexpid/VendettaPlugins/tree/master/plugins/${e.join("/")}`},"vendetta.sdh.gay":function(e){return`https://github.com/sdhhhhh/vd-repo/tree/master/plugins/${e.join("/")}`},"plugins.obamabot.me":function(e){return`https://github.com/WolfPlugs/${e[0]}/tree/master/${e.slice(1).join("/")}`},"mugman.catvibers.me":function(e){return`https://github.com/mugman174/${e[0]}/tree/master/plugins/${e.slice(1).join("/")}`}};function pe(e){const n=e.match(C.multiplePluginGitio);if(n?.[0])return`https://github.com/${n[1]}/${n[2]}/tree/master/plugins/${n[3]}`;const r=e.match(C.singlePluginGitio)??e.match(C.githubReleases);if(r?.[0])return`https://github.com/${r[1]}/${r[2]}`;const[s,i,c]=e.match(C.origin);if(X[i])return X[i](c.split("/"))}async function Re(e){const n=e.enabled;for(let r=0;r<2;r++)n&&E.stopPlugin(e.id,!1),await E.fetchPlugin(e.id),n&&await E.startPlugin(e.id)}const x=Symbol.for("vendetta.storage.emitter"),ye=!!E.plugins[x]&&!!ie.themes[x];function Ee(e){const[n,r]=t.React.useState(!!E.plugins[e]),s=E.plugins[x],i=function(){return r(!!E.plugins[e])};return t.React.useEffect(function(){return s.on("SET",i),s.on("DEL",i),function(){s.off("SET",i),s.off("DEL",i)}}),n}const{View:Ne}=R.General;function Se(e){let{item:n,index:r,changes:s}=e;const i=he(`https://vd-plugins.github.io/proxy/${n.vendetta.original}`),c=Ee(i),d=s.find(function(a){return a[0]===i}),g=pe(n.vendetta.original),f=[];return g&&f.push({icon:l.getAssetIDByName("img_account_sync_github_white"),onPress:function(){return t.url.openURL(g)},onLongPress:function(){t.clipboard.setString(g),y.showToast("Copied GitHub link",l.getAssetIDByName("toast_copy_link"))}}),t.React.createElement(t.React.Fragment,null,t.React.createElement(fe,{index:r,headerLabel:t.React.createElement(Ne,{style:{flexDirection:"row"}},d&&t.React.createElement(Y,{text:d[1]==="new"?"New":"Upd"}),t.React.createElement(_,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},n.name,n.authors[0]&&" by ",...n.authors.map(function(a,o,h){return t.React.createElement(t.React.Fragment,null,t.React.createElement(ge,{userId:a.id,color:"TEXT_LINK"},a.name),o!==h.length-1&&", ")}))),headerIcon:l.getAssetIDByName(n.vendetta.icon),descriptionLabel:n.description,actions:i.includes("plugin-browser")?f:c?[E.plugins[i]?.manifest.hash!==n.hash&&{icon:l.getAssetIDByName("ic_sync_24px"),onPress:function(){Re(i).then(function(){return y.showToast(`Successfully updated ${n.name}`,l.getAssetIDByName("ic_sync_24px"))}).catch(function(){return y.showToast(`Failed to update ${n.name}!`,l.getAssetIDByName("Small"))})}},{icon:l.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(){try{E.removePlugin(i),y.showToast(`Successfully deleted ${n.name}`,l.getAssetIDByName("ic_message_delete"))}catch{y.showToast(`Failed to delete ${n.name}!`,l.getAssetIDByName("Small"))}},onLongPress:function(){t.clipboard.setString(n.vendetta.original),y.showToast("Copied unproxied link",l.getAssetIDByName("toast_copy_link"))}},...f].filter(function(a){return!!a}):[{icon:l.getAssetIDByName("ic_download_24px"),onPress:async function(){E.installPlugin(i,!0).then(function(){y.showToast(`Successfully installed ${n.name}`,l.getAssetIDByName("toast_image_saved"))}).catch(function(a){return y.showToast(a?.message??`Failed to install ${n.name}!`,l.getAssetIDByName("Small"))})},onLongPress:function(){t.clipboard.setString(n.vendetta.original),y.showToast("Copied unproxied link",l.getAssetIDByName("toast_copy_link"))}},...f]}))}const{showSimpleActionSheet:Ie}=u.findByProps("showSimpleActionSheet"),{View:ve}=R.General;var S;(function(e){e.Newest="Newest",e.Oldest="Oldest",e.Alphabetical="Alphabetical",e.ReverseAlphabetical="Reverse Alphabetical"})(S||(S={}));let W,q;function J(){const e=t.NavigationNative.useNavigation();if(!ye)return ae.showConfirmationAlert({title:"Can't use",content:"You must reinstall Vendetta first in order for Plugin Browser to function properly",confirmText:"Dismiss",confirmColor:"brand",onConfirm:function(){},isDismissable:!0}),e.goBack(),null;const[n]=t.React.useState(D()),[r,s]=t.React.useState(S.Newest),[i,c]=t.React.useState(),[d,g]=t.React.useState("");if(t.React.useEffect(function(){g(""),s(S.Newest)},[]),t.React.useEffect(function(){ue()},[]),t.React.useEffect(function(){i||P.safeFetch(U,{cache:"no-store"}).then(function(a){return a.json().then(function(o){return c(o)}).catch(function(){return y.showToast("Failed to parse plugins",l.getAssetIDByName("Small"))})}).catch(function(){return y.showToast("Failed to fetch plugins",l.getAssetIDByName("Small"))})},[i]),W=function(){return i&&c(void 0)},q=function(){return i&&Ie({key:"CardOverflow",options:Object.values(S).map(function(a){return{label:a,onPress:function(){return s(a)}}})})},e.addListener("focus",function(){e.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(ve,{style:{flexDirection:"row-reverse"}},t.React.createElement(B,{onPress:function(){return W?.()},icon:l.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(B,{onPress:function(){return q?.()},icon:l.getAssetIDByName("ic_filter"),style:"header"}))}})}),!i)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let f=i.filter(function(a){return a.name?.toLowerCase().includes(d)||a.authors?.some(function(o){return o.name?.toLowerCase().includes(d)})||a.description?.toLowerCase().includes(d)});return[S.Alphabetical,S.ReverseAlphabetical].includes(r)&&(f=f.sort(function(a,o){return a.name<o.name?-1:a.name>o.name?1:0})),[S.ReverseAlphabetical,S.Newest].includes(r)&&f.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(R.Search,{style:{marginBottom:10},onChangeText:function(a){return g(a.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:f,renderItem:function(a){let{item:o,index:h}=a;return t.React.createElement(R.ErrorBoundary,null,t.React.createElement(Se,{item:o,index:h,changes:n}))},removeClippedSubviews:!0})}const{FormRow:O}=R.Forms;function Te(e){let{changes:n}=e;const r=t.NavigationNative.useNavigation();return React.createElement(R.ErrorBoundary,null,React.createElement(O,{label:React.createElement(_,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},"Plugin Browser",n?React.createElement(Y,{text:n.toString(),marginLeft:!0}):React.createElement(React.Fragment,null)),leading:React.createElement(O.Icon,{source:l.getAssetIDByName("ic_search_items_24px")}),trailing:O.Arrow,onPress:function(){return r.push("VendettaCustomPage",{render:J})}}))}const{FormSection:Pe}=R.Forms,_e=u.findByName("getScreens"),be=u.findByName("UserSettingsOverviewWrapper",!1),we=u.findByName("SettingsOverviewScreen",!1);//! Changed in 194204 lol
const Ce=["SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"],Ae=["SETTING_RENDERER_CONFIG"],v=u.findByProps(...Ce),F=u.findByProps(...Ae),Q="getSettingTitleConfig",Z="getSettingTitles",ee=u.findByProps(Q),me=ee?Q:Z,Be=ee??u.findByProps(Z),De=t.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:I.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function Le(e,n,r){const s=[],i=b.after("default",be,function(c,d){i();const g=P.findInReactTree(d.props.children,function(f){return f.type&&f.type.name==="UserSettingsOverview"});s.push(b.after("render",g.type.prototype,function(f,a){let{props:{children:o}}=a;const h=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];o=P.findInReactTree(o,function(p){return p.children[1].type===Pe}).children;const N=o.findIndex(function(p){return h.includes(p?.props.label)});e()&&o.splice(N===-1?4:N,0,n({}))}))},!0);if(s.push(i),_e&&r){const c=`VENDETTA_PLUGIN_${t.lodash.snakeCase(r.key).toUpperCase()}`;s.push(b.after("default",we,function(a,o){const h=o.props.sections,N=h.findIndex(function(p){return p.title==="Vendetta"});if(h[N]&&e()){const p={...h[N]};p.settings=[...p.settings,c],h[N]=p}})),s.push(b.after(me,Be,function(a,o){return{...o,[c]:typeof r.title=="function"?r.title():r.title}}));const d=r.page.render,g=t.React.memo(function(a){let{navigation:o}=a;const h=o.addListener("focus",function(){h(),o.setOptions(P.without(r.page,"noErrorBoundary","render"))});return t.React.createElement(t.ReactNative.View,{style:De.container},r.page.noErrorBoundary?t.React.createElement(d,null):t.React.createElement(R.ErrorBoundary,null,t.React.createElement(d,null)))}),f={[c]:{type:"route",icon:r.icon,screen:{route:`VendettaPlugin${t.lodash.chain(r.key).camelCase().upperFirst().value()}`,getComponent:function(){return g}}}};//! DEBUGGING REQUIRED!
if(v){const a=v.SETTING_RELATIONSHIPS;v.SETTING_RELATIONSHIPS={...a,[c]:null};const o=v.SETTING_RENDERER_CONFIGS;v.SETTING_RENDERER_CONFIGS={...o,...f},s.push(function(){v.SETTING_RELATIONSHIPS=a,v.SETTING_RENDERER_CONFIGS=o})}else{const a=F.SETTING_RENDERER_CONFIG;F.SETTING_RENDERER_CONFIG={...a,...f},s.push(function(){F.SETTING_RENDERER_CONFIG})}}return function(){return s.forEach(function(c){return c()})}}function Ge(){let e=[];return e.push(Le(function(){return!0},function(){return React.createElement(Te,{changes:D().filter(function(n){return n[1]==="new"}).length})},{key:m.plugin.manifest.name,icon:l.getAssetIDByName("ic_search_items_24px"),title:function(){const n=D().filter(function(r){return r[1]==="new"}).length;return`Plugin Browser${n?` (+${n})`:""}`},page:{render:J}})),e.push(de()),function(){return e.forEach(function(n){return n()})}}const U="https://vd-plugins.github.io/proxy/plugins-full.json",A=re.storage;let te;var $e={onLoad:function(){return te=Ge()},onUnload:function(){return te?.()}};return T.default=$e,T.pluginsURL=U,T.vstorage=A,Object.defineProperty(T,"__esModule",{value:!0}),T})({},vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.ui.toasts,vendetta.metro,vendetta.ui,vendetta.utils,vendetta,vendetta.plugins,vendetta.themes,vendetta.ui.alerts,vendetta.patcher);
