(function(w,t,g,S,ce,E,s,x,N,A,I,oe,ue,b){"use strict";const le=s.findByStoreName("ThemeStore"),de=s.findByProps("colors","meta");s.findByProps("triggerHaptic");const fe=s.findByProps("TextStyleSheet").TextStyleSheet,{View:Ue,Text:z,Pressable:Fe}=S.General;s.findByProps("TableRow"),s.findByProps("ActionSheet")?.ActionSheet??s.find(function(e){return e.render?.name==="ActionSheet"}),s.findByProps("openLazy","hideActionSheet"),s.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),s.findByProps("ActionSheetRow")?.ActionSheetRow,s.findByName("Navigator")??s.findByProps("Navigator")?.Navigator,s.findByProps("getRenderCloseButton")?.getRenderCloseButton??s.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,s.findByProps("popModal","pushModal");const K=s.findByProps("useSearchControls"),O=s.findByProps("useSettingSearchQuery"),ge=s.findByName("SettingSearchBar");s.findByProps("SvgXml"),s.findByProps("useInMainTabsExperiment","isInMainTabsExperiment"),s.find(function(e){return e?.WebView&&!e.default}).WebView;function he(e){return de.meta.resolveSemanticColor(le.theme,e)}Object.assign(function(e){let{searchContext:n,controls:r}=e;return t.React.createElement(t.ReactNative.ScrollView,{scrollEnabled:!1},t.React.createElement(K.default,{searchContext:n,controls:r},t.React.createElement(ge,null)))},{useAdvancedSearch:function(e){const n=O.useSettingSearchQuery(),r=K.useSearchControls(e,!1,function(){});return t.React.useEffect(function(){return function(){O.setSettingSearchQuery(""),O.setIsSettingSearchActive(!1)}},[]),[n,r]}});var W;(function(e){function n(a){let{children:i,onPress:c}=a;return t.React.createElement(C,{variant:"text-md/bold",onPress:c},i)}e.Bold=n;function r(a){let{children:i,onPress:c}=a;return t.React.createElement(z,{style:{textDecorationLine:"underline"},onPress:c},i)}e.Underline=r})(W||(W={}));function C(e){let{variant:n,lineClamp:r,color:a,align:i,style:c,onPress:d,getChildren:R,children:h,liveUpdate:o}=e;const[f,u]=t.React.useReducer(function(p){return~p},0);return t.React.useEffect(function(){if(!o)return;const p=new Date().setMilliseconds(1e3);let l,y;return y=setTimeout(function(){u(),l=setInterval(u,1e3)},p-Date.now()),function(){clearTimeout(y),clearInterval(l)}},[]),t.React.createElement(z,{style:[n?fe[n]:{},a?{color:he(N.semanticColors[a])}:{},i?{textAlign:i}:{},c??{}],numberOfLines:r,onPress:d},R?.()??h)}function G(e){let{onPress:n,onLongPress:r,icon:a,style:i,destructive:c,color:d}=e;const R=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:N.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:N.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:N.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n,onLongPress:r},t.React.createElement(t.ReactNative.Image,{style:[typeof i=="string"?i==="header"?R.headerStyleIcon:R.cardStyleIcon:i,c&&R.destructiveIcon,d&&{tintColor:d}].filter(function(h){return!!h}),source:a}))}let L={};function $(){return!Object.keys(L)[0]||!m.pluginCache?.[0]?[]:Object.entries(L).map(function(e){let[n,r]=e;return m.pluginCache?.includes(n)?x.plugins.plugins[n]&&x.plugins.plugins[n].manifest.hash!==r?[n,"update"]:void 0:[n,"new"]}).filter(function(e){return!!e})}function pe(){m.pluginCache=Object.keys(L)}async function X(){const e=await(await A.safeFetch(H,{cache:"no-store"})).json();L=Object.fromEntries(e.map(function(n){return[`https://vd-plugins.github.io/proxy/${n.vendetta.original}`,n.hash]}))}function Re(){const e=setInterval(X,6e5);return X(),function(){return clearInterval(e)}}const{FormRow:U}=S.Forms,F=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:N.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:N.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function ye(e){return t.React.createElement(t.ReactNative.View,{style:[F.card,{marginBottom:10}]},t.React.createElement(U,{style:F.header,label:e.headerLabel,leading:e.headerIcon&&t.React.createElement(U.Icon,{source:e.headerIcon})}),t.React.createElement(U,{label:e.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:F.actions},e.actions?.map(function(n){let{icon:r,onPress:a,onLongPress:i,destructive:c}=n;return t.React.createElement(G,{icon:r,onPress:a,onLongPress:i,style:"card",destructive:c??!1})}),e.loading&&t.React.createElement(t.ReactNative.ActivityIndicator,{size:"small",style:{height:22,width:22}}))}))}const{View:Q}=S.General,J=t.stylesheet.createThemedStyleSheet({main:{marginRight:16,flexGrow:0},content:{backgroundColor:N.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:16,marginLeft:8,paddingHorizontal:8}});function q(e){let{text:n,marginLeft:r}=e;return React.createElement(Q,{style:[J.main,r?{marginLeft:16,marginRight:0}:{}]},React.createElement(Q,{style:J.content},React.createElement(C,{variant:"eyebrow",color:"TEXT_NORMAL"},n)))}const{showUserProfile:Z}=s.findByProps("showUserProfile"),{fetchProfile:ee}=s.findByProps("fetchProfile"),k=s.findByStoreName("UserStore");function Se(e){let{userId:n,color:r,loadUsername:a,children:i}=e;const[c,d]=t.React.useState(null);return t.React.useEffect(function(){return!c&&a&&(k.getUser(n)?d(k.getUser(n).username):ee(n).then(function(R){return d(R.user.username)}))},[a]),t.React.createElement(C,{variant:"text-md/bold",color:r??"TEXT_NORMAL",onPress:function(){return k.getUser(n)?Z({userId:n}):ee(n).then(function(){return Z({userId:n})})}},a?`@${c??"..."}`:i)}function Ee(e){return e.endsWith("/")?e:e+"/"}const D={origin:/^([^/]+)\/(.*)/,multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/},te={"vendetta.nexpid.xyz":function(e){return`https://github.com/nexpid/VendettaPlugins/tree/master/plugins/${e.join("/")}`},"vendetta.sdh.gay":function(e){return`https://github.com/sdhhhhh/vd-repo/tree/master/plugins/${e.join("/")}`},"plugins.obamabot.me":function(e){return`https://github.com/WolfPlugs/${e[0]}/tree/master/${e.slice(1).join("/")}`},"mugman.catvibers.me":function(e){return`https://github.com/mugman174/${e[0]}/tree/master/plugins/${e.slice(1).join("/")}`}};function Ie(e){const n=e.match(D.multiplePluginGitio);if(n?.[0])return`https://github.com/${n[1]}/${n[2]}/tree/master/plugins/${n[3]}`;const r=e.match(D.singlePluginGitio)??e.match(D.githubReleases);if(r?.[0])return`https://github.com/${r[1]}/${r[2]}`;const[a,i,c]=e.match(D.origin);if(te[i])return te[i](c.split("/"))}async function ve(e){const n=e.enabled;for(let r=0;r<2;r++)n&&I.stopPlugin(e.id,!1),await I.fetchPlugin(e.id),n&&await I.startPlugin(e.id)}const V=Symbol.for("vendetta.storage.emitter"),Ne=!!I.plugins[V]&&!!oe.themes[V];function Pe(e){const[n,r]=t.React.useState(JSON.stringify(I.plugins[e])),a=I.plugins[V],i=function(){return r(JSON.stringify(I.plugins[e]))};return t.React.useEffect(function(){return a.on("SET",i),a.on("DEL",i),function(){a.off("SET",i),a.off("DEL",i)}}),n}const{View:Te}=S.General;function be(e){let{item:n,index:r,changes:a}=e;const i=Ee(`https://vd-plugins.github.io/proxy/${n.vendetta.original}`),[c,d]=t.React.useState(!1),R=Pe(i),h=a.find(function(u){return u[0]===i}),o=Ie(n.vendetta.original),f=[];return o&&f.push({icon:g.getAssetIDByName("img_account_sync_github_white"),onPress:function(){return t.url.openURL(o)},onLongPress:function(){t.clipboard.setString(o),E.showToast("Copied GitHub link",g.getAssetIDByName("toast_copy_link"))}}),t.React.createElement(ye,{index:r,headerLabel:t.React.createElement(Te,{style:{flexDirection:"row"}},h&&t.React.createElement(q,{text:h[1]==="new"?"New":"Upd"}),t.React.createElement(C,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},n.name,n.authors[0]&&" by ",...n.authors.map(function(u,p,l){return t.React.createElement(t.React.Fragment,null,t.React.createElement(Se,{userId:u.id,color:"TEXT_LINK"},u.name),p!==l.length-1&&", ")}))),headerIcon:g.getAssetIDByName(n.vendetta.icon),descriptionLabel:n.description,actions:c?[]:i.includes("plugin-browser")?f:R?[I.plugins[i]?.manifest.hash!==n.hash&&{icon:g.getAssetIDByName("ic_sync_24px"),onPress:function(){d(!0),ve(i).then(function(){return E.showToast(`Successfully updated ${n.name}`,g.getAssetIDByName("ic_sync_24px"))}).catch(function(){return E.showToast(`Failed to update ${n.name}!`,g.getAssetIDByName("Small"))}).finally(function(){return d(!1)})}},{icon:g.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(){d(!0);try{I.removePlugin(i),E.showToast(`Successfully deleted ${n.name}`,g.getAssetIDByName("ic_message_delete"))}catch{E.showToast(`Failed to delete ${n.name}!`,g.getAssetIDByName("Small"))}d(!1)},onLongPress:function(){t.clipboard.setString(n.vendetta.original),E.showToast("Copied unproxied link",g.getAssetIDByName("toast_copy_link"))}},...f].filter(function(u){return!!u}):[{icon:g.getAssetIDByName("ic_download_24px"),onPress:async function(){d(!0),I.installPlugin(i,!0).then(function(){E.showToast(`Successfully installed ${n.name}`,g.getAssetIDByName("toast_image_saved"))}).catch(function(u){return E.showToast(u?.message??`Failed to install ${n.name}!`,g.getAssetIDByName("Small"))}).finally(function(){return d(!1)})},onLongPress:function(){t.clipboard.setString(n.vendetta.original),E.showToast("Copied unproxied link",g.getAssetIDByName("toast_copy_link"))}},...f],loading:c})}const{showSimpleActionSheet:Be}=s.findByProps("showSimpleActionSheet"),{View:we}=S.General;var v;(function(e){e.Newest="Newest",e.Oldest="Oldest",e.Alphabetical="Alphabetical",e.ReverseAlphabetical="Reverse Alphabetical"})(v||(v={}));let ne,re;function ie(){const e=t.NavigationNative.useNavigation();if(!Ne)return ue.showConfirmationAlert({title:"Can't use",content:"You must reinstall Vendetta first in order for Plugin Browser to function properly",confirmText:"Dismiss",confirmColor:"brand",onConfirm:function(){},isDismissable:!0}),e.goBack(),null;const[n]=t.React.useState($()),[r,a]=t.React.useState(v.Newest),[i,c]=t.React.useState(),[d,R]=t.React.useState("");if(t.React.useEffect(function(){R(""),a(v.Newest)},[]),t.React.useEffect(function(){pe()},[]),t.React.useEffect(function(){i||A.safeFetch(H,{cache:"no-store"}).then(function(o){return o.json().then(function(f){return c(f)}).catch(function(){return E.showToast("Failed to parse plugins",g.getAssetIDByName("Small"))})}).catch(function(){return E.showToast("Failed to fetch plugins",g.getAssetIDByName("Small"))})},[i]),ne=function(){return i&&c(void 0)},re=function(){return i&&Be({key:"CardOverflow",options:Object.values(v).map(function(o){return{label:o,onPress:function(){return a(o)}}})})},e.addListener("focus",function(){e.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(we,{style:{flexDirection:"row-reverse"}},t.React.createElement(G,{onPress:function(){return ne?.()},icon:g.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(G,{onPress:function(){return re?.()},icon:g.getAssetIDByName("ic_filter"),style:"header"}))}})}),!i)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let h=i.filter(function(o){return o.name?.toLowerCase().includes(d)||o.authors?.some(function(f){return f.name?.toLowerCase().includes(d)})||o.description?.toLowerCase().includes(d)});return[v.Alphabetical,v.ReverseAlphabetical].includes(r)&&(h=h.sort(function(o,f){return o.name<f.name?-1:o.name>f.name?1:0})),[v.ReverseAlphabetical,v.Newest].includes(r)&&h.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(S.Search,{style:{marginBottom:10},onChangeText:function(o){return R(o.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:h,renderItem:function(o){let{item:f,index:u}=o;return t.React.createElement(S.ErrorBoundary,null,t.React.createElement(be,{item:f,index:u,changes:n}))},removeClippedSubviews:!0})}const{FormRow:M}=S.Forms;function Ae(e){let{changes:n}=e;const r=t.NavigationNative.useNavigation();return React.createElement(S.ErrorBoundary,null,React.createElement(M,{label:React.createElement(C,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},"Plugin Browser",n?React.createElement(q,{text:n.toString(),marginLeft:!0}):React.createElement(React.Fragment,null)),leading:React.createElement(M.Icon,{source:g.getAssetIDByName("ic_search_items_24px")}),trailing:M.Arrow,onPress:function(){return r.push("VendettaCustomPage",{render:ie})}}))}const{FormSection:Ce}=S.Forms,_e=s.findByName("getScreens"),Le=s.findByName("UserSettingsOverviewWrapper",!1),De=t.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:N.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function me(e,n,r){const a=[],i=b.after("default",Le,function(c,d){i();const R=A.findInReactTree(d.props.children,function(h){return h.type&&h.type.name==="UserSettingsOverview"});a.push(b.after("render",R.type.prototype,function(h,o){let{props:{children:f}}=o;const u=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];f=A.findInReactTree(f,function(l){return l.children[1].type===Ce}).children;const p=f.findIndex(function(l){return u.includes(l?.props.label)});e()&&f.splice(p===-1?4:p,0,n({}))}))},!0);if(a.push(i),_e&&r){const c=`VENDETTA_PLUGIN_${t.lodash.snakeCase(r.key).toUpperCase()}`,d=r.page.render,R=t.React.memo(function(u){let{navigation:p}=u;const l=p.addListener("focus",function(){l(),p.setOptions(A.without(r.page,"noErrorBoundary","render"))});return t.React.createElement(t.ReactNative.View,{style:De.container},r.page.noErrorBoundary?t.React.createElement(d,null):t.React.createElement(S.ErrorBoundary,null,t.React.createElement(d,null)))}),h={[c]:{type:"route",title:function(){return r.title},icon:r.icon,parent:null,screen:{route:`VendettaPlugin${t.lodash.chain(r.key).camelCase().upperFirst().value()}`,getComponent:function(){return R}}}},o=function(u,p){const l=[...u],y=p?l?.[0]?.sections:l;if(!Array.isArray(y))return y;const P="Vendetta",T=y.find(function(B){return B?.title===P||B?.label===P});return T&&!T?.settings?.includes(c)&&T.settings.push(c),l},f=function(){const u=s.findByProps("useOverviewSettings"),p=s.findByProps("getSettingTitleConfig"),l=s.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),y="getSettingSearchListItems",P="getSettingListItems",T=s.findByProps(y),B=T?y:P,se=T??s.findByProps(P);if(!se||!u)return!1;a.push(b.after("useOverviewSettings",u,function(Y,_){return o(_)})),a.push(b.after("getSettingTitleConfig",p,function(Y,_){return{..._,[c]:r.title}})),a.push(b.after(B,se,function(Y,_){let[$e]=Y;return[...$e.includes(c)?[{type:"setting_search_result",ancestorRendererData:h[c],setting:c,title:function(){return r.title},breadcrumbs:["Vendetta"],icon:h[c].icon}]:[],..._]}));const j=l.SETTING_RELATIONSHIPS,Ge=l.SETTING_RENDERER_CONFIGS;return l.SETTING_RELATIONSHIPS={...j,[c]:null},l.SETTING_RENDERER_CONFIGS={...Ge,...h},a.push(function(){l.SETTING_RELATIONSHIPS=j,l.SETTING_RENDERER_CONFIGS=j}),!0};(function(){const u=s.findByProps("SearchableSettingsList"),p=s.findByProps("SETTING_RENDERER_CONFIG"),l=s.findByProps("getSettingListItems");if(!l||!u||!p)return!1;a.push(b.before("type",u.SearchableSettingsList,function(P){return o(P,!0)})),a.push(b.after("getSettingListSearchResultItems",l,function(P,T){for(const B of T)B.setting===c&&(B.breadcrumbs=["Vendetta"])}));const y=p.SETTING_RENDERER_CONFIG;return p.SETTING_RENDERER_CONFIG={...y,...h},a.push(function(){p.SETTING_RENDERER_CONFIG=y}),!0})()||f()}return function(){return a.forEach(function(c){return c()})}}function xe(){let e=[];return e.push(me(function(){return!0},function(){return React.createElement(Ae,{changes:$().filter(function(n){return n[1]==="new"}).length})},{key:x.plugin.manifest.name,icon:g.getAssetIDByName("ic_search_items_24px"),get title(){const n=$().filter(function(r){return r[1]==="new"}).length;return`Plugin Browser${n?` (+${n})`:""}`},page:{render:ie}})),e.push(Re()),function(){return e.forEach(function(n){return n()})}}const H="https://vd-plugins.github.io/proxy/plugins-full.json",m=ce.storage;let ae;var Oe={onLoad:function(){return ae=xe()},onUnload:function(){return ae?.()}};return w.default=Oe,w.pluginsURL=H,w.vstorage=m,Object.defineProperty(w,"__esModule",{value:!0}),w})({},vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.ui.toasts,vendetta.metro,vendetta,vendetta.ui,vendetta.utils,vendetta.plugins,vendetta.themes,vendetta.ui.alerts,vendetta.patcher);
