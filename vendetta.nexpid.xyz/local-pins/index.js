(function(d,Y,t,Q,f,b,h,E,K,s,I,W,P){"use strict";const J=s.findByStoreName("ThemeStore");s.findByProps("triggerHaptic");const M=s.findByProps("colors","unsafe_rawColors"),q=M?.internal??M?.meta,Z=s.findByProps("TextStyleSheet").TextStyleSheet,{View:C,Text:_,Pressable:ee}=E.General;s.findByProps("TableRow");const te=s.findByProps("ActionSheet")?.ActionSheet??s.find(function(e){return e.render?.name==="ActionSheet"}),D=s.findByProps("openLazy","hideActionSheet"),{openLazy:ne,hideActionSheet:m}=D,{ActionSheetTitleHeader:re,ActionSheetCloseButton:ie,ActionSheetContentContainer:ae}=s.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");s.findByProps("ActionSheetRow")?.ActionSheetRow,s.findByName("Navigator")??s.findByProps("Navigator")?.Navigator,s.findByProps("getRenderCloseButton")?.getRenderCloseButton??s.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,s.findByProps("popModal","pushModal");const x=s.findByProps("useSearchControls"),w=s.findByProps("useSettingSearchQuery"),se=s.findByName("SettingSearchBar");s.findByProps("SvgXml"),s.findByProps("useInMainTabsExperiment","isInMainTabsExperiment"),s.find(function(e){return e?.WebView&&!e.default}).WebView,s.findByProps("Button","SegmentedControl");function ce(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:J.theme;return q.resolveSemanticColor(n,e)}function le(e,n){try{ne(new Promise(function(r){return r({default:e})}),"ActionSheet",n)}catch(r){K.logger.error(r.stack),I.showToast("Got error when opening ActionSheet! Please check debug logs",h.getAssetIDByName("Smal"))}}Object.assign(function(e){let{searchContext:n,controls:r}=e;return t.React.createElement(t.ReactNative.ScrollView,{scrollEnabled:!1},t.React.createElement(x.default,{searchContext:n,controls:r},t.React.createElement(se,null)))},{useAdvancedSearch:function(e){const n=w.useSettingSearchQuery(),r=x.useSearchControls(e,!1,function(){});return t.React.useEffect(function(){return function(){w.setSettingSearchQuery(""),w.setIsSettingSearchActive(!1)}},[]),[n,r]}}),window.nativeModuleProxy.DCDFileManager??window.nativeModuleProxy.RTNFileManager,window.nativeModuleProxy.BundleUpdaterManager,window.nativeModuleProxy.MMKVManager,window.nativeModuleProxy.DCDSoundManager;function oe(e){let{title:n,onPress:r,icon:i}=e;const a=t.stylesheet.createThemedStyleSheet({androidRipple:{color:f.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:f.semanticColors.HEADER_SECONDARY,opacity:.5}}),c=r?ee:C;return t.React.createElement(c,{android_ripple:a.androidRipple,disabled:!1,accessibilityRole:"button",onPress:r,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&t.React.createElement(C,{style:{marginRight:4}},t.React.createElement(t.ReactNative.Image,{style:a.icon,source:i,resizeMode:"contain"})),t.React.createElement(v,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},n))}function ue(e){let{title:n,onTitlePress:r,icon:i,children:a,padding:c}=e;const o=t.stylesheet.createThemedStyleSheet({main:{backgroundColor:f.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return t.React.createElement(C,{style:{marginHorizontal:16,marginTop:16}},t.React.createElement(oe,{title:n,onPress:r,icon:i}),t.React.createElement(C,{style:o.main},c?t.React.createElement(C,{style:{paddingHorizontal:16,paddingVertical:16}},a):a))}var L;(function(e){function n(i){let{children:a,onPress:c}=i;return t.React.createElement(v,{variant:"text-md/bold",onPress:c},a)}e.Bold=n;function r(i){let{children:a,onPress:c}=i;return t.React.createElement(_,{style:{textDecorationLine:"underline"},onPress:c},a)}e.Underline=r})(L||(L={}));function v(e){let{variant:n,lineClamp:r,color:i,align:a,style:c,onPress:o,getChildren:u,children:g,liveUpdate:y}=e;const[R,p]=t.React.useReducer(function(S){return~S},0);return t.React.useEffect(function(){if(!y)return;const S=new Date().setMilliseconds(1e3);let j;const Te=setTimeout(function(){p(),j=setInterval(p,1e3)},S-Date.now());return function(){clearTimeout(Te),clearInterval(j)}},[]),t.React.createElement(_,{style:[n?Z[n]:{},i?{color:ce(f.semanticColors[i])}:{},a?{textAlign:a}:{},c??{}],numberOfLines:r,onPress:o},u?.()??g)}function O(e){let{onPress:n,onLongPress:r,icon:i,style:a,destructive:c,color:o}=e;const u=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:f.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:f.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:f.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n,onLongPress:r},t.React.createElement(t.ReactNative.Image,{style:[typeof a=="string"?a==="header"?u.headerStyleIcon:u.cardStyleIcon:a,c&&u.destructiveIcon,o&&{tintColor:o}].filter(function(g){return!!g}),source:i}))}const{ScrollView:de}=E.General,{FormRow:A}=E.Forms,fe=t.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:f.semanticColors.TEXT_DANGER}}),he={color:"TEXT_DANGER",variant:"text-md/semibold"};function ge(){return Q.useProxy(l),React.createElement(de,null,React.createElement(ue,{title:"Settings",icon:h.getAssetIDByName("ic_cog_24px")},React.createElement(A,{label:"Data size",subLabel:l.pinned?`${Math.floor(JSON.stringify(l.pinned).length/1e3*100)/100} kilobytes`:"N/A",leading:React.createElement(A.Icon,{source:h.getAssetIDByName("ic_message_edit")})}),React.createElement(A,{label:React.createElement(v,he,"Clear data"),leading:React.createElement(A.Icon,{style:fe.destructiveIcon,source:h.getAssetIDByName("ic_message_delete")}),trailing:React.createElement(A.Arrow,null),onPress:function(){return b.showConfirmationAlert({title:"Clear data",content:"Are you sure you want to clear all local pin data?",confirmText:"Clear",confirmColor:"red",onConfirm:function(){delete l.pinned},isDismissable:!0})}})))}const{ActionSheetRow:B}=s.findByProps("ActionSheetRow"),{FormRow:F}=s.findByProps("FormRow");function ye(e){let{label:n,icon:r,onPress:i}=e;const a=t.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:f.semanticColors.INTERACTIVE_NORMAL}});return B?React.createElement(B,{label:n,icon:React.createElement(B.Icon,{source:r,IconComponent:function(){return React.createElement(t.ReactNative.Image,{resizeMode:"cover",style:a.iconComponent,source:r})}}),onPress:i}):React.createElement(F,{label:n,leading:React.createElement(F.Icon,{source:r}),onPress:i})}function Re(e){const n=T(e.channel_id,e.id);return React.createElement(ye,{label:n?"Unpin Message Locally":"Pin Message Locally",icon:h.getAssetIDByName("ic_message_pin"),onPress:function(){n?(U(e.channel_id,e.id),I.showToast(`Unpinned ${e.nick??e.author.globalName??e.author.username}'s message locally`,h.getAssetIDByName("ic_message_pin"))):(k(e.channel_id,e.id),I.showToast(`Pinned ${e.nick??e.author.globalName??e.author.username}'s message locally`,h.getAssetIDByName("ic_message_pin"))),m()}})}const{FormCheckboxRow:G}=E.Forms;function pe(e){let{defFilters:n,set:r}=e;const[i,a]=t.React.useState(n);return r(i),t.React.createElement(te,null,t.React.createElement(ae,null,t.React.createElement(re,{title:"Filters",trailing:t.React.createElement(ie,{onPress:function(){return m()}})}),t.React.createElement(G,{label:"Server pinned",onPress:function(){return a(i.includes("server")?i.filter(function(c){return c!=="server"}):i.concat("server"))},selected:i.includes("server")}),t.React.createElement(G,{label:"Locally pinned",onPress:function(){return a(i.includes("local")?i.filter(function(c){return c!=="local"}):i.concat("local"))},selected:i.includes("local")})))}const{View:Se}=E.General,H=s.findByStoreName("MessageStore"),Ee=s.findByName("ChannelPinsConnected",!1),Pe=s.findByProps("fetchMessages","sendMessage");function Ce(e){let{channelId:n}=e;const[r,i]=t.React.useState(l.preferFilters??["server","local"]),[a,c]=t.React.useState(0);return we({filters:function(){return le(pe,{defFilters:r,set:i})},clear:function(){return Array.isArray(a)&&b.showConfirmationAlert({title:"Clear local pins",content:`Are you sure you want to clear **${a.length}** pin${a.length!==1?"s":""} in this channel?`,confirmText:"Clear",confirmColor:"red",onConfirm:function(){$(n),c([])},isDismissable:!0})}}),z[n]=function(o){return[...r.includes("local")?Array.isArray(a)?a:[]:[],...r.includes("server")?o:[]]},t.React.useEffect(function(){(async function(){const o=[],u=V(n)?.slice().reverse()??[];for(let g=0;g<u.length;g++){const y=u[g];c(g/u.length);let R=H.getMessage(n,y.id);if(!R){const p=[(BigInt(y.id)+1n).toString(),(BigInt(y.id)-1n).toString()];await Pe.fetchMessages({channelId:n,before:p[0],after:p[1],limit:1}),R=H.getMessage(n,y.id)}R&&o.push(R)}c(o)})()},[]),Array.isArray(a)?t.React.createElement(Ee.default,{channelId:n}):t.React.createElement(Se,{style:{alignItems:"center",justifyContent:"center",flex:1}},t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{marginBottom:10}}),t.React.createElement(v,{variant:"text-lg/semibold",color:"TEXT_NORMAL",align:"center"},Math.floor(a*100),"%"))}const{View:Ae}=E.General,ve=s.findByName("ChannelSettingsModal",!1),Ie=s.findByName("ChannelPinsConnected",!1);let N={};function we(e){N=e}const z={};function Be(){const e=new Array;return e.push(P.after("default",Ie,function(n,r){const{channelId:i,loaded:a,messages:c}=r.props;return{...r,props:{...r.props,messages:a&&c?z[i]?.(c)??c:c}}})),e.push(P.before("openLazy",D,function(n){let[r,i,a]=n;const c=a?.message;i!=="MessageLongPressActionSheet"||!c||r.then(function(o){const u=P.after("default",o,function(g,y){t.React.useEffect(function(){return function(){u()}},[]);const R=W.findInReactTree(y,function(S){return S?.[0]?.type?.name==="ButtonRow"});if(!R)return y;const p=Math.max(R.findIndex(function(S){return S.props.message===t.i18n.Messages.MARK_UNREAD}),0);R.splice(p,0,t.React.createElement(Re,c))})})})),e.push(P.after("default",ve,function(n,r){const i=r.props.screens;i.PINNED_MESSAGES.headerRight=function(){return t.React.createElement(Ae,{style:{flexDirection:"row-reverse"}},t.React.createElement(O,{icon:h.getAssetIDByName("ic_filter"),style:"header",onPress:function(){return N.filters?.()}}),t.React.createElement(O,{icon:h.getAssetIDByName("ic_message_delete"),style:"header",destructive:!0,onPress:function(){return N.clear?.()}}))},e.push(P.after("render",i.PINNED_MESSAGES,function(a,c){return t.React.createElement(Ce,{channelId:c.props.channelId})}))})),function(){return e.forEach(function(n){return n()})}}const l=Y.storage;function V(e){return l.pinned?.[e]}function $(e){l.pinned??(l.pinned={}),delete l.pinned?.[e]}function T(e,n){return l.pinned?.[e]?.some(function(r){return r.id===n})}function k(e,n){var r;l.pinned??(l.pinned={}),(r=l.pinned)[e]??(r[e]=[]),T(e,n)||l.pinned[e].push({id:n,pinned:Date.now()})}function U(e,n){l.pinned??(l.pinned={}),l.pinned[e]=(l.pinned[e]??[]).filter(function(r){return r.id!==n})}let X;var Ne={onLoad:function(){return X=Be()},onUnload:function(){return X()},settings:ge};return d.addPin=k,d.clearPins=$,d.default=Ne,d.getPins=V,d.hasPin=T,d.removePin=U,d.vstorage=l,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.plugin,vendetta.metro.common,vendetta.storage,vendetta.ui,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui.components,vendetta,vendetta.metro,vendetta.ui.toasts,vendetta.utils,vendetta.patcher);
