(function(A,oe,l,d,_,ae,w,S,I,G,le,ue,$){"use strict";const fe=d.findByStoreName("ThemeStore"),he=d.findByProps("colors","meta");d.findByProps("triggerHaptic");const{TextStyleSheet:de}=d.findByProps("TextStyleSheet"),{View:T,Text:U,Pressable:ge}=I.General,{FormRow:q}=I.Forms,Re=d.findByProps("ActionSheet")?.ActionSheet??d.find(function(e){return e.render?.name==="ActionSheet"}),{openLazy:Ee,hideActionSheet:Y}=d.findByProps("openLazy","hideActionSheet"),{ActionSheetTitleHeader:pe,ActionSheetCloseButton:ve,ActionSheetContentContainer:Pe}=d.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),k=d.findByProps("ActionSheetRow")?.ActionSheetRow;d.findByName("Navigator"),d.findByProps("getRenderCloseButton"),d.findByProps("popModal","pushModal");function Ae(e){return he.meta.resolveSemanticColor(fe.theme,e)}function we(e,t){try{Ee(new Promise(function(n){return n({default:e})}),"ActionSheet",t)}catch(n){ae.logger.error(n.stack),G.showToast("Got error when opening ActionSheet! Please check debug logs",S.getAssetIDByName("Smal"))}}function Se(e){let{label:t,icon:n,onPress:i}=e;const r=l.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:w.semanticColors.INTERACTIVE_NORMAL}});return k?l.React.createElement(k,{label:t,icon:l.React.createElement(k.Icon,{source:n,IconComponent:function(){return l.React.createElement(l.ReactNative.Image,{resizeMode:"cover",style:r.iconComponent,source:n})}}),onPress:function(){return i?.()}}):l.React.createElement(q,{label:t,leading:l.React.createElement(q.Icon,{source:n}),onPress:function(){return i?.()}})}function Ie(e){let{title:t,onPress:n,icon:i}=e;const r=l.stylesheet.createThemedStyleSheet({androidRipple:{color:w.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:w.semanticColors.HEADER_SECONDARY,opacity:.5}}),s=n?ge:T;return l.React.createElement(s,{android_ripple:r.androidRipple,disabled:!1,accessibilityRole:"button",onPress:n,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&l.React.createElement(T,{style:{marginRight:4}},l.React.createElement(l.ReactNative.Image,{style:r.icon,source:i,resizeMode:"contain"})),l.React.createElement(O,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},t))}function Ne(e){let{title:t,onTitlePress:n,icon:i,children:r,padding:s}=e;const u=l.stylesheet.createThemedStyleSheet({main:{backgroundColor:w.semanticColors.REDESIGN_ACTIVITY_CARD_BACKGROUND,borderRadius:16,overflow:"hidden",flex:1}});return l.React.createElement(T,{style:{marginHorizontal:16,marginTop:16}},l.React.createElement(Ie,{title:t,onPress:n,icon:i}),l.React.createElement(T,{style:u.main},s?l.React.createElement(T,{style:{paddingHorizontal:16,paddingVertical:16}},r):r))}var X;(function(e){function t(i){let{children:r,onPress:s}=i;return l.React.createElement(O,{variant:"text-md/bold",onPress:s},r)}e.Bold=t;function n(i){let{children:r,onPress:s}=i;return l.React.createElement(U,{style:{textDecorationLine:"underline"},onPress:s},r)}e.Underline=n})(X||(X={}));function O(e){let{variant:t,lineClamp:n,color:i,align:r,style:s,onPress:u,getChildren:c,children:a,liveUpdate:o}=e;const[g,f]=l.React.useReducer(function(R){return~R},0);return l.React.useEffect(function(){if(!o)return;const R=new Date().setMilliseconds(1e3);let B,F;return F=setTimeout(function(){f(),B=setInterval(f,1e3)},R-Date.now()),function(){clearTimeout(F),clearInterval(B)}},[]),l.React.createElement(U,{style:[t?de[t]:{},i?{color:Ae(w.semanticColors[i])}:{},r?{textAlign:r}:{},s??{}],numberOfLines:n,onPress:u},c?.()??a)}function J(e){let{onPress:t,onLongPress:n,icon:i,style:r,destructive:s,color:u}=e;const c=l.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:w.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:w.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:w.semanticColors.TEXT_DANGER}});return l.React.createElement(l.ReactNative.TouchableOpacity,{onPress:t,onLongPress:n},l.React.createElement(l.ReactNative.Image,{style:[typeof r=="string"?r==="header"?c.headerStyleIcon:c.cardStyleIcon:r,s&&c.destructiveIcon,u&&{tintColor:u}].filter(function(a){return!!a}),source:i}))}d.findByProps("TableRowGroup"),d.findByProps("showShareActionSheet"),d.findByProps("showSimpleActionSheet"),d.findByProps("downloadMediaAsset"),d.findByProps("isAndroid");const Ce=d.findByProps("openLazy","hideActionSheet");d.findByProps("PRIMARY_INFO_TOP_OFFSET","SECONDARY_INFO_TOP_MARGIN","SIDE_PADDING"),d.findByStoreName("ThemeStore"),d.findByProps("colors","meta");function ye(e){const t=j(e.channel_id,e.id);return React.createElement(Se,{label:t?"Unpin Message Locally":"Pin Message Locally",icon:S.getAssetIDByName("ic_message_pin"),onPress:function(){t?(se(e.channel_id,e.id),G.showToast(`Unpinned ${e.nick??e.author.globalName??e.author.username}'s message locally`,S.getAssetIDByName("ic_message_pin"))):(ie(e.channel_id,e.id),G.showToast(`Pinned ${e.nick??e.author.globalName??e.author.username}'s message locally`,S.getAssetIDByName("ic_message_pin"))),Y()}})}const{FormCheckboxRow:K}=I.Forms;function be(e){let{defFilters:t,set:n}=e;const[i,r]=l.React.useState(t);return n(i),l.React.createElement(Re,null,l.React.createElement(Pe,null,l.React.createElement(pe,{title:"Filters",trailing:l.React.createElement(ve,{onPress:function(){return Y()}})}),l.React.createElement(K,{label:"Server pinned",onPress:function(){return r(i.includes("server")?i.filter(function(s){return s!=="server"}):i.concat("server"))},selected:i.includes("server")}),l.React.createElement(K,{label:"Locally pinned",onPress:function(){return r(i.includes("local")?i.filter(function(s){return s!=="local"}):i.concat("local"))},selected:i.includes("local")})))}var Be=20,De=1,N=1e6,W=1e6,_e=-7,Te=21,Me=!1,M="[big.js] ",C=M+"Invalid ",L=C+"decimal places",me=C+"rounding mode",Z=M+"Division by zero",h={},P=void 0,xe=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Q(){function e(t){var n=this;if(!(n instanceof e))return t===P?Q():new e(t);if(t instanceof e)n.s=t.s,n.e=t.e,n.c=t.c.slice();else{if(typeof t!="string"){if(e.strict===!0&&typeof t!="bigint")throw TypeError(C+"value");t=t===0&&1/t<0?"-0":String(t)}Oe(n,t)}n.constructor=e}return e.prototype=h,e.DP=Be,e.RM=De,e.NE=_e,e.PE=Te,e.strict=Me,e.roundDown=0,e.roundHalfUp=1,e.roundHalfEven=2,e.roundUp=3,e}function Oe(e,t){var n,i,r;if(!xe.test(t))throw Error(C+"number");for(e.s=t.charAt(0)=="-"?(t=t.slice(1),-1):1,(n=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(n<0&&(n=i),n+=+t.slice(i+1),t=t.substring(0,i)):n<0&&(n=t.length),r=t.length,i=0;i<r&&t.charAt(i)=="0";)++i;if(i==r)e.c=[e.e=0];else{for(;r>0&&t.charAt(--r)=="0";);for(e.e=n-i-1,e.c=[],n=0;i<=r;)e.c[n++]=+t.charAt(i++)}return e}function y(e,t,n,i){var r=e.c;if(n===P&&(n=e.constructor.RM),n!==0&&n!==1&&n!==2&&n!==3)throw Error(me);if(t<1)i=n===3&&(i||!!r[0])||t===0&&(n===1&&r[0]>=5||n===2&&(r[0]>5||r[0]===5&&(i||r[1]!==P))),r.length=1,i?(e.e=e.e-t+1,r[0]=1):r[0]=e.e=0;else if(t<r.length){if(i=n===1&&r[t]>=5||n===2&&(r[t]>5||r[t]===5&&(i||r[t+1]!==P||r[t-1]&1))||n===3&&(i||!!r[0]),r.length=t,i){for(;++r[--t]>9;)if(r[t]=0,t===0){++e.e,r.unshift(1);break}}for(t=r.length;!r[--t];)r.pop()}return e}function b(e,t,n){var i=e.e,r=e.c.join(""),s=r.length;if(t)r=r.charAt(0)+(s>1?"."+r.slice(1):"")+(i<0?"e":"e+")+i;else if(i<0){for(;++i;)r="0"+r;r="0."+r}else if(i>0)if(++i>s)for(i-=s;i--;)r+="0";else i<s&&(r=r.slice(0,i)+"."+r.slice(i));else s>1&&(r=r.charAt(0)+"."+r.slice(1));return e.s<0&&n?"-"+r:r}h.abs=function(){var e=new this.constructor(this);return e.s=1,e},h.cmp=function(e){var t,n=this,i=n.c,r=(e=new n.constructor(e)).c,s=n.s,u=e.s,c=n.e,a=e.e;if(!i[0]||!r[0])return i[0]?s:r[0]?-u:0;if(s!=u)return s;if(t=s<0,c!=a)return c>a^t?1:-1;for(u=(c=i.length)<(a=r.length)?c:a,s=-1;++s<u;)if(i[s]!=r[s])return i[s]>r[s]^t?1:-1;return c==a?0:c>a^t?1:-1},h.div=function(e){var t=this,n=t.constructor,i=t.c,r=(e=new n(e)).c,s=t.s==e.s?1:-1,u=n.DP;if(u!==~~u||u<0||u>N)throw Error(L);if(!r[0])throw Error(Z);if(!i[0])return e.s=s,e.c=[e.e=0],e;var c,a,o,g,f,R=r.slice(),B=c=r.length,F=i.length,E=i.slice(0,c),v=E.length,D=e,H=D.c=[],V=0,x=u+(D.e=t.e-e.e)+1;for(D.s=s,s=x<0?0:x,R.unshift(0);v++<c;)E.push(0);do{for(o=0;o<10;o++){if(c!=(v=E.length))g=c>v?1:-1;else for(f=-1,g=0;++f<c;)if(r[f]!=E[f]){g=r[f]>E[f]?1:-1;break}if(g<0){for(a=v==c?r:R;v;){if(E[--v]<a[v]){for(f=v;f&&!E[--f];)E[f]=9;--E[f],E[v]+=10}E[v]-=a[v]}for(;!E[0];)E.shift()}else break}H[V++]=g?o:++o,E[0]&&g?E[v]=i[B]||0:E=[i[B]]}while((B++<F||E[0]!==P)&&s--);return!H[0]&&V!=1&&(H.shift(),D.e--,x--),V>x&&y(D,x,n.RM,E[0]!==P),D},h.eq=function(e){return this.cmp(e)===0},h.gt=function(e){return this.cmp(e)>0},h.gte=function(e){return this.cmp(e)>-1},h.lt=function(e){return this.cmp(e)<0},h.lte=function(e){return this.cmp(e)<1},h.minus=h.sub=function(e){var t,n,i,r,s=this,u=s.constructor,c=s.s,a=(e=new u(e)).s;if(c!=a)return e.s=-a,s.plus(e);var o=s.c.slice(),g=s.e,f=e.c,R=e.e;if(!o[0]||!f[0])return f[0]?e.s=-a:o[0]?e=new u(s):e.s=1,e;if(c=g-R){for((r=c<0)?(c=-c,i=o):(R=g,i=f),i.reverse(),a=c;a--;)i.push(0);i.reverse()}else for(n=((r=o.length<f.length)?o:f).length,c=a=0;a<n;a++)if(o[a]!=f[a]){r=o[a]<f[a];break}if(r&&(i=o,o=f,f=i,e.s=-e.s),(a=(n=f.length)-(t=o.length))>0)for(;a--;)o[t++]=0;for(a=t;n>c;){if(o[--n]<f[n]){for(t=n;t&&!o[--t];)o[t]=9;--o[t],o[n]+=10}o[n]-=f[n]}for(;o[--a]===0;)o.pop();for(;o[0]===0;)o.shift(),--R;return o[0]||(e.s=1,o=[R=0]),e.c=o,e.e=R,e},h.mod=function(e){var t,n=this,i=n.constructor,r=n.s,s=(e=new i(e)).s;if(!e.c[0])throw Error(Z);return n.s=e.s=1,t=e.cmp(n)==1,n.s=r,e.s=s,t?new i(n):(r=i.DP,s=i.RM,i.DP=i.RM=0,n=n.div(e),i.DP=r,i.RM=s,this.minus(n.times(e)))},h.neg=function(){var e=new this.constructor(this);return e.s=-e.s,e},h.plus=h.add=function(e){var t,n,i,r=this,s=r.constructor;if(e=new s(e),r.s!=e.s)return e.s=-e.s,r.minus(e);var u=r.e,c=r.c,a=e.e,o=e.c;if(!c[0]||!o[0])return o[0]||(c[0]?e=new s(r):e.s=r.s),e;if(c=c.slice(),t=u-a){for(t>0?(a=u,i=o):(t=-t,i=c),i.reverse();t--;)i.push(0);i.reverse()}for(c.length-o.length<0&&(i=o,o=c,c=i),t=o.length,n=0;t;c[t]%=10)n=(c[--t]=c[t]+o[t]+n)/10|0;for(n&&(c.unshift(n),++a),t=c.length;c[--t]===0;)c.pop();return e.c=c,e.e=a,e},h.pow=function(e){var t=this,n=new t.constructor("1"),i=n,r=e<0;if(e!==~~e||e<-W||e>W)throw Error(C+"exponent");for(r&&(e=-e);e&1&&(i=i.times(t)),e>>=1,!!e;)t=t.times(t);return r?n.div(i):i},h.prec=function(e,t){if(e!==~~e||e<1||e>N)throw Error(C+"precision");return y(new this.constructor(this),e,t)},h.round=function(e,t){if(e===P)e=0;else if(e!==~~e||e<-N||e>N)throw Error(L);return y(new this.constructor(this),e+this.e+1,t)},h.sqrt=function(){var e,t,n,i=this,r=i.constructor,s=i.s,u=i.e,c=new r("0.5");if(!i.c[0])return new r(i);if(s<0)throw Error(M+"No square root");s=Math.sqrt(i+""),s===0||s===1/0?(t=i.c.join(""),t.length+u&1||(t+="0"),s=Math.sqrt(t),u=((u+1)/2|0)-(u<0||u&1),e=new r((s==1/0?"5e":(s=s.toExponential()).slice(0,s.indexOf("e")+1))+u)):e=new r(s+""),u=e.e+(r.DP+=4);do n=e,e=c.times(n.plus(i.div(n)));while(n.c.slice(0,u).join("")!==e.c.slice(0,u).join(""));return y(e,(r.DP-=4)+e.e+1,r.RM)},h.times=h.mul=function(e){var t,n=this,i=n.constructor,r=n.c,s=(e=new i(e)).c,u=r.length,c=s.length,a=n.e,o=e.e;if(e.s=n.s==e.s?1:-1,!r[0]||!s[0])return e.c=[e.e=0],e;for(e.e=a+o,u<c&&(t=r,r=s,s=t,o=u,u=c,c=o),t=new Array(o=u+c);o--;)t[o]=0;for(a=c;a--;){for(c=0,o=u+a;o>a;)c=t[o]+s[a]*r[o-a-1]+c,t[o--]=c%10,c=c/10|0;t[o]=c}for(c?++e.e:t.shift(),a=t.length;!t[--a];)t.pop();return e.c=t,e},h.toExponential=function(e,t){var n=this,i=n.c[0];if(e!==P){if(e!==~~e||e<0||e>N)throw Error(L);for(n=y(new n.constructor(n),++e,t);n.c.length<e;)n.c.push(0)}return b(n,!0,!!i)},h.toFixed=function(e,t){var n=this,i=n.c[0];if(e!==P){if(e!==~~e||e<0||e>N)throw Error(L);for(n=y(new n.constructor(n),e+n.e+1,t),e=e+n.e+1;n.c.length<e;)n.c.push(0)}return b(n,!1,!!i)},h[Symbol.for("nodejs.util.inspect.custom")]=h.toJSON=h.toString=function(){var e=this,t=e.constructor;return b(e,e.e<=t.NE||e.e>=t.PE,!!e.c[0])},h.toNumber=function(){var e=Number(b(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(e.toString()))throw Error(M+"Imprecise conversion");return e},h.toPrecision=function(e,t){var n=this,i=n.constructor,r=n.c[0];if(e!==P){if(e!==~~e||e<1||e>N)throw Error(C+"precision");for(n=y(new i(n),e,t);n.c.length<e;)n.c.push(0)}return b(n,e<=n.e||n.e<=i.NE||n.e>=i.PE,!!r)},h.valueOf=function(){var e=this,t=e.constructor;if(t.strict===!0)throw Error(M+"valueOf disallowed");return b(e,e.e<=t.NE||e.e>=t.PE,!0)};var Le=Q();const{View:Fe}=I.General,ee=d.findByStoreName("MessageStore"),Ge=d.findByName("ChannelPinsConnected",!1),ke=d.findByProps("fetchMessages","sendMessage");function ze(e){let{channelId:t}=e;const[n,i]=l.React.useState(p.preferFilters??["server","local"]),[r,s]=l.React.useState(0);return $e({filters:function(){return we(be,{defFilters:n,set:i})},clear:function(){return Array.isArray(r)&&$.showConfirmationAlert({title:"Clear local pins",content:`Are you sure you want to clear **${r.length}** pin${r.length!==1?"s":""} in this channel?`,confirmText:"Clear",confirmColor:"red",onConfirm:function(){re(t),s([])},isDismissable:!0})}}),te[t]=function(u){return[...n.includes("local")?Array.isArray(r)?r:[]:[],...n.includes("server")?u:[]]},l.React.useEffect(function(){(async function(){const u=[],c=ne(t)?.slice().reverse()??[];for(let a=0;a<c.length;a++){const o=c[a];s(a/c.length);let g=ee.getMessage(t,o.id);if(!g){const f=new Le(o.id),R=[f.plus(1).toFixed(),f.minus(1).toFixed()];await ke.fetchMessages({channelId:t,before:R[0],after:R[1],limit:1}),g=ee.getMessage(t,o.id)}g&&u.push(g)}s(u)})()},[]),Array.isArray(r)?l.React.createElement(Ge.default,{channelId:t}):l.React.createElement(Fe,{style:{alignItems:"center",justifyContent:"center",flex:1}},l.React.createElement(l.ReactNative.ActivityIndicator,{size:"large",style:{marginBottom:10}}),l.React.createElement(O,{variant:"text-lg/semibold",color:"TEXT_NORMAL",align:"center"},Math.floor(r*100),"%"))}const{View:je}=I.General,He=d.findByName("ChannelSettingsModal",!1),Ve=d.findByName("ChannelPinsConnected",!1);let z={};function $e(e){z=e}const te={};function Ue(){const e=new Array;return e.push(_.after("default",Ve,function(t,n){const{channelId:i,loaded:r,messages:s}=n.props;return{...n,props:{...n.props,messages:r&&s?te[i]?.(s)??s:s}}})),e.push(_.before("openLazy",Ce,function(t){let[n,i,r]=t;const s=r?.message;i!=="MessageLongPressActionSheet"||!s||n.then(function(u){const c=_.after("default",u,function(a,o){l.React.useEffect(function(){return function(){c()}},[]);const g=le.findInReactTree(o,function(R){return R?.[0]?.type?.name==="ButtonRow"});if(!g)return o;let f=Math.max(g.findIndex(function(R){return R.props.message===l.i18n.Messages.MARK_UNREAD}),0);g.splice(f,0,l.React.createElement(ye,s))})})})),e.push(_.after("default",He,function(t,n){const i=n.props.screens;i.PINNED_MESSAGES.headerRight=function(){return l.React.createElement(je,{style:{flexDirection:"row-reverse"}},l.React.createElement(J,{icon:S.getAssetIDByName("ic_filter"),style:"header",onPress:function(){return z.filters?.()}}),l.React.createElement(J,{icon:S.getAssetIDByName("ic_message_delete"),style:"header",destructive:!0,onPress:function(){return z.clear?.()}}))},e.push(_.after("render",i.PINNED_MESSAGES,function(r,s){return l.React.createElement(ze,{channelId:s.props.channelId})}))})),function(){return e.forEach(function(t){return t()})}}const{ScrollView:qe}=I.General,{FormRow:m}=I.Forms,Ye=l.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:w.semanticColors.TEXT_DANGER}}),Xe={color:"TEXT_DANGER",variant:"text-md/semibold"};function Je(){return ue.useProxy(p),React.createElement(qe,null,React.createElement(Ne,{title:"Settings",icon:S.getAssetIDByName("ic_cog_24px")},React.createElement(m,{label:"Data size",subLabel:p.pinned?`${Math.floor(JSON.stringify(p.pinned).length/1e3*100)/100} kilobytes`:"N/A",leading:React.createElement(m.Icon,{source:S.getAssetIDByName("ic_message_edit")})}),React.createElement(m,{label:React.createElement(O,Xe,"Clear data"),leading:React.createElement(m.Icon,{style:Ye.destructiveIcon,source:S.getAssetIDByName("ic_message_delete")}),trailing:React.createElement(m.Arrow,null),onPress:function(){return $.showConfirmationAlert({title:"Clear data",content:"Are you sure you want to clear all local pin data?",confirmText:"Clear",confirmColor:"red",onConfirm:function(){delete p.pinned},isDismissable:!0})}})))}const p=oe.storage;function ne(e){return p.pinned?.[e]}function re(e){p.pinned??={},delete p.pinned?.[e]}function j(e,t){return p.pinned?.[e]?.some(function(n){return n.id===t})}function ie(e,t){p.pinned??={},p.pinned[e]??=[],j(e,t)||p.pinned[e].push({id:t,pinned:Date.now()})}function se(e,t){p.pinned??={},p.pinned[e]=(p.pinned[e]??[]).filter(function(n){return n.id!==t})}let ce;var Ke={onLoad:function(){return ce=Ue()},onUnload:function(){return ce()},settings:Je};return A.addPin=ie,A.clearPins=re,A.default=Ke,A.getPins=ne,A.hasPin=j,A.removePin=se,A.vstorage=p,Object.defineProperty(A,"__esModule",{value:!0}),A})({},vendetta.plugin,vendetta.metro.common,vendetta.metro,vendetta.patcher,vendetta,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta.utils,vendetta.storage,vendetta.ui.alerts);
