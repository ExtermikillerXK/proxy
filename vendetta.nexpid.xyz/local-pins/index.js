(function(A,oe,u,d,_,S,w,I,G,ae,le,$){"use strict";const ue=d.findByStoreName("ThemeStore"),fe=d.findByProps("colors","meta"),{TextStyleSheet:he}=d.findByProps("TextStyleSheet"),{View:T,Text:H,Pressable:de}=I.General,V=d.find(function(e){return e.render?.name==="ActionSheet"}),{openLazy:ge,hideActionSheet:q}=d.findByProps("openLazy","hideActionSheet"),{ActionSheetTitleHeader:Ee,ActionSheetCloseButton:Re,ActionSheetContentContainer:pe}=d.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");d.findByName("Navigator"),d.findByProps("getRenderCloseButton"),d.findByProps("popModal","pushModal");function ve(e){return fe.meta.resolveSemanticColor(ue.theme,e)}function Pe(e,t){V?ge(new Promise(function(n){return n({default:e})}),"ActionSheet",t):G.showToast("You cannot open ActionSheets on this version! Update to 163+",w.getAssetIDByName("Small"))}function Ae(e){let{title:t,onPress:n,icon:i}=e;const r=u.stylesheet.createThemedStyleSheet({androidRipple:{color:S.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:S.semanticColors.HEADER_SECONDARY,opacity:.5}}),s=n?de:T;return u.React.createElement(s,{android_ripple:r.androidRipple,disabled:!1,accessibilityRole:"button",onPress:n,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&u.React.createElement(T,{style:{marginRight:4}},u.React.createElement(u.ReactNative.Image,{style:r.icon,source:i,resizeMode:"contain"})),u.React.createElement(O,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},t))}function we(e){let{title:t,onTitlePress:n,icon:i,children:r,padding:s}=e;const l=u.stylesheet.createThemedStyleSheet({main:{backgroundColor:S.semanticColors.BACKGROUND_TERTIARY,borderRadius:16,overflow:"hidden",flex:1}});return u.React.createElement(T,{style:{marginHorizontal:16,marginTop:16}},u.React.createElement(Ae,{title:t,onPress:n,icon:i}),u.React.createElement(T,{style:l.main},s?u.React.createElement(T,{style:{paddingHorizontal:16,paddingVertical:16}},r):r))}var Y;(function(e){function t(i){let{children:r,onPress:s}=i;return u.React.createElement(O,{variant:"text-md/bold",onPress:s},r)}e.Bold=t;function n(i){let{children:r,onPress:s}=i;return u.React.createElement(H,{style:{textDecorationLine:"underline"},onPress:s},r)}e.Underline=n})(Y||(Y={}));function O(e){let{variant:t,lineClamp:n,color:i,align:r,style:s,onPress:l,getChildren:c,children:a,liveUpdate:o}=e;const[g,f]=u.React.useReducer(function(E){return~E},0);return u.React.useEffect(function(){if(!o)return;const E=new Date().setMilliseconds(1e3);let b,F;return F=setTimeout(function(){f(),b=setInterval(f,1e3)},E-Date.now()),function(){clearTimeout(F),clearInterval(b)}},[]),u.React.createElement(H,{style:[t?he[t]:{},i?{color:ve(S.semanticColors[i])}:{},r?{textAlign:r}:{},s??{}],numberOfLines:n,onPress:l},c?.()??a)}function X(e){let{onPress:t,onLongPress:n,icon:i,style:r,destructive:s}=e;const l=u.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:S.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:S.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:S.semanticColors.TEXT_DANGER}});return u.React.createElement(u.ReactNative.TouchableOpacity,{onPress:t,onLongPress:n},u.React.createElement(u.ReactNative.Image,{style:[typeof r=="string"?r==="header"?l.headerStyleIcon:l.cardStyleIcon:r,s&&l.destructiveIcon].filter(function(c){return!!c}),source:i}))}d.findByProps("TableRowGroup"),d.findByProps("showShareActionSheet"),d.findByProps("showSimpleActionSheet"),d.findByProps("downloadMediaAsset"),d.findByProps("isAndroid");const Se=d.findByProps("openLazy","hideActionSheet");d.findByProps("PRIMARY_INFO_TOP_OFFSET","SECONDARY_INFO_TOP_MARGIN","SIDE_PADDING"),d.findByStoreName("ThemeStore"),d.findByProps("colors","meta");const{FormRow:J}=I.Forms;function Ie(e){const t=j(e.channel_id,e.id);return React.createElement(J,{label:t?"Unpin Message Locally":"Pin Message Locally",leading:React.createElement(J.Icon,{style:{opacity:1},source:w.getAssetIDByName("ic_message_pin")}),onPress:function(){t?(se(e.channel_id,e.id),G.showToast(`Unpinned ${e.nick??e.author.globalName??e.author.username}'s message locally`,w.getAssetIDByName("ic_message_pin"))):(ie(e.channel_id,e.id),G.showToast(`Pinned ${e.nick??e.author.globalName??e.author.username}'s message locally`,w.getAssetIDByName("ic_message_pin"))),q()}})}const{FormCheckboxRow:K}=I.Forms;function Ne(e){let{defFilters:t,set:n}=e;const[i,r]=u.React.useState(t);return n(i),u.React.createElement(V,null,u.React.createElement(pe,null,u.React.createElement(Ee,{title:"Filters",trailing:u.React.createElement(Re,{onPress:function(){return q()}})}),u.React.createElement(K,{label:"Server pinned",onPress:function(){return r(i.includes("server")?i.filter(function(s){return s!=="server"}):i.concat("server"))},selected:i.includes("server")}),u.React.createElement(K,{label:"Locally pinned",onPress:function(){return r(i.includes("local")?i.filter(function(s){return s!=="local"}):i.concat("local"))},selected:i.includes("local")})))}var ye=20,Be=1,N=1e6,W=1e6,De=-7,be=21,Ce=!1,m="[big.js] ",y=m+"Invalid ",L=y+"decimal places",_e=y+"rounding mode",Z=m+"Division by zero",h={},P=void 0,Te=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Q(){function e(t){var n=this;if(!(n instanceof e))return t===P?Q():new e(t);if(t instanceof e)n.s=t.s,n.e=t.e,n.c=t.c.slice();else{if(typeof t!="string"){if(e.strict===!0&&typeof t!="bigint")throw TypeError(y+"value");t=t===0&&1/t<0?"-0":String(t)}me(n,t)}n.constructor=e}return e.prototype=h,e.DP=ye,e.RM=Be,e.NE=De,e.PE=be,e.strict=Ce,e.roundDown=0,e.roundHalfUp=1,e.roundHalfEven=2,e.roundUp=3,e}function me(e,t){var n,i,r;if(!Te.test(t))throw Error(y+"number");for(e.s=t.charAt(0)=="-"?(t=t.slice(1),-1):1,(n=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(n<0&&(n=i),n+=+t.slice(i+1),t=t.substring(0,i)):n<0&&(n=t.length),r=t.length,i=0;i<r&&t.charAt(i)=="0";)++i;if(i==r)e.c=[e.e=0];else{for(;r>0&&t.charAt(--r)=="0";);for(e.e=n-i-1,e.c=[],n=0;i<=r;)e.c[n++]=+t.charAt(i++)}return e}function B(e,t,n,i){var r=e.c;if(n===P&&(n=e.constructor.RM),n!==0&&n!==1&&n!==2&&n!==3)throw Error(_e);if(t<1)i=n===3&&(i||!!r[0])||t===0&&(n===1&&r[0]>=5||n===2&&(r[0]>5||r[0]===5&&(i||r[1]!==P))),r.length=1,i?(e.e=e.e-t+1,r[0]=1):r[0]=e.e=0;else if(t<r.length){if(i=n===1&&r[t]>=5||n===2&&(r[t]>5||r[t]===5&&(i||r[t+1]!==P||r[t-1]&1))||n===3&&(i||!!r[0]),r.length=t,i){for(;++r[--t]>9;)if(r[t]=0,t===0){++e.e,r.unshift(1);break}}for(t=r.length;!r[--t];)r.pop()}return e}function D(e,t,n){var i=e.e,r=e.c.join(""),s=r.length;if(t)r=r.charAt(0)+(s>1?"."+r.slice(1):"")+(i<0?"e":"e+")+i;else if(i<0){for(;++i;)r="0"+r;r="0."+r}else if(i>0)if(++i>s)for(i-=s;i--;)r+="0";else i<s&&(r=r.slice(0,i)+"."+r.slice(i));else s>1&&(r=r.charAt(0)+"."+r.slice(1));return e.s<0&&n?"-"+r:r}h.abs=function(){var e=new this.constructor(this);return e.s=1,e},h.cmp=function(e){var t,n=this,i=n.c,r=(e=new n.constructor(e)).c,s=n.s,l=e.s,c=n.e,a=e.e;if(!i[0]||!r[0])return i[0]?s:r[0]?-l:0;if(s!=l)return s;if(t=s<0,c!=a)return c>a^t?1:-1;for(l=(c=i.length)<(a=r.length)?c:a,s=-1;++s<l;)if(i[s]!=r[s])return i[s]>r[s]^t?1:-1;return c==a?0:c>a^t?1:-1},h.div=function(e){var t=this,n=t.constructor,i=t.c,r=(e=new n(e)).c,s=t.s==e.s?1:-1,l=n.DP;if(l!==~~l||l<0||l>N)throw Error(L);if(!r[0])throw Error(Z);if(!i[0])return e.s=s,e.c=[e.e=0],e;var c,a,o,g,f,E=r.slice(),b=c=r.length,F=i.length,R=i.slice(0,c),v=R.length,C=e,z=C.c=[],U=0,x=l+(C.e=t.e-e.e)+1;for(C.s=s,s=x<0?0:x,E.unshift(0);v++<c;)R.push(0);do{for(o=0;o<10;o++){if(c!=(v=R.length))g=c>v?1:-1;else for(f=-1,g=0;++f<c;)if(r[f]!=R[f]){g=r[f]>R[f]?1:-1;break}if(g<0){for(a=v==c?r:E;v;){if(R[--v]<a[v]){for(f=v;f&&!R[--f];)R[f]=9;--R[f],R[v]+=10}R[v]-=a[v]}for(;!R[0];)R.shift()}else break}z[U++]=g?o:++o,R[0]&&g?R[v]=i[b]||0:R=[i[b]]}while((b++<F||R[0]!==P)&&s--);return!z[0]&&U!=1&&(z.shift(),C.e--,x--),U>x&&B(C,x,n.RM,R[0]!==P),C},h.eq=function(e){return this.cmp(e)===0},h.gt=function(e){return this.cmp(e)>0},h.gte=function(e){return this.cmp(e)>-1},h.lt=function(e){return this.cmp(e)<0},h.lte=function(e){return this.cmp(e)<1},h.minus=h.sub=function(e){var t,n,i,r,s=this,l=s.constructor,c=s.s,a=(e=new l(e)).s;if(c!=a)return e.s=-a,s.plus(e);var o=s.c.slice(),g=s.e,f=e.c,E=e.e;if(!o[0]||!f[0])return f[0]?e.s=-a:o[0]?e=new l(s):e.s=1,e;if(c=g-E){for((r=c<0)?(c=-c,i=o):(E=g,i=f),i.reverse(),a=c;a--;)i.push(0);i.reverse()}else for(n=((r=o.length<f.length)?o:f).length,c=a=0;a<n;a++)if(o[a]!=f[a]){r=o[a]<f[a];break}if(r&&(i=o,o=f,f=i,e.s=-e.s),(a=(n=f.length)-(t=o.length))>0)for(;a--;)o[t++]=0;for(a=t;n>c;){if(o[--n]<f[n]){for(t=n;t&&!o[--t];)o[t]=9;--o[t],o[n]+=10}o[n]-=f[n]}for(;o[--a]===0;)o.pop();for(;o[0]===0;)o.shift(),--E;return o[0]||(e.s=1,o=[E=0]),e.c=o,e.e=E,e},h.mod=function(e){var t,n=this,i=n.constructor,r=n.s,s=(e=new i(e)).s;if(!e.c[0])throw Error(Z);return n.s=e.s=1,t=e.cmp(n)==1,n.s=r,e.s=s,t?new i(n):(r=i.DP,s=i.RM,i.DP=i.RM=0,n=n.div(e),i.DP=r,i.RM=s,this.minus(n.times(e)))},h.neg=function(){var e=new this.constructor(this);return e.s=-e.s,e},h.plus=h.add=function(e){var t,n,i,r=this,s=r.constructor;if(e=new s(e),r.s!=e.s)return e.s=-e.s,r.minus(e);var l=r.e,c=r.c,a=e.e,o=e.c;if(!c[0]||!o[0])return o[0]||(c[0]?e=new s(r):e.s=r.s),e;if(c=c.slice(),t=l-a){for(t>0?(a=l,i=o):(t=-t,i=c),i.reverse();t--;)i.push(0);i.reverse()}for(c.length-o.length<0&&(i=o,o=c,c=i),t=o.length,n=0;t;c[t]%=10)n=(c[--t]=c[t]+o[t]+n)/10|0;for(n&&(c.unshift(n),++a),t=c.length;c[--t]===0;)c.pop();return e.c=c,e.e=a,e},h.pow=function(e){var t=this,n=new t.constructor("1"),i=n,r=e<0;if(e!==~~e||e<-W||e>W)throw Error(y+"exponent");for(r&&(e=-e);e&1&&(i=i.times(t)),e>>=1,!!e;)t=t.times(t);return r?n.div(i):i},h.prec=function(e,t){if(e!==~~e||e<1||e>N)throw Error(y+"precision");return B(new this.constructor(this),e,t)},h.round=function(e,t){if(e===P)e=0;else if(e!==~~e||e<-N||e>N)throw Error(L);return B(new this.constructor(this),e+this.e+1,t)},h.sqrt=function(){var e,t,n,i=this,r=i.constructor,s=i.s,l=i.e,c=new r("0.5");if(!i.c[0])return new r(i);if(s<0)throw Error(m+"No square root");s=Math.sqrt(i+""),s===0||s===1/0?(t=i.c.join(""),t.length+l&1||(t+="0"),s=Math.sqrt(t),l=((l+1)/2|0)-(l<0||l&1),e=new r((s==1/0?"5e":(s=s.toExponential()).slice(0,s.indexOf("e")+1))+l)):e=new r(s+""),l=e.e+(r.DP+=4);do n=e,e=c.times(n.plus(i.div(n)));while(n.c.slice(0,l).join("")!==e.c.slice(0,l).join(""));return B(e,(r.DP-=4)+e.e+1,r.RM)},h.times=h.mul=function(e){var t,n=this,i=n.constructor,r=n.c,s=(e=new i(e)).c,l=r.length,c=s.length,a=n.e,o=e.e;if(e.s=n.s==e.s?1:-1,!r[0]||!s[0])return e.c=[e.e=0],e;for(e.e=a+o,l<c&&(t=r,r=s,s=t,o=l,l=c,c=o),t=new Array(o=l+c);o--;)t[o]=0;for(a=c;a--;){for(c=0,o=l+a;o>a;)c=t[o]+s[a]*r[o-a-1]+c,t[o--]=c%10,c=c/10|0;t[o]=c}for(c?++e.e:t.shift(),a=t.length;!t[--a];)t.pop();return e.c=t,e},h.toExponential=function(e,t){var n=this,i=n.c[0];if(e!==P){if(e!==~~e||e<0||e>N)throw Error(L);for(n=B(new n.constructor(n),++e,t);n.c.length<e;)n.c.push(0)}return D(n,!0,!!i)},h.toFixed=function(e,t){var n=this,i=n.c[0];if(e!==P){if(e!==~~e||e<0||e>N)throw Error(L);for(n=B(new n.constructor(n),e+n.e+1,t),e=e+n.e+1;n.c.length<e;)n.c.push(0)}return D(n,!1,!!i)},h[Symbol.for("nodejs.util.inspect.custom")]=h.toJSON=h.toString=function(){var e=this,t=e.constructor;return D(e,e.e<=t.NE||e.e>=t.PE,!!e.c[0])},h.toNumber=function(){var e=Number(D(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(e.toString()))throw Error(m+"Imprecise conversion");return e},h.toPrecision=function(e,t){var n=this,i=n.constructor,r=n.c[0];if(e!==P){if(e!==~~e||e<1||e>N)throw Error(y+"precision");for(n=B(new i(n),e,t);n.c.length<e;)n.c.push(0)}return D(n,e<=n.e||n.e<=i.NE||n.e>=i.PE,!!r)},h.valueOf=function(){var e=this,t=e.constructor;if(t.strict===!0)throw Error(m+"valueOf disallowed");return D(e,e.e<=t.NE||e.e>=t.PE,!0)};var Me=Q();const{View:xe}=I.General,ee=d.findByStoreName("MessageStore"),Oe=d.findByName("ChannelPinsConnected",!1),Le=d.findByProps("fetchMessages","sendMessage");function Fe(e){let{channelId:t}=e;const[n,i]=u.React.useState(p.preferFilters??["server","local"]),[r,s]=u.React.useState(0);return ze({filters:function(){return Pe(Ne,{defFilters:n,set:i})},clear:function(){return Array.isArray(r)&&$.showConfirmationAlert({title:"Clear local pins",content:`Are you sure you want to clear **${r.length}** pin${r.length!==1?"s":""} in this channel?`,confirmText:"Clear",confirmColor:"red",onConfirm:function(){re(t),s([])},isDismissable:!0})}}),te[t]=function(l){return[...n.includes("local")?Array.isArray(r)?r:[]:[],...n.includes("server")?l:[]]},u.React.useEffect(function(){(async function(){const l=[],c=ne(t)?.slice().reverse()??[];for(let a=0;a<c.length;a++){const o=c[a];s(a/c.length);let g=ee.getMessage(t,o.id);if(!g){const f=new Me(o.id),E=[f.plus(1).toFixed(),f.minus(1).toFixed()];await Le.fetchMessages({channelId:t,before:E[0],after:E[1],limit:1}),g=ee.getMessage(t,o.id)}g&&l.push(g)}s(l)})()},[]),Array.isArray(r)?u.React.createElement(Oe.default,{channelId:t}):u.React.createElement(xe,{style:{alignItems:"center",justifyContent:"center",flex:1}},u.React.createElement(u.ReactNative.ActivityIndicator,{size:"large",style:{marginBottom:10}}),u.React.createElement(O,{variant:"text-lg/semibold",color:"TEXT_NORMAL",align:"center"},Math.floor(r*100),"%"))}const{View:Ge}=I.General,ke=d.findByName("ChannelSettingsModal",!1),je=d.findByName("ChannelPinsConnected",!1);let k={};function ze(e){k=e}const te={};function Ue(){const e=new Array;return e.push(_.after("default",je,function(t,n){const{channelId:i,loaded:r,messages:s}=n.props;return{...n,props:{...n.props,messages:r&&s?te[i]?.(s)??s:s}}})),e.push(_.before("openLazy",Se,function(t){let[n,i,r]=t;const s=r?.message;i!=="MessageLongPressActionSheet"||!s||n.then(function(l){const c=_.after("default",l,function(a,o){u.React.useEffect(function(){return function(){c()}},[]);const g=ae.findInReactTree(o,function(E){return E?.[0]?.type?.name==="ButtonRow"});if(!g)return o;let f=Math.max(g.findIndex(function(E){return E.props.message===u.i18n.Messages.MARK_UNREAD}),0);g.splice(f,0,u.React.createElement(Ie,s))})})})),e.push(_.after("default",ke,function(t,n){const i=n.props.screens;i.PINNED_MESSAGES.headerRight=function(){return u.React.createElement(Ge,{style:{flexDirection:"row-reverse"}},u.React.createElement(X,{icon:w.getAssetIDByName("ic_filter"),style:"header",onPress:function(){return k.filters?.()}}),u.React.createElement(X,{icon:w.getAssetIDByName("ic_message_delete"),style:"header",destructive:!0,onPress:function(){return k.clear?.()}}))},e.push(_.after("render",i.PINNED_MESSAGES,function(r,s){return u.React.createElement(Fe,{channelId:s.props.channelId})}))})),function(){return e.forEach(function(t){return t()})}}const{ScrollView:$e}=I.General,{FormRow:M}=I.Forms,He=u.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:S.semanticColors.TEXT_DANGER}}),Ve={color:"TEXT_DANGER",variant:"text-md/semibold"};function qe(){return le.useProxy(p),React.createElement($e,null,React.createElement(we,{title:"Settings",icon:w.getAssetIDByName("ic_cog_24px")},React.createElement(M,{label:"Data size",subLabel:p.pinned?`${Math.floor(JSON.stringify(p.pinned).length/1e3*100)/100} kilobytes`:"N/A",leading:React.createElement(M.Icon,{source:w.getAssetIDByName("ic_message_edit")})}),React.createElement(M,{label:React.createElement(O,Ve,"Clear data"),leading:React.createElement(M.Icon,{style:He.destructiveIcon,source:w.getAssetIDByName("ic_message_delete")}),trailing:React.createElement(M.Arrow,null),onPress:function(){return $.showConfirmationAlert({title:"Clear data",content:"Are you sure you want to clear all local pin data?",confirmText:"Clear",confirmColor:"red",onConfirm:function(){delete p.pinned},isDismissable:!0})}})))}const p=oe.storage;function ne(e){return p.pinned?.[e]}function re(e){p.pinned??={},delete p.pinned?.[e]}function j(e,t){return p.pinned?.[e]?.some(function(n){return n.id===t})}function ie(e,t){p.pinned??={},p.pinned[e]??=[],j(e,t)||p.pinned[e].push({id:t,pinned:Date.now()})}function se(e,t){p.pinned??={},p.pinned[e]=(p.pinned[e]??[]).filter(function(n){return n.id!==t})}let ce;var Ye={onLoad:function(){return ce=Ue()},onUnload:function(){return ce()},settings:qe};return A.addPin=ie,A.clearPins=re,A.default=Ye,A.getPins=ne,A.hasPin=j,A.removePin=se,A.vstorage=p,Object.defineProperty(A,"__esModule",{value:!0}),A})({},vendetta.plugin,vendetta.metro.common,vendetta.metro,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta.utils,vendetta.storage,vendetta.ui.alerts);
