(function(A,ce,l,h,_,ae,w,S,I,k,le,ue,V){"use strict";const fe=h.findByStoreName("ThemeStore"),he=h.findByProps("colors","meta");h.findByProps("triggerHaptic");const{TextStyleSheet:de}=h.findByProps("TextStyleSheet"),{View:M,Text:U,Pressable:ge}=I.General,{FormRow:q}=I.Forms,Re=h.findByProps("ActionSheet")?.ActionSheet??h.find(function(e){return e.render?.name==="ActionSheet"}),{openLazy:pe,hideActionSheet:X}=h.findByProps("openLazy","hideActionSheet"),{ActionSheetTitleHeader:Ee,ActionSheetCloseButton:ve,ActionSheetContentContainer:Pe}=h.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),G=h.findByProps("ActionSheetRow")?.ActionSheetRow;h.findByName("Navigator")??h.findByProps("Navigator")?.Navigator,h.findByProps("getRenderCloseButton")?.getRenderCloseButton??h.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,h.findByProps("popModal","pushModal"),h.findByProps("SvgXml");function Ae(e){return he.meta.resolveSemanticColor(fe.theme,e)}function we(e,t){try{pe(new Promise(function(n){return n({default:e})}),"ActionSheet",t)}catch(n){ae.logger.error(n.stack),k.showToast("Got error when opening ActionSheet! Please check debug logs",S.getAssetIDByName("Smal"))}}function Se(e){let{label:t,icon:n,onPress:i}=e;const r=l.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:w.semanticColors.INTERACTIVE_NORMAL}});return G?l.React.createElement(G,{label:t,icon:l.React.createElement(G.Icon,{source:n,IconComponent:function(){return l.React.createElement(l.ReactNative.Image,{resizeMode:"cover",style:r.iconComponent,source:n})}}),onPress:function(){return i?.()}}):l.React.createElement(q,{label:t,leading:l.React.createElement(q.Icon,{source:n}),onPress:function(){return i?.()}})}function Ie(e){let{title:t,onPress:n,icon:i}=e;const r=l.stylesheet.createThemedStyleSheet({androidRipple:{color:w.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:w.semanticColors.HEADER_SECONDARY,opacity:.5}}),s=n?ge:M;return l.React.createElement(s,{android_ripple:r.androidRipple,disabled:!1,accessibilityRole:"button",onPress:n,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&l.React.createElement(M,{style:{marginRight:4}},l.React.createElement(l.ReactNative.Image,{style:r.icon,source:i,resizeMode:"contain"})),l.React.createElement(L,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},t))}function ye(e){let{title:t,onTitlePress:n,icon:i,children:r,padding:s}=e;const u=l.stylesheet.createThemedStyleSheet({main:{backgroundColor:w.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return l.React.createElement(M,{style:{marginHorizontal:16,marginTop:16}},l.React.createElement(Ie,{title:t,onPress:n,icon:i}),l.React.createElement(M,{style:u.main},s?l.React.createElement(M,{style:{paddingHorizontal:16,paddingVertical:16}},r):r))}var Y;(function(e){function t(i){let{children:r,onPress:s}=i;return l.React.createElement(L,{variant:"text-md/bold",onPress:s},r)}e.Bold=t;function n(i){let{children:r,onPress:s}=i;return l.React.createElement(U,{style:{textDecorationLine:"underline"},onPress:s},r)}e.Underline=n})(Y||(Y={}));function L(e){let{variant:t,lineClamp:n,color:i,align:r,style:s,onPress:u,getChildren:o,children:a,liveUpdate:c}=e;const[R,f]=l.React.useReducer(function(p){return~p},0);return l.React.useEffect(function(){if(!c)return;const p=new Date().setMilliseconds(1e3);let b,F;return F=setTimeout(function(){f(),b=setInterval(f,1e3)},p-Date.now()),function(){clearTimeout(F),clearInterval(b)}},[]),l.React.createElement(U,{style:[t?de[t]:{},i?{color:Ae(w.semanticColors[i])}:{},r?{textAlign:r}:{},s??{}],numberOfLines:n,onPress:u},o?.()??a)}function J(e){let{onPress:t,onLongPress:n,icon:i,style:r,destructive:s,color:u}=e;const o=l.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:w.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:w.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:w.semanticColors.TEXT_DANGER}});return l.React.createElement(l.ReactNative.TouchableOpacity,{onPress:t,onLongPress:n},l.React.createElement(l.ReactNative.Image,{style:[typeof r=="string"?r==="header"?o.headerStyleIcon:o.cardStyleIcon:r,s&&o.destructiveIcon,u&&{tintColor:u}].filter(function(a){return!!a}),source:i}))}h.findByProps("TableRowGroup"),h.findByProps("showShareActionSheet"),h.findByProps("showSimpleActionSheet"),h.findByProps("downloadMediaAsset"),h.findByProps("isAndroid");const Ne=h.findByProps("openLazy","hideActionSheet");h.findByProps("PRIMARY_INFO_TOP_OFFSET","SECONDARY_INFO_TOP_MARGIN","SIDE_PADDING"),h.findByStoreName("ThemeStore"),h.findByProps("colors","meta");function Ce(e){const t=z(e.channel_id,e.id);return React.createElement(Se,{label:t?"Unpin Message Locally":"Pin Message Locally",icon:S.getAssetIDByName("ic_message_pin"),onPress:function(){t?(se(e.channel_id,e.id),k.showToast(`Unpinned ${e.nick??e.author.globalName??e.author.username}'s message locally`,S.getAssetIDByName("ic_message_pin"))):(ie(e.channel_id,e.id),k.showToast(`Pinned ${e.nick??e.author.globalName??e.author.username}'s message locally`,S.getAssetIDByName("ic_message_pin"))),X()}})}const{FormCheckboxRow:K}=I.Forms;function Be(e){let{defFilters:t,set:n}=e;const[i,r]=l.React.useState(t);return n(i),l.React.createElement(Re,null,l.React.createElement(Pe,null,l.React.createElement(Ee,{title:"Filters",trailing:l.React.createElement(ve,{onPress:function(){return X()}})}),l.React.createElement(K,{label:"Server pinned",onPress:function(){return r(i.includes("server")?i.filter(function(s){return s!=="server"}):i.concat("server"))},selected:i.includes("server")}),l.React.createElement(K,{label:"Locally pinned",onPress:function(){return r(i.includes("local")?i.filter(function(s){return s!=="local"}):i.concat("local"))},selected:i.includes("local")})))}var be=20,De=1,y=1e6,W=1e6,_e=-7,Me=21,Te=!1,T="[big.js] ",N=T+"Invalid ",O=N+"decimal places",me=N+"rounding mode",Z=T+"Division by zero",d={},P=void 0,xe=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Q(){function e(t){var n=this;if(!(n instanceof e))return t===P?Q():new e(t);if(t instanceof e)n.s=t.s,n.e=t.e,n.c=t.c.slice();else{if(typeof t!="string"){if(e.strict===!0&&typeof t!="bigint")throw TypeError(N+"value");t=t===0&&1/t<0?"-0":String(t)}Le(n,t)}n.constructor=e}return e.prototype=d,e.DP=be,e.RM=De,e.NE=_e,e.PE=Me,e.strict=Te,e.roundDown=0,e.roundHalfUp=1,e.roundHalfEven=2,e.roundUp=3,e}function Le(e,t){var n,i,r;if(!xe.test(t))throw Error(N+"number");for(e.s=t.charAt(0)=="-"?(t=t.slice(1),-1):1,(n=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(n<0&&(n=i),n+=+t.slice(i+1),t=t.substring(0,i)):n<0&&(n=t.length),r=t.length,i=0;i<r&&t.charAt(i)=="0";)++i;if(i==r)e.c=[e.e=0];else{for(;r>0&&t.charAt(--r)=="0";);for(e.e=n-i-1,e.c=[],n=0;i<=r;)e.c[n++]=+t.charAt(i++)}return e}function C(e,t,n,i){var r=e.c;if(n===P&&(n=e.constructor.RM),n!==0&&n!==1&&n!==2&&n!==3)throw Error(me);if(t<1)i=n===3&&(i||!!r[0])||t===0&&(n===1&&r[0]>=5||n===2&&(r[0]>5||r[0]===5&&(i||r[1]!==P))),r.length=1,i?(e.e=e.e-t+1,r[0]=1):r[0]=e.e=0;else if(t<r.length){if(i=n===1&&r[t]>=5||n===2&&(r[t]>5||r[t]===5&&(i||r[t+1]!==P||r[t-1]&1))||n===3&&(i||!!r[0]),r.length=t,i){for(;++r[--t]>9;)if(r[t]=0,t===0){++e.e,r.unshift(1);break}}for(t=r.length;!r[--t];)r.pop()}return e}function B(e,t,n){var i=e.e,r=e.c.join(""),s=r.length;if(t)r=r.charAt(0)+(s>1?"."+r.slice(1):"")+(i<0?"e":"e+")+i;else if(i<0){for(;++i;)r="0"+r;r="0."+r}else if(i>0)if(++i>s)for(i-=s;i--;)r+="0";else i<s&&(r=r.slice(0,i)+"."+r.slice(i));else s>1&&(r=r.charAt(0)+"."+r.slice(1));return e.s<0&&n?"-"+r:r}d.abs=function(){var e=new this.constructor(this);return e.s=1,e},d.cmp=function(e){var t,n=this,i=n.c,r=(e=new n.constructor(e)).c,s=n.s,u=e.s,o=n.e,a=e.e;if(!i[0]||!r[0])return i[0]?s:r[0]?-u:0;if(s!=u)return s;if(t=s<0,o!=a)return o>a^t?1:-1;for(u=(o=i.length)<(a=r.length)?o:a,s=-1;++s<u;)if(i[s]!=r[s])return i[s]>r[s]^t?1:-1;return o==a?0:o>a^t?1:-1},d.div=function(e){var t=this,n=t.constructor,i=t.c,r=(e=new n(e)).c,s=t.s==e.s?1:-1,u=n.DP;if(u!==~~u||u<0||u>y)throw Error(O);if(!r[0])throw Error(Z);if(!i[0])return e.s=s,e.c=[e.e=0],e;var o,a,c,R,f,p=r.slice(),b=o=r.length,F=i.length,E=i.slice(0,o),v=E.length,D=e,j=D.c=[],$=0,x=u+(D.e=t.e-e.e)+1;for(D.s=s,s=x<0?0:x,p.unshift(0);v++<o;)E.push(0);do{for(c=0;c<10;c++){if(o!=(v=E.length))R=o>v?1:-1;else for(f=-1,R=0;++f<o;)if(r[f]!=E[f]){R=r[f]>E[f]?1:-1;break}if(R<0){for(a=v==o?r:p;v;){if(E[--v]<a[v]){for(f=v;f&&!E[--f];)E[f]=9;--E[f],E[v]+=10}E[v]-=a[v]}for(;!E[0];)E.shift()}else break}j[$++]=R?c:++c,E[0]&&R?E[v]=i[b]||0:E=[i[b]]}while((b++<F||E[0]!==P)&&s--);return!j[0]&&$!=1&&(j.shift(),D.e--,x--),$>x&&C(D,x,n.RM,E[0]!==P),D},d.eq=function(e){return this.cmp(e)===0},d.gt=function(e){return this.cmp(e)>0},d.gte=function(e){return this.cmp(e)>-1},d.lt=function(e){return this.cmp(e)<0},d.lte=function(e){return this.cmp(e)<1},d.minus=d.sub=function(e){var t,n,i,r,s=this,u=s.constructor,o=s.s,a=(e=new u(e)).s;if(o!=a)return e.s=-a,s.plus(e);var c=s.c.slice(),R=s.e,f=e.c,p=e.e;if(!c[0]||!f[0])return f[0]?e.s=-a:c[0]?e=new u(s):e.s=1,e;if(o=R-p){for((r=o<0)?(o=-o,i=c):(p=R,i=f),i.reverse(),a=o;a--;)i.push(0);i.reverse()}else for(n=((r=c.length<f.length)?c:f).length,o=a=0;a<n;a++)if(c[a]!=f[a]){r=c[a]<f[a];break}if(r&&(i=c,c=f,f=i,e.s=-e.s),(a=(n=f.length)-(t=c.length))>0)for(;a--;)c[t++]=0;for(a=t;n>o;){if(c[--n]<f[n]){for(t=n;t&&!c[--t];)c[t]=9;--c[t],c[n]+=10}c[n]-=f[n]}for(;c[--a]===0;)c.pop();for(;c[0]===0;)c.shift(),--p;return c[0]||(e.s=1,c=[p=0]),e.c=c,e.e=p,e},d.mod=function(e){var t,n=this,i=n.constructor,r=n.s,s=(e=new i(e)).s;if(!e.c[0])throw Error(Z);return n.s=e.s=1,t=e.cmp(n)==1,n.s=r,e.s=s,t?new i(n):(r=i.DP,s=i.RM,i.DP=i.RM=0,n=n.div(e),i.DP=r,i.RM=s,this.minus(n.times(e)))},d.neg=function(){var e=new this.constructor(this);return e.s=-e.s,e},d.plus=d.add=function(e){var t,n,i,r=this,s=r.constructor;if(e=new s(e),r.s!=e.s)return e.s=-e.s,r.minus(e);var u=r.e,o=r.c,a=e.e,c=e.c;if(!o[0]||!c[0])return c[0]||(o[0]?e=new s(r):e.s=r.s),e;if(o=o.slice(),t=u-a){for(t>0?(a=u,i=c):(t=-t,i=o),i.reverse();t--;)i.push(0);i.reverse()}for(o.length-c.length<0&&(i=c,c=o,o=i),t=c.length,n=0;t;o[t]%=10)n=(o[--t]=o[t]+c[t]+n)/10|0;for(n&&(o.unshift(n),++a),t=o.length;o[--t]===0;)o.pop();return e.c=o,e.e=a,e},d.pow=function(e){var t=this,n=new t.constructor("1"),i=n,r=e<0;if(e!==~~e||e<-W||e>W)throw Error(N+"exponent");for(r&&(e=-e);e&1&&(i=i.times(t)),e>>=1,!!e;)t=t.times(t);return r?n.div(i):i},d.prec=function(e,t){if(e!==~~e||e<1||e>y)throw Error(N+"precision");return C(new this.constructor(this),e,t)},d.round=function(e,t){if(e===P)e=0;else if(e!==~~e||e<-y||e>y)throw Error(O);return C(new this.constructor(this),e+this.e+1,t)},d.sqrt=function(){var e,t,n,i=this,r=i.constructor,s=i.s,u=i.e,o=new r("0.5");if(!i.c[0])return new r(i);if(s<0)throw Error(T+"No square root");s=Math.sqrt(i+""),s===0||s===1/0?(t=i.c.join(""),t.length+u&1||(t+="0"),s=Math.sqrt(t),u=((u+1)/2|0)-(u<0||u&1),e=new r((s==1/0?"5e":(s=s.toExponential()).slice(0,s.indexOf("e")+1))+u)):e=new r(s+""),u=e.e+(r.DP+=4);do n=e,e=o.times(n.plus(i.div(n)));while(n.c.slice(0,u).join("")!==e.c.slice(0,u).join(""));return C(e,(r.DP-=4)+e.e+1,r.RM)},d.times=d.mul=function(e){var t,n=this,i=n.constructor,r=n.c,s=(e=new i(e)).c,u=r.length,o=s.length,a=n.e,c=e.e;if(e.s=n.s==e.s?1:-1,!r[0]||!s[0])return e.c=[e.e=0],e;for(e.e=a+c,u<o&&(t=r,r=s,s=t,c=u,u=o,o=c),t=new Array(c=u+o);c--;)t[c]=0;for(a=o;a--;){for(o=0,c=u+a;c>a;)o=t[c]+s[a]*r[c-a-1]+o,t[c--]=o%10,o=o/10|0;t[c]=o}for(o?++e.e:t.shift(),a=t.length;!t[--a];)t.pop();return e.c=t,e},d.toExponential=function(e,t){var n=this,i=n.c[0];if(e!==P){if(e!==~~e||e<0||e>y)throw Error(O);for(n=C(new n.constructor(n),++e,t);n.c.length<e;)n.c.push(0)}return B(n,!0,!!i)},d.toFixed=function(e,t){var n=this,i=n.c[0];if(e!==P){if(e!==~~e||e<0||e>y)throw Error(O);for(n=C(new n.constructor(n),e+n.e+1,t),e=e+n.e+1;n.c.length<e;)n.c.push(0)}return B(n,!1,!!i)},d[Symbol.for("nodejs.util.inspect.custom")]=d.toJSON=d.toString=function(){var e=this,t=e.constructor;return B(e,e.e<=t.NE||e.e>=t.PE,!!e.c[0])},d.toNumber=function(){var e=Number(B(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(e.toString()))throw Error(T+"Imprecise conversion");return e},d.toPrecision=function(e,t){var n=this,i=n.constructor,r=n.c[0];if(e!==P){if(e!==~~e||e<1||e>y)throw Error(N+"precision");for(n=C(new i(n),e,t);n.c.length<e;)n.c.push(0)}return B(n,e<=n.e||n.e<=i.NE||n.e>=i.PE,!!r)},d.valueOf=function(){var e=this,t=e.constructor;if(t.strict===!0)throw Error(T+"valueOf disallowed");return B(e,e.e<=t.NE||e.e>=t.PE,!0)};var Oe=Q();const{View:Fe}=I.General,ee=h.findByStoreName("MessageStore"),ke=h.findByName("ChannelPinsConnected",!1),Ge=h.findByProps("fetchMessages","sendMessage");function He(e){let{channelId:t}=e;const[n,i]=l.React.useState(g.preferFilters??["server","local"]),[r,s]=l.React.useState(0);return Ve({filters:function(){return we(Be,{defFilters:n,set:i})},clear:function(){return Array.isArray(r)&&V.showConfirmationAlert({title:"Clear local pins",content:`Are you sure you want to clear **${r.length}** pin${r.length!==1?"s":""} in this channel?`,confirmText:"Clear",confirmColor:"red",onConfirm:function(){re(t),s([])},isDismissable:!0})}}),te[t]=function(u){return[...n.includes("local")?Array.isArray(r)?r:[]:[],...n.includes("server")?u:[]]},l.React.useEffect(function(){(async function(){const u=[],o=ne(t)?.slice().reverse()??[];for(let a=0;a<o.length;a++){const c=o[a];s(a/o.length);let R=ee.getMessage(t,c.id);if(!R){const f=new Oe(c.id),p=[f.plus(1).toFixed(),f.minus(1).toFixed()];await Ge.fetchMessages({channelId:t,before:p[0],after:p[1],limit:1}),R=ee.getMessage(t,c.id)}R&&u.push(R)}s(u)})()},[]),Array.isArray(r)?l.React.createElement(ke.default,{channelId:t}):l.React.createElement(Fe,{style:{alignItems:"center",justifyContent:"center",flex:1}},l.React.createElement(l.ReactNative.ActivityIndicator,{size:"large",style:{marginBottom:10}}),l.React.createElement(L,{variant:"text-lg/semibold",color:"TEXT_NORMAL",align:"center"},Math.floor(r*100),"%"))}const{View:ze}=I.General,je=h.findByName("ChannelSettingsModal",!1),$e=h.findByName("ChannelPinsConnected",!1);let H={};function Ve(e){H=e}const te={};function Ue(){const e=new Array;return e.push(_.after("default",$e,function(t,n){const{channelId:i,loaded:r,messages:s}=n.props;return{...n,props:{...n.props,messages:r&&s?te[i]?.(s)??s:s}}})),e.push(_.before("openLazy",Ne,function(t){let[n,i,r]=t;const s=r?.message;i!=="MessageLongPressActionSheet"||!s||n.then(function(u){const o=_.after("default",u,function(a,c){l.React.useEffect(function(){return function(){o()}},[]);const R=le.findInReactTree(c,function(p){return p?.[0]?.type?.name==="ButtonRow"});if(!R)return c;let f=Math.max(R.findIndex(function(p){return p.props.message===l.i18n.Messages.MARK_UNREAD}),0);R.splice(f,0,l.React.createElement(Ce,s))})})})),e.push(_.after("default",je,function(t,n){const i=n.props.screens;i.PINNED_MESSAGES.headerRight=function(){return l.React.createElement(ze,{style:{flexDirection:"row-reverse"}},l.React.createElement(J,{icon:S.getAssetIDByName("ic_filter"),style:"header",onPress:function(){return H.filters?.()}}),l.React.createElement(J,{icon:S.getAssetIDByName("ic_message_delete"),style:"header",destructive:!0,onPress:function(){return H.clear?.()}}))},e.push(_.after("render",i.PINNED_MESSAGES,function(r,s){return l.React.createElement(He,{channelId:s.props.channelId})}))})),function(){return e.forEach(function(t){return t()})}}const{ScrollView:qe}=I.General,{FormRow:m}=I.Forms,Xe=l.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:w.semanticColors.TEXT_DANGER}}),Ye={color:"TEXT_DANGER",variant:"text-md/semibold"};function Je(){return ue.useProxy(g),React.createElement(qe,null,React.createElement(ye,{title:"Settings",icon:S.getAssetIDByName("ic_cog_24px")},React.createElement(m,{label:"Data size",subLabel:g.pinned?`${Math.floor(JSON.stringify(g.pinned).length/1e3*100)/100} kilobytes`:"N/A",leading:React.createElement(m.Icon,{source:S.getAssetIDByName("ic_message_edit")})}),React.createElement(m,{label:React.createElement(L,Ye,"Clear data"),leading:React.createElement(m.Icon,{style:Xe.destructiveIcon,source:S.getAssetIDByName("ic_message_delete")}),trailing:React.createElement(m.Arrow,null),onPress:function(){return V.showConfirmationAlert({title:"Clear data",content:"Are you sure you want to clear all local pin data?",confirmText:"Clear",confirmColor:"red",onConfirm:function(){delete g.pinned},isDismissable:!0})}})))}const g=ce.storage;function ne(e){return g.pinned?.[e]}function re(e){g.pinned??(g.pinned={}),delete g.pinned?.[e]}function z(e,t){return g.pinned?.[e]?.some(function(n){return n.id===t})}function ie(e,t){var n;g.pinned??(g.pinned={}),(n=g.pinned)[e]??(n[e]=[]),z(e,t)||g.pinned[e].push({id:t,pinned:Date.now()})}function se(e,t){g.pinned??(g.pinned={}),g.pinned[e]=(g.pinned[e]??[]).filter(function(n){return n.id!==t})}let oe;var Ke={onLoad:function(){return oe=Ue()},onUnload:function(){return oe()},settings:Je};return A.addPin=ie,A.clearPins=re,A.default=Ke,A.getPins=ne,A.hasPin=z,A.removePin=se,A.vstorage=g,Object.defineProperty(A,"__esModule",{value:!0}),A})({},vendetta.plugin,vendetta.metro.common,vendetta.metro,vendetta.patcher,vendetta,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta.utils,vendetta.storage,vendetta.ui.alerts);
