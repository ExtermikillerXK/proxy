(function(C,Z,b,l,P,$,E,u,A,e,w,m,O,ee,we,We){"use strict";const Je=l.findByStoreName("ThemeStore"),Xe=l.findByProps("colors","meta");l.findByProps("triggerHaptic");const te=l.findByProps("TextStyleSheet").TextStyleSheet,{View:L,Text:me,Pressable:Ye}=m.General;l.findByProps("TableRow");const Qe=l.findByProps("ActionSheet")?.ActionSheet??l.find(function(t){return t.render?.name==="ActionSheet"}),qe=l.findByProps("openLazy","hideActionSheet"),{openLazy:Ze,hideActionSheet:ve}=qe,{ActionSheetTitleHeader:et,ActionSheetCloseButton:tt,ActionSheetContentContainer:nt}=l.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");l.findByProps("ActionSheetRow")?.ActionSheetRow,l.findByName("Navigator")??l.findByProps("Navigator")?.Navigator,l.findByProps("getRenderCloseButton")?.getRenderCloseButton??l.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,l.findByProps("popModal","pushModal");const Ie=l.findByProps("useSearchControls"),ne=l.findByProps("useSettingSearchQuery"),rt=l.findByName("SettingSearchBar");l.findByProps("SvgXml"),l.findByProps("useInMainTabsExperiment","isInMainTabsExperiment");const at=l.find(function(t){return t?.WebView&&!t.default}).WebView;function it(t){return Xe.meta.resolveSemanticColor(Je.theme,t)}function re(t,r){try{Ze(new Promise(function(n){return n({default:t})}),"ActionSheet",r)}catch(n){we.logger.error(n.stack),E.showToast("Got error when opening ActionSheet! Please check debug logs",u.getAssetIDByName("Smal"))}}Object.assign(function(t){let{searchContext:r,controls:n}=t;return e.React.createElement(e.ReactNative.ScrollView,{scrollEnabled:!1},e.React.createElement(Ie.default,{searchContext:r,controls:n},e.React.createElement(rt,null)))},{useAdvancedSearch:function(t){const r=ne.useSettingSearchQuery(),n=Ie.useSearchControls(t,!1,function(){});return e.React.useEffect(function(){return function(){ne.setSettingSearchQuery(""),ne.setIsSettingSearchActive(!1)}},[]),[r,n]}});function ot(t){let{title:r,onPress:n,icon:i}=t;const a=e.stylesheet.createThemedStyleSheet({androidRipple:{color:w.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:w.semanticColors.HEADER_SECONDARY,opacity:.5}}),c=n?Ye:L;return e.React.createElement(c,{android_ripple:a.androidRipple,disabled:!1,accessibilityRole:"button",onPress:n,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&e.React.createElement(L,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:a.icon,source:i,resizeMode:"contain"})),e.React.createElement(F,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},r))}function K(t){let{title:r,onTitlePress:n,icon:i,children:a,padding:c}=t;const o=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:w.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(L,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(ot,{title:r,onPress:n,icon:i}),e.React.createElement(L,{style:o.main},c?e.React.createElement(L,{style:{paddingHorizontal:16,paddingVertical:16}},a):a))}function Te(t){let{addPadding:r}=t;const n=e.stylesheet.createThemedStyleSheet({line:{width:"100%",height:2,backgroundColor:w.semanticColors.BACKGROUND_ACCENT,borderRadius:2147483647}});return e.React.createElement(L,{style:[{marginTop:16,marginBottom:16},r&&{marginHorizontal:16}]},e.React.createElement(L,{style:n.line}))}var Ce;(function(t){function r(i){let{children:a,onPress:c}=i;return e.React.createElement(F,{variant:"text-md/bold",onPress:c},a)}t.Bold=r;function n(i){let{children:a,onPress:c}=i;return e.React.createElement(me,{style:{textDecorationLine:"underline"},onPress:c},a)}t.Underline=n})(Ce||(Ce={}));function F(t){let{variant:r,lineClamp:n,color:i,align:a,style:c,onPress:o,getChildren:f,children:g,liveUpdate:p}=t;const[s,y]=e.React.useReducer(function(R){return~R},0);return e.React.useEffect(function(){if(!p)return;const R=new Date().setMilliseconds(1e3);let h,T;return T=setTimeout(function(){y(),h=setInterval(y,1e3)},R-Date.now()),function(){clearTimeout(T),clearInterval(h)}},[]),e.React.createElement(me,{style:[r?te[r]:{},i?{color:it(w.semanticColors[i])}:{},a?{textAlign:a}:{},c??{}],numberOfLines:n,onPress:o},f?.()??g)}function ct(t){let{onPress:r,onLongPress:n,icon:i,style:a,destructive:c,color:o}=t;const f=e.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:w.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:w.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:w.semanticColors.TEXT_DANGER}});return e.React.createElement(e.ReactNative.TouchableOpacity,{onPress:r,onLongPress:n},e.React.createElement(e.ReactNative.Image,{style:[typeof a=="string"?a==="header"?f.headerStyleIcon:f.cardStyleIcon:a,c&&f.destructiveIcon,o&&{tintColor:o}].filter(function(g){return!!g}),source:i}))}const{View:lt,Text:be}=m.General,Pe=e.stylesheet.createThemedStyleSheet({count:{...te["text-lg/bold"],color:w.semanticColors.TEXT_NORMAL,textAlign:"center"},subtitle:{...te["text-md/medium"],color:w.semanticColors.TEXT_MUTED,textAlign:"center"}});function Ae(t){let{subtitle:r,count:n}=t;return React.createElement(lt,{style:{alignItems:"center",justifyContent:"center",marginHorizontal:16}},React.createElement(be,{style:Pe.count},n),React.createElement(be,{style:Pe.subtitle},r))}const ae="https://cloudsync.nexpid.xyz/",ie="1120793656878714913",Ne=function(){return d.host?d.host.endsWith("/")?d.host:`${d.host}/`:ae};var v={get api(){return Ne()},raw:"https://raw.githubusercontent.com/nexpid/VendettaPlugins/main/plugins/cloud-sync/",oauth2:{get clientId(){return d.clientId||ie},get redirectURL(){return`${Ne()}api/oauth2-response`}}};function st(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ut(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function W(t,r,n){return _e()?W=Reflect.construct:W=function(i,a,c){var o=[null];o.push.apply(o,a);var f=Function.bind.apply(i,o),g=new f;return c&&V(g,c.prototype),g},W.apply(null,arguments)}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},U(t)}function dt(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&V(t,r)}function ft(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function gt(t,r){return r&&(pt(r)==="object"||typeof r=="function")?r:st(t)}function V(t,r){return V=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},V(t,r)}function pt(t){"@swc/helpers - typeof";return t&&typeof Symbol<"u"&&t.constructor===Symbol?"symbol":typeof t}function oe(t){var r=typeof Map=="function"?new Map:void 0;return oe=function(n){if(n===null||!ft(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return W(n,arguments,U(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),V(i,n)},oe(t)}function _e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function yt(t){var r=_e();return function(){var n=U(t),i;if(r){var a=U(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return gt(this,i)}}const Be=l.findByStoreName("UserStore");let k=function(t){dt(n,t);var r=yt(n);function n(i){ut(this,n);var a;return a=r.call(this,`${i.status}: ${i.message}${i.error?` (${i.error})`:""}`),a.name=a.constructor.name,a}return n}(oe(Error));function N(){return d.auth?.[Be.getCurrentUser()?.id]}async function J(){var t;const r=new Error("Unauthorized, try logging out and back in again");let n=N();if(!n)throw r;if(Date.now()>=n.expiresAt){const i=await fetch(`${v.api}api/refresh-access-token?refresh_token=${encodeURIComponent(n.refreshToken)}`);if(i.status!==200)throw new k(await i.json());n=await i.json(),(t=d).auth??(t.auth={}),d.auth[Be.getCurrentUser().id]=n}return n.accessToken}async function ht(t){const r=await fetch(`${v.api}api/get-access-token?code=${encodeURIComponent(t)}`);if(r.status===200)return await r.json();throw new k(await r.json())}async function Rt(){if(!N())return;const t=await fetch(`${v.api}api/get-data`,{headers:{authorization:await J()}});if(t.status===200)return await t.json();throw new k(await t.json())}async function De(t){if(!N())return;const r=await fetch(`${v.api}api/sync-data`,{method:"POST",headers:{authorization:await J(),"content-type":"application/json"},body:JSON.stringify(t)});if(r.status===200)return await r.json();throw new k(await r.json())}async function St(){if(!N())return;const t=await fetch(`${v.api}api/delete-data`,{method:"DELETE",headers:{authorization:await J()}});if(t.status===200)return await t.json();throw new k(await t.json())}async function Et(t){if(!N())return;const r=await fetch(`${v.api}api/file/upload`,{method:"POST",headers:{authorization:await J(),"content-type":"text/plain"},body:t});if(r.status===200)return await r.json();throw new k(await r.json())}const{pushModal:wt,popModal:mt}=l.findByProps("pushModal","popModal"),vt=l.findByName("OAuth2AuthorizeModal"),It=l.findByStoreName("UserStore");function Tt(){wt({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:vt,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:v.oauth2.clientId,redirectUri:v.oauth2.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(t){var r;let{location:n}=t;if(n)try{const i=new URL(n).searchParams.get("code"),a=await ht(i);(r=d).auth??(r.auth={}),d.auth[It.getCurrentUser().id]=a,ye(),E.showToast("Successfully authenticated",u.getAssetIDByName("Check"))}catch(i){E.showToast(String(i),u.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return mt("oauth2-authorize")}},closable:!0}})}const{FormSwitchRow:xe}=m.Forms;function Ct(){const[t,r]=e.React.useState(""),[,n]=e.React.useReducer(function(c){return~c},0);e.React.useEffect(function(){r("")},[]),b.useProxy(d);const i=e.NavigationNative.useNavigation(),a=i.addListener("focus",function(){a(),i.setOptions({title:"Plugin Settings",headerRight:function(){return e.React.createElement(ct,{onPress:function(){return A.showConfirmationAlert({title:"Revert Settings",content:"Are you sure you want to revert all plugin settings?",confirmText:"Revert",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return d.pluginSettings={}}})},icon:u.getAssetIDByName("ic_message_delete"),style:"header"})}})});return e.React.createElement(e.ReactNative.FlatList,{ListHeaderComponent:e.React.createElement(m.Search,{style:{marginBottom:10},onChangeText:function(c){return r(c.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.entries(P.plugins).filter(function(c){return c[1].manifest.name?.toLowerCase().includes(t)}),renderItem:function(c){var o;let{item:[f,g]}=c;(o=d).pluginSettings??(o.pluginSettings={});const p=d.pluginSettings[f]??{syncPlugin:!0,syncStorage:!0},s=function(){var y;(y=d).pluginSettings??(y.pluginSettings={}),p.syncPlugin===!0&&p.syncStorage===!0?delete d.pluginSettings[f]:d.pluginSettings[f]=p,n()};return e.React.createElement(m.Summary,{label:g.manifest.name,icon:g.manifest.vendetta.icon??":3"},e.React.createElement(xe,{label:"Sync Plugin",onValueChange:function(){p.syncPlugin=!p.syncPlugin,s()},value:p.syncPlugin}),e.React.createElement(xe,{label:"Sync Plugin Storage",onValueChange:function(){p.syncStorage=!p.syncStorage,s()},value:p.syncStorage}))}})}let X=!1,ce;const le=[];function bt(){le.length=0,ce?.()}function _(t,r){le.push([t,r]),ce?.()}const Pt={themes:"#42f5a4",plugins:"#4290f5",importer:"#e6f542"},$e=e.stylesheet.createThemedStyleSheet({text:{fontFamily:e.constants.Fonts.CODE_SEMIBOLD,includeFontPadding:!1,color:w.semanticColors.TEXT_NORMAL,marginHorizontal:12,marginTop:24}}),At=function(){const[t,r]=e.React.useReducer(function(i){return~i},0);ce=r;const n=e.React.useRef();return e.React.useEffect(function(){return X=!0,function(){X=!1}},[]),e.React.createElement(e.ReactNative.ScrollView,{style:{flex:1},ref:n,onContentSizeChange:function(){return n.current.scrollToEnd({animated:!0})}},e.React.createElement(e.ReactNative.Text,{style:$e.text},le.map(function(i){let[a,c]=i;return[e.React.createElement(e.ReactNative.Text,{style:[$e.text,{color:Pt[a]}]},"[",a.toUpperCase(),"]:"),` ${c}
`]})))};function Nt(t){t.push("VendettaCustomPage",{render:At,title:"Import Logs"})}const{MMKVManager:_t}=window.nativeModuleProxy;async function Oe(){const t={themes:[],plugins:[]};for(const r of Object.values(P.plugins)){const n=d.pluginSettings?.[r.id];if(n?.syncPlugin===!1)continue;const i=n?.syncStorage===!1?{}:await b.createMMKVBackend(r.id).get();t.plugins.push({id:r.id,enabled:r.enabled,options:i})}for(const r of Object.values($.themes))t.themes.push({id:r.id,enabled:r.selected});return t}let Y;function Le(t){Y=t}async function Bt(t,r){if(!t)return;Y?.(!0);const n=[...t.sync.plugins.filter(function(o){return!P.plugins[o.id]&&!j(o.id)&&z(o.id)&&r.unproxiedPlugins}),...t.sync.plugins.filter(function(o){return!P.plugins[o.id]&&j(o.id)&&z(o.id)&&r.plugins})],i=t.sync.themes.filter(function(o){return!$.themes[o.id]&&r.themes});if(!n[0]&&!i[0])return Y?.(!1),E.showToast("Nothing to import",u.getAssetIDByName("Small"));bt(),_("importer",`Starting to import ${n.length} plugin${n.length!==1?"s":""} and ${i.length} theme${i.length!==1?"s":""}`),X||E.showToast(`Importing ${[n.length&&`${n.length} plugin${n.length!==1?"s":""}`,i.length&&`${i.length} theme${i.length!==1?"s":""}`].filter(function(o){return!!o}).join(" and ")}`,u.getAssetIDByName("toast_image_saved"));const a={plugins:0,themes:0,failed:0};await Promise.all([...n.map(function(o){return new Promise(async function(f){_t.setItem(o.id,JSON.stringify(o.options)),P.installPlugin(o.id,o.enabled).then(function(){a.plugins++,_("plugins",`Successfully imported plugin: ${o.id}`)}).catch(function(g){a.failed++,_("plugins",`Failed to import plugin: ${o.id}
${g}`)}).finally(f)})}),...i.map(function(o){return new Promise(async function(f){return $.installTheme(o.id).then(function(){a.themes++,_("themes",`Successfully imported theme: ${o.id}`)}).catch(function(g){a.failed++,_("themes",`Failed to import theme: ${o.id}
${g}`)}).finally(f)})})]),X||E.showToast(`Imported ${[[a.plugins,"plugin"],[a.themes,"theme"]].map(function(o){let[f,g]=o;return`${f} ${g}${f!==1?"s":""}`}).join(" and ")}! (${a.failed} failed)`,u.getAssetIDByName("check"));const c=$.themes[i.find(function(o){return o.enabled})?.id];c&&(_("themes",`Selecting theme: ${c.id}`),await b.createFileBackend("vendetta_theme.json").set(Object.assign(c,{selected:!0})),_("themes","Prompting user to reload"),await function(){return new Promise(function(o){return A.showConfirmationAlert({title:"Theme selected",content:"A reload is required to see the theme. Do you want to reload now?",confirmText:"Reload",confirmColor:"red",onConfirm:function(){window.nativeModuleProxy.BundleUpdaterManager.reload(),o()},cancelText:"Skip",onCancel:o,isDismissable:!0})})}()),_("importer",`Finished! Imported ${a.plugins} plugin${a.plugins!==1?"s":""} and ${a.themes} theme${a.themes!==1?"s":""}. ${a.failed?`Failed to import ${a.failed} plugin${a.failed!==1?"s":""}/theme${a.failed!==1?"s":""}`:"All imports were successful"}`),Y?.(!1)}const{View:Dt}=m.General,{FormCheckboxRow:se}=m.Forms;function ue(t){let{defOptions:r,save:n=I.save,navigation:i}=t;const a={unproxiedPlugins:n.sync.plugins.filter(function(p){return!P.plugins[p.id]&&!j(p.id)&&z(p.id)}).length,plugins:n.sync.plugins.filter(function(p){return!P.plugins[p.id]&&j(p.id)&&z(p.id)}).length,themes:n.sync.themes.filter(function(p){return!$.themes[p.id]}).length},c=[a.unproxiedPlugins,a.plugins,a.themes].reduce(function(p,s){return p+s},0),[o,f]=e.React.useState(r??{unproxiedPlugins:!1,plugins:!!a.plugins,themes:!!a.themes}),g=e.stylesheet.createThemedStyleSheet({icon:{width:18,height:18,tintColor:w.semanticColors.TEXT_BRAND,marginRight:4},btnIcon:{tintColor:w.semanticColors.TEXT_NORMAL,marginRight:8}});return e.React.createElement(Qe,null,e.React.createElement(nt,null,e.React.createElement(et,{title:"Import Data",trailing:e.React.createElement(tt,{onPress:function(){return ve()}})}),!c&&e.React.createElement(e.React.Fragment,null,e.React.createElement(Dt,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginTop:8}},e.React.createElement(e.ReactNative.Image,{source:u.getAssetIDByName("ic_info_24px"),style:g.icon,resizeMode:"cover"}),e.React.createElement(F,{variant:"text-md/semibold",color:"TEXT_BRAND",align:"center"},"All addons in the cloud are already imported"))),e.React.createElement(se,{label:`Unproxied Plugins (${a.unproxiedPlugins})`,disabled:!a.unproxiedPlugins,onPress:function(){return a.unproxiedPlugins&&(!o.unproxiedPlugins&&!r?A.showConfirmationAlert({title:"Warning",content:"Installing unproxied plugins can be dangerous since they haven't been verified by Vendetta staff. Are you sure you want to import them?",isDismissable:!0,confirmText:"Yes",confirmColor:"brand",onConfirm:function(){return re(ue,{save:n,navigation:i,defOptions:{...o,unproxiedPlugins:!0}})},cancelText:"Cancel"}):f({...o,unproxiedPlugins:!o.unproxiedPlugins}))},selected:o.unproxiedPlugins}),e.React.createElement(se,{label:`Plugins (${a.plugins})`,disabled:!a.plugins,onPress:function(){return a.plugins&&f({...o,plugins:!o.plugins})},selected:o.plugins}),e.React.createElement(se,{label:`Themes (${a.themes})`,disabled:!a.themes,onPress:function(){return a.themes&&f({...o,themes:!o.themes})},selected:o.themes}),e.React.createElement(m.Button,{text:"Import",color:"green",size:"medium",renderIcon:function(){return e.React.createElement(e.ReactNative.Image,{style:g.btnIcon,resizeMode:"cover",source:u.getAssetIDByName("ic_download_24px")})},onPress:function(){Nt(i),Bt(n,o),ve()},style:{marginHorizontal:16,marginVertical:16},disabled:!o.unproxiedPlugins&&!o.plugins&&!o.themes})))}const Q=window.nativeModuleProxy.DCDSoundManager;async function Me(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n=Math.floor(Math.random()*1e6),i=await Promise.resolve(new Promise(function(c){return Q.prepare(t,"notification",n,function(o,f){return c(f?.duration??r)})}));let a=null;return{play(){a&&(clearTimeout(a),a=null,Q.stop(n)),Q.play(n),a=setTimeout(function(){a=null,Q.stop(n)},i)}}}var xt=`<!DOCTYPE html>
<html></html>
<script>
  const RNWV = window.ReactNativeWebView;

  const stringToBuffer = (string) => new TextEncoder().encode(string);
  const bufferToString = (buffer) => new TextDecoder().decode(buffer);

  const keyCache = {};
  const getKey = async (raw) => {
    if (keyCache[raw]) return keyCache[raw];

    const pkey = await crypto.subtle.importKey(
      "raw",
      stringToBuffer(raw),
      { name: "PBKDF2" },
      false,
      ["deriveKey"]
    );
    const key = await crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: new Uint8Array(16),
        iterations: 100000,
        hash: "SHA-256",
      },
      pkey,
      { name: "AES-GCM", length: 256 },
      false,
      ["encrypt", "decrypt"]
    );
    keyCache[raw] = key;
    return key;
  };

  window.addEventListener("message", async (ev) => {
    const { action, data, key, tracker } = ev.data;
    if (!action || !data || !key || !tracker) return;

    try {
      if (action === "encrypt") {
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const ret = await window.crypto.subtle.encrypt(
          {
            name: "AES-GCM",
            iv,
          },
          await getKey(key),
          stringToBuffer(data)
        );
        return RNWV.postMessage(
          JSON.stringify({
            tracker,
            data: btoa(
              String.fromCharCode
                .apply(null, iv)
                .concat(String.fromCharCode.apply(null, new Uint8Array(ret)))
            ),
          })
        );
      } else if (action === "decrypt") {
        const raw = atob(data);
        const iv = new Uint8Array(
          raw
            .slice(0, 12)
            .split("")
            .map((x) => x.charCodeAt(0))
        );
        const dt = new Uint8Array(
          raw
            .slice(12)
            .split("")
            .map((x) => x.charCodeAt(0))
        );

        const ret = await window.crypto.subtle.decrypt(
          {
            name: "AES-GCM",
            iv,
          },
          await getKey(key),
          dt
        );
        return RNWV.postMessage(
          JSON.stringify({ tracker, data: bufferToString(ret) })
        );
      }
    } catch (e) {
      return RNWV.postMessage(
        JSON.stringify({ tracker, error: e.message ?? \`\${e}\` })
      );
    }
  });
<\/script>`;let G;const de={},ke=function(){return Math.floor(Math.random()*1e36).toString(36)},Fe=function(t){return G?.injectJavaScript(`window.postMessage(${JSON.stringify(t)})`)};async function $t(t,r){if(!G)return null;const n=ke();return new Promise(function(i,a){de[n]=function(c){return"error"in c?a(c.error):i(c.data)},Fe({action:"encrypt",data:t,key:r,tracker:n})})}async function Ot(t,r){if(!G)return null;const n=ke();return new Promise(function(i,a){de[n]=function(c){return"error"in c?a(c.error):i(c.data)},Fe({action:"decrypt",data:t,key:r,tracker:n})})}function Lt(){return e.React.useEffect(function(){return function(){return G=void 0}},[]),e.React.createElement(at,{ref:function(t){return G=t},source:{html:xt,baseUrl:"https://localhost"},style:{display:"none",opacity:0},onMessage:function(t){let{nativeEvent:{data:r}}=t,n;try{n=JSON.parse(r)}catch{return}de[n.tracker]?.(n)}})}const fe=l.findByProps("pickSingle","isCancel"),{downloadMediaAsset:Mt}=l.findByProps("downloadMediaAsset"),{ScrollView:kt,View:Ue}=m.General,{FormRow:S,FormInput:Ve,FormSwitchRow:Ge}=m.Forms,je=l.findByStoreName("UserStore"),Ft=b.wrapSync(Me(`${v.raw}assets/snd_creepyjingle.ogg`,1.6)),Ut=b.wrapSync(Me(`${v.raw}assets/snd_mysterygo.ogg`,2.2));function ge(){const[t,r]=e.React.useState(!1),[n,i]=e.React.useState([]);b.useProxy(I),b.useProxy(d);const a=function(s){return!n.includes(s)&&i([...n,s])},c=function(s){return i(n.filter(function(y){return s!==y}))};let o=0;const f=e.NavigationNative.useNavigation(),g=!!N(),p=!!I.save;return e.React.createElement(kt,null,e.React.createElement(Lt,null),e.React.createElement(K,{title:"Current Data",icon:u.getAssetIDByName("ic_contact_sync"),padding:!0},e.React.createElement(Ue,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginVertical:8}},e.React.createElement(Ae,{count:I.save?.sync?.plugins?.length??"-",subtitle:"plugins"}),e.React.createElement(Ae,{count:I.save?.sync?.themes?.length??"-",subtitle:"themes"}))),e.React.createElement(K,{title:"Settings",icon:u.getAssetIDByName("ic_cog_24px"),onTitlePress:function(){return o>=Date.now()?(t?Ut.play():Ft.play(),r(!t),o=0):o=Date.now()+500}},e.React.createElement(Ge,{label:"Auto Save",subLabel:"Automatically save data to cloud",leading:e.React.createElement(S.Icon,{source:u.getAssetIDByName("ic_contact_sync")}),onValueChange:function(){return d.autoSync=!d.autoSync},value:d.autoSync??!1}),!he&&d.autoSync&&e.React.createElement(F,{variant:"text-md/semibold",color:"TEXT_DANGER",style:{marginHorizontal:20,marginVertical:2}},"You must reinstall Vendetta in order to use Auto Save!"),e.React.createElement(Ge,{label:"Pin To Settings",subLabel:"Pin Cloud Sync to the settings page",leading:e.React.createElement(S.Icon,{source:u.getAssetIDByName("ic_message_pin")}),onValueChange:function(){return d.addToSettings=!d.addToSettings},value:d.addToSettings??!1}),e.React.createElement(S,{label:"Plugin Settings",leading:e.React.createElement(S.Icon,{source:u.getAssetIDByName("debug")}),trailing:e.React.createElement(S.Arrow,null),onPress:function(){return f.push("VendettaCustomPage",{render:Ct})}}),t&&e.React.createElement(e.React.Fragment,null,e.React.createElement(Te,{addPadding:!0}),e.React.createElement(S,{label:"API URL",subLabel:"Custom URL for the CloudSync backend API",leading:e.React.createElement(S.Icon,{source:u.getAssetIDByName("ic_message_edit")})}),e.React.createElement(Ve,{title:"",placeholder:ae,value:v.api,onChange:function(s){return d.host=s||ae},style:{marginTop:-25,marginHorizontal:12}}),e.React.createElement(S,{label:"Client ID",subLabel:"Custom client ID for OAuth2",leading:e.React.createElement(S.Icon,{source:u.getAssetIDByName("ic_message_edit")})}),e.React.createElement(Ve,{title:"",placeholder:ie,value:v.oauth2.clientId,onChange:function(s){return d.clientId=s||ie},style:{marginTop:-25,marginHorizontal:12}}))),e.React.createElement(K,{title:"Authentication",icon:u.getAssetIDByName("lock")},N()?e.React.createElement(e.React.Fragment,null,e.React.createElement(S,{label:"Log out",subLabel:"Logs you out of CloudSync",leading:e.React.createElement(S.Icon,{source:u.getAssetIDByName("ic_logout_24px")}),onPress:function(){return A.showConfirmationAlert({title:"Log out",content:"Are you sure you want to log out?",confirmText:"Log out",confirmColor:"BRAND",onConfirm:function(){var s;(s=d).auth??(s.auth={}),delete d.auth[je.getCurrentUser().id],delete I.save,E.showToast("Successfully logged out",u.getAssetIDByName("ic_logout_24px"))},cancelText:"Cancel"})}}),e.React.createElement(S,{label:"Delete data",subLabel:"Deletes your CloudSync data",leading:e.React.createElement(S.Icon,{source:u.getAssetIDByName("trash")}),onPress:function(){return A.showConfirmationAlert({title:"Delete data",content:"Are you sure you want to delete your save data? (this cannot be undone!)",confirmText:"Delete",confirmColor:"RED",onConfirm:async function(){var s;await St(),(s=d).auth??(s.auth={}),delete d.auth[je.getCurrentUser().id],delete I.save,E.showToast("Successfully deleted data",u.getAssetIDByName("trash"))},cancelText:"Cancel"})}})):e.React.createElement(S,{label:"Authenticate",leading:e.React.createElement(S.Icon,{source:u.getAssetIDByName("copy")}),trailing:S.Arrow,onPress:Tt})),e.React.createElement(K,{title:"Data Management",icon:u.getAssetIDByName("ic_message_edit"),padding:!g||!p},g&&p?e.React.createElement(e.React.Fragment,null,e.React.createElement(S,{label:"Save Data",subLabel:"Saves your data to the CloudSync API",leading:n.includes("save_api")?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small"}):e.React.createElement(S.Icon,{source:u.getAssetIDByName("ic_file_upload_24px")}),onPress:function(){return A.showConfirmationAlert({title:"Save data",content:"Are you sure you want to overwrite your save data? (this cannot be undone!)",confirmText:"Overwrite",confirmColor:"BRAND",onConfirm:async function(){a("save_api");try{I.save=await De(await Oe()),E.showToast("Successfully synced data",u.getAssetIDByName("Check"))}catch(s){E.showToast(String(s),u.getAssetIDByName("Small"))}c("save_api")},cancelText:"Cancel"})}}),e.React.createElement(S,{label:"Import Data",subLabel:"Imports data from the CloudSync API",leading:n.includes("import_api")?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small"}):e.React.createElement(S.Icon,{source:u.getAssetIDByName("ic_download_24px")}),onPress:function(){re(ue,{navigation:f}),Le(function(s){return s?a("import_api"):c("import_api")})}}),e.React.createElement(Te,{addPadding:!0}),e.React.createElement(S,{label:"Export Local Data",subLabel:"Exports data to a .txt file",leading:n.includes("export_local")?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small"}):e.React.createElement(S.Icon,{source:u.getAssetIDByName("ic_file_upload_24px")}),onPress:async function(){A.showInputAlert({title:"Enter encryption key",placeholder:"secret password",confirmText:"Enter",cancelText:"Cancel",onConfirm:async function(s){if(!s)throw new Error("An encryption key must be set");if(n.length)return;a("local_export");let y;try{y=await $t(JSON.stringify(I.save),s)}catch{return c("local_export"),E.showToast("Failed to encrypt!",u.getAssetIDByName("Small"))}E.showToast("Preparing for download...",u.getAssetIDByName("ic_upload"));let R;try{R=await Et(y)}catch(h){return c("local_export"),E.showToast(h?.message??`${h}`,u.getAssetIDByName("Small"))}E.showToast("Backup Saved",u.getAssetIDByName("ic_file_small_document")),Mt(`${v.api}api/files/${encodeURIComponent(R.key)}/${encodeURIComponent(R.file)}`,3),c("local_export")}})}}),e.React.createElement(S,{label:"Import Local Data",subLabel:"Imports data from a .txt file",leading:n.includes("import_local")?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small"}):e.React.createElement(S.Icon,{source:u.getAssetIDByName("ic_download_24px")}),onPress:async function(){if(n.length)return;a("import_local");let s;try{const{type:y,uri:R}=await fe.pickSingle({type:fe.types.plainText,mode:"open"});y==="text/plain"&&(s=await(await fetch(R)).text())}catch(y){fe.isCancel(y)||E.showToast(`Got an error! ${y}`,u.getAssetIDByName("Small"))}c("import_local"),s&&A.showInputAlert({title:"Enter decryption key",placeholder:"secret password",cancelText:"Cancel",confirmText:"Enter",onConfirm:async function(y){if(!y)throw new Error("A decryption key must be set");if(!n.length){a("import_local");try{const R=JSON.parse(await Ot(s,y));re(ue,{save:R,navigation:f}),c("import_local"),Le(function(h){return h?a("import_local"):c("import_local")})}catch{return c("import_local"),E.showToast("Failed to decrypt!",u.getAssetIDByName("Small"))}}}})}})):g?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small",style:{flex:1}}):e.React.createElement(F,{variant:"text-md/semibold",color:"TEXT_NORMAL",align:"center"},"Authenticate first to manage your data")),e.React.createElement(Ue,{style:{height:12}}))}let ze=0;function Vt(t){clearTimeout(ze),ze=setTimeout(t,1500)}const{FormRow:pe}=m.Forms;function Gt(){const t=e.NavigationNative.useNavigation();return React.createElement(m.ErrorBoundary,null,React.createElement(pe,{label:"Cloud Sync",leading:React.createElement(pe.Icon,{source:u.getAssetIDByName("ic_contact_sync")}),trailing:pe.Arrow,onPress:function(){return t.push("VendettaCustomPage",{title:"CloudSync",render:ge})}}))}const{FormSection:jt}=m.Forms,zt=l.findByName("getScreens"),Ht=l.findByName("UserSettingsOverviewWrapper",!1),Kt=e.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:w.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function Wt(t,r,n){const i=[],a=O.after("default",Ht,function(c,o){a();const f=ee.findInReactTree(o.props.children,function(g){return g.type&&g.type.name==="UserSettingsOverview"});i.push(O.after("render",f.type.prototype,function(g,p){let{props:{children:s}}=p;const y=[e.i18n.Messages.BILLING_SETTINGS,e.i18n.Messages.PREMIUM_SETTINGS];s=ee.findInReactTree(s,function(h){return h.children[1].type===jt}).children;const R=s.findIndex(function(h){return y.includes(h?.props.label)});t()&&s.splice(R===-1?4:R,0,r({}))}))},!0);if(i.push(a),zt&&n){const c=`VENDETTA_PLUGIN_${e.lodash.snakeCase(n.key).toUpperCase()}`,o=n.page.render,f=e.React.memo(function(y){let{navigation:R}=y;const h=R.addListener("focus",function(){h(),R.setOptions(ee.without(n.page,"noErrorBoundary","render"))});return e.React.createElement(e.ReactNative.View,{style:Kt.container},n.page.noErrorBoundary?e.React.createElement(o,null):e.React.createElement(m.ErrorBoundary,null,e.React.createElement(o,null)))}),g={[c]:{type:"route",title:function(){return n.title},icon:n.icon,parent:null,screen:{route:`VendettaPlugin${e.lodash.chain(n.key).camelCase().upperFirst().value()}`,getComponent:function(){return f}}}},p=function(y,R){const h=[...y],T=R?h?.[0]?.sections:h;if(!Array.isArray(T))return T;const D="Vendetta",x=T.find(function(M){return M?.title===D||M?.label===D});return x&&!x?.settings?.includes(c)&&x.settings.push(c),h},s=function(){const y=l.findByProps("useOverviewSettings"),R=l.findByProps("getSettingTitleConfig"),h=l.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),T="getSettingSearchListItems",D="getSettingListItems",x=l.findByProps(T),M=x?T:D,Ke=x??l.findByProps(D);if(!Ke||!y)return!1;i.push(O.after("useOverviewSettings",y,function(Ee,H){return p(H)})),i.push(O.after("getSettingTitleConfig",R,function(Ee,H){return{...H,[c]:n.title}})),i.push(O.after(M,Ke,function(Ee,H){let[Qt]=Ee;return[...Qt.includes(c)?[{type:"setting_search_result",ancestorRendererData:g[c],setting:c,title:function(){return n.title},breadcrumbs:["Vendetta"],icon:g[c].icon}]:[],...H]}));const Se=h.SETTING_RELATIONSHIPS,Yt=h.SETTING_RENDERER_CONFIGS;return h.SETTING_RELATIONSHIPS={...Se,[c]:null},h.SETTING_RENDERER_CONFIGS={...Yt,...g},i.push(function(){h.SETTING_RELATIONSHIPS=Se,h.SETTING_RENDERER_CONFIGS=Se}),!0};(function(){const y=l.findByProps("SearchableSettingsList"),R=l.findByProps("SETTING_RENDERER_CONFIG"),h=l.findByProps("getSettingListItems");if(!h||!y||!R)return!1;i.push(O.before("type",y.SearchableSettingsList,function(D){return p(D,!0)})),i.push(O.after("getSettingListSearchResultItems",h,function(D,x){for(const M of x)M.setting===c&&(M.breadcrumbs=["Vendetta"])}));const T=R.SETTING_RENDERER_CONFIG;return R.SETTING_RENDERER_CONFIG={...T,...g},i.push(function(){R.SETTING_RENDERER_CONFIG=T}),!0})()||s()}return function(){return i.forEach(function(c){return c()})}}function Jt(){let t=[];return t.push(Wt(function(){return d.addToSettings},function(){return React.createElement(Gt,null)},{key:we.plugin.manifest.name,icon:u.getAssetIDByName("ic_contact_sync"),title:"Cloud Sync",page:{title:"CloudSync",render:ge}})),function(){return t.forEach(function(r){return r()})}}const d=Z.storage;let He;const I=b.wrapSync(b.createStorage({get:function(){return He},set:function(t){He=t}}));async function ye(){try{I.save=await Rt()}catch{}}function j(t){return t.startsWith(We.PROXY_PREFIX)}function z(t){return!t.includes("cloud-sync")}const B=async function(){if(!d.autoSync)return;const t=await Oe();JSON.stringify(I.save)!==JSON.stringify(t)&&Vt(async function(){return I.save=await De(t)})},q=Symbol.for("vendetta.storage.emitter"),he=!!P.plugins[q]&&!!$.themes[q];let Re=[];var Xt={onLoad:function(){if(N()&&ye(),he){const t={plugins:P.plugins[q],themes:$.themes[q]};t.plugins.on("SET",B),t.themes.on("SET",B),t.plugins.on("DEL",B),t.themes.on("DEL",B),Re.push(function(){t.plugins.off("SET",B),t.themes.off("SET",B),t.plugins.off("DEL",B),t.themes.off("DEL",B)})}Re.push(Jt()),Z.storage.databaseMigrate&&delete Z.storage.databaseMigrate},onUnload:function(){return Re.forEach(function(t){return t()})},settings:ge};return C.cache=I,C.canImport=z,C.default=Xt,C.emitterAvailable=he,C.fillCache=ye,C.isPluginProxied=j,C.vstorage=d,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.plugin,vendetta.storage,vendetta.metro,vendetta.plugins,vendetta.themes,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.alerts,vendetta.metro.common,vendetta.ui,vendetta.ui.components,vendetta.patcher,vendetta.utils,vendetta,vendetta.constants);
