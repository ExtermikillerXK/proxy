(function(C,q,b,s,P,_,E,d,L,e,w,v,B,Z,Re,ze){"use strict";const He=s.findByStoreName("ThemeStore"),We=s.findByProps("colors","meta");s.findByProps("triggerHaptic");const{TextStyleSheet:Je}=s.findByProps("TextStyleSheet"),{View:x,Text:Se,Pressable:Ke}=v.General;s.findByProps("TableRow");const Xe=s.findByProps("ActionSheet")?.ActionSheet??s.find(function(t){return t.render?.name==="ActionSheet"}),Ye=s.findByProps("openLazy","hideActionSheet"),{openLazy:Qe,hideActionSheet:Ee}=Ye,{ActionSheetTitleHeader:qe,ActionSheetCloseButton:Ze,ActionSheetContentContainer:et}=s.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");s.findByProps("ActionSheetRow")?.ActionSheetRow,s.findByName("Navigator")??s.findByProps("Navigator")?.Navigator,s.findByProps("getRenderCloseButton")?.getRenderCloseButton??s.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,s.findByProps("popModal","pushModal");const we=s.findByProps("useSearchControls"),ee=s.findByProps("useSettingSearchQuery"),tt=s.findByName("SettingSearchBar");s.findByProps("SvgXml"),s.findByProps("useInMainTabsExperiment","isInMainTabsExperiment");const nt=s.find(function(t){return t?.WebView&&!t.default}).WebView;function rt(t){return We.meta.resolveSemanticColor(He.theme,t)}function te(t,r){try{Qe(new Promise(function(n){return n({default:t})}),"ActionSheet",r)}catch(n){Re.logger.error(n.stack),E.showToast("Got error when opening ActionSheet! Please check debug logs",d.getAssetIDByName("Smal"))}}Object.assign(function(t){let{searchContext:r,controls:n}=t;return e.React.createElement(e.ReactNative.ScrollView,{scrollEnabled:!1},e.React.createElement(we.default,{searchContext:r,controls:n},e.React.createElement(tt,null)))},{useAdvancedSearch:function(t){const r=ee.useSettingSearchQuery(),n=we.useSearchControls(t,!1,function(){});return e.React.useEffect(function(){return function(){ee.setSettingSearchQuery(""),ee.setIsSettingSearchActive(!1)}},[]),[r,n]}});function at(t){let{title:r,onPress:n,icon:a}=t;const i=e.stylesheet.createThemedStyleSheet({androidRipple:{color:w.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:w.semanticColors.HEADER_SECONDARY,opacity:.5}}),c=n?Ke:x;return e.React.createElement(c,{android_ripple:i.androidRipple,disabled:!1,accessibilityRole:"button",onPress:n,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},a&&e.React.createElement(x,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:i.icon,source:a,resizeMode:"contain"})),e.React.createElement(M,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},r))}function W(t){let{title:r,onTitlePress:n,icon:a,children:i,padding:c}=t;const o=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:w.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(x,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(at,{title:r,onPress:n,icon:a}),e.React.createElement(x,{style:o.main},c?e.React.createElement(x,{style:{paddingHorizontal:16,paddingVertical:16}},i):i))}function ve(t){let{addPadding:r}=t;const n=e.stylesheet.createThemedStyleSheet({line:{width:"100%",height:2,backgroundColor:w.semanticColors.BACKGROUND_ACCENT,borderRadius:2147483647}});return e.React.createElement(x,{style:[{marginTop:16,marginBottom:16},r&&{marginHorizontal:16}]},e.React.createElement(x,{style:n.line}))}var me;(function(t){function r(a){let{children:i,onPress:c}=a;return e.React.createElement(M,{variant:"text-md/bold",onPress:c},i)}t.Bold=r;function n(a){let{children:i,onPress:c}=a;return e.React.createElement(Se,{style:{textDecorationLine:"underline"},onPress:c},i)}t.Underline=n})(me||(me={}));function M(t){let{variant:r,lineClamp:n,color:a,align:i,style:c,onPress:o,getChildren:p,children:f,liveUpdate:g}=t;const[u,y]=e.React.useReducer(function(S){return~S},0);return e.React.useEffect(function(){if(!g)return;const S=new Date().setMilliseconds(1e3);let h,I;return I=setTimeout(function(){y(),h=setInterval(y,1e3)},S-Date.now()),function(){clearTimeout(I),clearInterval(h)}},[]),e.React.createElement(Se,{style:[r?Je[r]:{},a?{color:rt(w.semanticColors[a])}:{},i?{textAlign:i}:{},c??{}],numberOfLines:n,onPress:o},p?.()??f)}function it(t){let{onPress:r,onLongPress:n,icon:a,style:i,destructive:c,color:o}=t;const p=e.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:w.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:w.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:w.semanticColors.TEXT_DANGER}});return e.React.createElement(e.ReactNative.TouchableOpacity,{onPress:r,onLongPress:n},e.React.createElement(e.ReactNative.Image,{style:[typeof i=="string"?i==="header"?p.headerStyleIcon:p.cardStyleIcon:i,c&&p.destructiveIcon,o&&{tintColor:o}].filter(function(f){return!!f}),source:a}))}const{View:ot,Text:Te}=v.General,{TextStyleSheet:Ie}=s.findByProps("TextStyleSheet"),Ce=e.stylesheet.createThemedStyleSheet({count:{...Ie["text-lg/bold"],color:w.semanticColors.TEXT_NORMAL,textAlign:"center"},subtitle:{...Ie["text-md/medium"],color:w.semanticColors.TEXT_MUTED,textAlign:"center"}});function be(t){let{subtitle:r,count:n,contents:a}=t;return React.createElement(ot,{style:{alignItems:"center",justifyContent:"center",marginHorizontal:16}},React.createElement(Te,{style:Ce.count},n),React.createElement(Te,{style:Ce.subtitle},r))}const Pe="https://cloudsync.nexpid.xyz/";var T={get api(){return l.host?l.host.endsWith("/")?l.host:`${l.host}/`:Pe},raw:"https://raw.githubusercontent.com/nexpid/VendettaPlugins/main/plugins/cloud-sync/",oauth2:{clientId:"1120793656878714913",get redirectURL(){return`${l.host?l.host.endsWith("/")?l.host:`${l.host}/`:Pe}api/oauth2-response`}}};function ct(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function st(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function J(t,r,n){return Ne()?J=Reflect.construct:J=function(a,i,c){var o=[null];o.push.apply(o,i);var p=Function.bind.apply(a,o),f=new p;return c&&U(f,c.prototype),f},J.apply(null,arguments)}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},F(t)}function lt(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&U(t,r)}function ut(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function dt(t,r){return r&&(ft(r)==="object"||typeof r=="function")?r:ct(t)}function U(t,r){return U=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},U(t,r)}function ft(t){"@swc/helpers - typeof";return t&&typeof Symbol<"u"&&t.constructor===Symbol?"symbol":typeof t}function ne(t){var r=typeof Map=="function"?new Map:void 0;return ne=function(n){if(n===null||!ut(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(n))return r.get(n);r.set(n,a)}function a(){return J(n,arguments,F(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),U(a,n)},ne(t)}function Ne(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function gt(t){var r=Ne();return function(){var n=F(t),a;if(r){var i=F(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return dt(this,a)}}const Ae=s.findByStoreName("UserStore");let V=function(t){lt(n,t);var r=gt(n);function n(a){st(this,n);var i;return i=r.call(this,`${a.status}: ${a.message}${a.error?` (${a.error})`:""}`),i.name=i.constructor.name,i}return n}(ne(Error));function D(){return l.auth?.[Ae.getCurrentUser()?.id]}async function re(){var t;const r=new Error("Unauthorized, try logging out and back in again");let n=D();if(!n)throw r;if(Date.now()>=n.expiresAt){const a=await fetch(`${T.api}api/refresh-access-token?refresh_token=${encodeURIComponent(n.refreshToken)}`);if(a.status!==200)throw new V(await a.json());n=await a.json(),(t=l).auth??(t.auth={}),l.auth[Ae.getCurrentUser().id]=n}return n.accessToken}async function pt(t){const r=await fetch(`${T.api}api/get-access-token?code=${encodeURIComponent(t)}`);if(r.status===200)return await r.json();throw new V(await r.json())}async function yt(){if(!D())return;const t=await fetch(`${T.api}api/get-data`,{headers:{authorization:await re()}});if(t.status===200)return await t.json();throw new V(await t.json())}async function _e(t){if(!D())return;const r=await fetch(`${T.api}api/sync-data`,{method:"POST",headers:{authorization:await re(),"content-type":"application/json"},body:JSON.stringify(t)});if(r.status===200)return await r.json();throw new V(await r.json())}async function ht(){if(!D())return;const t=await fetch(`${T.api}api/delete-data`,{method:"DELETE",headers:{authorization:await re()}});if(t.status===200)return await t.json();throw new V(await t.json())}const{pushModal:Rt,popModal:St}=s.findByProps("pushModal","popModal"),Et=s.findByName("OAuth2AuthorizeModal"),wt=s.findByStoreName("UserStore");function vt(){Rt({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:Et,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:T.oauth2.clientId,redirectUri:T.oauth2.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(t){var r;let{location:n}=t;try{const a=new URL(n).searchParams.get("code"),i=await pt(a);(r=l).auth??(r.auth={}),l.auth[wt.getCurrentUser().id]=i,fe(),E.showToast("Successfully authenticated",d.getAssetIDByName("Check"))}catch(a){E.showToast(String(a),d.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return St("oauth2-authorize")}},closable:!0}})}const{FormSwitchRow:Be}=v.Forms;function mt(){const[t,r]=e.React.useState(""),[,n]=e.React.useReducer(function(c){return~c},0);e.React.useEffect(function(){r("")},[]),b.useProxy(l);const a=e.NavigationNative.useNavigation(),i=a.addListener("focus",function(){i(),a.setOptions({title:"Plugin Settings",headerRight:function(){return e.React.createElement(it,{onPress:function(){return L.showConfirmationAlert({title:"Revert Settings",content:"Are you sure you want to revert all plugin settings?",confirmText:"Revert",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return l.pluginSettings={}}})},icon:d.getAssetIDByName("ic_message_delete"),style:"header"})}})});return e.React.createElement(e.ReactNative.FlatList,{ListHeaderComponent:e.React.createElement(v.Search,{style:{marginBottom:10},onChangeText:function(c){return r(c.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.entries(P.plugins).filter(function(c){return c[1].manifest.name?.toLowerCase().includes(t)}),renderItem:function(c){var o;let{item:[p,f]}=c;(o=l).pluginSettings??(o.pluginSettings={});const g=l.pluginSettings[p]??{syncPlugin:!0,syncStorage:!0},u=function(){var y;(y=l).pluginSettings??(y.pluginSettings={}),g.syncPlugin===!0&&g.syncStorage===!0?delete l.pluginSettings[p]:l.pluginSettings[p]=g,n()};return e.React.createElement(v.Summary,{label:f.manifest.name,icon:f.manifest.vendetta.icon??":3"},e.React.createElement(Be,{label:"Sync Plugin",onValueChange:function(){g.syncPlugin=!g.syncPlugin,u()},value:g.syncPlugin}),e.React.createElement(Be,{label:"Sync Plugin Storage",onValueChange:function(){g.syncStorage=!g.syncStorage,u()},value:g.syncStorage}))}})}let K=!1,ae;const ie=[];function Tt(){ie.length=0,ae?.()}function N(t,r){ie.push([t,r]),ae?.()}const It={themes:"#42f5a4",plugins:"#4290f5",importer:"#e6f542"},xe=e.stylesheet.createThemedStyleSheet({text:{fontFamily:e.constants.Fonts.CODE_SEMIBOLD,includeFontPadding:!1,color:w.semanticColors.TEXT_NORMAL,marginHorizontal:12,marginTop:24}}),Ct=function(){const[t,r]=e.React.useReducer(function(a){return~a},0);ae=r;const n=e.React.useRef();return e.React.useEffect(function(){return K=!0,function(){K=!1}},[]),e.React.createElement(e.ReactNative.ScrollView,{style:{flex:1},ref:n,onContentSizeChange:function(){return n.current.scrollToEnd({animated:!0})}},e.React.createElement(e.ReactNative.Text,{style:xe.text},ie.map(function(a){let[i,c]=a;return[e.React.createElement(e.ReactNative.Text,{style:[xe.text,{color:It[i]}]},"[",i.toUpperCase(),"]:"),` ${c}
`]})))};function bt(t){t.push("VendettaCustomPage",{render:Ct,title:"Import Logs"})}const{MMKVManager:Pt}=window.nativeModuleProxy;async function De(){const t={themes:[],plugins:[]};for(const r of Object.values(P.plugins)){const n=l.pluginSettings?.[r.id];if(n?.syncPlugin===!1)continue;const a=n?.syncStorage===!1?{}:await b.createMMKVBackend(r.id).get();t.plugins.push({id:r.id,enabled:r.enabled,options:a})}for(const r of Object.values(_.themes))t.themes.push({id:r.id,enabled:r.selected});return t}let X;function $e(t){X=t}async function Nt(t,r){if(!t)return;X?.(!0);const n=[...t.sync.plugins.filter(function(o){return!P.plugins[o.id]&&!j(o.id)&&z(o.id)&&r.unproxiedPlugins}),...t.sync.plugins.filter(function(o){return!P.plugins[o.id]&&j(o.id)&&z(o.id)&&r.plugins})],a=t.sync.themes.filter(function(o){return!_.themes[o.id]&&r.themes});if(!n[0]&&!a[0])return X?.(!1),E.showToast("Nothing to import",d.getAssetIDByName("Small"));Tt(),N("importer",`Starting to import ${n.length} plugin${n.length!==1?"s":""} and ${a.length} theme${a.length!==1?"s":""}`),K||E.showToast(`Importing ${[n.length&&`${n.length} plugin${n.length!==1?"s":""}`,a.length&&`${a.length} theme${a.length!==1?"s":""}`].filter(function(o){return!!o}).join(" and ")}`,d.getAssetIDByName("toast_image_saved"));const i={plugins:0,themes:0,failed:0};await Promise.all([...n.map(function(o){return new Promise(async function(p){Pt.setItem(o.id,JSON.stringify(o.options)),P.installPlugin(o.id,o.enabled).then(function(){i.plugins++,N("plugins",`Successfully imported plugin: ${o.id}`)}).catch(function(f){i.failed++,N("plugins",`Failed to import plugin: ${o.id}
${f}`)}).finally(p)})}),...a.map(function(o){return new Promise(async function(p){return _.installTheme(o.id).then(function(){i.themes++,N("themes",`Successfully imported theme: ${o.id}`)}).catch(function(f){i.failed++,N("themes",`Failed to import theme: ${o.id}
${f}`)}).finally(p)})})]),K||E.showToast(`Imported ${[[i.plugins,"plugin"],[i.themes,"theme"]].map(function(o){let[p,f]=o;return`${p} ${f}${p!==1?"s":""}`}).join(" and ")}! (${i.failed} failed)`,d.getAssetIDByName("check"));const c=_.themes[a.find(function(o){return o.enabled})?.id];c&&(N("themes",`Selecting theme: ${c.id}`),await b.createFileBackend("vendetta_theme.json").set(Object.assign(c,{selected:!0})),N("themes","Prompting user to reload"),await function(){return new Promise(function(o){return L.showConfirmationAlert({title:"Theme selected",content:"A reload is required to see the theme. Do you want to reload now?",confirmText:"Reload",confirmColor:"red",onConfirm:function(){window.nativeModuleProxy.BundleUpdaterManager.reload(),o()},cancelText:"Skip",onCancel:o,isDismissable:!0})})}()),N("importer",`Finished! Imported ${i.plugins} plugin${i.plugins!==1?"s":""} and ${i.themes} theme${i.themes!==1?"s":""}. ${i.failed?`Failed to import ${i.failed} plugin${i.failed!==1?"s":""}/theme${i.failed!==1?"s":""}`:"All imports were successful"}`),X?.(!1)}const{View:At}=v.General,{FormCheckboxRow:oe}=v.Forms;function ce(t){let{defOptions:r,save:n=m.save,navigation:a}=t;const i={unproxiedPlugins:n.sync.plugins.filter(function(g){return!P.plugins[g.id]&&!j(g.id)&&z(g.id)}).length,plugins:n.sync.plugins.filter(function(g){return!P.plugins[g.id]&&j(g.id)&&z(g.id)}).length,themes:n.sync.themes.filter(function(g){return!_.themes[g.id]}).length},c=[i.unproxiedPlugins,i.plugins,i.themes].reduce(function(g,u){return g+u},0),[o,p]=e.React.useState(r??{unproxiedPlugins:!1,plugins:!!i.plugins,themes:!!i.themes}),f=e.stylesheet.createThemedStyleSheet({icon:{width:18,height:18,tintColor:w.semanticColors.TEXT_BRAND,marginRight:4},btnIcon:{tintColor:w.semanticColors.TEXT_NORMAL,marginRight:8}});return e.React.createElement(Xe,null,e.React.createElement(et,null,e.React.createElement(qe,{title:"Import Data",trailing:e.React.createElement(Ze,{onPress:function(){return Ee()}})}),!c&&e.React.createElement(e.React.Fragment,null,e.React.createElement(At,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginTop:8}},e.React.createElement(e.ReactNative.Image,{source:d.getAssetIDByName("ic_info_24px"),style:f.icon,resizeMode:"cover"}),e.React.createElement(M,{variant:"text-md/semibold",color:"TEXT_BRAND",align:"center"},"All addons in the cloud are already imported"))),e.React.createElement(oe,{label:`Unproxied Plugins (${i.unproxiedPlugins})`,disabled:!i.unproxiedPlugins,onPress:function(){return i.unproxiedPlugins&&(!o.unproxiedPlugins&&!r?L.showConfirmationAlert({title:"Warning",content:"Installing unproxied plugins can be dangerous since they haven't been verified by Vendetta staff. Are you sure you want to import them?",isDismissable:!0,confirmText:"Yes",confirmColor:"brand",onConfirm:function(){return te(ce,{navigation:a,defOptions:{...o,unproxiedPlugins:!0}})},cancelText:"Cancel"}):p({...o,unproxiedPlugins:!o.unproxiedPlugins}))},selected:o.unproxiedPlugins}),e.React.createElement(oe,{label:`Plugins (${i.plugins})`,disabled:!i.plugins,onPress:function(){return i.plugins&&p({...o,plugins:!o.plugins})},selected:o.plugins}),e.React.createElement(oe,{label:`Themes (${i.themes})`,disabled:!i.themes,onPress:function(){return i.themes&&p({...o,themes:!o.themes})},selected:o.themes}),e.React.createElement(v.Button,{text:"Import",color:"green",size:"medium",renderIcon:function(){return e.React.createElement(e.ReactNative.Image,{style:f.btnIcon,resizeMode:"cover",source:d.getAssetIDByName("ic_download_24px")})},onPress:function(){bt(a),Nt(n,o),Ee()},style:{marginHorizontal:16,marginVertical:16},disabled:!o.unproxiedPlugins&&!o.plugins&&!o.themes})))}const Y=window.nativeModuleProxy.DCDSoundManager;async function Oe(t){const r=Math.floor(Math.random()*1e6),n=await Promise.resolve(new Promise(function(i){return Y.prepare(t,"notification",r,function(c,o){return i(o.duration)})}));let a=null;return{play(){a&&(clearTimeout(a),a=null,Y.stop(r)),Y.play(r),a=setTimeout(function(){a=null,Y.stop(r)},n)}}}var _t=`<!DOCTYPE html>
<html></html>
<script>
  const RNWV = window.ReactNativeWebView;

  const stringToBuffer = (string) => new TextEncoder().encode(string);
  const bufferToString = (buffer) => new TextDecoder().decode(buffer);

  const keyCache = {};
  const getKey = async (raw) => {
    if (keyCache[raw]) return keyCache[raw];

    const pkey = await crypto.subtle.importKey(
      "raw",
      stringToBuffer(raw),
      { name: "PBKDF2" },
      false,
      ["deriveKey"]
    );
    const key = await crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: new Uint8Array(16),
        iterations: 100000,
        hash: "SHA-256",
      },
      pkey,
      { name: "AES-GCM", length: 256 },
      false,
      ["encrypt", "decrypt"]
    );
    keyCache[raw] = key;
    return key;
  };

  window.addEventListener("message", async (ev) => {
    const { action, data, key, tracker } = ev.data;
    if (!action || !data || !key || !tracker) return;

    try {
      if (action === "encrypt") {
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const ret = await window.crypto.subtle.encrypt(
          {
            name: "AES-GCM",
            iv,
          },
          await getKey(key),
          stringToBuffer(data)
        );
        return RNWV.postMessage(
          JSON.stringify({
            tracker,
            data: btoa(
              String.fromCharCode
                .apply(null, iv)
                .concat(String.fromCharCode.apply(null, new Uint8Array(ret)))
            ),
          })
        );
      } else if (action === "decrypt") {
        const raw = atob(data);
        const iv = new Uint8Array(
          raw
            .slice(0, 12)
            .split("")
            .map((x) => x.charCodeAt(0))
        );
        const dt = new Uint8Array(
          raw
            .slice(12)
            .split("")
            .map((x) => x.charCodeAt(0))
        );

        const ret = await window.crypto.subtle.decrypt(
          {
            name: "AES-GCM",
            iv,
          },
          await getKey(key),
          dt
        );
        return RNWV.postMessage(
          JSON.stringify({ tracker, data: bufferToString(ret) })
        );
      }
    } catch (e) {
      return RNWV.postMessage(
        JSON.stringify({ tracker, error: e.message ?? \`\${e}\` })
      );
    }
  });
<\/script>`;let G;const se={},Le=function(){return Math.floor(Math.random()*1e36).toString(36)},ke=function(t){return G?.injectJavaScript(`window.postMessage(${JSON.stringify(t)})`)};async function Bt(t,r){if(!G)return null;const n=Le();return new Promise(function(a,i){se[n]=function(c){return"error"in c?i(c.error):a(c.data)},ke({action:"encrypt",data:t,key:r,tracker:n})})}async function xt(t,r){if(!G)return null;const n=Le();return new Promise(function(a,i){se[n]=function(c){return"error"in c?i(c.error):a(c.data)},ke({action:"decrypt",data:t,key:r,tracker:n})})}function Dt(){return e.React.useEffect(function(){return function(){return G=void 0}},[]),e.React.createElement(nt,{ref:function(t){return G=t},source:{html:_t,baseUrl:"https://localhost"},style:{display:"none",opacity:0},onMessage:function(t){let{nativeEvent:{data:r}}=t,n;try{n=JSON.parse(r)}catch{return}se[n.tracker]?.(n)}})}const le=s.findByProps("pickSingle","isCancel"),{ScrollView:$t,View:Me}=v.General,{FormRow:R,FormInput:Ot,FormSwitchRow:Fe}=v.Forms,Ue=s.findByStoreName("UserStore"),Lt=b.wrapSync(Oe(`${T.raw}assets/snd_creepyjingle.ogg`)),kt=b.wrapSync(Oe(`${T.raw}assets/snd_mysterygo.ogg`));function ue(){const[t,r]=e.React.useState(!1),[n,a]=e.React.useState([]);b.useProxy(m),b.useProxy(l);const i=function(u){return!n.includes(u)&&a([...n,u])},c=function(u){return a(n.filter(function(y){return u!==y}))};let o=0;const p=e.NavigationNative.useNavigation(),f=!!D(),g=!!m.save;return e.React.createElement($t,null,e.React.createElement(Dt,null),e.React.createElement(W,{title:"Current Data",icon:d.getAssetIDByName("ic_contact_sync"),padding:!0},e.React.createElement(Me,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginVertical:8}},e.React.createElement(be,{count:m.save?.sync?.plugins?.length??"-",subtitle:"plugins",contents:2}),e.React.createElement(be,{count:m.save?.sync?.themes?.length??"-",subtitle:"themes",contents:2}))),e.React.createElement(W,{title:"Settings",icon:d.getAssetIDByName("ic_cog_24px"),onTitlePress:function(){return o>=Date.now()?(t?kt.play():Lt.play(),r(!t),o=0):o=Date.now()+500}},e.React.createElement(Fe,{label:"Auto Save",subLabel:"Automatically save data to cloud",leading:e.React.createElement(R.Icon,{source:d.getAssetIDByName("ic_contact_sync")}),onValueChange:function(){return l.autoSync=!l.autoSync},value:l.autoSync??!1}),!ge&&l.autoSync&&e.React.createElement(M,{variant:"text-md/semibold",color:"TEXT_DANGER",style:{marginHorizontal:20,marginVertical:2}},"You must reinstall Vendetta in order to use Auto Save!"),e.React.createElement(Fe,{label:"Pin To Settings",subLabel:"Pin Cloud Sync to the settings page",leading:e.React.createElement(R.Icon,{source:d.getAssetIDByName("ic_message_pin")}),onValueChange:function(){return l.addToSettings=!l.addToSettings},value:l.addToSettings??!1}),e.React.createElement(R,{label:"Plugin Settings",leading:e.React.createElement(R.Icon,{source:d.getAssetIDByName("debug")}),trailing:e.React.createElement(R.Arrow,null),onPress:function(){return p.push("VendettaCustomPage",{render:mt})}}),t&&e.React.createElement(e.React.Fragment,null,e.React.createElement(ve,{addPadding:!0}),e.React.createElement(R,{label:"Custom Host",subLabel:"Custom URL for the CloudSync backend API",leading:e.React.createElement(R.Icon,{source:d.getAssetIDByName("ic_message_edit")})}),e.React.createElement(Ot,{title:"",keyboardType:"numeric",placeholder:"1",value:T.api,onChange:function(u){return l.host=u},style:{marginTop:-25,marginHorizontal:12}}))),e.React.createElement(W,{title:"Authentication",icon:d.getAssetIDByName("lock")},D()?e.React.createElement(e.React.Fragment,null,e.React.createElement(R,{label:"Log out",subLabel:"Logs you out of CloudSync",leading:e.React.createElement(R.Icon,{source:d.getAssetIDByName("ic_logout_24px")}),onPress:function(){var u;(u=l).auth??(u.auth={}),delete l.auth[Ue.getCurrentUser().id],delete m.save,E.showToast("Successfully logged out",d.getAssetIDByName("ic_logout_24px"))}}),e.React.createElement(R,{label:"Delete data",subLabel:"Deletes your CloudSync data",leading:e.React.createElement(R.Icon,{source:d.getAssetIDByName("trash")}),onPress:async function(){var u;await ht(),(u=l).auth??(u.auth={}),delete l.auth[Ue.getCurrentUser().id],delete m.save,E.showToast("Successfully deleted data",d.getAssetIDByName("trash"))}})):e.React.createElement(R,{label:"Authenticate",leading:e.React.createElement(R.Icon,{source:d.getAssetIDByName("copy")}),trailing:R.Arrow,onPress:vt})),e.React.createElement(W,{title:"Data Management",icon:d.getAssetIDByName("ic_message_edit"),padding:!f||!g},f&&g?e.React.createElement(e.React.Fragment,null,e.React.createElement(R,{label:"Save Data",subLabel:"Saves your data to the CloudSync API",leading:n.includes("save_api")?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small"}):e.React.createElement(R.Icon,{source:d.getAssetIDByName("ic_file_upload_24px")}),onPress:function(){L.showConfirmationAlert({title:"Save data",content:"Are you sure you want to overwrite your save data?",confirmText:"Overwrite",confirmColor:"BRAND",onConfirm:async function(){i("save_api");try{m.save=await _e(await De()),E.showToast("Successfully synced data",d.getAssetIDByName("Check"))}catch(u){E.showToast(String(u),d.getAssetIDByName("Small"))}c("save_api")},cancelText:"Cancel"})}}),e.React.createElement(R,{label:"Import Data",subLabel:"Imports data from the CloudSync API",leading:n.includes("import_api")?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small"}):e.React.createElement(R.Icon,{source:d.getAssetIDByName("ic_download_24px")}),onPress:function(){te(ce,{navigation:p}),$e(function(u){return u?i("import_api"):c("import_api")})}}),e.React.createElement(ve,{addPadding:!0}),e.React.createElement(R,{label:"Export Local Data",subLabel:"Exports data to a .txt file",leading:n.includes("export_local")?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small"}):e.React.createElement(R.Icon,{source:d.getAssetIDByName("ic_file_upload_24px")}),onPress:async function(){L.showInputAlert({title:"Enter encryption key",placeholder:"secret password",confirmText:"Enter",cancelText:"Cancel",onConfirm:async function(u){if(!u)throw new Error("An encryption key must be set");if(n.length)return;i("local_export");let y;try{y=await Bt(JSON.stringify(m.save),u)}catch{return c("local_export"),E.showToast("Failed to encrypt!",d.getAssetIDByName("Small"))}E.showToast("Downloading file in your browser",d.getAssetIDByName("Check")),e.url.openURL(`${T.api}api/download?data=${encodeURIComponent(y)}`),c("local_export")}})}}),e.React.createElement(R,{label:"Import Local Data",subLabel:"Imports data from a .txt file",leading:n.includes("import_local")?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small"}):e.React.createElement(R.Icon,{source:d.getAssetIDByName("ic_download_24px")}),onPress:async function(){if(n.length)return;i("import_local");let u;try{const{uri:y,type:S}=await le.pickSingle({type:le.types.plainText,mode:"open"});S==="text/plain"&&(u=await(await fetch(y)).text())}catch(y){le.isCancel(y)||E.showToast(`Got an error! ${y}`,d.getAssetIDByName("Small"))}c("import_local"),u&&L.showInputAlert({title:"Enter decryption key",placeholder:"secret password",cancelText:"Cancel",confirmText:"Enter",onConfirm:async function(y){if(!y)throw new Error("A decryption key must be set");if(!n.length){i("import_local");try{const S=JSON.parse(await xt(u,y));te(ce,{save:S,navigation:p}),c("import_local"),$e(function(h){return h?i("import_local"):c("import_local")})}catch{return c("import_local"),E.showToast("Failed to decrypt!",d.getAssetIDByName("Small"))}}}})}})):f?e.React.createElement(e.ReactNative.ActivityIndicator,{size:"small",style:{flex:1}}):e.React.createElement(M,{variant:"text-md/semibold",color:"TEXT_NORMAL",align:"center"},"Authenticate first to manage your data")),e.React.createElement(Me,{style:{height:12}}))}let Ve=0;function Mt(t){clearTimeout(Ve),Ve=setTimeout(t,1500)}const{FormRow:de}=v.Forms;function Ft(){const t=e.NavigationNative.useNavigation();return React.createElement(v.ErrorBoundary,null,React.createElement(de,{label:"Cloud Sync",leading:React.createElement(de.Icon,{source:d.getAssetIDByName("ic_contact_sync")}),trailing:de.Arrow,onPress:function(){return t.push("VendettaCustomPage",{title:"CloudSync",render:ue})}}))}const{FormSection:Ut}=v.Forms,Vt=s.findByName("getScreens"),Gt=s.findByName("UserSettingsOverviewWrapper",!1),jt=e.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:w.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function zt(t,r,n){const a=[],i=B.after("default",Gt,function(c,o){i();const p=Z.findInReactTree(o.props.children,function(f){return f.type&&f.type.name==="UserSettingsOverview"});a.push(B.after("render",p.type.prototype,function(f,g){let{props:{children:u}}=g;const y=[e.i18n.Messages.BILLING_SETTINGS,e.i18n.Messages.PREMIUM_SETTINGS];u=Z.findInReactTree(u,function(h){return h.children[1].type===Ut}).children;const S=u.findIndex(function(h){return y.includes(h?.props.label)});t()&&u.splice(S===-1?4:S,0,r({}))}))},!0);if(a.push(i),Vt&&n){const c=`VENDETTA_PLUGIN_${e.lodash.snakeCase(n.key).toUpperCase()}`,o=n.page.render,p=e.React.memo(function(y){let{navigation:S}=y;const h=S.addListener("focus",function(){h(),S.setOptions(Z.without(n.page,"noErrorBoundary","render"))});return e.React.createElement(e.ReactNative.View,{style:jt.container},n.page.noErrorBoundary?e.React.createElement(o,null):e.React.createElement(v.ErrorBoundary,null,e.React.createElement(o,null)))}),f={[c]:{type:"route",title:typeof n.title=="function"?n.title:function(){return n.title},icon:n.icon,screen:{route:`VendettaPlugin${e.lodash.chain(n.key).camelCase().upperFirst().value()}`,getComponent:function(){return p}}}},g=function(y,S){const h=[...y],I=S?h?.[0]?.sections:h;if(!Array.isArray(I))return h;const $="Vendetta",O=I.find(function(k){return k?.title===$});return O&&O.settings.push(c),h},u=function(){const y=s.findByProps("useOverviewSettings"),S=s.findByProps("getSettingTitleConfig"),h=s.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),I="getSettingSearchListItems",$="getSettingListItems",O=s.findByProps(I),k=O?I:$,je=O??s.findByProps($);if(!je||!y)return!1;a.push(B.after("useOverviewSettings",y,function(he,H){return g(H,!1)})),a.push(B.after("getSettingTitleConfig",S,function(he,H){return{...H,[c]:typeof n.title=="function"?n.title():n.title}})),a.push(B.after(k,je,function(he,H){let[Kt]=he;return[...Kt.includes(c)?[{type:"setting_search_result",ancestorRendererData:f[c],setting:c,title:typeof n.title=="function"?n.title():n.title,breadcrumbs:["Vendetta"],icon:f[c].icon}]:[],...H]}));const ye=h.SETTING_RELATIONSHIPS,Jt=h.SETTING_RENDERER_CONFIGS;return h.SETTING_RELATIONSHIPS={...ye,[c]:null},h.SETTING_RENDERER_CONFIGS={...Jt,...f},a.push(function(){h.SETTING_RELATIONSHIPS=ye,h.SETTING_RENDERER_CONFIGS=ye}),!0};(function(){const y=s.findByProps("SearchableSettingsList"),S=s.findByProps("SETTING_RENDERER_CONFIG"),h=s.findByProps("getSettingListItems");if(!h||!y||!S)return!1;a.push(B.before("type",y.SearchableSettingsList,function($){return g($,!0)})),a.push(B.after("getSettingListSearchResultItems",h,function($,O){for(const k of O)k.setting===c&&(k.breadcrumbs=["Vendetta"])}));const I=S.SETTING_RENDERER_CONFIG;return S.SETTING_RENDERER_CONFIG={...I,...f},a.push(function(){S.SETTING_RENDERER_CONFIG=I}),!0})()||u()}return function(){return a.forEach(function(c){return c()})}}function Ht(){let t=[];return t.push(zt(function(){return l.addToSettings},function(){return React.createElement(Ft,null)},{key:Re.plugin.manifest.name,icon:d.getAssetIDByName("ic_contact_sync"),title:"Cloud Sync",page:{title:"CloudSync",render:ue}})),function(){return t.forEach(function(r){return r()})}}const l=q.storage;let Ge;const m=b.wrapSync(b.createStorage({get:function(){return Ge},set:function(t){Ge=t}}));async function fe(){try{m.save=await yt()}catch{}}function j(t){return t.startsWith(ze.PROXY_PREFIX)}function z(t){return!t.includes("cloud-sync")}const A=async function(){if(!l.autoSync)return;const t=await De();JSON.stringify(m.save)!==JSON.stringify(t)&&Mt(async function(){return m.save=await _e(t)})},Q=Symbol.for("vendetta.storage.emitter"),ge=!!P.plugins[Q]&&!!_.themes[Q];let pe=[];var Wt={onLoad:function(){if(D()&&fe(),ge){const t={plugins:P.plugins[Q],themes:_.themes[Q]};t.plugins.on("SET",A),t.themes.on("SET",A),t.plugins.on("DEL",A),t.themes.on("DEL",A),pe.push(function(){t.plugins.off("SET",A),t.themes.off("SET",A),t.plugins.off("DEL",A),t.themes.off("DEL",A)})}pe.push(Ht()),q.storage.databaseMigrate&&delete q.storage.databaseMigrate},onUnload:function(){return pe.forEach(function(t){return t()})},settings:ue};return C.cache=m,C.canImport=z,C.default=Wt,C.emitterAvailable=ge,C.fillCache=fe,C.isPluginProxied=j,C.vstorage=l,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.plugin,vendetta.storage,vendetta.metro,vendetta.plugins,vendetta.themes,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.alerts,vendetta.metro.common,vendetta.ui,vendetta.ui.components,vendetta.patcher,vendetta.utils,vendetta,vendetta.constants);
