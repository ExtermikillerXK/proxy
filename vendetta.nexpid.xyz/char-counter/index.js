(function(B,Y,s,E,D,t,I,k,N,he,f,S){"use strict";const Q=s.findByStoreName("UserStore");function O(e){return a.display==="length"?w(e):a.display==="remaining"?w(_()-e):`${w(e)}/${w(_())}`}function w(e){return a.commas===!1?e.toString():e.toString().split("").reverse().map(function(i,r,l){return r%3===0&&l.length>3&&r!==0?`${i},`:i}).reverse().join("")}function G(){return!!(a.supportSLM!==!1&&Object.values(k.plugins).find(function(e){return e.manifest.name==="SplitLargeMessages"})?.enabled)}function _(){return Q.getCurrentUser()?.premiumType===2?4e3:2e3}const{Animated:M}=t.ReactNative;function V(e){let{duration:i,children:r,style:l,fade:n,trigger:o,customOpacity:p,setDisplay:R,animateOnInit:d}=e;d??(d=!0);const y=t.React.useRef(!0),A=t.React.useRef(!0),c=t.React.useRef(new M.Value(d&&n==="in"?1:0)).current,[h,b]=t.React.useState(d?n!=="in":!0);return t.React.useEffect(function(){const m=c.addListener(function(Re){let{value:ye}=Re;b(ye<=.1)});return function(){return c.removeListener(m)}},[]),t.React.useEffect(function(){if(!d&&y.current){y.current=!1;return}!d&&A.current&&(c.setValue(n==="in"?0:1),A.current=!1),M.timing(c,{toValue:p??(n==="in"?1:0),duration:i,useNativeDriver:!0}).start()},[c,n,p,o]),t.React.createElement(M.View,{style:[{opacity:c},R&&h&&{display:"none"},l]},r)}const K=s.findByStoreName("ThemeStore"),J=s.findByProps("colors","meta");s.findByProps("triggerHaptic");const H=s.findByProps("TextStyleSheet").TextStyleSheet,{View:v,Text:U,Pressable:q}=I.General;s.findByProps("TableRow"),s.findByProps("ActionSheet")?.ActionSheet??s.find(function(e){return e.render?.name==="ActionSheet"}),s.findByProps("openLazy","hideActionSheet"),s.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),s.findByProps("ActionSheetRow")?.ActionSheetRow,s.findByName("Navigator")??s.findByProps("Navigator")?.Navigator,s.findByProps("getRenderCloseButton")?.getRenderCloseButton??s.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,s.findByProps("popModal","pushModal");const F=s.findByProps("useSearchControls"),z=s.findByProps("useSettingSearchQuery"),Z=s.findByName("SettingSearchBar");s.findByProps("SvgXml"),s.findByProps("useInMainTabsExperiment","isInMainTabsExperiment"),s.find(function(e){return e?.WebView&&!e.default}).WebView;function ee(e){return J.meta.resolveSemanticColor(K.theme,e)}Object.assign(function(e){let{searchContext:i,controls:r}=e;return t.React.createElement(t.ReactNative.ScrollView,{scrollEnabled:!1},t.React.createElement(F.default,{searchContext:i,controls:r},t.React.createElement(Z,null)))},{useAdvancedSearch:function(e){const i=z.useSettingSearchQuery(),r=F.useSearchControls(e,!1,function(){});return t.React.useEffect(function(){return function(){z.setSettingSearchQuery(""),z.setIsSettingSearchActive(!1)}},[]),[i,r]}});function te(e){let{title:i,onPress:r,icon:l}=e;const n=t.stylesheet.createThemedStyleSheet({androidRipple:{color:f.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:f.semanticColors.HEADER_SECONDARY,opacity:.5}}),o=r?q:v;return t.React.createElement(o,{android_ripple:n.androidRipple,disabled:!1,accessibilityRole:"button",onPress:r,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},l&&t.React.createElement(v,{style:{marginRight:4}},t.React.createElement(t.ReactNative.Image,{style:n.icon,source:l,resizeMode:"contain"})),t.React.createElement(C,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},i))}function ne(e){let{title:i,onTitlePress:r,icon:l,children:n,padding:o}=e;const p=t.stylesheet.createThemedStyleSheet({main:{backgroundColor:f.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return t.React.createElement(v,{style:{marginHorizontal:16,marginTop:16}},t.React.createElement(te,{title:i,onPress:r,icon:l}),t.React.createElement(v,{style:p.main},o?t.React.createElement(v,{style:{paddingHorizontal:16,paddingVertical:16}},n):n))}var $;(function(e){function i(l){let{children:n,onPress:o}=l;return t.React.createElement(C,{variant:"text-md/bold",onPress:o},n)}e.Bold=i;function r(l){let{children:n,onPress:o}=l;return t.React.createElement(U,{style:{textDecorationLine:"underline"},onPress:o},n)}e.Underline=r})($||($={}));function C(e){let{variant:i,lineClamp:r,color:l,align:n,style:o,onPress:p,getChildren:R,children:d,liveUpdate:y}=e;const[A,c]=t.React.useReducer(function(h){return~h},0);return t.React.useEffect(function(){if(!y)return;const h=new Date().setMilliseconds(1e3);let b,m;return m=setTimeout(function(){c(),b=setInterval(c,1e3)},h-Date.now()),function(){clearTimeout(m),clearInterval(b)}},[]),t.React.createElement(U,{style:[i?H[i]:{},l?{color:ee(f.semanticColors[l])}:{},n?{textAlign:n}:{},o??{}],numberOfLines:r,onPress:p},R?.()??d)}const{View:re,Pressable:ae}=I.General,T=H["text-xs/semibold"].fontSize,P=t.stylesheet.createThemedStyleSheet({androidRipple:{color:f.semanticColors.ANDROID_RIPPLE,cornerRadius:8},container:{backgroundColor:f.semanticColors.BACKGROUND_TERTIARY,borderRadius:8,marginRight:8,marginTop:-12},text:{...H["text-xs/semibold"],textAlign:"right",paddingHorizontal:8,paddingVertical:8},extraMessagesCircle:{backgroundColor:f.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:2147483647,position:"absolute",left:0,top:0,transform:[{translateX:-T},{translateY:-T}],minWidth:T*2,height:T*2,justifyContent:"center",alignItems:"center",zIndex:2}});function ie(e){let{inputProps:i}=e;const[r,l]=t.React.useState(!1),[n,o]=t.React.useState("");L.value=n,E.after("onChangeText",i,function(b){let[m]=b;return o(m)},!0);const p=n.length,R=_(),d=G()?Math.floor(p/R):0,y=p-d*R,A=P.text.fontSize*2+P.text.paddingVertical,c=p>=(a.minChars??1),h=c?ae:re;return t.React.createElement(V,{duration:100,style:{flexDirection:"row-reverse",position:"absolute",right:0,top:-A,zIndex:1},fade:c?"in":"out",customOpacity:r&&c?.3:void 0},t.React.createElement(h,{android_ripple:P.androidRipple,disabled:!1,accessibilityRole:"button",accessibilityState:{disabled:!1,expanded:!1},accessibilityLabel:"Character counter",accessibilityHint:"Tap to toggle character counter translucency",style:P.container,onPress:c?function(){return l(!r)}:void 0},t.React.createElement(V,{fade:d>0&&c?"in":"out",duration:100,style:P.extraMessagesCircle},t.React.createElement(C,{variant:"text-xs/semibold",color:"TEXT_NORMAL",style:{paddingHorizontal:T/2}},d)),t.React.createElement(C,{variant:"text-xs/semibold",color:y<=R?"TEXT_NORMAL":"TEXT_DANGER",style:{paddingHorizontal:8,paddingVertical:8}},O(y))))}const le=t.stylesheet.createThemedStyleSheet({container:{textAlign:"center",paddingBottom:2,paddingRight:5,marginTop:-5}});function se(){N.useProxy(L);const e=L.value.length,i=_(),r=G()?Math.floor(e/i):0,l=e-r*i,n=e>=(a.minChars??1);return t.React.createElement(V,{duration:100,style:le.container,fade:n?"in":"out",setDisplay:!0},t.React.createElement(C,{variant:"text-xs/semibold",color:l<=i?"TEXT_NORMAL":"TEXT_DANGER"},O(l)))}const{ChatInput:oe}=s.findByProps("ChatInput"),{MessagesWrapper:ce}=s.findByProps("MessagesWrapper");let g=[],X={value:""};const L=N.wrapSync(N.createStorage({get:function(){return X},set:function(e){X=e}}));function ue(){return g.push(E.after("render",oe.prototype,function(e,i){const r=D.findInReactTree(i.props.children,function(n){return n?.type?.name==="ChatInput"})?.props;if(!r?.onChangeText)return;const l=D.findInReactTree(i.props.children,function(n){return n?.type?.displayName==="View"&&Array.isArray(n?.props?.children)})?.props?.children;l&&(a.position==="pill"?l.unshift(t.React.createElement(ie,{inputProps:r})):g.push(E.after("onChangeText",r,function(n){let[o]=n;return L.value=o})))})),g.push(E.after("render",ce.prototype,function(e,i){const r=D.findInReactTree(i,function(l){return l?.type?.name==="JumpToPresentButton"});r&&g.push(E.after("type",r,function(l,n){n?.props?.style&&a.position==="pill"&&(n.props.style[1].bottom+=32+8)}))})),g.push(E.before("render",t.ReactNative.View,function(e){const i=[...e],[r]=i;if(r.children?.[0]?.type?.name==="TextInputWrapper"&&a.position==="inside"){const l=r.children[1].props.children;l[1].props.children=t.React.createElement(t.React.Fragment,{}),l.splice(1,0,t.React.createElement(se,{}))}return i})),function(){g.forEach(function(e){return e()}),g=[]}}const{ScrollView:de}=I.General,{FormSwitchRow:j,FormRadioRow:x,FormRow:u,FormInput:pe}=I.Forms;function fe(){var e,i,r,l,n;return(e=a).position??(e.position="pill"),(i=a).display??(i.display="full"),(r=a).commas??(r.commas=!0),(l=a).minChars??(l.minChars=1),(n=a).supportSLM??(n.supportSLM=!0),N.useProxy(a),React.createElement(de,null,React.createElement(ne,{title:"Settings",icon:S.getAssetIDByName("ic_cog_24px")},React.createElement(u,{label:"Position",subLabel:"Choose where Char Counter will appear",leading:React.createElement(u.Icon,{source:S.getAssetIDByName("ic_message_edit")})}),React.createElement(x,{label:"Floating Pill",onPress:function(){return a.position="pill"},trailing:React.createElement(u.Arrow,null),selected:a.position==="pill",style:{marginHorizontal:12}}),React.createElement(x,{label:"Inside Textbox",onPress:function(){return a.position="inside"},trailing:React.createElement(u.Arrow,null),selected:a.position==="inside",style:{marginHorizontal:12}}),React.createElement(u,{label:"Display Type",subLabel:"Choose how the char counter text appears",leading:React.createElement(u.Icon,{source:S.getAssetIDByName("ic_message_edit")})}),React.createElement(x,{label:"Full",subLabel:"100/300",onPress:function(){return a.display="full"},trailing:React.createElement(u.Arrow,null),selected:a.display==="full",style:{marginHorizontal:12}}),React.createElement(x,{label:"Length",subLabel:"100",onPress:function(){return a.display="length"},trailing:React.createElement(u.Arrow,null),selected:a.display==="length",style:{marginHorizontal:12}}),React.createElement(x,{label:"Remaining",subLabel:"200",onPress:function(){return a.display="remaining"},trailing:React.createElement(u.Arrow,null),selected:a.display==="remaining",style:{marginHorizontal:12}}),React.createElement(u,{label:"Minimum Characters",subLabel:"The minimum amount of characters for Char Counter to show up",leading:React.createElement(u.Icon,{source:S.getAssetIDByName("ic_message_edit")})}),React.createElement(pe,{title:"",keyboardType:"numeric",placeholder:"1",value:a.minChars.toString(),onChange:function(o){return a.minChars=Math.max(Number.isNaN(Number(o))?1:Number(o),1)},style:{marginTop:-25,marginHorizontal:12}}),React.createElement(j,{label:"Add Thousand Seperators",subLabel:"Adds thousand seperators (1,234,567) to numbers",leading:React.createElement(u.Icon,{source:S.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return a.commas=!a.commas},value:a.commas}),React.createElement(j,{label:"Support SplitLargeMessages",leading:React.createElement(u.Icon,{source:S.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return a.supportSLM=!a.supportSLM},value:a.supportSLM})))}const a=Y.storage;let W;var ge={onLoad:function(){return W=ue()},onUnload:function(){return W?.()},settings:fe};return B.default=ge,B.vstorage=a,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.plugin,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.metro.common,vendetta.ui.components,vendetta.plugins,vendetta.storage,vendetta,vendetta.ui,vendetta.ui.assets);
