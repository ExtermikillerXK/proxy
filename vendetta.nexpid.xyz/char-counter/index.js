(function(P,X,l,m,_,e,I,Y,N,Re,R,T){"use strict";const j=l.findByStoreName("UserStore");function B(t){return s.commas?t.toString().split("").reverse().map(function(a,i,r){return i%3===0&&r.length>3&&i!==0?`${a},`:a}).reverse().join(""):t.toString()}function L(){return!!(s.supportSLM&&Object.values(Y.plugins).find(function(t){return t.manifest.name==="SplitLargeMessages"})?.enabled)}function O(){return j.getCurrentUser()?.premiumType===2?4e3:2e3}const{Animated:w}=e.ReactNative;function M(t){let{duration:a,children:i,style:r,fade:n,trigger:o,customOpacity:u,setDisplay:f,animateOnInit:d}=t;d??=!0;const h=e.React.useRef(!0),A=e.React.useRef(!0),c=e.React.useRef(new w.Value(d&&n==="in"?1:0)).current,[y,E]=e.React.useState(!1);return e.React.useEffect(function(){const S=c.addListener(function(pe){let{value:fe}=pe;E(fe<=.1)});return function(){return c.removeListener(S)}},[]),e.React.useEffect(function(){if(!d&&h.current){h.current=!1;return}!d&&A.current&&(c.setValue(n==="in"?0:1),A.current=!1),w.timing(c,{toValue:u??(n==="in"?1:0),duration:a,useNativeDriver:!0}).start()},[c,n,u,o]),e.React.createElement(w.View,{style:[{opacity:c},f&&y&&{display:"none"},r]},i)}const k=l.findByStoreName("ThemeStore"),W=l.findByProps("colors","meta");l.findByProps("triggerHaptic");const{TextStyleSheet:K}=l.findByProps("TextStyleSheet"),{View:b,Text:V,Pressable:J}=I.General;l.findByProps("ActionSheet")?.ActionSheet??l.find(function(t){return t.render?.name==="ActionSheet"}),l.findByProps("openLazy","hideActionSheet"),l.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),l.findByName("Navigator"),l.findByProps("getRenderCloseButton"),l.findByProps("popModal","pushModal");function q(t){return W.meta.resolveSemanticColor(k.theme,t)}function Q(t){let{title:a,onPress:i,icon:r}=t;const n=e.stylesheet.createThemedStyleSheet({androidRipple:{color:R.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:R.semanticColors.HEADER_SECONDARY,opacity:.5}}),o=i?J:b;return e.React.createElement(o,{android_ripple:n.androidRipple,disabled:!1,accessibilityRole:"button",onPress:i,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},r&&e.React.createElement(b,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:n.icon,source:r,resizeMode:"contain"})),e.React.createElement(v,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},a))}function Z(t){let{title:a,onTitlePress:i,icon:r,children:n,padding:o}=t;const u=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:R.semanticColors.BACKGROUND_TERTIARY,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(b,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(Q,{title:a,onPress:i,icon:r}),e.React.createElement(b,{style:u.main},o?e.React.createElement(b,{style:{paddingHorizontal:16,paddingVertical:16}},n):n))}var z;(function(t){function a(r){let{children:n,onPress:o}=r;return e.React.createElement(v,{variant:"text-md/bold",onPress:o},n)}t.Bold=a;function i(r){let{children:n,onPress:o}=r;return e.React.createElement(V,{style:{textDecorationLine:"underline"},onPress:o},n)}t.Underline=i})(z||(z={}));function v(t){let{variant:a,lineClamp:i,color:r,align:n,style:o,onPress:u,getChildren:f,children:d,liveUpdate:h}=t;const[A,c]=e.React.useReducer(function(y){return~y},0);return e.React.useEffect(function(){if(!h)return;const y=new Date().setMilliseconds(1e3);let E,S;return S=setTimeout(function(){c(),E=setInterval(c,1e3)},y-Date.now()),function(){clearTimeout(S),clearInterval(E)}},[]),e.React.createElement(V,{style:[a?K[a]:{},r?{color:q(R.semanticColors[r])}:{},n?{textAlign:n}:{},o??{}],numberOfLines:i,onPress:u},f?.()??d)}const{View:ee,Pressable:te}=I.General,{TextStyleSheet:H}=l.findByProps("TextStyleSheet"),C=H["text-xs/semibold"].fontSize,x=e.stylesheet.createThemedStyleSheet({androidRipple:{color:R.semanticColors.ANDROID_RIPPLE,cornerRadius:8},container:{backgroundColor:R.semanticColors.BACKGROUND_TERTIARY,borderRadius:8,marginRight:8,marginTop:-12},text:{...H["text-xs/semibold"],textAlign:"right",paddingHorizontal:8,paddingVertical:8},extraMessagesCircle:{backgroundColor:R.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:2147483647,position:"absolute",left:0,top:0,transform:[{translateX:-C},{translateY:-C}],minWidth:C*2,height:C*2,justifyContent:"center",alignItems:"center",zIndex:2}});function ne(t){let{inputProps:a}=t;const[i,r]=e.React.useState(!1),[n,o]=e.React.useState("");D.value=n,m.after("onChangeText",a,function(E){let[S]=E;return o(S)},!0);const u=n.length,f=O(),d=L()?Math.floor(u/f):0,h=u-d*f,A=x.text.fontSize*2+x.text.paddingVertical,c=u>=(s.minChars??1),y=c?te:ee;return e.React.createElement(M,{duration:100,style:{flexDirection:"row-reverse",position:"absolute",right:0,top:-A,zIndex:1},fade:c?"in":"out",customOpacity:i&&c?.3:void 0},e.React.createElement(y,{android_ripple:x.androidRipple,disabled:!1,accessibilityRole:"button",accessibilityState:{disabled:!1,expanded:!1},accessibilityLabel:"Character counter",accessibilityHint:"Tap to toggle character counter translucency",style:x.container,onPress:c?function(){return r(!i)}:void 0},e.React.createElement(M,{fade:d>0&&c?"in":"out",duration:100,style:x.extraMessagesCircle},e.React.createElement(v,{variant:"text-xs/semibold",color:"TEXT_NORMAL",style:{paddingHorizontal:C/2}},d)),e.React.createElement(v,{variant:"text-xs/semibold",color:h<=f?"TEXT_NORMAL":"TEXT_DANGER",style:{paddingHorizontal:8,paddingVertical:8}},B(h),"/",B(f))))}const re=e.stylesheet.createThemedStyleSheet({container:{textAlign:"center",paddingBottom:2,paddingRight:5,marginTop:-5}});function ae(){N.useProxy(D);const t=D.value.length,a=O(),i=L()?Math.floor(t/a):0,r=t-i*a,n=t>=(s.minChars??1);return e.React.createElement(M,{duration:100,style:re.container,fade:n?"in":"out",setDisplay:!0},e.React.createElement(v,{variant:"text-xs/semibold",color:r<=a?"TEXT_NORMAL":"TEXT_DANGER"},B(r),"/",B(a)))}const{ChatInput:ie}=l.findByProps("ChatInput"),{MessagesWrapper:se}=l.findByProps("MessagesWrapper");let g=[],G={value:""};const D=N.wrapSync(N.createStorage({get:function(){return G},set:function(t){G=t}}));function le(){return g.push(m.after("render",ie.prototype,function(t,a){const i=_.findInReactTree(a.props.children,function(n){return n?.type?.name==="ChatInput"})?.props;if(!i?.onChangeText)return;const r=_.findInReactTree(a.props.children,function(n){return n?.type?.displayName==="View"&&Array.isArray(n?.props?.children)})?.props?.children;r&&(s.position==="pill"?r.unshift(e.React.createElement(ne,{inputProps:i})):g.push(m.after("onChangeText",i,function(n){let[o]=n;return D.value=o})))})),g.push(m.after("render",se.prototype,function(t,a){const i=_.findInReactTree(a,function(r){return r?.type?.name==="JumpToPresentButton"});i&&g.push(m.after("type",i,function(r,n){n?.props?.style&&s.position==="pill"&&(n.props.style[1].bottom+=32+8)}))})),g.push(m.before("render",e.ReactNative.View,function(t){const a=[...t],[i]=a;if(i.children?.[0]?.type?.name==="TextInputWrapper"&&s.position==="inside"){const r=i.children[1].props.children;r[1].props.children=e.React.createElement(e.React.Fragment,{}),r.splice(1,0,e.React.createElement(ae,{}))}return a})),function(){g.forEach(function(t){return t()}),g=[]}}const{ScrollView:oe}=I.General,{FormSwitchRow:$,FormRadioRow:U,FormRow:p,FormInput:ce}=I.Forms;function ue(){return s.position??="pill",s.commas??=!0,s.minChars??=1,s.supportSLM??=!0,N.useProxy(s),React.createElement(oe,null,React.createElement(Z,{title:"Settings",icon:T.getAssetIDByName("ic_cog_24px")},React.createElement(p,{label:"Position",subLabel:"Choose where Char Counter will appear",leading:React.createElement(p.Icon,{source:T.getAssetIDByName("ic_message_edit")})}),React.createElement(U,{label:"Floating Pill",onPress:function(){return s.position="pill"},trailing:React.createElement(p.Arrow,null),selected:s.position==="pill",style:{marginHorizontal:12}}),React.createElement(U,{label:"Inside Textbox",onPress:function(){return s.position="inside"},trailing:React.createElement(p.Arrow,null),selected:s.position==="inside",style:{marginHorizontal:12}}),React.createElement(p,{label:"Minimum Characters",subLabel:"The minimum amount of characters for Char Counter to show up",leading:React.createElement(p.Icon,{source:T.getAssetIDByName("ic_message_edit")})}),React.createElement(ce,{title:"",keyboardType:"numeric",placeholder:"1",value:s.minChars.toString(),onChange:function(t){return s.minChars=Math.max(Number.isNaN(Number(t))?1:Number(t),1)},style:{marginTop:-25,marginHorizontal:12}}),React.createElement($,{label:"Add Thousand Seperators",subLabel:"Adds thousand seperators (1,234,567) to numbers",leading:React.createElement(p.Icon,{source:T.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return s.commas=!s.commas},value:s.commas}),React.createElement($,{label:"Support SplitLargeMessages",leading:React.createElement(p.Icon,{source:T.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return s.supportSLM=!s.supportSLM},value:s.supportSLM})))}const s=X.storage;let F;var de={onLoad:function(){return F=le()},onUnload:function(){return F?.()},settings:ue};return P.default=de,P.vstorage=s,Object.defineProperty(P,"__esModule",{value:!0}),P})({},vendetta.plugin,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.metro.common,vendetta.ui.components,vendetta.plugins,vendetta.storage,vendetta,vendetta.ui,vendetta.ui.assets);
