(function(B,Y,s,m,L,e,I,j,N,Re,f,E){"use strict";const k=s.findByStoreName("UserStore");function z(t){return r.display==="length"?_(t):r.display==="remaining"?_(w()-t):`${_(t)}/${_(w())}`}function _(t){return r.commas===!1?t.toString():t.toString().split("").reverse().map(function(l,i,a){return i%3===0&&a.length>3&&i!==0?`${l},`:l}).reverse().join("")}function V(){return!!(r.supportSLM!==!1&&Object.values(j.plugins).find(function(t){return t.manifest.name==="SplitLargeMessages"})?.enabled)}function w(){return k.getCurrentUser()?.premiumType===2?4e3:2e3}const{Animated:M}=e.ReactNative;function H(t){let{duration:l,children:i,style:a,fade:n,trigger:o,customOpacity:p,setDisplay:R,animateOnInit:d}=t;d??(d=!0);const y=e.React.useRef(!0),A=e.React.useRef(!0),c=e.React.useRef(new M.Value(d&&n==="in"?1:0)).current,[h,b]=e.React.useState(d?n!=="in":!0);return e.React.useEffect(function(){const S=c.addListener(function(fe){let{value:ge}=fe;b(ge<=.1)});return function(){return c.removeListener(S)}},[]),e.React.useEffect(function(){if(!d&&y.current){y.current=!1;return}!d&&A.current&&(c.setValue(n==="in"?0:1),A.current=!1),M.timing(c,{toValue:p??(n==="in"?1:0),duration:l,useNativeDriver:!0}).start()},[c,n,p,o]),e.React.createElement(M.View,{style:[{opacity:c},R&&h&&{display:"none"},a]},i)}const W=s.findByStoreName("ThemeStore"),K=s.findByProps("colors","meta");s.findByProps("triggerHaptic");const{TextStyleSheet:J}=s.findByProps("TextStyleSheet"),{View:C,Text:O,Pressable:q}=I.General;s.findByProps("ActionSheet")?.ActionSheet??s.find(function(t){return t.render?.name==="ActionSheet"}),s.findByProps("openLazy","hideActionSheet"),s.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),s.findByProps("ActionSheetRow")?.ActionSheetRow,s.findByName("Navigator")??s.findByProps("Navigator")?.Navigator,s.findByProps("getRenderCloseButton")?.getRenderCloseButton??s.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,s.findByProps("popModal","pushModal"),s.findByProps("SvgXml");function Q(t){return K.meta.resolveSemanticColor(W.theme,t)}function Z(t){let{title:l,onPress:i,icon:a}=t;const n=e.stylesheet.createThemedStyleSheet({androidRipple:{color:f.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:f.semanticColors.HEADER_SECONDARY,opacity:.5}}),o=i?q:C;return e.React.createElement(o,{android_ripple:n.androidRipple,disabled:!1,accessibilityRole:"button",onPress:i,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},a&&e.React.createElement(C,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:n.icon,source:a,resizeMode:"contain"})),e.React.createElement(T,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},l))}function ee(t){let{title:l,onTitlePress:i,icon:a,children:n,padding:o}=t;const p=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:f.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(C,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(Z,{title:l,onPress:i,icon:a}),e.React.createElement(C,{style:p.main},o?e.React.createElement(C,{style:{paddingHorizontal:16,paddingVertical:16}},n):n))}var $;(function(t){function l(a){let{children:n,onPress:o}=a;return e.React.createElement(T,{variant:"text-md/bold",onPress:o},n)}t.Bold=l;function i(a){let{children:n,onPress:o}=a;return e.React.createElement(O,{style:{textDecorationLine:"underline"},onPress:o},n)}t.Underline=i})($||($={}));function T(t){let{variant:l,lineClamp:i,color:a,align:n,style:o,onPress:p,getChildren:R,children:d,liveUpdate:y}=t;const[A,c]=e.React.useReducer(function(h){return~h},0);return e.React.useEffect(function(){if(!y)return;const h=new Date().setMilliseconds(1e3);let b,S;return S=setTimeout(function(){c(),b=setInterval(c,1e3)},h-Date.now()),function(){clearTimeout(S),clearInterval(b)}},[]),e.React.createElement(O,{style:[l?J[l]:{},a?{color:Q(f.semanticColors[a])}:{},n?{textAlign:n}:{},o??{}],numberOfLines:i,onPress:p},R?.()??d)}const{View:te,Pressable:ne}=I.General,{TextStyleSheet:G}=s.findByProps("TextStyleSheet"),v=G["text-xs/semibold"].fontSize,x=e.stylesheet.createThemedStyleSheet({androidRipple:{color:f.semanticColors.ANDROID_RIPPLE,cornerRadius:8},container:{backgroundColor:f.semanticColors.BACKGROUND_TERTIARY,borderRadius:8,marginRight:8,marginTop:-12},text:{...G["text-xs/semibold"],textAlign:"right",paddingHorizontal:8,paddingVertical:8},extraMessagesCircle:{backgroundColor:f.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:2147483647,position:"absolute",left:0,top:0,transform:[{translateX:-v},{translateY:-v}],minWidth:v*2,height:v*2,justifyContent:"center",alignItems:"center",zIndex:2}});function re(t){let{inputProps:l}=t;const[i,a]=e.React.useState(!1),[n,o]=e.React.useState("");D.value=n,m.after("onChangeText",l,function(b){let[S]=b;return o(S)},!0);const p=n.length,R=w(),d=V()?Math.floor(p/R):0,y=p-d*R,A=x.text.fontSize*2+x.text.paddingVertical,c=p>=(r.minChars??1),h=c?ne:te;return e.React.createElement(H,{duration:100,style:{flexDirection:"row-reverse",position:"absolute",right:0,top:-A,zIndex:1},fade:c?"in":"out",customOpacity:i&&c?.3:void 0},e.React.createElement(h,{android_ripple:x.androidRipple,disabled:!1,accessibilityRole:"button",accessibilityState:{disabled:!1,expanded:!1},accessibilityLabel:"Character counter",accessibilityHint:"Tap to toggle character counter translucency",style:x.container,onPress:c?function(){return a(!i)}:void 0},e.React.createElement(H,{fade:d>0&&c?"in":"out",duration:100,style:x.extraMessagesCircle},e.React.createElement(T,{variant:"text-xs/semibold",color:"TEXT_NORMAL",style:{paddingHorizontal:v/2}},d)),e.React.createElement(T,{variant:"text-xs/semibold",color:y<=R?"TEXT_NORMAL":"TEXT_DANGER",style:{paddingHorizontal:8,paddingVertical:8}},z(y))))}const ae=e.stylesheet.createThemedStyleSheet({container:{textAlign:"center",paddingBottom:2,paddingRight:5,marginTop:-5}});function ie(){N.useProxy(D);const t=D.value.length,l=w(),i=V()?Math.floor(t/l):0,a=t-i*l,n=t>=(r.minChars??1);return e.React.createElement(H,{duration:100,style:ae.container,fade:n?"in":"out",setDisplay:!0},e.React.createElement(T,{variant:"text-xs/semibold",color:a<=l?"TEXT_NORMAL":"TEXT_DANGER"},z(a)))}const{ChatInput:le}=s.findByProps("ChatInput"),{MessagesWrapper:se}=s.findByProps("MessagesWrapper");let g=[],F={value:""};const D=N.wrapSync(N.createStorage({get:function(){return F},set:function(t){F=t}}));function oe(){return g.push(m.after("render",le.prototype,function(t,l){const i=L.findInReactTree(l.props.children,function(n){return n?.type?.name==="ChatInput"})?.props;if(!i?.onChangeText)return;const a=L.findInReactTree(l.props.children,function(n){return n?.type?.displayName==="View"&&Array.isArray(n?.props?.children)})?.props?.children;a&&(r.position==="pill"?a.unshift(e.React.createElement(re,{inputProps:i})):g.push(m.after("onChangeText",i,function(n){let[o]=n;return D.value=o})))})),g.push(m.after("render",se.prototype,function(t,l){const i=L.findInReactTree(l,function(a){return a?.type?.name==="JumpToPresentButton"});i&&g.push(m.after("type",i,function(a,n){n?.props?.style&&r.position==="pill"&&(n.props.style[1].bottom+=32+8)}))})),g.push(m.before("render",e.ReactNative.View,function(t){const l=[...t],[i]=l;if(i.children?.[0]?.type?.name==="TextInputWrapper"&&r.position==="inside"){const a=i.children[1].props.children;a[1].props.children=e.React.createElement(e.React.Fragment,{}),a.splice(1,0,e.React.createElement(ie,{}))}return l})),function(){g.forEach(function(t){return t()}),g=[]}}const{ScrollView:ce}=I.General,{FormSwitchRow:U,FormRadioRow:P,FormRow:u,FormInput:ue}=I.Forms;function de(){var t,l,i,a,n;return(t=r).position??(t.position="pill"),(l=r).display??(l.display="full"),(i=r).commas??(i.commas=!0),(a=r).minChars??(a.minChars=1),(n=r).supportSLM??(n.supportSLM=!0),N.useProxy(r),React.createElement(ce,null,React.createElement(ee,{title:"Settings",icon:E.getAssetIDByName("ic_cog_24px")},React.createElement(u,{label:"Position",subLabel:"Choose where Char Counter will appear",leading:React.createElement(u.Icon,{source:E.getAssetIDByName("ic_message_edit")})}),React.createElement(P,{label:"Floating Pill",onPress:function(){return r.position="pill"},trailing:React.createElement(u.Arrow,null),selected:r.position==="pill",style:{marginHorizontal:12}}),React.createElement(P,{label:"Inside Textbox",onPress:function(){return r.position="inside"},trailing:React.createElement(u.Arrow,null),selected:r.position==="inside",style:{marginHorizontal:12}}),React.createElement(u,{label:"Display Type",subLabel:"Choose how the char counter text appears",leading:React.createElement(u.Icon,{source:E.getAssetIDByName("ic_message_edit")})}),React.createElement(P,{label:"Full",subLabel:"100/300",onPress:function(){return r.display="full"},trailing:React.createElement(u.Arrow,null),selected:r.display==="full",style:{marginHorizontal:12}}),React.createElement(P,{label:"Length",subLabel:"100",onPress:function(){return r.display="length"},trailing:React.createElement(u.Arrow,null),selected:r.display==="length",style:{marginHorizontal:12}}),React.createElement(P,{label:"Remaining",subLabel:"200",onPress:function(){return r.display="remaining"},trailing:React.createElement(u.Arrow,null),selected:r.display==="remaining",style:{marginHorizontal:12}}),React.createElement(u,{label:"Minimum Characters",subLabel:"The minimum amount of characters for Char Counter to show up",leading:React.createElement(u.Icon,{source:E.getAssetIDByName("ic_message_edit")})}),React.createElement(ue,{title:"",keyboardType:"numeric",placeholder:"1",value:r.minChars.toString(),onChange:function(o){return r.minChars=Math.max(Number.isNaN(Number(o))?1:Number(o),1)},style:{marginTop:-25,marginHorizontal:12}}),React.createElement(U,{label:"Add Thousand Seperators",subLabel:"Adds thousand seperators (1,234,567) to numbers",leading:React.createElement(u.Icon,{source:E.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return r.commas=!r.commas},value:r.commas}),React.createElement(U,{label:"Support SplitLargeMessages",leading:React.createElement(u.Icon,{source:E.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return r.supportSLM=!r.supportSLM},value:r.supportSLM})))}const r=Y.storage;let X;var pe={onLoad:function(){return X=oe()},onUnload:function(){return X?.()},settings:de};return B.default=pe,B.vstorage=r,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.plugin,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.metro.common,vendetta.ui.components,vendetta.plugins,vendetta.storage,vendetta,vendetta.ui,vendetta.ui.assets);
