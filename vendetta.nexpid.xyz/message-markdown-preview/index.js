(function(w,O,r,T,D,e,E,y,f,z,pe,fe,G){"use strict";const{Animated:A}=e.ReactNative;function U(t){let{duration:i,children:l,style:a,fade:n,trigger:o,customOpacity:d,setDisplay:h,animateOnInit:p}=t;p??(p=!0);const C=e.React.useRef(!0),N=e.React.useRef(!0),c=e.React.useRef(new A.Value(p&&n==="in"?1:0)).current,[v,S]=e.React.useState(p?n!=="in":!0);return e.React.useEffect(function(){const B=c.addListener(function(ue){let{value:de}=ue;S(de<=.1)});return function(){return c.removeListener(B)}},[]),e.React.useEffect(function(){if(!p&&C.current){C.current=!1;return}!p&&N.current&&(c.setValue(n==="in"?0:1),N.current=!1),A.timing(c,{toValue:d??(n==="in"?1:0),duration:i,useNativeDriver:!0}).start()},[c,n,d,o]),e.React.createElement(A.View,{style:[{opacity:c},h&&v&&{display:"none"},a]},l)}const{ScrollView:$}=y.General,{default:k}=r.findByProps("DCDAutoModerationSystemMessageView","default"),F=r.findByName("MessageRecord"),j=r.findByName("RowManager"),I=r.findByStoreName("SelectedChannelStore"),x=r.findByStoreName("UserStore"),{receiveMessage:Y}=r.findByProps("receiveMessage"),{createBotMessage:K}=r.findByProps("createBotMessage"),{getText:X}=r.findByProps("openSystemKeyboard","getText");function _(){const t=X(I.getChannelId());if(t.trim()!=="")if(s.previewType==="popup")z.showConfirmationAlert({title:"Message Preview",onConfirm:function(){},children:React.createElement($,{style:{marginVertical:12,maxHeight:e.ReactNative.Dimensions.get("window").height*.7}},React.createElement(k,{rowGenerator:new j,message:new F({id:"0",channel_id:I.getChannelId(),author:x.getCurrentUser(),content:t})}))});else{const i=I.getChannelId(),l=x.getCurrentUser();return Y(i,Object.assign(K({channelId:i,content:t}),{author:l}))}}const{Pressable:q,View:J}=y.General,g=40,m=e.stylesheet.createThemedStyleSheet({androidRipple:{color:f.semanticColors.ANDROID_RIPPLE,cornerRadius:2147483647},actionButton:{borderRadius:2147483647,height:g,width:g,marginHorizontal:4,flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:f.semanticColors.BACKGROUND_SECONDARY_ALT,marginLeft:8,marginTop:-4},actionIcon:{tintColor:f.semanticColors.INTERACTIVE_NORMAL,width:g*.6,height:g*.6}});function Q(t){let{inputProps:i}=t;const[l,a]=e.React.useState("");b.push(T.after("onChangeText",i,function(d){let[h]=d;return a(h)},!0));const n=l.length>0,o=n?q:J;return e.React.createElement(U,{style:{flexDirection:"row",position:"absolute",left:0,top:-g,zIndex:3},duration:100,fade:n?"in":"out"},e.React.createElement(o,{android_ripple:m.androidRipple,disabled:!1,accessibilityRole:"button",accessibilityState:{disabled:!1,expanded:!1},accessibilityLabel:"Open markdown preview",accessibilityHint:"Open a modal which shows your message's markdown preview",onPress:n?function(){return _()}:void 0,style:m.actionButton},e.React.createElement(e.ReactNative.Image,{style:m.actionIcon,source:E.getAssetIDByName("ic_eye")})))}const{ChatInput:W}=r.findByProps("ChatInput"),b=[];function Z(){return b.push(T.after("render",W.prototype,function(t,i){const l=D.findInReactTree(i.props.children,function(n){return n?.type?.name==="ChatInput"})?.props;if(!l?.onChangeText)return;const a=D.findInReactTree(i.props.children,function(n){return n?.type?.displayName==="View"&&Array.isArray(n?.props?.children)})?.props?.children;a&&s.buttonType==="pill"&&a.unshift(React.createElement(Q,{inputProps:l}))})),b.push(T.before("render",e.ReactNative.Pressable.type,function(t){let[i]=t;i?.accessibilityLabel===e.i18n.Messages.SEND&&(i.onLongPress=function(){return s.buttonType==="send"&&_()})})),function(){return b.forEach(function(t){return t()})}}const ee=r.findByStoreName("ThemeStore"),te=r.findByProps("colors","meta");r.findByProps("triggerHaptic");const{TextStyleSheet:ne}=r.findByProps("TextStyleSheet"),{View:R,Text:M,Pressable:re}=y.General;r.findByProps("ActionSheet")?.ActionSheet??r.find(function(t){return t.render?.name==="ActionSheet"}),r.findByProps("openLazy","hideActionSheet"),r.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),r.findByProps("ActionSheetRow")?.ActionSheetRow,r.findByName("Navigator")??r.findByProps("Navigator")?.Navigator,r.findByProps("getRenderCloseButton")?.getRenderCloseButton??r.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,r.findByProps("popModal","pushModal"),r.findByProps("SvgXml");function ie(t){return te.meta.resolveSemanticColor(ee.theme,t)}function ae(t){let{title:i,onPress:l,icon:a}=t;const n=e.stylesheet.createThemedStyleSheet({androidRipple:{color:f.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:f.semanticColors.HEADER_SECONDARY,opacity:.5}}),o=l?re:R;return e.React.createElement(o,{android_ripple:n.androidRipple,disabled:!1,accessibilityRole:"button",onPress:l,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},a&&e.React.createElement(R,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:n.icon,source:a,resizeMode:"contain"})),e.React.createElement(L,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},i))}function le(t){let{title:i,onTitlePress:l,icon:a,children:n,padding:o}=t;const d=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:f.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(R,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(ae,{title:i,onPress:l,icon:a}),e.React.createElement(R,{style:d.main},o?e.React.createElement(R,{style:{paddingHorizontal:16,paddingVertical:16}},n):n))}var H;(function(t){function i(a){let{children:n,onPress:o}=a;return e.React.createElement(L,{variant:"text-md/bold",onPress:o},n)}t.Bold=i;function l(a){let{children:n,onPress:o}=a;return e.React.createElement(M,{style:{textDecorationLine:"underline"},onPress:o},n)}t.Underline=l})(H||(H={}));function L(t){let{variant:i,lineClamp:l,color:a,align:n,style:o,onPress:d,getChildren:h,children:p,liveUpdate:C}=t;const[N,c]=e.React.useReducer(function(v){return~v},0);return e.React.useEffect(function(){if(!C)return;const v=new Date().setMilliseconds(1e3);let S,B;return B=setTimeout(function(){c(),S=setInterval(c,1e3)},v-Date.now()),function(){clearTimeout(B),clearInterval(S)}},[]),e.React.createElement(M,{style:[i?ne[i]:{},a?{color:ie(f.semanticColors[a])}:{},n?{textAlign:n}:{},o??{}],numberOfLines:l,onPress:d},h?.()??p)}const{ScrollView:se}=y.General,{FormRow:u,FormRadioRow:P}=y.Forms;function oe(){var t,i;return(t=s).buttonType??(t.buttonType="pill"),(i=s).previewType??(i.previewType="popup"),G.useProxy(s),React.createElement(se,null,React.createElement(le,{title:"Settings",icon:E.getAssetIDByName("ic_cog")},React.createElement(u,{label:"Button type",leading:React.createElement(u.Icon,{source:E.getAssetIDByName("ic_message_edit")})}),React.createElement(P,{label:"Floating Pill",onPress:function(){return s.buttonType="pill"},trailing:React.createElement(u.Arrow,null),selected:s.buttonType==="pill",style:{marginHorizontal:12}}),React.createElement(P,{label:"Send button",subLabel:"Holding the send button",onPress:function(){return s.buttonType="send"},trailing:React.createElement(u.Arrow,null),selected:s.buttonType==="send",style:{marginHorizontal:12}}),React.createElement(u,{label:"Preview type",leading:React.createElement(u.Icon,{source:E.getAssetIDByName("ic_message_edit")})}),React.createElement(P,{label:"Popup",onPress:function(){return s.previewType="popup"},trailing:React.createElement(u.Arrow,null),selected:s.previewType==="popup",style:{marginHorizontal:12}}),React.createElement(P,{label:"Ephemeral message",onPress:function(){return s.previewType="clyde"},trailing:React.createElement(u.Arrow,null),selected:s.previewType==="clyde",style:{marginHorizontal:12}})))}const s=O.storage;let V;var ce={onLoad:function(){return V=Z()},onUnload:function(){return V?.()},settings:oe};return w.default=ce,w.vstorage=s,Object.defineProperty(w,"__esModule",{value:!0}),w})({},vendetta.plugin,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.ui.alerts,vendetta,vendetta.ui.toasts,vendetta.storage);
