(function(v,V,a,B,N,e,b,y,p,z,pe,fe,G){"use strict";const{Animated:A}=e.ReactNative;function U(n){let{duration:r,children:l,style:i,fade:t,trigger:o,customOpacity:d,setDisplay:h,animateOnInit:f}=n;f??=!0;const C=e.React.useRef(!0),D=e.React.useRef(!0),c=e.React.useRef(new A.Value(f&&t==="in"?1:0)).current,[E,T]=e.React.useState(!1);return e.React.useEffect(function(){const S=c.addListener(function(ue){let{value:de}=ue;T(de<=.1)});return function(){return c.removeListener(S)}},[]),e.React.useEffect(function(){if(!f&&C.current){C.current=!1;return}!f&&D.current&&(c.setValue(t==="in"?0:1),D.current=!1),A.timing(c,{toValue:d??(t==="in"?1:0),duration:r,useNativeDriver:!0}).start()},[c,t,d,o]),e.React.createElement(A.View,{style:[{opacity:c},h&&E&&{display:"none"},i]},l)}const{ScrollView:$}=y.General,{default:k}=a.findByProps("DCDAutoModerationSystemMessageView","default"),F=a.findByName("MessageRecord"),j=a.findByName("RowManager"),I=a.findByStoreName("SelectedChannelStore"),x=a.findByStoreName("UserStore"),{receiveMessage:Y}=a.findByProps("receiveMessage"),{createBotMessage:K}=a.findByProps("createBotMessage"),{getText:q}=a.findByProps("openSystemKeyboard","getText");function _(){const n=q(I.getChannelId());if(n.trim()!=="")if(s.previewType==="popup")z.showConfirmationAlert({title:"Message Preview",onConfirm:function(){},children:React.createElement($,{style:{marginVertical:12,maxHeight:e.ReactNative.Dimensions.get("window").height*.7}},React.createElement(k,{rowGenerator:new j,message:new F({id:"0",channel_id:I.getChannelId(),author:x.getCurrentUser(),content:n})}))});else{const r=I.getChannelId(),l=x.getCurrentUser();return Y(r,Object.assign(K({channelId:r,content:n}),{author:l}))}}const{Pressable:J,View:Q}=y.General,R=40,m=e.stylesheet.createThemedStyleSheet({androidRipple:{color:p.semanticColors.ANDROID_RIPPLE,cornerRadius:2147483647},actionButton:{borderRadius:2147483647,height:R,width:R,marginHorizontal:4,flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:p.semanticColors.BACKGROUND_SECONDARY_ALT,marginLeft:8,marginTop:-4},actionIcon:{tintColor:p.semanticColors.INTERACTIVE_NORMAL,width:R*.6,height:R*.6}});function W(n){let{inputProps:r}=n;const[l,i]=e.React.useState("");w.push(B.after("onChangeText",r,function(d){let[h]=d;return i(h)},!0));const t=l.length>0,o=t?J:Q;return e.React.createElement(U,{style:{flexDirection:"row",position:"absolute",left:0,top:-R,zIndex:3},duration:100,fade:t?"in":"out"},e.React.createElement(o,{android_ripple:m.androidRipple,disabled:!1,accessibilityRole:"button",accessibilityState:{disabled:!1,expanded:!1},accessibilityLabel:"Open markdown preview",accessibilityHint:"Open a modal which shows your message's markdown preview",onPress:t?function(){return _()}:void 0,style:m.actionButton},e.React.createElement(e.ReactNative.Image,{style:m.actionIcon,source:b.getAssetIDByName("ic_eye")})))}const{ChatInput:X}=a.findByProps("ChatInput"),w=[];function Z(){return w.push(B.after("render",X.prototype,function(n,r){const l=N.findInReactTree(r.props.children,function(t){return t?.type?.name==="ChatInput"})?.props;if(!l?.onChangeText)return;const i=N.findInReactTree(r.props.children,function(t){return t?.type?.displayName==="View"&&Array.isArray(t?.props?.children)})?.props?.children;i&&s.buttonType==="pill"&&i.unshift(React.createElement(W,{inputProps:l}))})),w.push(B.before("render",e.ReactNative.Pressable.type,function(n){let[r]=n;r?.accessibilityLabel===e.i18n.Messages.SEND&&(r.onLongPress=function(){return s.buttonType==="send"&&_()})})),function(){return w.forEach(function(n){return n()})}}const ee=a.findByStoreName("ThemeStore"),te=a.findByProps("colors","meta");a.findByProps("triggerHaptic");const{TextStyleSheet:ne}=a.findByProps("TextStyleSheet"),{View:g,Text:L,Pressable:re}=y.General;a.findByProps("ActionSheet")?.ActionSheet??a.find(function(n){return n.render?.name==="ActionSheet"}),a.findByProps("openLazy","hideActionSheet"),a.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),a.findByName("Navigator"),a.findByProps("getRenderCloseButton"),a.findByProps("popModal","pushModal");function ae(n){return te.meta.resolveSemanticColor(ee.theme,n)}function ie(n){let{title:r,onPress:l,icon:i}=n;const t=e.stylesheet.createThemedStyleSheet({androidRipple:{color:p.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:p.semanticColors.HEADER_SECONDARY,opacity:.5}}),o=l?re:g;return e.React.createElement(o,{android_ripple:t.androidRipple,disabled:!1,accessibilityRole:"button",onPress:l,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&e.React.createElement(g,{style:{marginRight:4}},e.React.createElement(e.ReactNative.Image,{style:t.icon,source:i,resizeMode:"contain"})),e.React.createElement(H,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},r))}function le(n){let{title:r,onTitlePress:l,icon:i,children:t,padding:o}=n;const d=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:p.semanticColors.BACKGROUND_TERTIARY,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(g,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(ie,{title:r,onPress:l,icon:i}),e.React.createElement(g,{style:d.main},o?e.React.createElement(g,{style:{paddingHorizontal:16,paddingVertical:16}},t):t))}var M;(function(n){function r(i){let{children:t,onPress:o}=i;return e.React.createElement(H,{variant:"text-md/bold",onPress:o},t)}n.Bold=r;function l(i){let{children:t,onPress:o}=i;return e.React.createElement(L,{style:{textDecorationLine:"underline"},onPress:o},t)}n.Underline=l})(M||(M={}));function H(n){let{variant:r,lineClamp:l,color:i,align:t,style:o,onPress:d,getChildren:h,children:f,liveUpdate:C}=n;const[D,c]=e.React.useReducer(function(E){return~E},0);return e.React.useEffect(function(){if(!C)return;const E=new Date().setMilliseconds(1e3);let T,S;return S=setTimeout(function(){c(),T=setInterval(c,1e3)},E-Date.now()),function(){clearTimeout(S),clearInterval(T)}},[]),e.React.createElement(L,{style:[r?ne[r]:{},i?{color:ae(p.semanticColors[i])}:{},t?{textAlign:t}:{},o??{}],numberOfLines:l,onPress:d},h?.()??f)}const{ScrollView:se}=y.General,{FormRow:u,FormRadioRow:P}=y.Forms;function oe(){return s.buttonType??="pill",s.previewType??="popup",G.useProxy(s),React.createElement(se,null,React.createElement(le,{title:"Settings",icon:b.getAssetIDByName("ic_cog")},React.createElement(u,{label:"Button type",leading:React.createElement(u.Icon,{source:b.getAssetIDByName("ic_message_edit")})}),React.createElement(P,{label:"Floating Pill",onPress:function(){return s.buttonType="pill"},trailing:React.createElement(u.Arrow,null),selected:s.buttonType==="pill",style:{marginHorizontal:12}}),React.createElement(P,{label:"Send button",subLabel:"Holding the send button",onPress:function(){return s.buttonType="send"},trailing:React.createElement(u.Arrow,null),selected:s.buttonType==="send",style:{marginHorizontal:12}}),React.createElement(u,{label:"Preview type",leading:React.createElement(u.Icon,{source:b.getAssetIDByName("ic_message_edit")})}),React.createElement(P,{label:"Popup",onPress:function(){return s.previewType="popup"},trailing:React.createElement(u.Arrow,null),selected:s.previewType==="popup",style:{marginHorizontal:12}}),React.createElement(P,{label:"Ephemeral message",onPress:function(){return s.previewType="clyde"},trailing:React.createElement(u.Arrow,null),selected:s.previewType==="clyde",style:{marginHorizontal:12}})))}const s=V.storage;let O;var ce={onLoad:function(){return O=Z()},onUnload:function(){return O?.()},settings:oe};return v.default=ce,v.vstorage=s,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.plugin,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.ui.alerts,vendetta,vendetta.ui.toasts,vendetta.storage);
