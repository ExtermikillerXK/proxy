(function(a,c,y,b,p,u,i){"use strict";const d=u.findByProps("getUserAvatarURL","getUserAvatarSource"),P=u.findByProps("getBadgeAsset"),A=u.findByStoreName("UserProfileStore"),S=u.findByStoreName("UserStore");let s;const f=async function(){try{s=await(await y.safeFetch(l,{cache:"no-store"})).json()}catch(t){c.logger.error(`Failed to fetch avatars!
${t.stack}`)}};async function w(){const t=new Array;if(await f(),!s||!a.enabled)return function(){};const m=setInterval(function(){return f()},1e3*60*60);t.push(function(){return clearInterval(m)}),t.push(i.after("getUserAvatarURL",d,function(e){let[{id:n}]=e;return s.avatars[n]})),t.push(i.after("getUserAvatarSource",d,function(e,n){let[{id:r}]=e;return s.avatars[r]?{uri:s.avatars[r]}:n}));const v=Symbol("empty"),o="usrpfp-";return t.push(i.after("getUserProfile",A,function(e,n){let[r]=e;const h=S.getUser(r)?.username,U=s.badges[r]??s.badges[h];return n&&{...n,badges:[U?{id:"usrpfp-custom",description:`${h}'s custom USRPFP badge`,icon:o+U}:v,...n.badges].filter(function(L){return L!==v})}})),t.push(i.after("getBadgeAsset",P,function(e,n){let[r]=e;return r.startsWith(o)?r.slice(o.length):n})),function(){return t.forEach(function(e){return e()})}}const l="https://userpfp.github.io/UserPFP/source/data.json";a.enabled=!1;let g;var B={onLoad:async function(){a.enabled=!0;try{g=await w()}catch(t){c.logger.error(`Errored while patching!
${t.stack}`),b.stopPlugin(p.id)}},onUnload:function(){a.enabled=!1,g?.()}};return a.dataURL=l,a.default=B,Object.defineProperty(a,"__esModule",{value:!0}),a})({},vendetta,vendetta.utils,vendetta.plugins,vendetta.plugin,vendetta.metro,vendetta.patcher);
