(function(e,h,w,P,R,d,c){"use strict";const v=d.findByProps("getUserAvatarURL","getUserAvatarSource"),L=d.findByProps("getBadgeAsset"),A=d.findByStoreName("UserProfileStore"),U=d.findByStoreName("UserStore");let s;const p=async function(){try{s=await(await w.safeFetch(`${m}?_=${e.hash}`,{cache:"no-store"})).json()}catch(t){h.logger.error(`Failed to fetch avatars!
${t.stack}`)}},y=function(t,f){if(!s.avatars[t])return;const o=new URL(f?l(s.avatars[t]):s.avatars[t]);return o.searchParams.append("_",e.hash),o.toString()},$=function(t,f){const o=s.badges[t]??s.badges[f];if(!o)return;const u=new URL(o);return u.searchParams.append("_",e.hash),u.toString()},g=function(t){return new URL(t).pathname.split(".").slice(-1)[0]};async function B(){const t=new Array;if(await p(),!s||!e.enabled)return function(){};const f=setInterval(function(){return p()},1e3*60*60);t.push(function(){return clearInterval(f)}),t.push(c.after("getUser",U,function(i,r){let[a]=i;if((s.avatars[a]&&g(s.avatars[a]))==="gif"&&r){const n=r.avatar??"0";r.avatar=n.startsWith("a_")?n:`a_${n}`}})),t.push(c.after("getUserAvatarURL",v,function(i){let[{id:r},a]=i;const n=y(r,!a);if(n)return g(n)==="gif"?a?n:l(n):n})),t.push(c.after("getUserAvatarSource",v,function(i){let[{id:r},a]=i;const n=y(r,!a);if(n)return g(n)==="gif"?a?{uri:n}:{uri:l(n)}:n}));const o=Symbol("empty"),u="usrpfp-";return t.push(c.after("getUserProfile",A,function(i,r){let[a]=i;const n=U.getUser(a)?.username,b=$(a,n);return r&&{...r,badges:[b?{id:"usrpfp-custom",description:`${n}'s custom USRPFP badge`,icon:u+b}:o,...r.badges].filter(function(j){return j!==o})}})),t.push(c.after("getBadgeAsset",L,function(i,r){let[a]=i;return a.startsWith(u)?a.slice(u.length):r})),function(){return t.forEach(function(i){return i()})}}const m="https://userpfp.github.io/UserPFP/source/data.json",l=function(t){return`https://static-gif.nexpid.workers.dev/convert.gif?url=${encodeURIComponent(t)}`};e.enabled=!1,e.hash=void 0;let S;var _={onLoad:async function(){e.hash=Array.from(crypto.getRandomValues(new Uint8Array(20))).map(function(t){return t.toString(16).padStart(2,"0")}).join(""),e.enabled=!0;try{S=await B()}catch(t){h.logger.error(`Errored while patching!
${t.stack}`),P.stopPlugin(R.id)}},onUnload:function(){e.enabled=!1,S?.()}};return e.dataURL=m,e.default=_,e.staticGifURL=l,Object.defineProperty(e,"__esModule",{value:!0}),e})({},vendetta,vendetta.utils,vendetta.plugins,vendetta.plugin,vendetta.metro,vendetta.patcher);
