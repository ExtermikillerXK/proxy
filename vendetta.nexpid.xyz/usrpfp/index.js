(function(a,c,U,y,p,u,o){"use strict";const d=u.findByProps("getUserAvatarURL","getUserAvatarSource"),P=u.findByProps("getBadgeAsset"),S=u.findByStoreName("UserProfileStore"),A=u.findByStoreName("UserStore");let s;const f=async function(){try{s=await(await U.safeFetch(l,{cache:"no-store"})).json()}catch(t){c.logger.error(`Failed to fetch avatars!
${t.stack}`)}};async function m(){const t=new Array;if(await f(),!s||!a.enabled)return function(){};const R=setInterval(function(){return f()},1e3*60*60);t.push(function(){return clearInterval(R)}),t.push(o.after("getUserAvatarURL",d,function(e){let[{id:n}]=e;return s.avatars[n]})),t.push(o.after("getUserAvatarSource",d,function(e,n){let[{id:r}]=e;return s.avatars[r]?{uri:s.avatars[r]}:n}));const v=Symbol("empty"),i="usrpfp-";return t.push(o.after("getUserProfile",S,function(e,n){let[r]=e;const b=A.getUser(r)?.username,h=s.badges[r]??s.badges[b];return n&&{...n,badges:[h?{id:"usrpfp-custom",description:`${b}'s custom USRPFP badge`,icon:i+h}:v,...n.badges].filter(function(B){return B!==v})}})),t.push(o.after("getBadgeAsset",P,function(e,n){let[r]=e;return r.startsWith(i)?r.slice(i.length):n})),function(){return t.forEach(function(e){return e()})}}const l="https://raw.githubusercontent.com/Yeetov/USRPFP-Reborn/main/db/data.json";a.enabled=!1;let g;var w={onLoad:async function(){a.enabled=!0;try{g=await m()}catch(t){c.logger.error(`Errored while patching!
${t.stack}`),y.stopPlugin(p.id)}},onUnload:function(){a.enabled=!1,g?.()}};return a.dataURL=l,a.default=w,Object.defineProperty(a,"__esModule",{value:!0}),a})({},vendetta,vendetta.utils,vendetta.plugins,vendetta.plugin,vendetta.metro,vendetta.patcher);
