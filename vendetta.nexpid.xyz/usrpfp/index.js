(function(i,l,P,R,m,c,u){"use strict";const g=c.findByProps("getUserAvatarURL","getUserAvatarSource"),w=c.findByProps("getBadgeAsset"),A=c.findByStoreName("UserProfileStore"),v=c.findByStoreName("UserStore");let s;const U=async function(){try{s=await(await P.safeFetch(h,{cache:"no-store"})).json()}catch(e){l.logger.error(`Failed to fetch avatars!
${e.stack}`)}},o=function(e){return new URL(e).pathname.split(".").slice(-1)[0]};async function L(){const e=new Array;if(await U(),!s||!i.enabled)return function(){};const B=setInterval(function(){return U()},1e3*60*60);e.push(function(){return clearInterval(B)}),e.push(u.after("getUser",v,function(a,n){let[r]=a;if((s.avatars[r]&&o(s.avatars[r]))==="gif"&&n){const t=n.avatar??"0";n.avatar=t.startsWith("a_")?t:`a_${t}`}})),e.push(u.after("getUserAvatarURL",g,function(a,n){let[{id:r}]=a;const t=s.avatars[r];return t?o(t)==="gif"?o(n)==="gif"?t:f(t):t:void 0})),e.push(u.after("getUserAvatarSource",g,function(a,n){let[{id:r}]=a;const t=s.avatars[r];return t?o(t)==="gif"?!n?.uri||o(n.uri)==="gif"?{uri:t}:{uri:f(t)}:t:void 0}));const y=Symbol("empty"),d="usrpfp-";return e.push(u.after("getUserProfile",A,function(a,n){let[r]=a;const t=v.getUser(r)?.username,b=s.badges[r]??s.badges[t];return n&&{...n,badges:[b?{id:"usrpfp-custom",description:`${t}'s custom USRPFP badge`,icon:d+b}:y,...n.badges].filter(function($){return $!==y})}})),e.push(u.after("getBadgeAsset",w,function(a,n){let[r]=a;return r.startsWith(d)?r.slice(d.length):n})),function(){return e.forEach(function(a){return a()})}}const h="https://userpfp.github.io/UserPFP/source/data.json",f=function(e){return`https://static-gif.nexpid.workers.dev/convert.gif?url=${encodeURIComponent(e)}`};i.enabled=!1;let p;var S={onLoad:async function(){i.enabled=!0;try{p=await L()}catch(e){l.logger.error(`Errored while patching!
${e.stack}`),R.stopPlugin(m.id)}},onUnload:function(){i.enabled=!1,p?.()}};return i.dataURL=h,i.default=S,i.staticGifURL=f,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta,vendetta.utils,vendetta.plugins,vendetta.plugin,vendetta.metro,vendetta.patcher);
