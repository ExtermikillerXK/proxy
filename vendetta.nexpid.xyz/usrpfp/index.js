(function(n,f,R,p,L,d,u){"use strict";const h=d.findByProps("getUserAvatarURL","getUserAvatarSource"),m=d.findByStoreName("UserStore");let r;const l=async function(){try{r=await(await R.safeFetch(`${U}?_=${n.hash}`,{cache:"no-store"})).json()}catch(t){f.logger.error(`Failed to fetch avatars!
${t.stack}`)}},v=function(t,o){if(!r.avatars[t])return;const a=r.avatars[t];if(o&&g(a)==="gif")return y(a);const e=new URL(a);return e.searchParams.append("_",n.hash),e.toString()},g=function(t){return new URL(t).pathname.split(".").slice(-1)[0]};async function A(){const t=new Array;if(await l(),!r||!n.enabled)return function(){};const o=setInterval(function(){return l()},1e3*60*60);return t.push(function(){return clearInterval(o)}),t.push(u.after("getUser",m,function(a,e){let[i]=a;if((r.avatars[i]&&g(r.avatars[i]))==="gif"&&e){const c=e.avatar??"0";e.avatar=c.startsWith("a_")?c:`a_${c}`}})),t.push(u.after("getUserAvatarURL",h,function(a){let[{id:e},i]=a;return v(e,!i)})),t.push(u.after("getUserAvatarSource",h,function(a,e){let[{id:i},c]=a;const s=v(i,!c);if(s)return s?{uri:s}:e})),function(){return t.forEach(function(a){return a()})}}const U="https://userpfp.github.io/UserPFP/source/data.json",y=function(t){return`https://static-gif.nexpid.workers.dev/convert.gif?url=${encodeURIComponent(t)}&_=${n.hash}`};n.enabled=!1,n.hash=void 0;let w;var S={onLoad:async function(){n.hash=Array.from(crypto.getRandomValues(new Uint8Array(20))).map(function(t){return t.toString(16).padStart(2,"0")}).join(""),n.enabled=!0;try{w=await A()}catch(t){f.logger.error(`Errored while patching!
${t.stack}`),p.stopPlugin(L.id)}},onUnload:function(){n.enabled=!1,w?.()}};return n.dataURL=U,n.default=S,n.staticGifURL=y,Object.defineProperty(n,"__esModule",{value:!0}),n})({},vendetta,vendetta.utils,vendetta.plugins,vendetta.plugin,vendetta.metro,vendetta.patcher);
