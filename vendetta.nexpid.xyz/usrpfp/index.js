(function(e,g,P,R,S,l,f){"use strict";const h=l.findByProps("getUserAvatarURL","getUserAvatarSource"),L=l.findByProps("getBadgeAsset"),A=l.findByStoreName("UserProfileStore"),v=l.findByStoreName("UserStore");let u;const U=async function(){try{u=await(await P.safeFetch(`${b}?_=${e.hash}`,{cache:"no-store"})).json()}catch(t){g.logger.error(`Failed to fetch avatars!
${t.stack}`)}},p=function(t,d){if(!u.avatars[t])return;const s=u.avatars[t];if(d&&y(s)==="gif")return m(s);const i=new URL(s);return i.searchParams.append("_",e.hash),i.toString()},$=function(t,d){const s=u.badges[t]??u.badges[d];if(!s)return;const i=new URL(s);return i.searchParams.append("_",e.hash),i.toString()},y=function(t){return new URL(t).pathname.split(".").slice(-1)[0]};async function _(){const t=new Array;if(await U(),!u||!e.enabled)return function(){};const d=setInterval(function(){return U()},1e3*60*60);t.push(function(){return clearInterval(d)}),t.push(f.after("getUser",v,function(r,n){let[a]=r;if((u.avatars[a]&&y(u.avatars[a]))==="gif"&&n){const o=n.avatar??"0";n.avatar=o.startsWith("a_")?o:`a_${o}`}})),t.push(f.after("getUserAvatarURL",h,function(r){let[{id:n},a]=r;return p(n,!a)})),t.push(f.after("getUserAvatarSource",h,function(r,n){let[{id:a},o]=r;const c=p(a,!o);if(c)return c?{uri:c}:n}));const s=Symbol("empty"),i="usrpfp-";return t.push(f.after("getUserProfile",A,function(r,n){let[a]=r;const o=v.getUser(a)?.username,c=$(a,o);return n&&{...n,badges:[c?{id:"usrpfp-custom",description:`${o}'s custom USRPFP badge`,icon:i+c}:s,...n.badges].filter(function(j){return j!==s})}})),t.push(f.after("getBadgeAsset",L,function(r,n){let[a]=r;return a.startsWith(i)?a.slice(i.length):n})),function(){return t.forEach(function(r){return r()})}}const b="https://userpfp.github.io/UserPFP/source/data.json",m=function(t){return`https://static-gif.nexpid.workers.dev/convert.gif?url=${encodeURIComponent(t)}&_=${e.hash}`};e.enabled=!1,e.hash=void 0;let w;var B={onLoad:async function(){e.hash=Array.from(crypto.getRandomValues(new Uint8Array(20))).map(function(t){return t.toString(16).padStart(2,"0")}).join(""),e.enabled=!0;try{w=await _()}catch(t){g.logger.error(`Errored while patching!
${t.stack}`),R.stopPlugin(S.id)}},onUnload:function(){e.enabled=!1,w?.()}};return e.dataURL=b,e.default=B,e.staticGifURL=m,Object.defineProperty(e,"__esModule",{value:!0}),e})({},vendetta,vendetta.utils,vendetta.plugins,vendetta.plugin,vendetta.metro,vendetta.patcher);
