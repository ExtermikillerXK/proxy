(function(E,C,l,c,p,d,f,h,B){"use strict";const{Permissions:N}=c.constants,{computePermissions:S}=l.findByProps("computePermissions","canEveryoneRole"),_=l.findByStoreName("GuildMemberStore"),y=[c.i18n.Messages.AI_TAG,c.i18n.Messages.BOT_TAG_SERVER,c.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,c.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,c.i18n.Messages.REMIXING_TAG],G=[{text:"WEBHOOK",condition:function(o,e,r){return r.isNonUserBot()}},{text:"OWNER",backgroundColor:d.rawColors.ORANGE_345,condition:function(o,e,r){return o?.ownerId===r.id}},{text:c.i18n.Messages.BOT_TAG_BOT,condition:function(o,e,r){return r.bot},verified:function(o,e,r){return r.verified}},{text:"ADMIN",backgroundColor:d.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:d.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:d.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function b(o,e,r){let a;if(o){const n=S({user:r,context:o,overwrites:e?.permissionOverwrites});a=Object.entries(N).map(function(t){let[i,s]=t;return n&s?i:""}).filter(Boolean)}for(const n of G)if(n.condition?.(o,e,r)||n.permissions?.some(function(t){return a?.includes(t)})){let t=C.storage.useRoleColor?_.getMember(o.id,r.id)?.colorString:void 0,i=t||(n.backgroundColor??d.rawColors.BRAND_500),s=t||!n.textColor?c.chroma(i).get("lab.l")<70?d.rawColors.WHITE_500:d.rawColors.BLACK_500:n.textColor;return{...n,textColor:s,backgroundColor:i,verified:typeof n.verified=="function"?n.verified(o,e,r):n.verified,condition:void 0,permissions:void 0}}}const A=l.findByName("getTagProperties",!1),M=l.findByStoreName("GuildStore"),I=l.findByStoreName("ChannelStore");function k(){return p.after("default",A,function(o,e){let[{message:r}]=o;if(!y.includes(e.tagText)){const a=I.getChannel(r.channel_id),n=M.getGuild(a?.guild_id),t=b(n,a,r.author);if(t)return{...e,tagText:t.text,tagTextColor:t.textColor?c.ReactNative.processColor(c.chroma(t.textColor).hex()):void 0,tagBackgroundColor:t.backgroundColor?c.ReactNative.processColor(c.chroma(t.backgroundColor).hex()):void 0,tagVerified:t.verified,tagType:void 0}}})}const R=l.findByProps("getBotLabel"),w=R.getBotLabel,O=l.findByStoreName("GuildStore"),m=function(o,e){let[{guildId:r,user:a}]=o;console.log(e);const n=f.findInReactTree(e.props.label,function(t){return t.type.Types});if(!n||!y.includes(w(n.props.type))){const t=O.getGuild(r),i=b(t,void 0,a);if(i)if(n)n.props.text=i.text,n.props.textColor=i.textColor,n.props.backgroundColor=i.backgroundColor;else{const s=f.findInReactTree(e.props.label,function(x){return x.props?.lineClamp}).props.children;s.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(R.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))}}};function L(){const o=[];return l.findByTypeNameAll("UserRow").forEach(function(e){return o.push(p.after("type",e,m))}),function(){return o.forEach(function(e){return e()})}}const D=l.findByName("DisplayName",!1),$=l.findByName("HeaderName",!1),v=l.findByProps("getBotLabel"),P=v.getBotLabel,U=l.findByStoreName("GuildStore"),H=l.findByStoreName("ChannelStore");function K(){const o=[];return o.push(p.after("default",$,function(e,r){let[{channelId:a}]=e;r.props.channelId=a})),o.push(p.after("default",D,function(e,r){let[{guildId:a,channelId:n,user:t}]=e;const i=f.findInReactTree(r,function(s){return s.type.Types});if(!i||!y.includes(P(i.props.type))){const s=U.getGuild(a),x=H.getChannel(n),u=b(s,x,t);u&&(i?(i.props.text=u.text,i.props.textColor=u.textColor,i.props.backgroundColor=u.backgroundColor):f.findInReactTree(r,function(ee){return ee.props.style.flexDirection==="row"}).props.children.push(React.createElement(v.default,{style:{marginLeft:0},type:0,text:u.text,textColor:u.textColor,backgroundColor:u.backgroundColor,verified:u.verified})))}})),function(){return o.forEach(function(e){return e()})}}const F=l.findByProps("GuildMemberRow"),T=l.findByProps("getBotLabel"),V=T.getBotLabel,W=l.findByStoreName("GuildStore");function j(){return p.after("type",F.GuildMemberRow,function(o,e){let[{guildId:r,channel:a,user:n}]=o;const t=f.findInReactTree(e,function(i){return i.type.Types});if(!t||!y.includes(V(t.props.type))){const i=W.getGuild(r),s=b(i,a,n);s&&(t?(t.props.text=s.text,t.props.textColor=s.textColor,t.props.backgroundColor=s.backgroundColor):f.findInReactTree(e,function(x){return x.props.style.flexDirection==="row"}).props.children.splice(2,0,React.createElement(T.default,{type:0,text:s.text,textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified})))}})}const X=l.findByProps("getBotLabel");function Y(){return p.after("default",X,function(o,e){let[{text:r,textColor:a,backgroundColor:n}]=o;const t=f.findInReactTree(e,function(i){return typeof i.props.children=="string"});r&&(t.props.children=r),a&&t.props.style.push({color:a}),n&&e.props.style.push({backgroundColor:n})})}const{ScrollView:q}=B.General,{FormSection:z,FormSwitchRow:J}=B.Forms;function Q(){return h.useProxy(C.storage),React.createElement(q,{style:{flex:1}},React.createElement(z,{title:"Tag style"},React.createElement(J,{label:"Use top role color for tag backgrounds",value:C.storage.useRoleColor,onValueChange:function(o){C.storage.useRoleColor=o}})))}let g=[];var Z={onLoad:function(){C.storage.useRoleColor??=!1,g.push(k()),g.push(Y()),g.push(K()),g.push(j()),g.push(L())},onUnload:function(){return g.forEach(function(o){return o()})},settings:Q};return E.default=Z,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
